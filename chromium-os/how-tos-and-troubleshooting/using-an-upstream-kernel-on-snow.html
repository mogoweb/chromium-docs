<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/WebPage">
<head>
<meta http-equiv="X-UA-Compatible" content="chrome=1" />
<script type="text/javascript">/* Copyright 2008 Google. */ (function() { var e="wtsrt_",g="tbsd_",h="tbnd_",k="start",l="_wtsrt",m="_tbnd",n="CSI/";(function(){function f(a){this.t={};this.tick=function(a,c,b){this.t[a]=[void 0!=b?b:(new Date).getTime(),c];if(void 0==b)try{window.console.timeStamp(n+a)}catch(d){}};this.tick(k,null,a)}var a;window.performance&&(a=window.performance.timing);var p=a?new f(a.responseStart):new f;window.jstiming={Timer:f,load:p};if(a){var c=a.navigationStart,d=a.responseStart;0<c&&d>=c&&(window.jstiming.srt=d-c)}if(a){var b=window.jstiming.load;0<c&&d>=c&&(b.tick(l,void 0,c),b.tick(e,l,d),b.tick(g,e))}try{a=null,
window.chrome&&window.chrome.csi&&(a=Math.floor(window.chrome.csi().pageT),b&&0<c&&(b.tick(m,void 0,window.chrome.csi().startE),b.tick(h,m,c))),null==a&&window.gtbExternal&&(a=window.gtbExternal.pageT()),null==a&&window.external&&(a=window.external.pageT,b&&0<c&&(b.tick(m,void 0,window.external.startE),b.tick(h,m,c))),a&&(window.jstiming.pt=a)}catch(q){}})(); })()
</script>
<link rel="shortcut icon" href="../../_/rsrc/1354323194313/favicon.ico" type="image/x-icon" />
<link rel="apple-touch-icon" href="https://ssl.gstatic.com/sites/p/56e332/system/app/images/apple-touch-icon.png" type="image/png" />
<script type="text/javascript">/* Copyright 2008 Google. */ (function() { var d="",g="__duration__",h="function";function k(c){return document.getElementById(c)}window.byId=k;function l(c){return c.replace(/^\s+|\s+$/g,d)}window.trim=l;var m=[],n=0;window.JOT_addListener=function(c,a,b){var e=new String(n++);c={eventName:c,handler:a,compId:b,key:e};m.push(c);return e};window.JOT_removeListenerByKey=function(c){for(var a=0;a<m.length;a++)if(m[a].key==c){m.splice(a,1);break}};
window.JOT_removeAllListenersForName=function(c){for(var a=0;a<m.length;a++)m[a].eventName==c&&m.splice(a,1)};window.JOT_postEvent=function(c,a,b){var e={eventName:c,eventSrc:a||{},payload:b||{}};if(window.JOT_fullyLoaded)for(a=m.length,b=0;b<a&&b<m.length;b++){var f=m[b];f&&f.eventName==c&&(e.listenerCompId=f.compId||d,(f=typeof f.handler==h?f.handler:window[f.handler])&&f(e))}else window.JOT_delayedEvents.push({eventName:c,eventSrc:a,payload:b})};window.JOT_delayedEvents=[];
window.JOT_fullyLoaded=!1;window.JOT_formatRelativeToNow=function(c,a){var b=((new Date).getTime()-c)/6E4;if(1440<=b||0>b)return null;var e=0;60<=b&&(b/=60,e=2);2<=b&&e++;return a?window.JOT_siteRelTimeStrs[e].replace(g,Math.floor(b)):window.JOT_userRelTimeStrs[e].replace(g,Math.floor(b))}; })()
</script>
<script>

  

  var breadcrumbs = [{"path":"/chromium-os","deleted":false,"title":"Chromium OS","dir":"ltr"},{"path":"/chromium-os/how-tos-and-troubleshooting","deleted":false,"title":"How Tos and Troubleshooting","dir":"ltr"},{"path":"/chromium-os/how-tos-and-troubleshooting/using-an-upstream-kernel-on-snow","deleted":false,"title":"Using an Upstream Kernel on Chrome OS","dir":"ltr"}];
  var JOT_clearDotPath = 'https://ssl.gstatic.com/sites/p/56e332/system/app/images/cleardot.gif';

  
  var JOT_userRelTimeStrs = ["a minute ago","__duration__ minutes ago","an hour ago","__duration__ hours ago"];

  
  

  

  var webspace = {"enableAnalytics":true,"pageSharingId":"jotspot_page","enableUniversalAnalytics":false,"sharingPolicy":"OPENED_WITH_INDICATOR","siteTitle":"The Chromium Projects","isStartPageEnabled":true,"adsensePublisherId":null,"features":{"languageSelectDefaultTextSetToDefault":true,"validateClientGvizDataSourceUrls":true,"moreMobileStyleImprovements":true,"newInsertMenuIcons":true,"accessibleSortingButtons":true,"domainAnalyticsInGAOnly":true,"noCaptcha":true,"fileCabinetScreenReaderFix":true,"updatedTosAndPrivacyLinks":null,"pageDrafts":false,"mobileOrientationFix":true,"plusBadge":false,"pdfEmbedSupport":false,"jsClickFix":true},"isPublic":true,"isConsumer":false,"serverFlags":{"cajaBaseUrl":"//www.gstatic.com/caja","cajaDebugMode":false},"onepickBaseUrl":"https://docs.google.com","domainAnalyticsAccountId":"","plusPageId":"","signInUrl":"https://www.google.com/a/SelectSession?continue\u003dhttps://sites.google.com/a/chromium.org/dev/chromium-os/how-tos-and-troubleshooting/using-an-upstream-kernel-on-snow\u0026service\u003djotspot","analyticsAccountId":"UA-5484340-1","scottyUrl":"/_/upload","homePath":"/","siteNoticeUrlEnabled":null,"plusPageUrl":"","adsensePromoClickedOrSiteIneligible":true,"csiReportUri":"https://gg.google.com/csi","sharingId":"jotspot","termsUrl":"//www.google.com/intl/en/policies/terms/","gvizVersion":1,"editorResources":{"sitelayout":["https://ssl.gstatic.com/sites/p/56e332/system/app/css/sitelayouteditor.css"],"text":["https://ssl.gstatic.com/sites/p/56e332/system/js/codemirror.js","https://ssl.gstatic.com/sites/p/56e332/system/app/css/codemirror_css.css","https://ssl.gstatic.com/sites/p/56e332/system/js/trog_edit__en.js","https://ssl.gstatic.com/sites/p/56e332/system/app/css/trogedit.css","/_/rsrc/1441580320000/system/app/css/editor.css","https://ssl.gstatic.com/sites/p/56e332/system/app/css/codeeditor.css","/_/rsrc/1441580320000/system/app/css/camelot/editor-jfk-wlb.css"]},"sharingUrlPrefix":"/_/sharing","isAdsenseEnabled":true,"domain":"chromium.org","baseUri":"","name":"dev","siteTemplateId":false,"siteNoticeRevision":null,"siteNoticeUrlAddress":null,"siteNoticeMessage":null,"page":{"isRtlLocale":false,"canDeleteWebspace":null,"isPageDraft":null,"parentPath":"/chromium-os/how-tos-and-troubleshooting","parentWuid":"wuid:gx:72ecb36fa9c83ecd","siteLocale":"en","timeZone":"America/Los_Angeles","type":"text","title":"Using an Upstream Kernel on Chrome OS","locale":"en","wuid":"wuid:gx:795e3ebee8420182","revision":24,"path":"/chromium-os/how-tos-and-troubleshooting/using-an-upstream-kernel-on-snow","isSiteRtlLocale":false,"pageInheritsPermissions":null,"name":"using-an-upstream-kernel-on-snow","canChangePath":true,"state":"","properties":{},"bidiEnabled":false,"currentTemplate":{"path":"/config/pagetemplates/devguidepage","title":"DevGuidePage"}},"canPublishScriptToAnyone":true,"user":{"keyboardShortcuts":true,"sessionIndex":"","guest_":true,"displayNameOrEmail":"guest","userName":"guest","uid":"","renderMobile":false,"domain":"","namespace":"","hasWriteAccess":false,"namespaceUser":false,"primaryEmail":"guest","hasAdminAccess":false},"gadgets":{"baseUri":"/system/app/pages/gadgets"}};
  webspace.page.breadcrumbs = breadcrumbs;

  
  var JOT_siteRelTimeStrs = ["a minute ago","__duration__ minutes ago","an hour ago","__duration__ hours ago"];

</script>
<script type="text/javascript">
                window.jstiming.load.tick('scl');
              </script>
<meta name="title" content="Using an Upstream Kernel on Chrome OS - The Chromium Projects" />
<meta itemprop="name" content="Using an Upstream Kernel on Chrome OS - The Chromium Projects" />
<meta property="og:title" content="Using an Upstream Kernel on Chrome OS - The Chromium Projects" />
<meta name="description" content="Home of the Chromium Open Source Project" />
<meta itemprop="description" content="Home of the Chromium Open Source Project" />
<meta id="meta-tag-description" property="og:description" content="Home of the Chromium Open Source Project" />
<style type="text/css">
</style>
<link rel="stylesheet" type="text/css" href="https://ssl.gstatic.com/sites/p/56e332/system/app/themes/beigeandblue/standard-css-beigeandblue-ltr-ltr.css" />
<link rel="stylesheet" type="text/css" href="../../_/rsrc/1441580320000/system/app/css/overlay.css%3Fcb=beigeandblueundefineda100%2525%2525150goog-ws-leftthemedefaultstandard.css" />
<link rel="stylesheet" type="text/css" href="../../_/rsrc/1441580320000/system/app/css/camelot/allthemes-view.css" />
<!--[if IE]>
          <link rel="stylesheet" type="text/css" href="/system/app/css/camelot/allthemes%2die.css" />
        <![endif]-->
<title>Using an Upstream Kernel on Chrome OS - The Chromium Projects</title>
<meta itemprop="image" content="/_/rsrc/1438879449147/config/customLogo.gif?revision=3" />
<meta property="og:image" content="/_/rsrc/1438879449147/config/customLogo.gif?revision=3" />
<script type="text/javascript">
                window.jstiming.load.tick('cl');
              </script>
</head>
<body xmlns="http://www.google.com/ns/jotspot" id="body" class=" en            ">
<div id="sites-page-toolbar" class="sites-header-divider">
<div xmlns="http://www.w3.org/1999/xhtml" id="sites-status" class="sites-status" style="display:none;"><div id="sites-notice" class="sites-notice" role="status" aria-live="assertive"> </div></div>
</div>
<div id="sites-chrome-everything-scrollbar">
<div id="sites-chrome-everything" class="">
<div id="sites-chrome-page-wrapper" style="direction: ltr">
<div id="sites-chrome-page-wrapper-inside">
<div xmlns="http://www.w3.org/1999/xhtml" id="sites-chrome-header-wrapper" style="height:auto;">
<table id="sites-chrome-header" class="sites-layout-hbox" cellspacing="0" style="height:auto;">
<tr class="sites-header-primary-row" id="sites-chrome-userheader">
<td id="sites-header-title" class="" role="banner"><div class="sites-header-cell-buffer-wrapper"><a href="../../index.html" id="sites-chrome-userheader-logo"><img id="logo-img-id" src="../../_/rsrc/1438879449147/config/customLogo.gif%3Frevision=3" alt="The Chromium Projects" class="sites-logo  " /></a><h2><a href="../../index.html" dir="ltr" id="sites-chrome-userheader-title">The Chromium Projects</a></h2></div></td><td class="sites-layout-searchbox  "><div class="sites-header-cell-buffer-wrapper"><form id="sites-searchbox-form" action="https://www.chromium.org/system/app/pages/search" role="search"><input type="hidden" id="sites-searchbox-scope" name="scope" value="search-site" /><input type="text" id="jot-ui-searchInput" name="q" size="20" value="" aria-label="Search this site" /><div id="sites-searchbox-button-set" class="goog-inline-block"><div role="button" id="sites-searchbox-search-button" class="goog-inline-block jfk-button jfk-button-standard" tabindex="0">Search this site</div></div></form></div></td>
</tr>
<tr class="sites-header-secondary-row" id="sites-chrome-horizontal-nav">
<td colspan="2" id="sites-chrome-header-horizontal-nav-container" role="navigation">
</td>
</tr>
</table>
</div>
<div id="sites-chrome-main-wrapper">
<div id="sites-chrome-main-wrapper-inside">
<table id="sites-chrome-main" class="sites-layout-hbox" cellspacing="0" cellpadding="{scmCellpadding}" border="0">
<tr>
<td id="sites-chrome-sidebar-left" class="sites-layout-sidebar-left initial" style="width:150px">
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_7648876402527094" class="sites-embed" role="navigation"><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotId="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="../../chromium-projects.html" jotId="wuid:gx:10ae433dadbbab13" class="sites-navigation-link">Home</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="../../Home.1.html" jotId="wuid:gx:43582b9d2029d3af" class="sites-navigation-link">Chromium</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="../../chromium-os.1.html" jotId="wuid:gx:83df2ab1f8880ba" class="sites-navigation-link">Chromium OS</a></div></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_14720868319272995" class="sites-embed" role="navigation"><h4 class="sites-embed-title">Quick links</h4><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotId="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="../../for-testers/bug-reporting-guidelines.html" class="sites-navigation-link">Report bugs</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="../../developers/discussion-groups.html" class="sites-navigation-link">Discuss</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="../../system/app/pages/sitemap/hierarchy.html" jotId="wuid:gx:4b58a9a350ad12f" class="sites-navigation-link">网站地图</a></div></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_19690813310444355" class="sites-embed" role="navigation"><h4 class="sites-embed-title">Other sites</h4><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotId="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="http://blog.chromium.org/" class="sites-navigation-link">Chromium Blog</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="http://code.google.com/chrome/extensions/" class="sites-navigation-link">Google Chrome Extensions</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="https://developers.google.com/chrome/chrome-frame/" class="sites-navigation-link">Google Chrome Frame</a></div></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_19695218559354544" class="sites-embed" role="complementary"><h4 class="sites-embed-title"></h4><div class="sites-embed-content sites-embed-content-sidebar-textbox"><div dir="ltr"><span style="font-size:x-small">Except as otherwise </span><a href="http://developers.google.com/site-policies.html#restrictions"><span style="font-size:x-small">noted</span></a><span style="font-size:x-small">, the content of this page is licensed under a </span><a href="http://creativecommons.org/licenses/by/2.5/"><span style="font-size:x-small">Creative Commons Attribution 2.5 license</span></a><span style="font-size:x-small">, and examples are licensed under the </span><a href="http://src.chromium.org/viewvc/chrome/trunk/src/LICENSE" target="_blank"><span style="font-size:x-small">BSD License</span></a><span style="font-size:x-small">.<br /></span></div></div></div>
</td>
<td id="sites-canvas-wrapper">
<div id="sites-canvas" role="main">
<div id="goog-ws-editor-toolbar-container"> </div>
<div xmlns="http://www.w3.org/1999/xhtml" id="title-crumbs" style="">
<A href="../../chromium-os.1.html" dir="ltr">Chromium OS</A>‎ &gt; ‎<A href="../how-tos-and-troubleshooting.1.html" dir="ltr">How Tos and Troubleshooting</A>‎ &gt; ‎
  </div>
<h3 xmlns="http://www.w3.org/1999/xhtml" id="sites-page-title-header" style="" align="left">
<span id="sites-page-title" dir="ltr" tabindex="-1" style="outline: none">Using an Upstream Kernel on Chrome OS</span>
</h3>
<div id="sites-canvas-main" class="sites-canvas-main">
<div id="sites-canvas-main-content">
<table xmlns="http://www.w3.org/1999/xhtml" cellspacing="0" class="sites-layout-name-one-column sites-layout-hbox"><tbody><tr><td class="sites-layout-tile sites-tile-name-content-1"><div dir="ltr"><h2><a name="TOC-Introduction"></a><b><font size="5"><p><div class="sites-embed-align-right-wrapping-on"><div class="sites-embed-border-off sites-embed" style="width:350px;"><div class="sites-embed-content sites-embed-type-toc"><div class="goog-toc sites-embed-toc-maxdepth-6"><p>Contents</p><ol class="goog-toc"><li class="goog-toc"><a href="using-an-upstream-kernel-on-snow.html#TOC-Introduction"><strong>1 </strong>Introduction</a></li><li class="goog-toc"><a href="using-an-upstream-kernel-on-snow.html#TOC-Obtain-source-code-and-recent-patches"><strong>2 </strong>Obtain source code and recent patches</a></li><li class="goog-toc"><a href="using-an-upstream-kernel-on-snow.html#TOC-Installing-pwclient"><strong>3 </strong>Installing pwclient</a></li><li class="goog-toc"><a href="using-an-upstream-kernel-on-snow.html#TOC-Patches-relevant-to-the-Samsung-ARM-Chromebook"><strong>4 </strong>Patches relevant to the Samsung ARM Chromebook</a></li><li class="goog-toc"><a href="using-an-upstream-kernel-on-snow.html#TOC-Building-and-installing-the-kernel"><strong>5 </strong>Building and installing the kernel</a></li><li class="goog-toc"><a href="using-an-upstream-kernel-on-snow.html#TOC-The-kernel-config"><strong>6 </strong>The kernel config</a></li><li class="goog-toc"><a href="using-an-upstream-kernel-on-snow.html#TOC-Making-sure-other-configs-compile"><strong>7 </strong>Making sure other configs compile</a></li><li class="goog-toc"><a href="using-an-upstream-kernel-on-snow.html#TOC-Sending-your-change-upstream"><strong>8 </strong>Sending your change upstream</a></li><li class="goog-toc"><a href="using-an-upstream-kernel-on-snow.html#TOC-What-is-known-to-work-and-known-to-not-work-"><strong>9 </strong>What is known to work (and known to not work)</a></li><li class="goog-toc"><a href="using-an-upstream-kernel-on-snow.html#TOC-Musings"><strong>10 </strong>Musings</a></li><li class="goog-toc"><a href="using-an-upstream-kernel-on-snow.html#TOC-Contributing"><strong>11 </strong>Contributing</a></li></ol></div></div></div></div></p>Introduction</font></b></h2><div><p><font face="arial, sans-serif">This page aims to document how to use an Upstream Kernel on Chrome OS.  It's aimed at helping people with upstreaming for </font><span style="font-family:arial,sans-serif;font-size:10pt">the </span><a href="http://www.samsung.com/us/computer/chrome-os-devices/XE303C12-A01US" style="font-family:arial,sans-serif;font-size:10pt">Samsung ARM Series 3 Chromebook</a><span style="font-family:arial,sans-serif;font-size:10pt"> (AKA snow) and uses that in many examples.  However, it's useful in other cases, too.</span></p><p><span style="font-family:arial,sans-serif;font-size:10pt">In general this documentation assumes that you've got the Chrome OS source tree synced down and have a build environment (and chroot) setup.  It assumes you've built packages and an image for your board (like </span><code style="font-size:10pt"><font color="#9900ff">BOARD=daisy</font></code><span style="font-family:arial,sans-serif;font-size:10pt"> for the snow board).  See the </span><a href="../developer-guide.1.html" style="font-family:arial,sans-serif;font-size:10pt">Developer Guide</a><span style="font-family:arial,sans-serif;font-size:10pt"> if you haven't done that.</span></p><h2><a name="TOC-Obtain-source-code-and-recent-patches"></a><font face="arial, sans-serif">Obtain source code and recent patches</font></h2><p><font face="arial, sans-serif">The whole point here is to use the upstream kernel, so these instructions will direct you to linux-next.  ...but linux-next is pretty darn bleeding edge.  If you get stuck and things won't boot, you could always try a known-good state.  In fact, many of the needed patches have now landed on even landed on the main linux tree now.  See the section below "Patches relevant to the Samsung ARM Chromebook" for the last known good state.</font></p><p><span style="font-family:arial,sans-serif;font-size:10pt">The easiest way to get source code is to just add a remote git server to your normal kernel tree, fetch things, and then use patchwork to apply some patches.</span></p><p><span style="font-family:arial,sans-serif;font-size:10pt">Here's some steps to do that and start a new work branch on linux-next.  WARNING: The fetch might be slow.</span></p><div><font face="arial, sans-serif"><div></div><div class="sites-codeblock sites-codesnippet-block"><div><font color="#9900ff"><code>cd ~/trunk/src/third_party/kernel/files</code></font></div><div><font color="#9900ff"><code>git remote add linuxnext git://git.kernel.org/pub/scm/linux/kernel/git/next/linux-next.git</code></font></div><div><font color="#9900ff"><code>git fetch linuxnext</code></font></div><div><font color="#9900ff"><code>git checkout -b my_branch linuxnext/master</code></font></div><div></div></div><br /></font></div><h2><a name="TOC-Installing-pwclient"></a>Installing pwclient</h2><p>Now that you've got the source code you should apply a few patches.  In this case we'll use <code>pwclient</code> to get things out of <a href="http://patchwork.kernel.org">patchwork.kernel.org</a>.  </p><p>First we need to install <code>pwclient</code>.</p><p><span style="font-size:10pt;background-color:transparent">One way to install the patchwork client </span><span style="font-size:10pt;background-color:transparent">in the cros chroot is via its ebuild:</span></p><div><font color="#9900ff"><div class="sites-codeblock sites-codesnippet-block"><code>sudo emerge pwclient</code></div></font><br /></div><div>Alternatively, you can install the latest pwclient directly from kernel.org:</div><div><br /></div><div><div style="line-height:13.3333320617676px"></div></div><div class="sites-codeblock sites-codesnippet-block"><div><div style="line-height:13.3333320617676px"><font color="#9900ff"><code>sudo bash -c "curl 'https://patchwork.kernel.org/pwclient/' &gt; /usr/local/bin/pwclient"</code></font></div><div style="line-height:13.3333320617676px"><font color="#9900ff"><code>sudo chmod +x /usr/local/bin/pwclient</code></font></div></div><div></div></div><font color="#9900ff"><div><font color="#9900ff"><br /></font></div></font><div><div>Next, setup the <code>.pwmclientrc</code> for the LKML project on patchwork.kernel.org:</div></div><div><br /></div><div><div></div></div><div class="sites-codeblock sites-codesnippet-block"><div><div><b style="color:rgb(153,0,255);font-family:monospace;line-height:1;font-size:10pt"><code># The following will clobber any existing ~/.pwclientrc you have (!)</code></b></div></div><div><font color="#9900ff" face="monospace"><code>curl 'https://patchwork.kernel.org/project/LKML/pwclientrc/' &gt; ~/.pwclientrc</code></font></div><div></div><div></div></div><br /></div><div><h2><a name="TOC-Patches-relevant-to-the-Samsung-ARM-Chromebook"></a>Patches relevant to the Samsung ARM Chromebook</h2><p>This section should go away eventually once patches are upstream...</p><p>Relevant patch series that I've tested (as of 12/19/12)</p><ul><li><a href="http://patchwork.kernel.org/bundle/dianders/mmc_wp/" style="font-size:10pt">SD card write protect patches</a> <b>(required)</b></li><li><a href="http://patchwork.kernel.org/bundle/dianders/i2c_bus_numbering/" style="font-size:10pt">i2c bus numbering patches</a> </li><li><a href="http://patchwork.kernel.org/bundle/dianders/snow_max77686/">max77686 basic support in device tree</a> (misses RTC + 32KHz clocks)</li></ul><div>Quick way to apply:</div><div><br /></div><div></div><div></div><div class="sites-codeblock sites-codesnippet-block"><div><font color="#9900ff"><code>for id in 1966801 1966931 1966871 1966781 1966811; do</code></font></div><div><font color="#9900ff"><code>  pwclient git-am $id</code></font></div><div><font color="#9900ff"><code>done</code></font></div><div><font color="#9900ff"><code>pwclient git-am </code></font><font color="#9900ff" face="monospace"><code>1966911</code></font></div><div><span style="color:rgb(153,0,255)"><code>pwclient git-am </code></span><font color="#9900ff" face="monospace"><code>1840211</code></font></div><div><div></div></div></div>Status on linux/master:<ul><li>Tested on 12/18 <code>ae664dba2724e59ddd66291b895f7370e28b9a7a: Merge branch 'slab/for-linus' of git://git.kernel.org/pub/scm/linux/kernel/git/penberg/linux</code></li><ul><li>Needed revert of <code>1974a042dd15f1f007a3a1a2dd7a23ca0e42c01d</code>.  Fix is in discussion upstream.</li><li>Applied patches (1823551 1823621 1823561 1823591 1781931 1840211 1894081)</li><li>Boots to command line</li></ul><li>Tested on 12/19 <code>74779e22261172ea728b989310f6ecc991b57d62: Merge tag 'for-3.8-rc1' of git://gitorious.org/linux-pwm/linux-pwm</code></li><ul><li>Needed revert of <code>1974a042dd15f1f007a3a1a2dd7a23ca0e42c01d</code>.  Fix is in discussion upstream.</li><li>Applied patches (1823551 1823621 1823561 1823591 1781931 1840211)</li><li>To fix DEPMOD step when doing emerge-daisy chromeos-kernel-3_8: Apply patch 2794701</li><li>Boots to command line</li></ul></ul><div>Status on linux-next/master:</div><div><ul><li>Tested on 12/6: <font color="#006000" face="monospace">cfc4410f5d3de0f68139ddffe065b9889a41d3c0</font><code style="font-size:10pt">: Add linux-next specific files for 20121206</code></li><ul><li>Applied above patches (1823551 1823621 1823561 1823591 1781931 1840211)</li><li>Boots to command line</li></ul><li>Tested on 12/18: <code>ff430f8aa011716b8274381e31b0bc8d49d4f4be: Add linux-next specific files for 20121218</code></li><ul><li>Applied patches (1823551 1823621 1823561 1823591 1781931 1840211 1894081)</li><li>Boots to command line</li></ul></ul></div><h2><a name="TOC-Building-and-installing-the-kernel"></a><font face="arial, sans-serif">Building and installing the kernel</font></h2><p><font face="arial, sans-serif">Certainly there are lots of ways to build and install the kernel.  I'm not going to copy them all here but I'll just point you at the </font><span style="font-family:arial,sans-serif"><font color="#ff0000"><a href="kernel-faq.html">Kernel FAQ</a></font></span><font face="arial, sans-serif">.  Specifically read the <a href="http://www.chromium.org/chromium-os/how-tos-and-troubleshooting/kernel-faq#TOC-How-to-quickly-test-kernel-modifications-the-fast-way-">How to quickly test kernel modifications (the fast way)</a> section carefully.</font></p><p><font face="arial, sans-serif">I would strongly suggest that you boot from a fast SD card rather than directly messing with what you have on eMMC.  That way you can always get back to a running system.  The quick set of steps for that is:</font></p><ul><li><span style="font-size:10pt;font-family:arial,sans-serif">Switch to </span><a href="../developer-information-for-chrome-os-devices/samsung-arm-chromebook.1.html" style="font-size:10pt;font-family:arial,sans-serif">developer mode</a>.</li><li>At the command prompt (VT2), enable USB (and SD card) booting with <code><font color="#990000"><font size="3">crossystem dev_boot_usb=1</font></font></code>.<code><font color="#990000"><br /></font></code>Note: the exact method might differ between boards; see the <a href="../developer-information-for-chrome-os-devices.1.html">Developer Information for Chrome OS Devices page</a> for specific details.</li><li><span style="font-size:10pt;font-family:arial,sans-serif">Insert an SD card with an image that you installed with <code><font color="#9900ff"><a href="../build/cros-flash.html">cros flash</a></font></code></span>.</li><li><span style="font-size:10pt;font-family:arial,sans-serif">Reboot your Chromebook and press </span><code style="font-size:10pt"><font color="#990000">Ctrl-U</font></code><span style="font-size:10pt;font-family:arial,sans-serif"> at the BIOS prompt to boot from your SD card.</span></li></ul><div><font face="arial, sans-serif">You might also want to look at <a href="../u-boot-porting-guide/using-nv-u-boot-on-the-samsung-arm-chromebook.html">Using nv-U-Boot on the Samsung ARM Chromebook</a>.</font></div><h2><a name="TOC-The-kernel-config"></a><font face="arial, sans-serif">The kernel config</font></h2><p><span style="font-family:arial,sans-serif;font-size:10pt">One especially weird thing when working with the upstream kernel is that standard ChromeOS kernel <code>splitconfig</code> system isn't in place.  The kernel ebuild used by ChromeOS will realize that and will pick up a backup config from <a href="https://chromium.googlesource.com/chromiumos/overlays/chromiumos-overlay/+/master/eclass/cros-kernel">chromiumos-overlay</a>.  On snow it will pick up the </span><font face="arial, sans-serif"><code>exynos5_defconfig</code> in particular.</font></p><p><font face="arial, sans-serif">If you need to make changes to the kernel config locally the easiest thing to do is to just override that config.  Here's a set of commands that might suit you:</font></p><div class="sites-codeblock sites-codesnippet-block"><code>DEFCONFIG=~/trunk/src/third_party/chromiumos-overlay/eclass/cros-kernel/exynos5_defconfig</code><br /><br /><code>cd ~/trunk/src/third_party/kernel/v3.8</code><br /><code>cp ${DEFCONFIG} .config</code><br /><code>ARCH=arm make menuconfig</code><br /><br /><code># Make your changes</code><br /><br /><code>ARCH=arm make savedefconfig</code><br /><code>cp defconfig ${DEFCONFIG}</code><br /><br /><code>make mrproper</code><br /></div><br /><div><font face="arial, sans-serif">If you have changes to the config that you think is relevant to others working on the upstream kernel then feel free to submit a patch!</font></div><h2><a name="TOC-Making-sure-other-configs-compile"></a><font face="arial, sans-serif">Making sure other configs compile</font></h2><p><font face="arial, sans-serif">It's hard to make 100% sure that your change won't break anyone else.  ...but it's usually considered courtesy to make sure that some other boards compile.  If you want to see if the <code>exynos4_defconfig</code> compiles you could use a recipe like this:</font></p><div class="sites-codeblock sites-codesnippet-block"><div><div><span style="color:rgb(153,0,255);font-family:monospace;line-height:1;font-size:10pt"><code>cd ~/trunk/src/third_party/kernel/v3.8</code></span></div><div><font color="#9900ff" face="monospace"><code>ARCH=arm CROSS_COMPILE=armv7a-cros-linux-gnueabi- make exynos4_defconfig</code></font></div><div><font color="#9900ff" face="monospace"><code>ARCH=arm CROSS_COMPILE=armv7a-cros-linux-gnueabi- make -j16</code></font></div><div><br /></div></div><div><span style="color:rgb(153,0,255);font-family:monospace;line-height:1;font-size:10pt"><code>make mrproper</code></span></div></div><span style="font-family:arial,sans-serif;font-size:10pt"><div><span style="font-family:arial,sans-serif;font-size:10pt"><br /></span></div>The <code>exynos4_defconfig</code> is particularly interesting when you're modifying exynos code because it is a non-device tree enabled board that shares a lot of code with the exynos config that we're using (so it's easy to break).  It's actually broken at the git hash I listed above because I didn't run it before submitting my last patch.  :(</span><h2><a name="TOC-Sending-your-change-upstream"></a><font face="arial, sans-serif">Sending your change upstream</font></h2><p><font face="arial, sans-serif">This is documented over at </font><font face="arial, sans-serif" style="font-size:10pt">the </font><span style="font-size:10pt;font-family:arial,sans-serif"><font color="#ff0000"><a href="kernel-faq.html">Kernel FAQ</a></font></span><font face="arial, sans-serif" style="font-size:10pt">, which will soon (hopefully) include the use of patman.</font></p><h2><a name="TOC-What-is-known-to-work-and-known-to-not-work-"></a><font face="arial, sans-serif">What is known to work (and known to not work)</font></h2><p><font face="arial, sans-serif">As of 11/30/12:</font></p><p><font face="arial, sans-serif">Works:</font></p><ul><li><font face="arial, sans-serif">Serial over UART3 (if you've got a <a href="../servo.1.html">servo2 debug board</a> hooked up).  ...though remember that the default BIOS will try to disable serial console by mucking with the kernel command line.</font></li><li><font face="arial, sans-serif">i2c (all busses except the very important i2c bus 4)</font></li><li><font face="arial, sans-serif">power button and lid switch</font></li><li><font face="arial, sans-serif">EMMC and SD</font></li></ul><p><font face="arial, sans-serif">Known not to work yet:</font></p><ul><li><font face="arial, sans-serif">X (so ui will crash a whole lot at bootup)</font></li><li><font face="arial, sans-serif">USB 2.0 - Can almost do this with patches posted, expect it real soon now.</font></li><li><font face="arial, sans-serif">USB 3.0</font></li><li><font face="arial, sans-serif">i2c4 (which means no keyboard and no tps65090 PMIC)</font></li><li><font face="arial, sans-serif">Display</font></li><li><font face="arial, sans-serif">HDMI</font></li><li><span style="font-family:arial,sans-serif;font-size:10pt">WiFi</span></li><li><font face="arial, sans-serif">max77686 RTC + 32KHz</font></li><li><font face="arial, sans-serif">Trackpad</font></li><li><font face="arial, sans-serif">Audio</font></li></ul><h2><a name="TOC-Musings"></a><font face="arial, sans-serif">Musings</font></h2><p><font face="arial, sans-serif">A few random thoughts:</font></p><ul><li><font face="arial, sans-serif">If you end up flashing a bad kernel a lot, it's a lot easier to use the "nv-U-Boot" (formerly known as legacy U-Boot).  There's now documentation for how to do this at <a href="../u-boot-porting-guide/using-nv-u-boot-on-the-samsung-arm-chromebook.html">Using nv-U-Boot on the Samsung ARM Chromebook</a>.  Pay special attention to the <a href="../u-boot-porting-guide/using-nv-u-boot-on-the-samsung-arm-chromebook.html#TOC-Booting-from-a-backup-kernel">Booting from a backup kernel</a> section, which is really helpful when dealing with lots of nonbooting kernels.</font></li><li><font face="arial, sans-serif">If you have access to a servo board (probably only people at Google will have these) you also have the option of using <code><font color="#9900ff">cros_bundle_firmware</font></code> to load up a kernel.  The magic command line I've used for this is as follows.  Note that this won't get you kernel modules, just the main kernel.</font></li><ul><li><font face="arial, sans-serif"><code><font color="#9900ff">cros_bundle_firmware -b daisy -d exynos5250-snow -w usb --kernel /build/daisy/boot/vmlinux.uimg</font></code></font><span style="font-family:arial,sans-serif"> </span></li></ul></ul><h2><a name="TOC-Contributing"></a><font face="arial, sans-serif">Contributing</font></h2><p><font face="arial, sans-serif">Patches are certainly appreciated as are reviews of patches posted upstream.  In general most people on the Chrome OS team wouldn't object to people taking patches from the Chrome OS kernel tree, adjusting them, and posting them upstream (check with the author, though, since people may be midway through doing that themselves).</font></p></div></div></td></tr></tbody></table>
</div> 
</div> 
<div id="sites-canvas-bottom-panel">
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_page-subpages"> </div>
<div id="sites-attachments-container">
</div>
<a xmlns="http://www.w3.org/1999/xhtml" name="page-comments"></a>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_page-comments"><div class="sites-comment-docos-wrapper"><div class="sites-comment-docos"><div class="sites-comment-docos-background"></div><div class="sites-comment-docos-header"><div class="sites-comment-docos-header-title">Comments</div></div><div id="sites-comment-docos-pane" class="sites-comment-docos-pane"></div></div></div></div>
</div>
</div> 
</td> 
</tr>
</table> 
</div> 
</div> 
<div id="sites-chrome-footer-wrapper">
<div id="sites-chrome-footer-wrapper-inside">
<div id="sites-chrome-footer">
</div>
</div>
</div>
</div> 
</div> 
<div id="sites-chrome-adminfooter-container">
<div xmlns="http://www.w3.org/1999/xhtml" class="sites-adminfooter" role="navigation"><p><a class="sites-system-link" href="https://www.google.com/a/UniversalLogin?service=jotspot&amp;continue=https://sites.google.com/a/chromium.org/dev/chromium-os/how-tos-and-troubleshooting/using-an-upstream-kernel-on-snow">Sign in</a><span aria-hidden="true">|</span><a class="sites-system-link" href="../../system/app/pages/recentChanges.html">Recent Site Activity</a><span aria-hidden="true">|</span><a class="sites-system-link" href="../../system/app/pages/reportAbuse.html" target="_blank">Report Abuse</a><span aria-hidden="true">|</span><a class="sites-system-link" href="javascript:;" onclick="window.open(webspace.printUrl)">Print Page</a><span aria-hidden="true">|</span><span class="sites-system-link">Powered By</span> <b class="powered-by"><a href="http://sites.google.com">Google Sites</a></b></p></div>
</div>
</div> 
</div> 
<div id="sites-chrome-onebar-footer">
</div>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    window.jstiming.load.tick('sjl');
  </script>
<script xmlns="http://www.w3.org/1999/xhtml" src="https://ssl.gstatic.com/sites/p/56e332/system/js/jot_min_view__en.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    window.jstiming.load.tick('jl');
  </script>
<script xmlns="http://www.w3.org/1999/xhtml">
      
          sites.core.Analytics.createTracker();
          sites.core.Analytics.trackPageview();
        
    </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
                    sites.Searchbox.initialize(
                        'sites-searchbox-search-button',
                        {"object":[]}['object'],
                        'search-site',
                        {"label":"Configure search options...","url":"/system/app/pages/admin/settings"});
                  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
      gsites.HoverPopupMenu.createSiteDropdownMenus('sites-header-nav-dropdown', false);
    </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
            JOT_setupNav("7648876402527094", "Navigation", false);
            JOT_addListener('titleChange', 'JOT_NAVIGATION_titleChange', 'COMP_7648876402527094');
          </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
            JOT_setupNav("14720868319272995", "Quick links", false);
            JOT_addListener('titleChange', 'JOT_NAVIGATION_titleChange', 'COMP_14720868319272995');
          </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
            JOT_setupNav("19690813310444355", "Other sites", false);
            JOT_addListener('titleChange', 'JOT_NAVIGATION_titleChange', 'COMP_19690813310444355');
          </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
              new sites.CommentPane('//docs.google.com/comments/d/AAHRpnXvrAwjAfmld0ObrebBiGRq9-TdbgF_hNXU_W2hF8J6LpyrufEgDkvjOB89mxjrE7p65VxXdAvSgrDimNymDfadBlJ4BWqvut0t3dfrW0OzDyRALrJG7zkPApqgwfOz5giLVMUBN/api/js?anon=true',
                  false, false);
            </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
  setTimeout(function() {
    var fingerprint = gsites.date.TimeZone.getFingerprint([]);
    gsites.Xhr.send('https://www.chromium.org/_/tz', null, null, 'GET', null, null, { afjstz: fingerprint });
  }, 500);
</script>
<script xmlns="http://www.w3.org/1999/xhtml">
                    window.onload = function() {
                      if (false) {
                        JOT_setMobilePreview();
                      }
                      var loadTimer = window.jstiming.load;
                      loadTimer.tick("ol");
                      loadTimer["name"] = "load," + webspace.page.type + ",user_page";
                      window.jstiming.report(loadTimer, {}, 'https://gg.google.com/csi');
                    }
                  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
        JOT_insertAnalyticsCode(false,
            false);
      </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    var maestroRunner = new gsites.pages.view.SitesMaestroRunner(
        webspace, "en");
    maestroRunner.initListeners();
    maestroRunner.installEditRender();
  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
  //<![CDATA[
    // Decorate any fastUI buttons on the page with a class of 'goog-button'.
    if (webspace.user.hasWriteAccess) {
      JOT_decorateButtons();
    }

    // Fires delayed events.
    (function() {
      JOT_fullyLoaded = true;
      var delayedEvents = JOT_delayedEvents;
      for (var x = 0; x < delayedEvents.length; x++) {
        var event = delayedEvents[x];
        JOT_postEvent(event.eventName, event.eventSrc, event.payload);
      }
      JOT_delayedEvents = null;
      JOT_postEvent('pageLoaded');
    })();
  //]]>
</script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    JOT_postEvent('decorateGvizCharts');
  </script>
<script type="text/javascript">
          JOT_setupPostRenderingManager();
        </script>
<script type="text/javascript">
          JOT_postEvent('renderPlus', null, 'sites-chrome-main');
        </script>
<div id="server-timer-div" style="display:none"> </div>
<script type="text/javascript">
          window.jstiming.load.tick('render');
          JOT_postEvent('usercontentrendered', this);
        </script>
</body>
</html>
