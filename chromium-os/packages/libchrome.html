<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/WebPage">
<head>
<meta http-equiv="X-UA-Compatible" content="chrome=1" />
<script type="text/javascript">/* Copyright 2008 Google. */ (function() { var e="wtsrt_",g="tbsd_",h="tbnd_",k="start",l="_wtsrt",m="_tbnd",n="CSI/";(function(){function f(a){this.t={};this.tick=function(a,c,b){this.t[a]=[void 0!=b?b:(new Date).getTime(),c];if(void 0==b)try{window.console.timeStamp(n+a)}catch(d){}};this.tick(k,null,a)}var a;window.performance&&(a=window.performance.timing);var p=a?new f(a.responseStart):new f;window.jstiming={Timer:f,load:p};if(a){var c=a.navigationStart,d=a.responseStart;0<c&&d>=c&&(window.jstiming.srt=d-c)}if(a){var b=window.jstiming.load;0<c&&d>=c&&(b.tick(l,void 0,c),b.tick(e,l,d),b.tick(g,e))}try{a=null,
window.chrome&&window.chrome.csi&&(a=Math.floor(window.chrome.csi().pageT),b&&0<c&&(b.tick(m,void 0,window.chrome.csi().startE),b.tick(h,m,c))),null==a&&window.gtbExternal&&(a=window.gtbExternal.pageT()),null==a&&window.external&&(a=window.external.pageT,b&&0<c&&(b.tick(m,void 0,window.external.startE),b.tick(h,m,c))),a&&(window.jstiming.pt=a)}catch(q){}})(); })()
</script>
<link rel="shortcut icon" href="http://www.chromium.org/_/rsrc/1354323194313/favicon.ico" type="image/x-icon" />
<link rel="apple-touch-icon" href="http://www.gstatic.com/sites/p/56e332/system/app/images/apple-touch-icon.png" type="image/png" />
<script type="text/javascript">/* Copyright 2008 Google. */ (function() { var d="",g="__duration__",h="function";function k(c){return document.getElementById(c)}window.byId=k;function l(c){return c.replace(/^\s+|\s+$/g,d)}window.trim=l;var m=[],n=0;window.JOT_addListener=function(c,a,b){var e=new String(n++);c={eventName:c,handler:a,compId:b,key:e};m.push(c);return e};window.JOT_removeListenerByKey=function(c){for(var a=0;a<m.length;a++)if(m[a].key==c){m.splice(a,1);break}};
window.JOT_removeAllListenersForName=function(c){for(var a=0;a<m.length;a++)m[a].eventName==c&&m.splice(a,1)};window.JOT_postEvent=function(c,a,b){var e={eventName:c,eventSrc:a||{},payload:b||{}};if(window.JOT_fullyLoaded)for(a=m.length,b=0;b<a&&b<m.length;b++){var f=m[b];f&&f.eventName==c&&(e.listenerCompId=f.compId||d,(f=typeof f.handler==h?f.handler:window[f.handler])&&f(e))}else window.JOT_delayedEvents.push({eventName:c,eventSrc:a,payload:b})};window.JOT_delayedEvents=[];
window.JOT_fullyLoaded=!1;window.JOT_formatRelativeToNow=function(c,a){var b=((new Date).getTime()-c)/6E4;if(1440<=b||0>b)return null;var e=0;60<=b&&(b/=60,e=2);2<=b&&e++;return a?window.JOT_siteRelTimeStrs[e].replace(g,Math.floor(b)):window.JOT_userRelTimeStrs[e].replace(g,Math.floor(b))}; })()
</script>
<script>

  

  var breadcrumbs = [{"path":"/chromium-os","deleted":false,"title":"Chromium OS","dir":"ltr"},{"path":"/chromium-os/packages","deleted":false,"title":"packages","dir":"ltr"},{"path":"/chromium-os/packages/libchrome","deleted":false,"title":"libchrome","dir":"ltr"}];
  var JOT_clearDotPath = 'http://www.gstatic.com/sites/p/56e332/system/app/images/cleardot.gif';

  
  var JOT_userRelTimeStrs = ["a minute ago","__duration__ minutes ago","an hour ago","__duration__ hours ago"];

  
  

  

  var webspace = {"enableAnalytics":true,"pageSharingId":"jotspot_page","enableUniversalAnalytics":false,"sharingPolicy":"OPENED_WITH_INDICATOR","siteTitle":"The Chromium Projects","isStartPageEnabled":true,"adsensePublisherId":null,"features":{"languageSelectDefaultTextSetToDefault":true,"validateClientGvizDataSourceUrls":true,"moreMobileStyleImprovements":true,"newInsertMenuIcons":true,"accessibleSortingButtons":true,"domainAnalyticsInGAOnly":true,"noCaptcha":true,"fileCabinetScreenReaderFix":true,"updatedTosAndPrivacyLinks":null,"pageDrafts":false,"mobileOrientationFix":true,"plusBadge":false,"pdfEmbedSupport":false,"jsClickFix":true},"isPublic":true,"isConsumer":false,"serverFlags":{"cajaBaseUrl":"//www.gstatic.com/caja","cajaDebugMode":false},"onepickBaseUrl":"https://docs.google.com","domainAnalyticsAccountId":"","plusPageId":"","signInUrl":"https://www.google.com/a/SelectSession?continue\u003dhttp://sites.google.com/a/chromium.org/dev/chromium-os/packages/libchrome\u0026service\u003djotspot","analyticsAccountId":"UA-5484340-1","scottyUrl":"/_/upload","homePath":"/","siteNoticeUrlEnabled":null,"plusPageUrl":"","adsensePromoClickedOrSiteIneligible":true,"csiReportUri":"http://csi.gstatic.com/csi","sharingId":"jotspot","termsUrl":"//www.google.com/intl/en/policies/terms/","gvizVersion":1,"editorResources":{"sitelayout":["http://www.gstatic.com/sites/p/56e332/system/app/css/sitelayouteditor.css"],"text":["http://www.gstatic.com/sites/p/56e332/system/js/codemirror.js","http://www.gstatic.com/sites/p/56e332/system/app/css/codemirror_css.css","http://www.gstatic.com/sites/p/56e332/system/js/trog_edit__en.js","http://www.gstatic.com/sites/p/56e332/system/app/css/trogedit.css","/_/rsrc/1441580320000/system/app/css/editor.css","http://www.gstatic.com/sites/p/56e332/system/app/css/codeeditor.css","/_/rsrc/1441580320000/system/app/css/camelot/editor-jfk-wlb.css"]},"sharingUrlPrefix":"/_/sharing","isAdsenseEnabled":true,"domain":"chromium.org","baseUri":"","name":"dev","siteTemplateId":false,"siteNoticeRevision":null,"siteNoticeUrlAddress":null,"siteNoticeMessage":null,"page":{"isRtlLocale":false,"canDeleteWebspace":null,"isPageDraft":null,"parentPath":"/chromium-os/packages","parentWuid":"wuid:gx:69207dc28a432611","siteLocale":"en","timeZone":"America/Los_Angeles","type":"text","title":"libchrome","locale":"en","wuid":"wuid:gx:38700038227a5dd9","revision":20,"path":"/chromium-os/packages/libchrome","isSiteRtlLocale":false,"pageInheritsPermissions":null,"name":"libchrome","canChangePath":true,"state":"","properties":{},"bidiEnabled":false,"currentTemplate":{"path":"/system/app/pagetemplates/text","title":"Web Page"}},"canPublishScriptToAnyone":true,"user":{"keyboardShortcuts":true,"sessionIndex":"","guest_":true,"displayNameOrEmail":"guest","userName":"guest","uid":"","renderMobile":false,"domain":"","namespace":"","hasWriteAccess":false,"namespaceUser":false,"primaryEmail":"guest","hasAdminAccess":false},"gadgets":{"baseUri":"/system/app/pages/gadgets"}};
  webspace.page.breadcrumbs = breadcrumbs;

  
  var JOT_siteRelTimeStrs = ["a minute ago","__duration__ minutes ago","an hour ago","__duration__ hours ago"];

</script>
<script type="text/javascript">
                window.jstiming.load.tick('scl');
              </script>
<meta name="title" content="libchrome - The Chromium Projects" />
<meta itemprop="name" content="libchrome - The Chromium Projects" />
<meta property="og:title" content="libchrome - The Chromium Projects" />
<meta name="description" content="Home of the Chromium Open Source Project" />
<meta itemprop="description" content="Home of the Chromium Open Source Project" />
<meta id="meta-tag-description" property="og:description" content="Home of the Chromium Open Source Project" />
<style type="text/css">
</style>
<link rel="stylesheet" type="text/css" href="http://www.gstatic.com/sites/p/56e332/system/app/themes/beigeandblue/standard-css-beigeandblue-ltr-ltr.css" />
<link rel="stylesheet" type="text/css" href="http://www.chromium.org/_/rsrc/1441580320000/system/app/css/overlay.css?cb=beigeandblueundefineda100%25%25150goog-ws-leftthemedefaultstandard" />
<link rel="stylesheet" type="text/css" href="http://www.chromium.org/_/rsrc/1441580320000/system/app/css/camelot/allthemes-view.css" />
<!--[if IE]>
          <link rel="stylesheet" type="text/css" href="/system/app/css/camelot/allthemes%2die.css" />
        <![endif]-->
<title>libchrome - The Chromium Projects</title>
<meta itemprop="image" content="/_/rsrc/1438879449147/config/customLogo.gif?revision=3" />
<meta property="og:image" content="/_/rsrc/1438879449147/config/customLogo.gif?revision=3" />
<script type="text/javascript">
                window.jstiming.load.tick('cl');
              </script>
</head>
<body xmlns="http://www.google.com/ns/jotspot" id="body" class=" en            ">
<div id="sites-page-toolbar" class="sites-header-divider">
<div xmlns="http://www.w3.org/1999/xhtml" id="sites-status" class="sites-status" style="display:none;"><div id="sites-notice" class="sites-notice" role="status" aria-live="assertive"> </div></div>
</div>
<div id="sites-chrome-everything-scrollbar">
<div id="sites-chrome-everything" class="">
<div id="sites-chrome-page-wrapper" style="direction: ltr">
<div id="sites-chrome-page-wrapper-inside">
<div xmlns="http://www.w3.org/1999/xhtml" id="sites-chrome-header-wrapper" style="height:auto;">
<table id="sites-chrome-header" class="sites-layout-hbox" cellspacing="0" style="height:auto;">
<tr class="sites-header-primary-row" id="sites-chrome-userheader">
<td id="sites-header-title" class="" role="banner"><div class="sites-header-cell-buffer-wrapper"><a href="http://www.chromium.org/" id="sites-chrome-userheader-logo"><img id="logo-img-id" src="http://www.chromium.org/_/rsrc/1438879449147/config/customLogo.gif?revision=3" alt="The Chromium Projects" class="sites-logo  " /></a><h2><a href="http://www.chromium.org/" dir="ltr" id="sites-chrome-userheader-title">The Chromium Projects</a></h2></div></td><td class="sites-layout-searchbox  "><div class="sites-header-cell-buffer-wrapper"><form id="sites-searchbox-form" action="http://www.chromium.org/system/app/pages/search" role="search"><input type="hidden" id="sites-searchbox-scope" name="scope" value="search-site" /><input type="text" id="jot-ui-searchInput" name="q" size="20" value="" aria-label="Search this site" /><div id="sites-searchbox-button-set" class="goog-inline-block"><div role="button" id="sites-searchbox-search-button" class="goog-inline-block jfk-button jfk-button-standard" tabindex="0">Search this site</div></div></form></div></td>
</tr>
<tr class="sites-header-secondary-row" id="sites-chrome-horizontal-nav">
<td colspan="2" id="sites-chrome-header-horizontal-nav-container" role="navigation">
</td>
</tr>
</table>
</div>
<div id="sites-chrome-main-wrapper">
<div id="sites-chrome-main-wrapper-inside">
<table id="sites-chrome-main" class="sites-layout-hbox" cellspacing="0" cellpadding="{scmCellpadding}" border="0">
<tr>
<td id="sites-chrome-sidebar-left" class="sites-layout-sidebar-left initial" style="width:150px">
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_7648876402527094" class="sites-embed" role="navigation"><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotId="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="http://www.chromium.org/chromium-projects" jotId="wuid:gx:10ae433dadbbab13" class="sites-navigation-link">Home</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="../../Home.html" jotId="wuid:gx:43582b9d2029d3af" class="sites-navigation-link">Chromium</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="../../chromium-os.html" jotId="wuid:gx:83df2ab1f8880ba" class="sites-navigation-link">Chromium OS</a></div></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_14720868319272995" class="sites-embed" role="navigation"><h4 class="sites-embed-title">Quick links</h4><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotId="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="../../for-testers/bug-reporting-guidelines.html" class="sites-navigation-link">Report bugs</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="../../developers/discussion-groups.html" class="sites-navigation-link">Discuss</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="http://www.chromium.org/system/app/pages/sitemap/hierarchy" jotId="wuid:gx:4b58a9a350ad12f" class="sites-navigation-link">网站地图</a></div></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_19690813310444355" class="sites-embed" role="navigation"><h4 class="sites-embed-title">Other sites</h4><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotId="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="http://blog.chromium.org/" class="sites-navigation-link">Chromium Blog</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="http://code.google.com/chrome/extensions/" class="sites-navigation-link">Google Chrome Extensions</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="https://developers.google.com/chrome/chrome-frame/" class="sites-navigation-link">Google Chrome Frame</a></div></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_19695218559354544" class="sites-embed" role="complementary"><h4 class="sites-embed-title"></h4><div class="sites-embed-content sites-embed-content-sidebar-textbox"><div dir="ltr"><span style="font-size:x-small">Except as otherwise </span><a href="http://developers.google.com/site-policies.html#restrictions"><span style="font-size:x-small">noted</span></a><span style="font-size:x-small">, the content of this page is licensed under a </span><a href="http://creativecommons.org/licenses/by/2.5/"><span style="font-size:x-small">Creative Commons Attribution 2.5 license</span></a><span style="font-size:x-small">, and examples are licensed under the </span><a href="http://src.chromium.org/viewvc/chrome/trunk/src/LICENSE" target="_blank"><span style="font-size:x-small">BSD License</span></a><span style="font-size:x-small">.<br /></span></div></div></div>
</td>
<td id="sites-canvas-wrapper">
<div id="sites-canvas" role="main">
<div id="goog-ws-editor-toolbar-container"> </div>
<div xmlns="http://www.w3.org/1999/xhtml" id="title-crumbs" style="">
<A href="../../chromium-os.html" dir="ltr">Chromium OS</A>‎ &gt; ‎<A href="../packages.1.html" dir="ltr">packages</A>‎ &gt; ‎
  </div>
<h3 xmlns="http://www.w3.org/1999/xhtml" id="sites-page-title-header" style="" align="left">
<span id="sites-page-title" dir="ltr" tabindex="-1" style="outline: none">libchrome</span>
</h3>
<div id="sites-canvas-main" class="sites-canvas-main">
<div id="sites-canvas-main-content">
<table xmlns="http://www.w3.org/1999/xhtml" cellspacing="0" class="sites-layout-name-one-column sites-layout-hbox"><tbody><tr><td class="sites-layout-tile sites-tile-name-content-1"><div dir="ltr"><div><div class="sites-embed-align-right-wrapping-on"><div class="sites-embed-border-off sites-embed" style="width:250px;"><div class="sites-embed-content sites-embed-type-toc"><div class="goog-toc sites-embed-toc-maxdepth-6"><p>Contents</p><ol class="goog-toc"><li class="goog-toc"><a href="libchrome.html#TOC-Background"><strong>1 </strong>Background</a></li><li class="goog-toc"><a href="libchrome.html#TOC-Using-In-Chromium-OS"><strong>2 </strong>Using In Chromium OS</a><ol class="goog-toc"><li class="goog-toc"><a href="libchrome.html#TOC-Ebuild-non-platform2-"><strong>2.1 </strong>Ebuild (non-platform2)</a></li><li class="goog-toc"><a href="libchrome.html#TOC-Package-s-Build-System"><strong>2.2 </strong>Package's Build System</a><ol class="goog-toc"><li class="goog-toc"><a href="libchrome.html#TOC-platform2"><strong>2.2.1 </strong>platform2</a></li><li class="goog-toc"><a href="libchrome.html#TOC-common.mk-old-"><strong>2.2.2 </strong>common.mk (old)</a></li></ol></li><li class="goog-toc"><a href="libchrome.html#TOC-Package-s-Source-Code"><strong>2.3 </strong>Package's Source Code</a></li></ol></li><li class="goog-toc"><a href="libchrome.html#TOC-Internal-Details"><strong>3 </strong>Internal Details</a><ol class="goog-toc"><li class="goog-toc"><a href="libchrome.html#TOC-Single-Static-Library"><strong>3.1 </strong>Single Static Library</a></li><li class="goog-toc"><a href="libchrome.html#TOC-Slotted-Static-Libraries"><strong>3.2 </strong>Slotted Static Libraries</a></li><li class="goog-toc"><a href="libchrome.html#TOC-Slotted-Dynamic-Libraries"><strong>3.3 </strong>Slotted Dynamic Libraries</a></li><li class="goog-toc"><a href="libchrome.html#TOC-Using-pkg-config"><strong>3.4 </strong>Using pkg-config</a></li><li class="goog-toc"><a href="libchrome.html#TOC-Optimized-Slotted-Dynamic-Libraries"><strong>3.5 </strong>Optimized Slotted Dynamic Libraries</a></li><li class="goog-toc"><a href="libchrome.html#TOC-Future-Work"><strong>3.6 </strong>Future Work</a></li></ol></li><li class="goog-toc"><a href="libchrome.html#TOC-Building-libbase"><strong>4 </strong>Building libbase</a></li><li class="goog-toc"><a href="libchrome.html#TOC-Upgrade-Release-Plans"><strong>5 </strong>Upgrade/Release Plans</a></li></ol></div></div></div></div></div>
<h2><a name="TOC-Background"></a>Background</h2>
<p>
The Chromium project has an general utility library referred to as libbase:<br />
 <a href="https://chromium.googlesource.com/chromium/src/base/">https://chromium.googlesource.com/chromium/src/base/</a></p>
<p>Because it is standalone and does not depend on any other parts of Chromium, it has been been picked up by other Google related projects so people don't have to reinvent these things.</p>
<p>Along those lines, a package in Chromium OS is provided so that projects specific to us can share the code without having to bundle it multiple times over. Currently, there are over 20 such projects in Chromium OS. To keep people on their toes, the package is named "libchrome" as "libbase" by itself is too confusing. Granted, "libchrome" isn't exactly clear itself, but it's a lose-lose situation, and we tried our best. Please still love us.</p>
<h2><a name="TOC-Using-In-Chromium-OS"></a>Using In Chromium OS</h2>
<h3><a name="TOC-Ebuild-non-platform2-"></a>Ebuild (non-platform2)</h3>
<div>
<p>Note: If your package is integrated into the platform2 ebuild, then this is already handled for you in the common platform2 ebuild and you can skip this section.</p>
<p>There are 4 things to make sure the ebuild does when building a Chromium OS package that uses libchrome:</p>
<ul><li>inherit the cros-debug eclass</li>
<li>depend on a specific version (SLOT) of libchrome with the right USE=cros-debug setting</li>
<li>call cros-debug-add-NDEBUG in one of: src_prepare src_configure src_compile<br />
</li>
<li>export BASE_VER to the version you are depending on</li></ul>
</div>
<p>Below you can find copy &amp; paste snippets that should work for any ebuild in the Chromium OS tree. All you should need to change is the "125070" as the number is updated.</p>
<div class="sites-codeblock sites-codesnippet-block"><code>...<br />
inherit cros-debug<br />
...<br />
LIBCHROME_VERS="125070"<br />
...<br />
RDEPEND="chromeos-base/libchrome:${LIBCHROME_VERS}[cros-debug=]"<br />
...<br />
src_compile() {<br />
    ...<br />
    tc-export PKG_CONFIG<br />
    cros-debug-add-NDEBUG<br />
    export BASE_VER=${LIBCHROME_VERS}<br />
    ...<br />
}</code></div>
<h3><a name="TOC-Package-s-Build-System"></a>Package's Build System</h3>
<h4><a name="TOC-platform2"></a>platform2</h4>
<p>If your package has been upgraded to <a href="http://www.chromium.org/chromium-os/getting-started-with-platform2">platform2</a> (if not, why not?), then it's simple. In your package's gyp file, you will want to:</p>
<ul><li>Declare the version of libbase you're using in the top level variables section.<br />
<br />
<div class="sites-codeblock sites-codesnippet-block">
<code>{<br />
  'variables': {<br />
    'libbase_ver': 242728,<br />
    ... other variables you might have ...<br />
  },<br />
  ... the rest of your gyp file ...<br />
}</code></div>
<br />
</li>
<li>List libchrome as a dependency as needed (e.g. either in the project-common target_defaults or the target-specific section); this section is used to look up packages via their pkg-config (.pc) files.<br />
<br />
<div class="sites-codeblock sites-codesnippet-block">
<code>...<br />
  {<br />
    'target_name': 'list_proxies',<br />
    'type': 'executable',<br />
    'variables': {<br />
      'deps': [<br />
        'libchrome-&lt;(libbase_ver)',<br />
        ... any other deps you have ...<br />
      ],<br />
...</code></div>
<br />
</li>
<li>If you also use libchromeos or libmetrics, you will list it using the dependencies section instead; this section is used to depend on other gyp targets (which these are).<br />
<br />
<div class="sites-codeblock sites-codesnippet-block">
<code>...<br />
  {<br />
    'target_name': 'crash_reporter',<br />
    'type': 'executable',<br />
    'dependencies': [<br />
      '../libchromeos/libchromeos-&lt;(libbase_ver).gyp:libchromeos-&lt;(libbase_ver)',<br />
      '../metrics/libmetrics-&lt;(libbase_ver).gyp:libmetrics-&lt;(libbase_ver)',<br />
      ... any other deps you have ...<br />
    ],<br />
...</code></div>
</li></ul>
<h4><a name="TOC-common.mk-old-"></a>common.mk (old)</h4>
<p>In a standard common.mk Chromium OS platform project, you can use these snippets in your Makefile:</p>
<div class="sites-codeblock sites-codesnippet-block">
<code>
# If the build env has exported $PKG_CONFIG to a wrapper, use that, else use<br />
# the default pkg-config wrapper (so we can `make` in place for testing).<br />
PKG_CONFIG ?= pkg-config<br />
<br />
# If the build env has exported $BASE_VER, use that. Else, use the last version<br />
# that we tested against. This allows the ebuild to update to a newer version<br />
# without having to explicitly update the source build system for trivial changes.<br />
BASE_VER ?= 125070<br />
<br />
# You can add as many or as view pkg-config libraries to this PC_DEPS value.<br />
# Here we just use a specific version of libbase.<br />
PC_DEPS = libchrome-$(BASE_VER)<br />
<br />
# Look up the compiler flags and linker settings via the pkg-config wrapper<br />
# once. That is why we use a dedicated variable and the := operator -- if<br />
# we use =, then make will end up executing the pkg-config wrapper many times.<br />
PC_CFLAGS := $(shell $(PKG_CONFIG) --cflags $(PC_DEPS))<br />
PC_LIBS := $(shell $(PKG_CONFIG) --libs $(PC_DEPS))</code></div>
<h3><a name="TOC-Package-s-Source-Code"></a>Package's Source Code</h3>
<p>In your source, include files from base/ like normal. So if you want to use the string printf API, do:</p>
<div class="sites-codeblock sites-codesnippet-block">
<div><code>#include &lt;base/stringprintf.h&gt;</code></div>
</div>
<h2><a name="TOC-Internal-Details"></a>Internal Details</h2>
<p>Over time, we've evolved how we package up the base source tree. Here we'll cover the lessons we've learned, and why we do the things that we do. This way future decisions can take into consideration all the factors without missing something.</p>
<p>For some more background (and specifics), see this thread: <a href="https://groups.google.com/a/chromium.org/d/topic/chromium-os-dev/daH97iacQeQ/discussion">https://groups.google.com/a/chromium.org/d/topic/chromium-os-dev/daH97iacQeQ/discussion</a></p>
<h3><a name="TOC-Single-Static-Library"></a>Single Static Library</h3>
<p>The first iteration involved creating a single libbase.a from a single version of Chromium (and install headers into /usr/include/base/). Then anyone who wanted to use this code base would link with -lbase and include &lt;base/foo.h&gt;.</p>
<p>The advantages here:</p>
<div>
<ul><li>It was very simple to put together/manage/get running.</li>
<li>Only the specific objects a project wanted were included (as the libbase.a archive was actually a bunch of .o files, and only the needed ones were pulled in).</li>
<li>Runtime foot print was relatively small, even though some symbols were duplicated between projects.</li></ul>
</div>
<p>Unfortunately, as it was widely deployed, we hit scaling issues:</p>
<div>
<ul><li>If the objects pulled in from libbase.a needed third-party libraries, projects had to manually link those in themselves (like -lrt or -lm or -lpthread or -lglib-2.0 or ...).</li>
<li>The exact list of additional libraries projects needed to specify in order to successfully link against libbase.a changed over time, so many projects ended up just copying &amp; pasting a long list of libraries leading to overlinking (pulling in libraries that at runtime never get used) which in turn leads to runtime overhead.</li>
<li>Similarly, the exact third-party headers that libbase itself uses changes over time. So projects ended up passing -I paths to many third-party projects just in case libbase needed them.</li>
<li>People would use libbase in shared libraries and not notice that the symbols pulled in from libbase were now exported as part of the shared library interface. With applications, there is only one copy of the libbase code active, but with shared libraries, applications might have the missing symbols satisfied via those! This meant sometimes the application would get the symbols from libbase.a and sometimes it wouldn't (depended on the order of libraries during link time!). This is a bad state to be in terms of reproducibility and reliability.</li>
<li>Upgrading libbase often broke various projects as the API evolved over time. This happens because libbase is maintained as part of Chromium, so when the API evolves there, all consumers get updated. But Chromium OS projects aren't part of Chromium, so we didn't see those updates propagating across.</li>
<li>Due to the large number of Chromium OS projects being locked to a specific version, updates in our system required simultaneous coordination of many groups so that all the source trees and ebuild packages to be updated more or less atomically. Any regressions in this led to hard-to-revert tree states and build failures that could last a few days as everyone scrambled.</li>
<li>Even after everyone was on board, some projects would inevitability get missed because it's not easy to determine applications that linked against a static library (there's nothing to search for in the ELF), and sometimes ebuilds would be added with missing version information.</li>
<li>Since upgrading is so painful, in practice the upgrade would happen only once or twice a year, and generally only because a project needed some API features that existed in newer versions of Chromium. Even then, sometimes groups avoided upgrading as long as possible so they wouldn't get blamed by other groups when things fell apart.</li></ul>
<p>The first few points were annoying, but bearable. The latter points (related to upgrading), however, were not. So we embarked on a search for a solution!</p>
<h3><a name="TOC-Slotted-Static-Libraries"></a>Slotted Static Libraries</h3>
<p>Since static libraries we so trivial to throw together, we tried to expand on this concept. Now, rather than installing libbase.a, we would install libbase-&lt;version&gt;.a and /usr/include/base-&lt;version&gt;/base/. Then projects would be built and linked against a specific version of libbase by using e.g. -lbase-85268 and compiled against a matching set of headers by using e.g. -I/usr/include/base-85268.</p>
<p>This has advantages over a single static library:</p>
<div>
<ul><li>Updating one project to a newer version of libbase does not affect any other project making testing much easier (build_packages still works!) for people.</li>
<li>Subgroups can update their specific projects to newer versions in their own schedule.</li>
<li>Newer versions of libbase can be added without affecting any projects, so people doing experiments with newer APIs can easily do so.</li></ul>
<p>
However, after building and testing this prototype, we hit problems that were non-starters for deploying related to libraries. When a Chromium OS shared library (e.g. libmetrics) links against a specific libbase version, it turns around and exports the symbols from that version. So when linking an application against a different version of libbase, and that shared library, we cannot guarantee that the ABI between the two versions are the same. While the compile might have been clean, we don't know if the runtime will be clean, and the behavior could change depending on the link order (-lbase-### -lmetrics vs -lmetrics -lbase-###). This could easily lead to hard-to-debug and -understand crashes or misbehavior at runtime.</p>
</div>
<p>We could say that the shared library would clean up its exported ABI by never exporting any libbase symbols (which would be a good thing regardless), but the resulting system is still unmanageable. Since linking against the static library pulls in both functions and state, and some of the APIs from libbase have initialization functions (such as the logging framework which sets up message headers, files, and maintains a buffer), libmetrics now has its own copy of the logging code, and the end application has its own copy of logging code. When the application initializes the logging framework, it initializes its own logging state, not libmetrics' logging state. So when libmetrics attempts to do logging of its own, it often times will crash as its logging state is uninitialized. We could add initialization functions to libmetrics so that it too would initialize its own libbase state, but now we have two parallel logging functions at runtime which could be clobbering the external state (e.g. files).</p>
</div>
<p>Similar complications come up when using static libraries that themselves use libbase. If libmetrics was built against libbase-1234, and another project was built against libbase-5678, they'll want different functions at link time which can lead to symbol clashing leading either to link time failures or runtime failures (as detailed above).</p>
<p>This is all fairly fragile, and is arguably trading one set of problems (hard to build and upgrade) for a different, and perhaps even worse, set of problems (things are easy to build and upgrade, but hard to run and debug). We can do better, so let's think harder.</p>
<h3><a name="TOC-Slotted-Dynamic-Libraries"></a>Slotted Dynamic Libraries</h3>
<p>Since the slotted aspect of the previous proposal got us the upgrade path that we desired, we now just have to solve the duplicate state problem. That could be done by only using shared libraries with libbase -- there's no chance to have multiple states be linked in as there are no static archives anymore. Now instead of providing libbase-&lt;version&gt;.a, we provide libbase-&lt;version&gt;.so. The other aspects of the previous proposal are the same (include paths, as well as compiling and linking flags).</p>
<p>The advantages here:</p>
<div>
<ul><li>There is only one copy of all libbase functions and state at runtime -- When we call a logging function, we know that function has one copy of its state, and know that everyone will be using that same function.</li>
<li>We know exactly what version of libbase an application was linked with after it's been built (by looking at DT_NEEDED ELF tags).</li>
<li>We can track down exactly what packages are implicitly using libbase but not declaring it in its ebuild.</li></ul>
<p>It's not all peaches and apple pie though -- there are some trade-offs here:</p>
</div>
<div>
<ul><li>All programs using libbase load all of libbase at runtime, even parts they don't use (functions and state).</li>
<ul><li>Arguably, this overhead is small, but it is not zero.</li></ul>
<li>All third-party libraries that libbase needs get pulled in at runtime, even if they're only needed by parts of libbase the application doesn't use (and those libraries could pull in other libraries!).</li>
<ul><li>This overhead is much more noticeable than the previously-mentioned issue.</li></ul>
<li>The libchrome ebuild has to be complete in terms of what files it builds and links together as any undefined references will cause a shared library link error.</li>
<ul><li>This is actually a good thing as it means we can be confident that when updating, our package has included all the objects we care about. Otherwise, we have to try compiling all the other projects and see if they all pass (without undefined references) before we know the new package built all the necessary files.</li></ul>
<li>Static libraries (other than project-specific ones e.g. convenience libraries) are no longer allowed to use libbase (e.g. a project provides libfoo.a which uses libbase and multiple other projects use libfoo.a) as this is hard to track, and leads to similar problems as slotted static libraries in terms of mismatch of ABI.</li>
<ul><li>Not a big deal as we have few libraries in Chromium OS that use libbase, and making them all shared has been okay.</li></ul>
<li>Projects that link against a shared library that links against libbase must use the same version of libbase. Otherwise, at runtime, an application will load libbase-1234.so and libfoo.so, and libfoo.so will load libbase-5678.so, and both libbases will attempt to satisfy symbol references leading to runtime ABI conflicts and possibly random crashes.</li>
<ul><li>To be safe, this improves the set of packages that need to be upgrade simultaneously from all consumers of libbase to consumers of a specific library. So anyone who links against libmetrics (which uses libbase) has to use the same version of libbase as libmetrics. When an upgrade occurs, they should all upgrade together. For standalone projects which don't link against any libraries that use libbase, they can safely upgrade/downgrade independently.</li></ul></ul>
<p>The last point here is the only real show stopper. Fortunately, two things work in our favor. Generally, the ABI is stable with libbase (across the version ranges we upgrade between), so the runtime "mostly works". This means we can tolerate a period of time where we are upgrading to a newer version of libbase but some applications are actually (runtime) linked against multiple versions. By the time we actually release, the upgrade will have completed, so there will once again only be one version live at a time. Further, since we can detect exactly what versions of a library an ELF has been linked against, we can confidently detect the cases where a program uses one version of libbase, but links against a shared library which pulls in a different one and act appropriately (i.e. update all the packages).</p>
</div>
<p>At this point, we have a workable solution. But we can still do better. Onwards!</p>
<h3><a name="TOC-Using-pkg-config"></a>Using pkg-config</h3>
<p>Since we need to change all projects that use libbase (from -lbase to -lbase-&lt;version&gt;, and adding -I/usr/include/base-&lt;version&gt;), we might as well come up with a better answer overall that scales and addresses other annoyances. This brings us to <a href="http://www.freedesktop.org/wiki/Software/pkg-config">pkg-config</a>.</p>
<p><span style="background-color:transparent">The advantages of providing a .pc file for projects to query are significant!</span></p>
<ul><li>We can hide all of libbases' dependencies from projects that just want to use libbase. Rather than having the projects manually specify -lrt or -lpthread or -I/usr/include/... or anything else, the .pc file declares everything it depends on. Projects then just ask for the cflags and libraries that libbase needs, and it gets expanded as needed.</li>
<li>If we want to make any library changes in the future (moving or renaming the files or the install paths), we only have to update the .pc file. No end projects need change.</li></ul>
<p>For the nit-pickers out there, there are disadvantages:</p>
<ul><li>You have to depend on the pkg-config package, and execute `pkg-config` at build time.</li>
<ul><li>This is required by many other projects already (like glib), so not really unique to libbase problem.</li></ul></ul>
<p>So this cleans up the compiling/linking process nicely, and integrates with existing pkg-config framework that other libraries depend on.</p>
<h3><a name="TOC-Optimized-Slotted-Dynamic-Libraries"></a>Optimized Slotted Dynamic Libraries</h3>
<p>The biggest disadvantage to shared libraries is that libbase isn't really one API, but rather a large collection of different APIs. Some require third party libraries to work (like pcre or glib or pthreads), while others require very little. So forcing one project that wants just the simple APIs (like string functions) to pull in more complicated APIs which pull in other third party libraries (like pcre) even though it won't use them is a waste of runtime resources.</p>
<p>We can combat this though by leveraging some linker tricks. When you specify a library like -lfoo, it doesn't have to be just a static archive (libfoo.a) or a shared ELF (libfoo.so), it could even be a <a href="http://sourceware.org/binutils/docs/ld/Implicit-Linker-Scripts.html">linker script</a>!  Combined with the useful AS_NEEDED directive, we can create an arbitrary number of smaller shared libraries (like libbase-core-1234 and libbase-pcre-1234 and libbase-foo-1234) where each one has its own additional library requirements and provides different sets of APIs. Then when people link against -lbase-1234, the linker will look at all of the smaller libbase shared libraries and only pull in the ones we actually use. This is all transparent to the user of the libbase API.</p>
<p>So we have all of the advantages of slotted dynamic libraries, and only one of the downsides: we still have possible runtime conflicts where a program uses one version, but a library it links against uses a different version. As noted previously, this is an acceptable trade off for now, and makes the upgrade situation significantly more manageable.</p>
<h3><a name="TOC-Future-Work"></a>Future Work</h3>
<p>Here are some random thoughts that might be worth investigating to try and improve the current situation:</p>
<ul><li>Put all of libbase into a version-specific C++ namespace</li></ul>
<h2><a name="TOC-Building-libbase"></a>Building libbase</h2>
<p>We currently build libbase with scons (and a <a href="http://git.chromium.org/gitweb/?p=chromiumos/overlays/chromiumos-overlay.git;a=blob;f=chromeos-base/libchrome/files/SConstruct-125070;h=67e62718e16134e52c929a5dcda24224740616b2;hb=HEAD">SConstruct</a>). It maintains a list of all the files which go into a shared library fragment (such as 'core' and 'glib' and 'event'). It's largely split along the lines of what third party libraries will get pulled in (so the 'core' only requires C libraries, 'glib' additionally requires glib, 'event' additionally requires libevent, etc...). The fragments could conceivably be split further, but the trade-offs in terms of runtime overhead were found to not warrant it (generally in the range of "system noise").</p>
<p>This build file is also responsible for generating the pkg-config .pc file and linker script.</p>
<p>The compiling logic is duplicated a bit with the existing .gyp files that the Chromium project provides, but we (sadly) can't really leverage that file for a few reasons:</p>
<div>
<ul><li>The .gyp builds *all* files while we only build a subset (what people in Chromium OS have asked for).</li>
<li>The .gyp produces a single static archive while we want multiple shared libraries (for all the reasons stated in previous sections).</li>
<li>We'd still need unique build logic to create the pkg-config file, and we still have to enumerate all the third party libraries we use in the ebuild.</li></ul>
</div>
<p>So, for now, we maintain our own file. The overhead isn't really all that great in the first place, so ...</p>
<h2><a name="TOC-Upgrade-Release-Plans"></a>Upgrade/Release Plans</h2>
<p>Once a Chromium OS project has identified newer APIs that they want to utilize, or the upstream Chromium project has introduced features that make it more attractive to us (such as no longer hard requiring GTK+), it's time for us to schedule an upgrade!  Here is a general approach which should work for people:</p>
<div>
<ul><li>Announce your intention to upgrade libbase to the chromium-os-dev@chromium.org mailing list!</li>
<ul><li>The various Chromium OS groups now can't say they didn't see this coming :).</li></ul>
<li>Wait for the next branch to be made so that ToT starts development anew.</li>
<ul><li>Gives plenty of time to all the various Chromium OS groups to plan an upgrade before the /next/ branch.</li></ul>
<li>Figure out what revision number you want to use for libchrome.</li>
<ul><li><span style="font-size:10pt">Look at the LKGRs for the latest Chrome branch.</span></li>
<li>See what revision number it lists.</li></ul>
<li>Figure out what git SHA-1 that revision number maps to in each of the sub-repositories.</li>
<ul><li>Check out a bunch of Chromium sub-repos that contain portions of the main Chromium repository:</li><ul><li><a href="https://chromium.googlesource.com/chromium/src/base/" style="font-size:10pt;background-color:transparent">dhromium/src/base</a></li><li><a href="https://chromium.googlesource.com/chromium/src/build/">chromium/src/build</a></li><li><a href="https://chromium.googlesource.com/chromium/src/components/timers/">chromium/src/components/timers</a></li><li><a href="https://chromium.googlesource.com/chromium/src/crypto/" style="font-size:13.3333330154419px">chromium/src/crypto</a></li><li><a href="https://chromium.googlesource.com/chromium/src/dbus/">chromium/src/dbus</a></li><li><a href="https://chromium.googlesource.com/chromium/src/sandbox/">chromium/src/sandbox</a></li></ul>
<li>Look at the git log -- every commit has metadata in it that tells you the revision number it maps to, <span style="font-size:10pt;background-color:transparent">e.g. </span><code style="font-size:10pt;background-color:transparent">Cr-Original-Commit-Position: refs/heads/master@{#<b>334285</b>}<font color="#000000" face="Arial, Verdana, sans-serif">.</font></code></li>
<li>Note that since upstream Chrome maps a single repository into many projects, the revision number that you choose from the main Chromium repository is unlikely to be present in the base, dbus, etc. repos. Instead, find the commits that are closest<span style="font-size:10pt"> to (but do not exceed) the revision number from the main repository.</span></li></ul>
<li><span style="font-size:10pt;background-color:transparent">Update the libchrome source on the Android aosp/master branch (this is the code that's built by the libchrome ebuild). This is a new, exciting process -- hope you're ready for an adventure!</span></li><ul><li><span style="font-size:10pt;background-color:transparent">Check out aosp/master if you don't have it already.</span></li><li><span style="font-size:10pt;background-color:transparent">The libchrome source lives in external/libchrome. Several pieces are brought together in this directory:</span></li><ul><li><span style="font-size:10pt;background-color:transparent">base/, build/build_config.h, components/timers/, crypto/, dbus/, and sandbox/ are copied wholesale from Chromium sub-repos.</span></li><li>Several small patches have been applied on top of the above code to get it to build. (In general, we try to upstream whatever changes we can.)</li><li>Additional files that are needed to build and test are under testing/ and third_party/.</li><li>Finally, there's an Android.mk file for building libchrome on Android, an SConstruct file for building it on Chrome OS, and MODULE_LICENSE_BSD and NOTICE files .</li></ul><li>The easiest approach here is probably something like:</li><ul><li>Identify all of the local changes that have been applied to the stock upstream code.</li><li>Copy in the new upstream code from the sub-repos.</li><li>Reapply the local changes.</li><li>Wrestle with libchrome until it builds for Android (Android always builds the most-recently-checked in code, so you need to get it compiling before you commit it).</li></ul></ul><li>Add a new libchrome-#### ebuild and update the revision it uses from the AOSP repository.</li>
<li>Add a new libchromeos-#### gyp file in src/platform/libchromeos/.</li>
<ul><li>Could be developed and even committed before the branch since it won't (yet) affect anything.</li></ul>
<li>Update the libchromeos code as needed by handling the new BASE_VER value.</li>
<ul><li>Could be developed and even committed before the branch since it won't (yet) affect anything.</li></ul>
<li>Update the platform2-9999.ebuild code to depend on the new libchrome version.</li>
<ul><li>Must be done after the branch as now the new libchrome ebuild will be pulled in &amp; compiled &amp; shipped in images.</li>
<li>Look for the LIBCHROME_VERS array and just add the new #### to it.</li></ul>
<li>Update the platform.gyp file in src/platform/common-mk/.</li>
<ul><li>Add the new libchromeos version to the targets.dependencies section.</li></ul>
<li>Start upgrading the various projects to the new libbase.</li>
<ul><li><span style="background-color:transparent;font-size:10pt">Upgrade packages that are looped by way of other libraries (e.g. libchaps needs libbase, so all projects that use libchaps) together.</span></li></ul>
<li>Once everyone has upgraded:</li>
<ul><li>Update the platform2-9999.ebuild to only depend on the latest libchrome version.</li>
<li>Update the platform.gyp to only include latest libchromeos version.</li>
<li>Drop the older libchromeos gyp files.</li>
<li>Remove all references to older BASE_VER in libchromeos code base.</li></ul></ul>
</div>
<p>This <i><b>really</b></i> should be done within a single development cycle so that we aren't wasting system resources by shipping (and having active) multiple libbase shared libraries. One of the advantages of using shared libraries is that all of the non-writable sections (like .text) get shared between processes, and that's defeated in part by multiple active libbase versions.</p></div></td></tr></tbody></table>
</div> 
</div> 
<div id="sites-canvas-bottom-panel">
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_page-subpages"> </div>
<div id="sites-attachments-container">
</div>
<a xmlns="http://www.w3.org/1999/xhtml" name="page-comments"></a>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_page-comments"><div class="sites-comment-docos-wrapper"><div class="sites-comment-docos"><div class="sites-comment-docos-background"></div><div class="sites-comment-docos-header"><div class="sites-comment-docos-header-title">Comments</div></div><div id="sites-comment-docos-pane" class="sites-comment-docos-pane"></div></div></div></div>
</div>
</div> 
</td> 
</tr>
</table> 
</div> 
</div> 
<div id="sites-chrome-footer-wrapper">
<div id="sites-chrome-footer-wrapper-inside">
<div id="sites-chrome-footer">
</div>
</div>
</div>
</div> 
</div> 
<div id="sites-chrome-adminfooter-container">
<div xmlns="http://www.w3.org/1999/xhtml" class="sites-adminfooter" role="navigation"><p><a class="sites-system-link" href="https://www.google.com/a/UniversalLogin?service=jotspot&amp;continue=http://sites.google.com/a/chromium.org/dev/chromium-os/packages/libchrome">Sign in</a><span aria-hidden="true">|</span><a class="sites-system-link" href="http://www.chromium.org/system/app/pages/recentChanges">Recent Site Activity</a><span aria-hidden="true">|</span><a class="sites-system-link" href="http://www.chromium.org/system/app/pages/reportAbuse" target="_blank">Report Abuse</a><span aria-hidden="true">|</span><a class="sites-system-link" href="javascript:;" onclick="window.open(webspace.printUrl)">Print Page</a><span aria-hidden="true">|</span><span class="sites-system-link">Powered By</span> <b class="powered-by"><a href="http://sites.google.com">Google Sites</a></b></p></div>
</div>
</div> 
</div> 
<div id="sites-chrome-onebar-footer">
</div>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    window.jstiming.load.tick('sjl');
  </script>
<script xmlns="http://www.w3.org/1999/xhtml" src="http://www.gstatic.com/sites/p/56e332/system/js/jot_min_view__en.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    window.jstiming.load.tick('jl');
  </script>
<script xmlns="http://www.w3.org/1999/xhtml">
      
          sites.core.Analytics.createTracker();
          sites.core.Analytics.trackPageview();
        
    </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
                    sites.Searchbox.initialize(
                        'sites-searchbox-search-button',
                        {"object":[]}['object'],
                        'search-site',
                        {"label":"Configure search options...","url":"/system/app/pages/admin/settings"});
                  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
      gsites.HoverPopupMenu.createSiteDropdownMenus('sites-header-nav-dropdown', false);
    </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
            JOT_setupNav("7648876402527094", "Navigation", false);
            JOT_addListener('titleChange', 'JOT_NAVIGATION_titleChange', 'COMP_7648876402527094');
          </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
            JOT_setupNav("14720868319272995", "Quick links", false);
            JOT_addListener('titleChange', 'JOT_NAVIGATION_titleChange', 'COMP_14720868319272995');
          </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
            JOT_setupNav("19690813310444355", "Other sites", false);
            JOT_addListener('titleChange', 'JOT_NAVIGATION_titleChange', 'COMP_19690813310444355');
          </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
              new sites.CommentPane('//docs.google.com/comments/d/AAHRpnXvrAwjAfmld0ObrebBiGRq9Ky4vwsySGFCxIszRp7uwm39YnmC-nWIRhiWuxwWmvZNeaUlWOOvo_U8jzZV2fhnTay6jNH9jcyKFm6sm7F-BR_c7lJvN2HR8wboWbXUBzQt8fJ7M/api/js?anon=true',
                  false, false);
            </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
  setTimeout(function() {
    var fingerprint = gsites.date.TimeZone.getFingerprint([]);
    gsites.Xhr.send('http://www.chromium.org/_/tz', null, null, 'GET', null, null, { afjstz: fingerprint });
  }, 500);
</script>
<script xmlns="http://www.w3.org/1999/xhtml">
                    window.onload = function() {
                      if (false) {
                        JOT_setMobilePreview();
                      }
                      var loadTimer = window.jstiming.load;
                      loadTimer.tick("ol");
                      loadTimer["name"] = "load," + webspace.page.type + ",user_page";
                      window.jstiming.report(loadTimer, {}, 'http://csi.gstatic.com/csi');
                    }
                  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
        JOT_insertAnalyticsCode(false,
            false);
      </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    var maestroRunner = new gsites.pages.view.SitesMaestroRunner(
        webspace, "en");
    maestroRunner.initListeners();
    maestroRunner.installEditRender();
  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
  //<![CDATA[
    // Decorate any fastUI buttons on the page with a class of 'goog-button'.
    if (webspace.user.hasWriteAccess) {
      JOT_decorateButtons();
    }

    // Fires delayed events.
    (function() {
      JOT_fullyLoaded = true;
      var delayedEvents = JOT_delayedEvents;
      for (var x = 0; x < delayedEvents.length; x++) {
        var event = delayedEvents[x];
        JOT_postEvent(event.eventName, event.eventSrc, event.payload);
      }
      JOT_delayedEvents = null;
      JOT_postEvent('pageLoaded');
    })();
  //]]>
</script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    JOT_postEvent('decorateGvizCharts');
  </script>
<script type="text/javascript">
          JOT_setupPostRenderingManager();
        </script>
<script type="text/javascript">
          JOT_postEvent('renderPlus', null, 'sites-chrome-main');
        </script>
<div id="server-timer-div" style="display:none"> </div>
<script type="text/javascript">
          window.jstiming.load.tick('render');
          JOT_postEvent('usercontentrendered', this);
        </script>
</body>
</html>
