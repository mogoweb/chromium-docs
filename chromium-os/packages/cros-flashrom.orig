<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/WebPage">
<head>
<meta http-equiv="X-UA-Compatible" content="chrome=1" />
<script type="text/javascript">/* Copyright 2008 Google. */ (function() { var e="wtsrt_",g="tbsd_",h="tbnd_",k="start",l="_wtsrt",m="_tbnd",n="CSI/";(function(){function f(a){this.t={};this.tick=function(a,c,b){this.t[a]=[void 0!=b?b:(new Date).getTime(),c];if(void 0==b)try{window.console.timeStamp(n+a)}catch(d){}};this.tick(k,null,a)}var a;window.performance&&(a=window.performance.timing);var p=a?new f(a.responseStart):new f;window.jstiming={Timer:f,load:p};if(a){var c=a.navigationStart,d=a.responseStart;0<c&&d>=c&&(window.jstiming.srt=d-c)}if(a){var b=window.jstiming.load;0<c&&d>=c&&(b.tick(l,void 0,c),b.tick(e,l,d),b.tick(g,e))}try{a=null,
window.chrome&&window.chrome.csi&&(a=Math.floor(window.chrome.csi().pageT),b&&0<c&&(b.tick(m,void 0,window.chrome.csi().startE),b.tick(h,m,c))),null==a&&window.gtbExternal&&(a=window.gtbExternal.pageT()),null==a&&window.external&&(a=window.external.pageT,b&&0<c&&(b.tick(m,void 0,window.external.startE),b.tick(h,m,c))),a&&(window.jstiming.pt=a)}catch(q){}})(); })()
</script>
<link rel="shortcut icon" href="/_/rsrc/1354323194313/favicon.ico" type="image/x-icon" />
<link rel="apple-touch-icon" href="https://ssl.gstatic.com/sites/p/56e332/system/app/images/apple-touch-icon.png" type="image/png" />
<script type="text/javascript">/* Copyright 2008 Google. */ (function() { var d="",g="__duration__",h="function";function k(c){return document.getElementById(c)}window.byId=k;function l(c){return c.replace(/^\s+|\s+$/g,d)}window.trim=l;var m=[],n=0;window.JOT_addListener=function(c,a,b){var e=new String(n++);c={eventName:c,handler:a,compId:b,key:e};m.push(c);return e};window.JOT_removeListenerByKey=function(c){for(var a=0;a<m.length;a++)if(m[a].key==c){m.splice(a,1);break}};
window.JOT_removeAllListenersForName=function(c){for(var a=0;a<m.length;a++)m[a].eventName==c&&m.splice(a,1)};window.JOT_postEvent=function(c,a,b){var e={eventName:c,eventSrc:a||{},payload:b||{}};if(window.JOT_fullyLoaded)for(a=m.length,b=0;b<a&&b<m.length;b++){var f=m[b];f&&f.eventName==c&&(e.listenerCompId=f.compId||d,(f=typeof f.handler==h?f.handler:window[f.handler])&&f(e))}else window.JOT_delayedEvents.push({eventName:c,eventSrc:a,payload:b})};window.JOT_delayedEvents=[];
window.JOT_fullyLoaded=!1;window.JOT_formatRelativeToNow=function(c,a){var b=((new Date).getTime()-c)/6E4;if(1440<=b||0>b)return null;var e=0;60<=b&&(b/=60,e=2);2<=b&&e++;return a?window.JOT_siteRelTimeStrs[e].replace(g,Math.floor(b)):window.JOT_userRelTimeStrs[e].replace(g,Math.floor(b))}; })()
</script>
<script>

  

  var breadcrumbs = [{"path":"/chromium-os","deleted":false,"title":"Chromium OS","dir":"ltr"},{"path":"/chromium-os/packages","deleted":false,"title":"packages","dir":"ltr"},{"path":"/chromium-os/packages/cros-flashrom","deleted":false,"title":"flashrom","dir":"ltr"}];
  var JOT_clearDotPath = 'https://ssl.gstatic.com/sites/p/56e332/system/app/images/cleardot.gif';

  
  var JOT_userRelTimeStrs = ["a minute ago","__duration__ minutes ago","an hour ago","__duration__ hours ago"];

  
  

  

  var webspace = {"enableAnalytics":true,"pageSharingId":"jotspot_page","enableUniversalAnalytics":false,"sharingPolicy":"OPENED_WITH_INDICATOR","siteTitle":"The Chromium Projects","isStartPageEnabled":true,"adsensePublisherId":null,"features":{"languageSelectDefaultTextSetToDefault":true,"validateClientGvizDataSourceUrls":true,"moreMobileStyleImprovements":true,"newInsertMenuIcons":true,"accessibleSortingButtons":true,"domainAnalyticsInGAOnly":true,"noCaptcha":true,"fileCabinetScreenReaderFix":true,"updatedTosAndPrivacyLinks":null,"pageDrafts":false,"mobileOrientationFix":true,"plusBadge":false,"pdfEmbedSupport":false,"jsClickFix":true},"isPublic":true,"isConsumer":false,"serverFlags":{"cajaBaseUrl":"//www.gstatic.com/caja","cajaDebugMode":false},"onepickBaseUrl":"https://docs.google.com","domainAnalyticsAccountId":"","plusPageId":"","signInUrl":"https://www.google.com/a/SelectSession?continue\u003dhttps://sites.google.com/a/chromium.org/dev/chromium-os/packages/cros-flashrom\u0026service\u003djotspot","analyticsAccountId":"UA-5484340-1","scottyUrl":"/_/upload","homePath":"/","siteNoticeUrlEnabled":null,"plusPageUrl":"","adsensePromoClickedOrSiteIneligible":true,"csiReportUri":"https://gg.google.com/csi","sharingId":"jotspot","termsUrl":"//www.google.com/intl/en/policies/terms/","gvizVersion":1,"editorResources":{"sitelayout":["https://ssl.gstatic.com/sites/p/56e332/system/app/css/sitelayouteditor.css"],"text":["https://ssl.gstatic.com/sites/p/56e332/system/js/codemirror.js","https://ssl.gstatic.com/sites/p/56e332/system/app/css/codemirror_css.css","https://ssl.gstatic.com/sites/p/56e332/system/js/trog_edit__en.js","https://ssl.gstatic.com/sites/p/56e332/system/app/css/trogedit.css","/_/rsrc/1441580320000/system/app/css/editor.css","https://ssl.gstatic.com/sites/p/56e332/system/app/css/codeeditor.css","/_/rsrc/1441580320000/system/app/css/camelot/editor-jfk-wlb.css"]},"sharingUrlPrefix":"/_/sharing","isAdsenseEnabled":true,"domain":"chromium.org","baseUri":"","name":"dev","siteTemplateId":false,"siteNoticeRevision":null,"siteNoticeUrlAddress":null,"siteNoticeMessage":null,"page":{"isRtlLocale":false,"canDeleteWebspace":null,"isPageDraft":null,"parentPath":"/chromium-os/packages","parentWuid":"wuid:gx:69207dc28a432611","siteLocale":"en","timeZone":"America/Los_Angeles","type":"text","title":"flashrom","locale":"en","wuid":"wuid:gx:189240ce9fdfb517","revision":31,"path":"/chromium-os/packages/cros-flashrom","isSiteRtlLocale":false,"pageInheritsPermissions":null,"name":"cros-flashrom","canChangePath":true,"state":"","properties":{},"bidiEnabled":false,"currentTemplate":{"path":"/system/app/pagetemplates/text","title":"Web Page"}},"canPublishScriptToAnyone":true,"user":{"keyboardShortcuts":true,"sessionIndex":"","guest_":true,"displayNameOrEmail":"guest","userName":"guest","uid":"","renderMobile":false,"domain":"","namespace":"","hasWriteAccess":false,"namespaceUser":false,"primaryEmail":"guest","hasAdminAccess":false},"gadgets":{"baseUri":"/system/app/pages/gadgets"}};
  webspace.page.breadcrumbs = breadcrumbs;

  
  var JOT_siteRelTimeStrs = ["a minute ago","__duration__ minutes ago","an hour ago","__duration__ hours ago"];

</script>
<script type="text/javascript">
                window.jstiming.load.tick('scl');
              </script>
<meta name="title" content="flashrom - The Chromium Projects" />
<meta itemprop="name" content="flashrom - The Chromium Projects" />
<meta property="og:title" content="flashrom - The Chromium Projects" />
<meta name="description" content="Home of the Chromium Open Source Project" />
<meta itemprop="description" content="Home of the Chromium Open Source Project" />
<meta id="meta-tag-description" property="og:description" content="Home of the Chromium Open Source Project" />
<style type="text/css">
</style>
<link rel="stylesheet" type="text/css" href="https://ssl.gstatic.com/sites/p/56e332/system/app/themes/beigeandblue/standard-css-beigeandblue-ltr-ltr.css" />
<link rel="stylesheet" type="text/css" href="/_/rsrc/1441580320000/system/app/css/overlay.css?cb=beigeandblueundefineda100%25%25150goog-ws-leftthemedefaultstandard" />
<link rel="stylesheet" type="text/css" href="/_/rsrc/1441580320000/system/app/css/camelot/allthemes-view.css" />
<!--[if IE]>
          <link rel="stylesheet" type="text/css" href="/system/app/css/camelot/allthemes%2die.css" />
        <![endif]-->
<title>flashrom - The Chromium Projects</title>
<meta itemprop="image" content="/_/rsrc/1438879449147/config/customLogo.gif?revision=3" />
<meta property="og:image" content="/_/rsrc/1438879449147/config/customLogo.gif?revision=3" />
<script type="text/javascript">
                window.jstiming.load.tick('cl');
              </script>
</head>
<body xmlns="http://www.google.com/ns/jotspot" id="body" class=" en            ">
<div id="sites-page-toolbar" class="sites-header-divider">
<div xmlns="http://www.w3.org/1999/xhtml" id="sites-status" class="sites-status" style="display:none;"><div id="sites-notice" class="sites-notice" role="status" aria-live="assertive"> </div></div>
</div>
<div id="sites-chrome-everything-scrollbar">
<div id="sites-chrome-everything" class="">
<div id="sites-chrome-page-wrapper" style="direction: ltr">
<div id="sites-chrome-page-wrapper-inside">
<div xmlns="http://www.w3.org/1999/xhtml" id="sites-chrome-header-wrapper" style="height:auto;">
<table id="sites-chrome-header" class="sites-layout-hbox" cellspacing="0" style="height:auto;">
<tr class="sites-header-primary-row" id="sites-chrome-userheader">
<td id="sites-header-title" class="" role="banner"><div class="sites-header-cell-buffer-wrapper"><a href="https://www.chromium.org/" id="sites-chrome-userheader-logo"><img id="logo-img-id" src="/_/rsrc/1438879449147/config/customLogo.gif?revision=3" alt="The Chromium Projects" class="sites-logo  " /></a><h2><a href="https://www.chromium.org/" dir="ltr" id="sites-chrome-userheader-title">The Chromium Projects</a></h2></div></td><td class="sites-layout-searchbox  "><div class="sites-header-cell-buffer-wrapper"><form id="sites-searchbox-form" action="/system/app/pages/search" role="search"><input type="hidden" id="sites-searchbox-scope" name="scope" value="search-site" /><input type="text" id="jot-ui-searchInput" name="q" size="20" value="" aria-label="Search this site" /><div id="sites-searchbox-button-set" class="goog-inline-block"><div role="button" id="sites-searchbox-search-button" class="goog-inline-block jfk-button jfk-button-standard" tabindex="0">Search this site</div></div></form></div></td>
</tr>
<tr class="sites-header-secondary-row" id="sites-chrome-horizontal-nav">
<td colspan="2" id="sites-chrome-header-horizontal-nav-container" role="navigation">
</td>
</tr>
</table>
</div>
<div id="sites-chrome-main-wrapper">
<div id="sites-chrome-main-wrapper-inside">
<table id="sites-chrome-main" class="sites-layout-hbox" cellspacing="0" cellpadding="{scmCellpadding}" border="0">
<tr>
<td id="sites-chrome-sidebar-left" class="sites-layout-sidebar-left initial" style="width:150px">
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_7648876402527094" class="sites-embed" role="navigation"><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotId="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="/chromium-projects" jotId="wuid:gx:10ae433dadbbab13" class="sites-navigation-link">Home</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="/Home" jotId="wuid:gx:43582b9d2029d3af" class="sites-navigation-link">Chromium</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="/chromium-os" jotId="wuid:gx:83df2ab1f8880ba" class="sites-navigation-link">Chromium OS</a></div></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_14720868319272995" class="sites-embed" role="navigation"><h4 class="sites-embed-title">Quick links</h4><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotId="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="http://www.chromium.org/for-testers/bug-reporting-guidelines" class="sites-navigation-link">Report bugs</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="http://www.chromium.org/developers/discussion-groups" class="sites-navigation-link">Discuss</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="/system/app/pages/sitemap/hierarchy" jotId="wuid:gx:4c0f552cb393ed23" class="sites-navigation-link">Sitemap</a></div></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_19690813310444355" class="sites-embed" role="navigation"><h4 class="sites-embed-title">Other sites</h4><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotId="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="http://blog.chromium.org/" class="sites-navigation-link">Chromium Blog</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="http://code.google.com/chrome/extensions/" class="sites-navigation-link">Google Chrome Extensions</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="https://developers.google.com/chrome/chrome-frame/" class="sites-navigation-link">Google Chrome Frame</a></div></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_19695218559354544" class="sites-embed" role="complementary"><h4 class="sites-embed-title"></h4><div class="sites-embed-content sites-embed-content-sidebar-textbox"><div dir="ltr"><span style="font-size:x-small">Except as otherwise </span><a href="http://developers.google.com/site-policies.html#restrictions"><span style="font-size:x-small">noted</span></a><span style="font-size:x-small">, the content of this page is licensed under a </span><a href="http://creativecommons.org/licenses/by/2.5/"><span style="font-size:x-small">Creative Commons Attribution 2.5 license</span></a><span style="font-size:x-small">, and examples are licensed under the </span><a href="http://src.chromium.org/viewvc/chrome/trunk/src/LICENSE" target="_blank"><span style="font-size:x-small">BSD License</span></a><span style="font-size:x-small">.<br /></span></div></div></div>
</td>
<td id="sites-canvas-wrapper">
<div id="sites-canvas" role="main">
<div id="goog-ws-editor-toolbar-container"> </div>
<div xmlns="http://www.w3.org/1999/xhtml" id="title-crumbs" style="">
<A href="/chromium-os" dir="ltr">Chromium OS</A>‎ &gt; ‎<A href="/chromium-os/packages" dir="ltr">packages</A>‎ &gt; ‎
  </div>
<h3 xmlns="http://www.w3.org/1999/xhtml" id="sites-page-title-header" style="" align="left">
<span id="sites-page-title" dir="ltr" tabindex="-1" style="outline: none">flashrom</span>
</h3>
<div id="sites-canvas-main" class="sites-canvas-main">
<div id="sites-canvas-main-content">
<table xmlns="http://www.w3.org/1999/xhtml" cellspacing="0" class="sites-layout-name-one-column sites-layout-hbox"><tbody><tr><td class="sites-layout-tile sites-tile-name-content-1"><div dir="ltr"><div><b><font size="4"><div><div class="sites-embed-align-left-wrapping-off"><div class="sites-embed-border-off sites-embed" style="width:500px;"><div class="sites-embed-content sites-embed-type-toc"><div class="goog-toc sites-embed-toc-maxdepth-6"><p>Contents</p><ol class="goog-toc"><li class="goog-toc"><a href="#TOC-Overview"><strong>1 </strong>Overview</a></li><li class="goog-toc"><a href="#TOC-Basic-Usage"><strong>2 </strong>Basic Usage</a></li><li class="goog-toc"><a href="#TOC-Servo"><strong>3 </strong>Servo</a></li><li class="goog-toc"><a href="#TOC-Partial-Reads-and-Writes"><strong>4 </strong>Partial Reads and Writes</a><ol class="goog-toc"><li class="goog-toc"><a href="#TOC-Selectively-include-regions"><strong>4.1 </strong>Selectively include regions</a></li><li class="goog-toc"><a href="#TOC-Layout"><strong>4.2 </strong>Layout</a></li><li class="goog-toc"><a href="#TOC-Selective-verification-of-partial-writes"><strong>4.3 </strong>Selective verification of partial writes</a></li><li class="goog-toc"><a href="#TOC-Speeding-Up-Writes"><strong>4.4 </strong>Speeding Up Writes</a></li></ol></li><li class="goog-toc"><a href="#TOC-Power-management-pitfalls-to-watch-out-for"><strong>5 </strong>Power management pitfalls to watch out for</a></li><li class="goog-toc"><a href="#TOC-Embedded-Controller-interactions"><strong>6 </strong>Embedded Controller interactions</a></li><li class="goog-toc"><a href="#TOC-Performance"><strong>7 </strong>Performance</a></li></ol></div></div></div></div></div></font></b></div><b><font size="4"><h2><a name="TOC-Overview"></a><b style="font-size:10pt;background-color:transparent"><font size="4">Overview</font></b></h2></font></b><div><span style="font-size:10pt;background-color:transparent">Flashrom is a userspace utility we use primarily to update host (AP/PCH) firmware, but can also be used to update firmware on other components such as ECs. it can be run both on the target machine (field updates) or on a user's workstation to flash via an external programmer such as Servo, Dediprog SF100, Bus Pirate and more.</span></div><div><br /></div><div>Flashrom is an open-source project hosted at <a href="http://flashrom.org">http://flashrom.org</a>. The version which is used in ChromeOS devices and in the CrOS SDK is a forked version with some CrOS-specific modifications.</div><h2><a name="TOC-Basic-Usage"></a><font size="4"><b>Basic Usage</b></font></h2><div><span style="font-family:Arial;font-size:small;white-space:pre-wrap;background-color:transparent">This section will cover basic command-line usage. The most commonly used command-line switches are:</span></div><div><span><span style="font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent"><font size="2"><br /></font></span></span></div><div><p style="font-size:small;line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-family:Courier New;line-height:1.15;white-space:pre-wrap;background-color:transparent"> -r | --read                       read flash and save to file</span></p><p dir="ltr" style="font-size:small;line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-family:Courier New;vertical-align:baseline;white-space:pre-wrap;background-color:transparent"> -w | --write                      write to flash</span></p><p dir="ltr" style="font-size:small;line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-family:Courier New;vertical-align:baseline;white-space:pre-wrap;background-color:transparent"> -p | --programmer &lt;name&gt;[:&lt;param] specify the programmer device and parameters</span></p><p dir="ltr" style="font-size:small;line-height:1.15;margin-top:0pt;margin-bottom:0pt"><br /></p><p dir="ltr" style="margin-top:0pt;margin-bottom:0pt"><span style="font-size:small;line-height:1.15;font-family:Courier New;vertical-align:baseline;white-space:pre-wrap;background-color:transparent"><span style="font-family:Arial,Verdana,sans-serif;font-size:13px;line-height:normal;white-space:normal">The "-p" argument tells us which programmer interface we are targeting. Examples include "host", "ec", or "</span></span><span style="background-color:transparent">ft2232_spi:type=servo-v2" (see section on Servo below). </span><span style="font-family:Arial;font-size:small;white-space:pre-wrap;background-color:transparent">For a full listing of command-line switches, use -h or --help.</span></p><p dir="ltr" style="margin-top:0pt;margin-bottom:0pt"><span style="background-color:transparent"><br /></span></p><p dir="ltr" style="margin-top:0pt;margin-bottom:0pt"><span style="background-color:transparent">The following commands have to do with write-protection:</span></p><div><span style="font-family:Courier New;font-size:small;white-space:pre-wrap;background-color:transparent"> --wp-status                       show write protect status</span></div><div><span><span style="font-size:small;font-family:Courier New;vertical-align:baseline;white-space:pre-wrap;background-color:transparent"> --wp-range                        set write protect range</span><span style="font-size:small;font-family:Courier New;vertical-align:baseline;white-space:pre-wrap;background-color:transparent"><br /></span><span style="font-size:small;font-family:Courier New;vertical-align:baseline;white-space:pre-wrap;background-color:transparent"> --wp-enable                       enable write protection</span><span style="font-size:small;font-family:Courier New;vertical-align:baseline;white-space:pre-wrap;background-color:transparent"><br /></span><span style="font-size:small;font-family:Courier New;vertical-align:baseline;white-space:pre-wrap;background-color:transparent"> --wp-disable                      disable write protection</span></span></div><div><br /></div><div>Some examples of basic usage, these are all run on the device itself:</div><div><br /></div><div>If you want to read the firmware from the SPI:</div><div><font face="courier new, monospace">$ flashrom -p host -r image.bin</font></div><div><br /></div><div>If you want to write a firmware image to the SPI:</div><div><font face="courier new, monospace">$ flashrom -p host -w image.bin</font></div><div><br /></div><div>If you want to read the ec image from the EC:</div><div><font face="courier new, monospace">$ flashrom -p ec -r ec.bin</font></div><div><br /></div><div>If you want to write an ec image to the EC:</div><div><font face="courier new, monospace">$ flashrom -p ec -w ec.bin</font></div><div><br /></div><div>If you just want to update your firmware and EC to the latest version in your Chrome OS system, ignoring any safety checks, run the below which invokes flashrom for you:</div><div><font face="courier new, monospace">$ chromeos-firmwareupdate --mode=incompatible_update</font></div><div><font face="courier new, monospace"><br /></font></div><div><b><font color="#ff0000">Warning</font>:</b> when running <font face="courier new, monospace">flashrom</font> on an x86 host, the Intel Management Engine (ME) firmware region will be read back as 0xff bytes, and writes to the ME region will be silently discarded.  This means that if you make a backup of your flash contents with <font face="courier new, monospace">flashrom -p host -r backup.bin</font><font face="arial, sans-serif"> and then try to restore </font><font face="courier new, monospace">backup.bin</font><font face="arial, sans-serif"> via servo, the ME region will be overwritten with 0xff bytes and your system will no longer boot.  The ME region can be identified by running </font><font face="courier new, monospace">dump_fmap</font><font face="arial, sans-serif"> on the firmware image; here is an example from Link:</font></div><div><font face="arial, sans-serif"><br /></font></div><div><div><font face="courier new, monospace">area:            3</font></div><div><font face="courier new, monospace">area_offset:     0x00001000</font></div><div><font face="courier new, monospace">area_size:       0x001ff000 (2093056)</font></div><div><font face="courier new, monospace">area_name:       SI_ME</font></div><div style="font-family:arial,sans-serif"><br /></div></div><div><span style="font-family:arial,sans-serif">The </span><font face="courier new, monospace">/usr/sbin/chromeos-firmwareupdate</font><font face="arial, sans-serif"> script contains a copy of the factory BIOS image (including the ME firmware), if you've already run into this problem.</font></div><h2><a name="TOC-Servo"></a><span><span style="vertical-align:baseline;white-space:pre-wrap;background-color:transparent"><font face="arial, sans-serif" size="3"><b>Servo</b></font></span></span></h2><div><span style="font-size:10pt;background-color:transparent">Servo has an FT2232 USB &lt;--&gt; SPI interface which Flashrom can use to pass commands thru to the SPI chip. All you need to do is set the programmer </span><font face="arial, sans-serif" style="font-size:10pt;background-color:transparent">target (-p <span style="font-size:small;white-space:pre-wrap;background-color:transparent">ft2232_spi:type=servo-v2) and enable/disable the buffers on the flex cable using dut-control (from the <b>hdctools</b> package).</span></font></div><div><font face="arial, sans-serif"><span style="font-size:small;white-space:pre-wrap;background-color:transparent"><br /></span></font></div><div><font face="arial, sans-serif"><span style="font-size:small;white-space:pre-wrap;background-color:transparent">One thing to watch for is the voltage argument to dut-control. Most SPI chips operate at either 1.8V or 3.3V. This is set by spi2_vref:ppXXXX where XXXX is 1800 or 3300.</span></font></div><div><br /></div><div>Example for programming a 1.8V SPI chip:</div><div><span><span style="vertical-align:baseline;background-color:transparent;white-space:pre-wrap"><font face="courier new, monospace" size="2"><div>$ dut-control <font color="#ff0000">spi2_vref:pp1800</font> spi2_buf_en:on spi2_buf_on_flex_en:on spi_hold:off cold_reset:on</div><div>$ sudo /usr/sbin/flashrom -p ft2232_spi:type=servo-v2 -w &lt;image to program&gt;</div><div>$ dut-control spi2_vref:off spi2_buf_en:off spi2_buf_on_flex_en:off spi_hold:off cold_reset:off</div></font></span></span></div><div><span><span style="vertical-align:baseline;white-space:pre-wrap;background-color:transparent"><font face="arial, sans-serif" size="3"><b><br /></b></font></span></span></div><div>Typically this will write out the entire flash image, so it is necessary to physically remove the write-protect screw in order for the operation to succeed.</div><div><br /></div><div>More details about how to run it with Servo are available <a href="https://www.chromium.org/chromium-os/servo">here</a> and <a href="http://go/cros-servo">here (for Googlers only)</a>.</div><p dir="ltr" style="font-size:small;line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent"><br /></span></p><h2 style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><a name="TOC-Partial-Reads-and-Writes"></a><span style="font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent"><b><font size="3">Partial Reads and Writes</font></b></span></h2><p dir="ltr" style="font-size:small;line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent"><br /></span></p><p dir="ltr" style="font-size:small;line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent"><span style="line-height:normal">Flashrom can be instructed to target only a specific region on the flash chip. This allows scripts (especially factory installer and autoupdate) to selectively update regions without spending a lot of time reading or updating the entire flash memory.</span></span></p><p dir="ltr" style="font-size:small;line-height:1.15;margin-top:0pt;margin-bottom:0pt"><br /></p><h3 style="font-size:small;line-height:1.15;margin-top:0pt;margin-bottom:0pt"><a name="TOC-Selectively-include-regions"></a><b>Selectively include regions</b></h3><p style="font-size:small;line-height:1.15;margin-top:0pt;margin-bottom:0pt">To include a region in a read/write operation, use the -i option:</p><p dir="ltr" style="margin-top:0pt;margin-bottom:0pt"><span style="vertical-align:baseline;background-color:transparent;line-height:14.9499998092651px;white-space:pre-wrap"><font face="Courier New" size="2"> -i | --image &lt;name&gt;[:&lt;file&gt;]      only access image &lt;name&gt; from flash layout</font></span></p><p dir="ltr" style="margin-top:0pt;margin-bottom:0pt"><span style="vertical-align:baseline;background-color:transparent;line-height:14.9499998092651px;white-space:pre-wrap"><font face="arial, sans-serif" size="2"><br /></font></span></p><p style="margin-top:0pt;margin-bottom:0pt"><font size="2"><span style="line-height:14.9499998092651px;white-space:pre-wrap"><font face="arial, sans-serif">The [:&lt;file&gt;] argument is optional and has an interesting effect on -r and -w. If a file is not supplied, flashrom will operate on a file that is the same size as the targeted flash chip. For example, if you wish to write sections FOO and BAR from a 4MB file to a 4MB flash chip, you could do:</font><font face="courier new, monospace"> flashrom -p &lt;programmer&gt; -i FOO -i BAR -w filename.bin</font></span></font></p><p style="margin-top:0pt;margin-bottom:0pt"><font size="2"><span style="line-height:14.9499998092651px;white-space:pre-wrap"><font face="courier new, monospace"><br /></font></span></font></p><div><font size="2"><font face="courier new, monospace"><div class="sites-embed-align-left-wrapping-off"><div class="sites-embed-border-on sites-embed" style="width:200px;"><div class="sites-embed-object-title" style="display:none;">Partial Write Method A</div><div class="sites-embed-content sites-embed-type-sketchy"><iframe src="https://docs.google.com/drawings/d/1dIS_ffpG6Hk63QB9q_qGEfBnArNuHizIvHhW7TXmhFk/preview?h=150&amp;hl=en&amp;w=200" width="200" height="150" title="Partial Write Method A" frameborder="0" id="246820407" allowfullscreen="true" mozallowfullscreen="true" webkitallowfullscreen="true"></iframe></div></div></div></font></font></div><font size="2"><font face="courier new, monospace"><br /></font></font><p style="margin-top:0pt;margin-bottom:0pt"><font face="arial, sans-serif" size="2"><span style="line-height:14.9499998092651px;white-space:pre-wrap"><br /></span></font></p><p style="margin-top:0pt;margin-bottom:0pt"><font size="2"><span style="line-height:14.9499998092651px;white-space:pre-wrap"><font face="arial, sans-serif">If a file is supplied, flashrom will not require an argument to -w or -r and instead will work with the files supplied via -i. So if you have separate files for FOO and BAR which are not part of a larger image, let's call them foo.bin and bar.bin, you can write them to the firmware ROM like so: </font><font face="courier new, monospace">flashrom -p &lt;programmer&gt; -i FOO:foo.bin BAR:bar.bin -w</font></span></font></p><p style="margin-top:0pt;margin-bottom:0pt"><font face="arial, sans-serif" size="2"><span style="line-height:14.9499998092651px;white-space:pre-wrap"><br /></span></font></p><div><font face="arial, sans-serif" size="2"><div class="sites-embed-align-left-wrapping-off"><div class="sites-embed-border-on sites-embed" style="width:200px;"><div class="sites-embed-object-title" style="display:none;">Partial Write Method B</div><div class="sites-embed-content sites-embed-type-sketchy"><iframe src="https://docs.google.com/drawings/d/11Z9XJ0iutP-nL-14xK14R_R6d9NsgkAs__CNvFbDL5Y/preview?h=150&amp;hl=en&amp;w=200" width="200" height="150" title="Partial Write Method B" frameborder="0" id="1586833842" allowfullscreen="true" mozallowfullscreen="true" webkitallowfullscreen="true"></iframe></div></div></div></font></div><font face="arial, sans-serif" size="2"><br /></font><p style="margin-top:0pt;margin-bottom:0pt"><font face="arial, sans-serif" size="2"><span style="line-height:14.9499998092651px;white-space:pre-wrap"><br /></span></font></p><h3 style="margin-top:0pt;margin-bottom:0pt"><a name="TOC-Layout"></a><font face="arial, sans-serif" size="2"><span style="line-height:14.9499998092651px;white-space:pre-wrap"><b>Layout</b></span></font></h3><p style="margin-top:0pt;margin-bottom:0pt"><span style="line-height:14.9499998092651px;white-space:pre-wrap;font-family:arial,sans-serif;font-size:small;background-color:transparent">When -i is used, Flashrom will search for the flashmap (fmap) and compare region names with the name supplied by the user. If the user wishes to supply a custom mapping instead of using the flashmap, a layout file can be used:</span></p><p style="margin-top:0pt;margin-bottom:0pt"><span style="font-family:Courier New;font-size:small;line-height:14.9499998092651px;white-space:pre-wrap;background-color:transparent"> -l | --layout                     read ROM layout from &lt;file&gt;</span></p><p style="margin-top:0pt;margin-bottom:0pt"><span style="font-family:arial,sans-serif"><br /></span></p><p style="margin-top:0pt;margin-bottom:0pt">For example, this will write the custom-defined ranges from the supplied filename to the ROM:</p><p style="margin-top:0pt;margin-bottom:0pt"><font face="courier new, monospace">echo "000000:0fffff FOO" &gt; layout.txt</font></p><p style="margin-top:0pt;margin-bottom:0pt"><font face="courier new, monospace">echo "200000:2fffff BAR" &gt;&gt; layout.txt</font></p><p style="margin-top:0pt;margin-bottom:0pt"><span style="font-family:courier new,monospace;font-size:10pt;background-color:transparent">flashrom -p &lt;programmer&gt; -l layout.txt -i FOO -i BAR -w filename.bin</span></p><p style="margin-top:0pt;margin-bottom:0pt"><br /></p><h3 style="margin-top:0pt;margin-bottom:0pt"><a name="TOC-Selective-verification-of-partial-writes"></a><b>Selective verification of partial writes</b></h3><p style="margin-top:0pt;margin-bottom:0pt">By default, flashrom verifies the result of any destructive operation by reading and comparing the entire ROM. To only verify portions which have supposedly been written, <font face="courier new, monospace">--fast-verify</font> can be used:</p><p style="margin-top:0pt;margin-bottom:0pt"><font face="courier new, monospace">   --fast-verify                     only verify -i part</font></p><p style="margin-top:0pt;margin-bottom:0pt"><font face="courier new, monospace"><br /></font></p><p style="margin-top:0pt;margin-bottom:0pt"><font face="arial, sans-serif">This is generally considered safe since a discrepancy in the partially written portions will indicate that something is likely wrong elsewhere.</font></p><p style="margin-top:0pt;margin-bottom:0pt"><font face="courier new, monospace"><br /></font></p><p style="margin-top:0pt;margin-bottom:0pt"><font face="arial, sans-serif">TODO(dhendrix): That should probably be renamed "--partial-verify" or something.</font></p><p style="margin-top:0pt;margin-bottom:0pt"><br /></p><h3 style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><a name="TOC-Speeding-Up-Writes"></a><b><font size="3">Speeding Up Writes</font></b></h3></div><div><br /></div><div>This section describes some shortcuts that can be useful for developers. <b>Do not rely on the behavior described below for production code</b>. It's really only intended to help developers iterate faster.</div><div><br /></div><div>Erase and write operations are orders of magnitude slower than reads on typical flash memory devices. Thus, flashrom figures out which blocks need to be updated so that it can try and skip as many as possible. The basic steps are:</div><div><ol><li>Read entire ROM to obtain a reference image before any destructive operation takes place.</li><li>Go thru write algorithm and only erase/write blocks as needed.</li><li>Read the ROM again to verify that it matches the supplied file.</li></ol><div>The main way to speed things up is to skip the first and last verification steps.</div></div><div><br /></div><div><b>Skipping verification</b></div><div>If you're confident that the bits will land where they need to, you can save time by skipping the verification step.</div><div><span style="font-size:10pt;background-color:transparent"><font face="courier new, monospace">   -n | --noverify                   don't auto-verify</font></span></div><div><br /></div><div><b>Supplying original ROM content with a file</b></div><div>This will allow you to skip the initial step of obtaining a reference image:</div><div><span style="font-family:courier new,monospace">   --diff &lt;file&gt;                     diff from file instead of ROM</span></div><div><br /></div><div>This tells flashrom that the file supplied as an argument to --diff will be used as a reference image, so it will skip reading the ROM content. <span style="font-size:10pt;background-color:transparent">This is useful if you can track exactly what is on the ROM, but can be lead to frustrating bugs if the contents get out of sync. <b>Use with caution!</b></span></div><div><span style="font-size:10pt;background-color:transparent"><b><br /></b></span></div><div>Example <span style="font-size:10pt;background-color:transparent">(note: this assumes that you have previously flashed "old.bin"):</span></div><div><span style="font-family:courier new,monospace;font-size:10pt;background-color:transparent">flashrom -p ft2232_spi:type=servo-v2 -w new.bin --diff old.bin </span><b style="font-family:courier new,monospace;font-size:10pt;background-color:transparent">&amp;&amp; cp new.bin old.bin</b></div><div><font face="courier new, monospace"><br /></font></div><h2><a name="TOC-Power-management-pitfalls-to-watch-out-for"></a><b style="font-size:10pt;background-color:transparent"><font size="4">Power management pitfalls to watch out for</font></b></h2><div><br /></div><div>In short:</div><div><ul><li>System must remain running (given).</li><li>powerd must not tickle the embedded controller (See "Embedded Controller Interactions" below).</li><li>Performance should not be significantly degraded.</li></ul><div>Chrome OS devices usually read firmware at least once per boot-up often to obtain things contained in VPD (e.g. antennae calibration data), populate entries for chrome://system, and small system maintenance tasks.</div></div><div><br /></div><h2><a name="TOC-Embedded-Controller-interactions"></a><b><font size="3">Embedded Controller interactions</font></b></h2><div>Embedded Controllers are independent microcontrollers which coexist in a platform to service some power management routines via ACPI or a other interface. This often includes handling lid switch events, sensors (such as ambient light sensor), thermal management, etc.</div><div><br /></div><div>The way they are designed can make firmware updates difficult. To cut down on cost, often times they lack internal flash memory and have limited amount of SRAM so they need to access the firmware ROM to load new routines. To make matters more complicated some systems use the same firmware ROM for both the host (PCH, SoC, etc) and the EC.</div><div><br /></div><div>In rare circumstances where we're updating the EC firmware itself, Flashrom will pause the EC. However, doing so has highly visible side-effects such as <span style="font-size:10pt;background-color:transparent">disabling keyboard, causing the fan to spin up all the way, or dimming the screen. For more frequent host firmware updates, which can take a long time, we have historically relied on stopping powerd and then restarting it after we're done. This avoids the problem of interrupting the EC such that it needs to load more code, and avoids UI jank that can last up to a minute and cause a user to try to reboot the system. For historical context, see <a href="https://code.google.com/p/chromium/issues/detail?id=201998">chromium-os:18895</a>.</span></div><div><br /></div><div><div><div class="sites-embed-align-left-wrapping-on"><div class="sites-embed-border-on sites-embed" style="width:266px;"><h4 class="sites-embed-title">Shared SPI block diagram</h4><div class="sites-embed-object-title" style="display:none;">Shared SPI block diagram</div><div class="sites-embed-content sites-embed-type-sketchy"><iframe src="https://docs.google.com/drawings/d/1oUZJ6NjDyVYOz59dWVWU6TbcJ93xNOZ82MsgLgc8Dy4/preview?h=200&amp;hl=en&amp;w=266" width="266" height="200" title="Shared SPI block diagram" frameborder="0" id="813749334" allowfullscreen="true" mozallowfullscreen="true" webkitallowfullscreen="true"></iframe></div></div></div><div><div class="sites-embed-align-left-wrapping-off"><div class="sites-embed-border-on sites-embed" style="width:266px;"><h4 class="sites-embed-title">Non-shared SPI block diagram</h4><div class="sites-embed-object-title" style="display:none;">Non-shared SPI block diagram</div><div class="sites-embed-content sites-embed-type-sketchy"><iframe src="https://docs.google.com/drawings/d/1Jwez2tNzpUM2FxkPuAsC3YwUwOff4KUJnphcr40zpkU/preview?h=200&amp;hl=en&amp;w=266" width="266" height="200" title="Non-shared SPI block diagram" frameborder="0" id="1272202046" allowfullscreen="true" mozallowfullscreen="true" webkitallowfullscreen="true"></iframe></div></div></div></div></div></div><div><br /></div><h2><a name="TOC-Performance"></a><b><font size="3">Performance</font></b></h2><div>We like firmware updates to be done as quickly as possible. This is important not only to minimize any side-effects the user might see as well as overall risk, but also to optimize time spent on the assembly line when a device is being manufactured (<a href="https://code.google.com/p/chromium/issues/detail?id=197236">chromium-os:14139</a>).</div><div><br /></div><div>Some older systems had performance issues when flashrom ran if powerd was enabled. This was due to poor DVFS implementations that could dramatically affect the behavior of the kernel's scheduler and cause huge delays when running flashrom.</div><div><br /></div><div>One side-effect was that flashrom would take an excessively long time to complete due to bad usleep() behavior (<a href="https://code.google.com/p/chromium/issues/detail?id=198133">chromium-os:15025</a>). However, when we disabled powerd we found that <span style="font-size:10pt;background-color:transparent">the UI would become janky (</span><a href="https://code.google.com/p/chromium/issues/detail?id=202422" style="font-size:10pt;background-color:transparent">chromium-os:19321</a>)<span style="font-size:10pt;background-color:transparent">. </span><span style="font-size:10pt;background-color:transparent">Eventually settled on disabling powerd only for operations expected to take a long time and are destructive (erase/writes).</span></div><div><span style="font-size:10pt;background-color:transparent"><br /></span></div><div>Now that powerd is smarter, we stopped disabling powerd (<a href="https://code.google.com/p/chromium/issues/detail?id=400641" style="font-size:10pt;background-color:transparent">chromium:400641</a>) and expect it to avoid doing anything which may degrade performance while flashrom is running.</div></div></td></tr></tbody></table>
</div> 
</div> 
<div id="sites-canvas-bottom-panel">
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_page-subpages"> </div>
<div id="sites-attachments-container">
</div>
<a xmlns="http://www.w3.org/1999/xhtml" name="page-comments"></a>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_page-comments"><div class="sites-comment-docos-wrapper"><div class="sites-comment-docos"><div class="sites-comment-docos-background"></div><div class="sites-comment-docos-header"><div class="sites-comment-docos-header-title">Comments</div></div><div id="sites-comment-docos-pane" class="sites-comment-docos-pane"></div></div></div></div>
</div>
</div> 
</td> 
</tr>
</table> 
</div> 
</div> 
<div id="sites-chrome-footer-wrapper">
<div id="sites-chrome-footer-wrapper-inside">
<div id="sites-chrome-footer">
</div>
</div>
</div>
</div> 
</div> 
<div id="sites-chrome-adminfooter-container">
<div xmlns="http://www.w3.org/1999/xhtml" class="sites-adminfooter" role="navigation"><p><a class="sites-system-link" href="https://www.google.com/a/UniversalLogin?service=jotspot&amp;continue=https://sites.google.com/a/chromium.org/dev/chromium-os/packages/cros-flashrom">Sign in</a><span aria-hidden="true">|</span><a class="sites-system-link" href="/system/app/pages/recentChanges">Recent Site Activity</a><span aria-hidden="true">|</span><a class="sites-system-link" href="/system/app/pages/reportAbuse" target="_blank">Report Abuse</a><span aria-hidden="true">|</span><a class="sites-system-link" href="javascript:;" onclick="window.open(webspace.printUrl)">Print Page</a><span aria-hidden="true">|</span><span class="sites-system-link">Powered By</span> <b class="powered-by"><a href="http://sites.google.com">Google Sites</a></b></p></div>
</div>
</div> 
</div> 
<div id="sites-chrome-onebar-footer">
</div>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    window.jstiming.load.tick('sjl');
  </script>
<script xmlns="http://www.w3.org/1999/xhtml" src="https://ssl.gstatic.com/sites/p/56e332/system/js/jot_min_view__en.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    window.jstiming.load.tick('jl');
  </script>
<script xmlns="http://www.w3.org/1999/xhtml">
      
          sites.core.Analytics.createTracker();
          sites.core.Analytics.trackPageview();
        
    </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
                    sites.Searchbox.initialize(
                        'sites-searchbox-search-button',
                        {"object":[]}['object'],
                        'search-site',
                        {"label":"Configure search options...","url":"/system/app/pages/admin/settings"});
                  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
      gsites.HoverPopupMenu.createSiteDropdownMenus('sites-header-nav-dropdown', false);
    </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
            JOT_setupNav("7648876402527094", "Navigation", false);
            JOT_addListener('titleChange', 'JOT_NAVIGATION_titleChange', 'COMP_7648876402527094');
          </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
            JOT_setupNav("14720868319272995", "Quick links", false);
            JOT_addListener('titleChange', 'JOT_NAVIGATION_titleChange', 'COMP_14720868319272995');
          </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
            JOT_setupNav("19690813310444355", "Other sites", false);
            JOT_addListener('titleChange', 'JOT_NAVIGATION_titleChange', 'COMP_19690813310444355');
          </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
              new sites.CommentPane('//docs.google.com/comments/d/AAHRpnXvrAwjAfmld0ObrebBiGRq9Ex9BPat-RgG3O8cmBFo90twcvM6cSLT_0-3Be_u42-5Pngb0h872xYYxqQJ5m_ON9nZgTM77mIHyuD3dw1z_DUSwPaJhjP6AI2uGzOnve8ZupQPj/api/js?anon=true',
                  false, false);
            </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
  setTimeout(function() {
    var fingerprint = gsites.date.TimeZone.getFingerprint([]);
    gsites.Xhr.send('https://www.chromium.org/_/tz', null, null, 'GET', null, null, { afjstz: fingerprint });
  }, 500);
</script>
<script xmlns="http://www.w3.org/1999/xhtml">
                    window.onload = function() {
                      if (false) {
                        JOT_setMobilePreview();
                      }
                      var loadTimer = window.jstiming.load;
                      loadTimer.tick("ol");
                      loadTimer["name"] = "load," + webspace.page.type + ",user_page";
                      window.jstiming.report(loadTimer, {}, 'https://gg.google.com/csi');
                    }
                  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
        JOT_insertAnalyticsCode(false,
            false);
      </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    var maestroRunner = new gsites.pages.view.SitesMaestroRunner(
        webspace, "en");
    maestroRunner.initListeners();
    maestroRunner.installEditRender();
  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
  //<![CDATA[
    // Decorate any fastUI buttons on the page with a class of 'goog-button'.
    if (webspace.user.hasWriteAccess) {
      JOT_decorateButtons();
    }

    // Fires delayed events.
    (function() {
      JOT_fullyLoaded = true;
      var delayedEvents = JOT_delayedEvents;
      for (var x = 0; x < delayedEvents.length; x++) {
        var event = delayedEvents[x];
        JOT_postEvent(event.eventName, event.eventSrc, event.payload);
      }
      JOT_delayedEvents = null;
      JOT_postEvent('pageLoaded');
    })();
  //]]>
</script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    JOT_postEvent('decorateGvizCharts');
  </script>
<script type="text/javascript">
          JOT_setupPostRenderingManager();
        </script>
<script type="text/javascript">
          JOT_postEvent('renderPlus', null, 'sites-chrome-main');
        </script>
<div id="server-timer-div" style="display:none"> </div>
<script type="text/javascript">
          window.jstiming.load.tick('render');
          JOT_postEvent('usercontentrendered', this);
        </script>
</body>
</html>
