<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/WebPage">
<head>
<meta http-equiv="X-UA-Compatible" content="chrome=1" />
<script type="text/javascript">/* Copyright 2008 Google. */ (function() { var e="wtsrt_",g="tbsd_",h="tbnd_",k="start",l="_wtsrt",m="_tbnd",n="CSI/";(function(){function f(a){this.t={};this.tick=function(a,c,b){this.t[a]=[void 0!=b?b:(new Date).getTime(),c];if(void 0==b)try{window.console.timeStamp(n+a)}catch(d){}};this.tick(k,null,a)}var a;window.performance&&(a=window.performance.timing);var p=a?new f(a.responseStart):new f;window.jstiming={Timer:f,load:p};if(a){var c=a.navigationStart,d=a.responseStart;0<c&&d>=c&&(window.jstiming.srt=d-c)}if(a){var b=window.jstiming.load;0<c&&d>=c&&(b.tick(l,void 0,c),b.tick(e,l,d),b.tick(g,e))}try{a=null,
window.chrome&&window.chrome.csi&&(a=Math.floor(window.chrome.csi().pageT),b&&0<c&&(b.tick(m,void 0,window.chrome.csi().startE),b.tick(h,m,c))),null==a&&window.gtbExternal&&(a=window.gtbExternal.pageT()),null==a&&window.external&&(a=window.external.pageT,b&&0<c&&(b.tick(m,void 0,window.external.startE),b.tick(h,m,c))),a&&(window.jstiming.pt=a)}catch(q){}})(); })()
</script>
<link rel="shortcut icon" href="../../../_/rsrc/1354323194313/favicon.ico" type="image/x-icon" />
<link rel="apple-touch-icon" href="https://ssl.gstatic.com/sites/p/56e332/system/app/images/apple-touch-icon.png" type="image/png" />
<script type="text/javascript">/* Copyright 2008 Google. */ (function() { var d="",g="__duration__",h="function";function k(c){return document.getElementById(c)}window.byId=k;function l(c){return c.replace(/^\s+|\s+$/g,d)}window.trim=l;var m=[],n=0;window.JOT_addListener=function(c,a,b){var e=new String(n++);c={eventName:c,handler:a,compId:b,key:e};m.push(c);return e};window.JOT_removeListenerByKey=function(c){for(var a=0;a<m.length;a++)if(m[a].key==c){m.splice(a,1);break}};
window.JOT_removeAllListenersForName=function(c){for(var a=0;a<m.length;a++)m[a].eventName==c&&m.splice(a,1)};window.JOT_postEvent=function(c,a,b){var e={eventName:c,eventSrc:a||{},payload:b||{}};if(window.JOT_fullyLoaded)for(a=m.length,b=0;b<a&&b<m.length;b++){var f=m[b];f&&f.eventName==c&&(e.listenerCompId=f.compId||d,(f=typeof f.handler==h?f.handler:window[f.handler])&&f(e))}else window.JOT_delayedEvents.push({eventName:c,eventSrc:a,payload:b})};window.JOT_delayedEvents=[];
window.JOT_fullyLoaded=!1;window.JOT_formatRelativeToNow=function(c,a){var b=((new Date).getTime()-c)/6E4;if(1440<=b||0>b)return null;var e=0;60<=b&&(b/=60,e=2);2<=b&&e++;return a?window.JOT_siteRelTimeStrs[e].replace(g,Math.floor(b)):window.JOT_userRelTimeStrs[e].replace(g,Math.floor(b))}; })()
</script>
<script>

  

  var breadcrumbs = [{"path":"/chromium-os","deleted":false,"title":"Chromium OS","dir":"ltr"},{"path":"/chromium-os/testing","deleted":false,"title":"Testing Home","dir":"ltr"},{"path":"/chromium-os/testing/test-code-labs","deleted":false,"title":"Test Code Labs","dir":"ltr"},{"path":"/chromium-os/testing/test-code-labs/dynamic-suite-codelab","deleted":false,"title":"Creating and deploying Chromium OS Dynamic Test Suites","dir":"ltr"}];
  var JOT_clearDotPath = 'https://ssl.gstatic.com/sites/p/56e332/system/app/images/cleardot.gif';

  
  var JOT_userRelTimeStrs = ["a minute ago","__duration__ minutes ago","an hour ago","__duration__ hours ago"];

  
  

  

  var webspace = {"enableAnalytics":true,"pageSharingId":"jotspot_page","enableUniversalAnalytics":false,"sharingPolicy":"OPENED_WITH_INDICATOR","siteTitle":"The Chromium Projects","isStartPageEnabled":true,"adsensePublisherId":null,"features":{"languageSelectDefaultTextSetToDefault":true,"validateClientGvizDataSourceUrls":true,"moreMobileStyleImprovements":true,"newInsertMenuIcons":true,"accessibleSortingButtons":true,"domainAnalyticsInGAOnly":true,"noCaptcha":true,"fileCabinetScreenReaderFix":true,"updatedTosAndPrivacyLinks":null,"pageDrafts":false,"mobileOrientationFix":true,"plusBadge":false,"pdfEmbedSupport":false,"jsClickFix":true},"isPublic":true,"isConsumer":false,"serverFlags":{"cajaBaseUrl":"//www.gstatic.com/caja","cajaDebugMode":false},"onepickBaseUrl":"https://docs.google.com","domainAnalyticsAccountId":"","plusPageId":"","signInUrl":"https://www.google.com/a/SelectSession?continue\u003dhttps://sites.google.com/a/chromium.org/dev/chromium-os/testing/test-code-labs/dynamic-suite-codelab\u0026service\u003djotspot","analyticsAccountId":"UA-5484340-1","scottyUrl":"/_/upload","homePath":"/","siteNoticeUrlEnabled":null,"plusPageUrl":"","adsensePromoClickedOrSiteIneligible":true,"csiReportUri":"https://gg.google.com/csi","sharingId":"jotspot","termsUrl":"//www.google.com/intl/en/policies/terms/","gvizVersion":1,"editorResources":{"sitelayout":["https://ssl.gstatic.com/sites/p/56e332/system/app/css/sitelayouteditor.css"],"text":["https://ssl.gstatic.com/sites/p/56e332/system/js/codemirror.js","https://ssl.gstatic.com/sites/p/56e332/system/app/css/codemirror_css.css","https://ssl.gstatic.com/sites/p/56e332/system/js/trog_edit__en.js","https://ssl.gstatic.com/sites/p/56e332/system/app/css/trogedit.css","/_/rsrc/1441580320000/system/app/css/editor.css","https://ssl.gstatic.com/sites/p/56e332/system/app/css/codeeditor.css","/_/rsrc/1441580320000/system/app/css/camelot/editor-jfk-wlb.css"]},"sharingUrlPrefix":"/_/sharing","isAdsenseEnabled":true,"domain":"chromium.org","baseUri":"","name":"dev","siteTemplateId":false,"siteNoticeRevision":null,"siteNoticeUrlAddress":null,"siteNoticeMessage":null,"page":{"isRtlLocale":false,"canDeleteWebspace":null,"isPageDraft":null,"parentPath":"/chromium-os/testing/test-code-labs","parentWuid":"wuid:gx:80a620e4fb3984","siteLocale":"en","timeZone":"America/Los_Angeles","type":"text","title":"Creating and deploying Chromium OS Dynamic Test Suites","locale":"en","wuid":"wuid:gx:535ffd7f7ce873af","revision":15,"path":"/chromium-os/testing/test-code-labs/dynamic-suite-codelab","isSiteRtlLocale":false,"pageInheritsPermissions":null,"name":"dynamic-suite-codelab","canChangePath":true,"state":"","properties":{},"bidiEnabled":false,"currentTemplate":{"path":"/system/app/pagetemplates/text","title":"Web Page"}},"canPublishScriptToAnyone":true,"user":{"keyboardShortcuts":true,"sessionIndex":"","guest_":true,"displayNameOrEmail":"guest","userName":"guest","uid":"","renderMobile":false,"domain":"","namespace":"","hasWriteAccess":false,"namespaceUser":false,"primaryEmail":"guest","hasAdminAccess":false},"gadgets":{"baseUri":"/system/app/pages/gadgets"}};
  webspace.page.breadcrumbs = breadcrumbs;

  
  var JOT_siteRelTimeStrs = ["a minute ago","__duration__ minutes ago","an hour ago","__duration__ hours ago"];

</script>
<script type="text/javascript">
                window.jstiming.load.tick('scl');
              </script>
<meta name="title" content="Creating and deploying Chromium OS Dynamic Test Suites - The Chromium Projects" />
<meta itemprop="name" content="Creating and deploying Chromium OS Dynamic Test Suites - The Chromium Projects" />
<meta property="og:title" content="Creating and deploying Chromium OS Dynamic Test Suites - The Chromium Projects" />
<meta name="description" content="Home of the Chromium Open Source Project" />
<meta itemprop="description" content="Home of the Chromium Open Source Project" />
<meta id="meta-tag-description" property="og:description" content="Home of the Chromium Open Source Project" />
<style type="text/css">
</style>
<link rel="stylesheet" type="text/css" href="https://ssl.gstatic.com/sites/p/56e332/system/app/themes/beigeandblue/standard-css-beigeandblue-ltr-ltr.css" />
<link rel="stylesheet" type="text/css" href="../../../_/rsrc/1441580320000/system/app/css/overlay.css%3Fcb=beigeandblueundefineda100%2525%2525150goog-ws-leftthemedefaultstandard.css" />
<link rel="stylesheet" type="text/css" href="../../../_/rsrc/1441580320000/system/app/css/camelot/allthemes-view.css" />
<!--[if IE]>
          <link rel="stylesheet" type="text/css" href="/system/app/css/camelot/allthemes%2die.css" />
        <![endif]-->
<title>Creating and deploying Chromium OS Dynamic Test Suites - The Chromium Projects</title>
<meta itemprop="image" content="/_/rsrc/1438879449147/config/customLogo.gif?revision=3" />
<meta property="og:image" content="/_/rsrc/1438879449147/config/customLogo.gif?revision=3" />
<script type="text/javascript">
                window.jstiming.load.tick('cl');
              </script>
</head>
<body xmlns="http://www.google.com/ns/jotspot" id="body" class=" en            ">
<div id="sites-page-toolbar" class="sites-header-divider">
<div xmlns="http://www.w3.org/1999/xhtml" id="sites-status" class="sites-status" style="display:none;"><div id="sites-notice" class="sites-notice" role="status" aria-live="assertive"> </div></div>
</div>
<div id="sites-chrome-everything-scrollbar">
<div id="sites-chrome-everything" class="">
<div id="sites-chrome-page-wrapper" style="direction: ltr">
<div id="sites-chrome-page-wrapper-inside">
<div xmlns="http://www.w3.org/1999/xhtml" id="sites-chrome-header-wrapper" style="height:auto;">
<table id="sites-chrome-header" class="sites-layout-hbox" cellspacing="0" style="height:auto;">
<tr class="sites-header-primary-row" id="sites-chrome-userheader">
<td id="sites-header-title" class="" role="banner"><div class="sites-header-cell-buffer-wrapper"><a href="../../../index.html" id="sites-chrome-userheader-logo"><img id="logo-img-id" src="../../../_/rsrc/1438879449147/config/customLogo.gif%3Frevision=3" alt="The Chromium Projects" class="sites-logo  " /></a><h2><a href="../../../index.html" dir="ltr" id="sites-chrome-userheader-title">The Chromium Projects</a></h2></div></td><td class="sites-layout-searchbox  "><div class="sites-header-cell-buffer-wrapper"><form id="sites-searchbox-form" action="https://www.chromium.org/system/app/pages/search" role="search"><input type="hidden" id="sites-searchbox-scope" name="scope" value="search-site" /><input type="text" id="jot-ui-searchInput" name="q" size="20" value="" aria-label="Search this site" /><div id="sites-searchbox-button-set" class="goog-inline-block"><div role="button" id="sites-searchbox-search-button" class="goog-inline-block jfk-button jfk-button-standard" tabindex="0">Search this site</div></div></form></div></td>
</tr>
<tr class="sites-header-secondary-row" id="sites-chrome-horizontal-nav">
<td colspan="2" id="sites-chrome-header-horizontal-nav-container" role="navigation">
</td>
</tr>
</table>
</div>
<div id="sites-chrome-main-wrapper">
<div id="sites-chrome-main-wrapper-inside">
<table id="sites-chrome-main" class="sites-layout-hbox" cellspacing="0" cellpadding="{scmCellpadding}" border="0">
<tr>
<td id="sites-chrome-sidebar-left" class="sites-layout-sidebar-left initial" style="width:150px">
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_7648876402527094" class="sites-embed" role="navigation"><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotId="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="../../../chromium-projects.html" jotId="wuid:gx:10ae433dadbbab13" class="sites-navigation-link">Home</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="../../../Home.1.html" jotId="wuid:gx:43582b9d2029d3af" class="sites-navigation-link">Chromium</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="../../../chromium-os.1.html" jotId="wuid:gx:83df2ab1f8880ba" class="sites-navigation-link">Chromium OS</a></div></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_14720868319272995" class="sites-embed" role="navigation"><h4 class="sites-embed-title">Quick links</h4><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotId="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="../../../for-testers/bug-reporting-guidelines.html" class="sites-navigation-link">Report bugs</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="../../../developers/discussion-groups.html" class="sites-navigation-link">Discuss</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="../../../system/app/pages/sitemap/hierarchy.html" jotId="wuid:gx:4b58a9a350ad12f" class="sites-navigation-link">网站地图</a></div></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_19690813310444355" class="sites-embed" role="navigation"><h4 class="sites-embed-title">Other sites</h4><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotId="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="http://blog.chromium.org/" class="sites-navigation-link">Chromium Blog</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="http://code.google.com/chrome/extensions/" class="sites-navigation-link">Google Chrome Extensions</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="https://developers.google.com/chrome/chrome-frame/" class="sites-navigation-link">Google Chrome Frame</a></div></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_19695218559354544" class="sites-embed" role="complementary"><h4 class="sites-embed-title"></h4><div class="sites-embed-content sites-embed-content-sidebar-textbox"><div dir="ltr"><span style="font-size:x-small">Except as otherwise </span><a href="http://developers.google.com/site-policies.html#restrictions"><span style="font-size:x-small">noted</span></a><span style="font-size:x-small">, the content of this page is licensed under a </span><a href="http://creativecommons.org/licenses/by/2.5/"><span style="font-size:x-small">Creative Commons Attribution 2.5 license</span></a><span style="font-size:x-small">, and examples are licensed under the </span><a href="http://src.chromium.org/viewvc/chrome/trunk/src/LICENSE" target="_blank"><span style="font-size:x-small">BSD License</span></a><span style="font-size:x-small">.<br /></span></div></div></div>
</td>
<td id="sites-canvas-wrapper">
<div id="sites-canvas" role="main">
<div id="goog-ws-editor-toolbar-container"> </div>
<div xmlns="http://www.w3.org/1999/xhtml" id="title-crumbs" style="">
<A href="../../../chromium-os.1.html" dir="ltr">Chromium OS</A>‎ &gt; ‎<A href="../../testing.1.html" dir="ltr">Testing Home</A>‎ &gt; ‎<A href="../test-code-labs.1.html" dir="ltr">Test Code Labs</A>‎ &gt; ‎
  </div>
<h3 xmlns="http://www.w3.org/1999/xhtml" id="sites-page-title-header" style="" align="left">
<span id="sites-page-title" dir="ltr" tabindex="-1" style="outline: none">Creating and deploying Chromium OS Dynamic Test Suites</span>
</h3>
<div id="sites-canvas-main" class="sites-canvas-main">
<div id="sites-canvas-main-content">
<table xmlns="http://www.w3.org/1999/xhtml" cellspacing="0" class="sites-layout-name-one-column sites-layout-hbox"><tbody><tr><td class="sites-layout-tile sites-tile-name-content-1"><div dir="ltr"><div class="sites-embed-align-right-wrapping-on"><div class="sites-embed-border-off sites-embed" style="width:250px;"><div class="sites-embed-content sites-embed-type-toc"><div class="goog-toc sites-embed-toc-maxdepth-6"><p>Contents</p><ol class="goog-toc"><li class="goog-toc"><a href="dynamic-suite-codelab.html#TOC-References-and-Further-Reading"><strong>1 </strong>References and Further Reading</a></li><li class="goog-toc"><a href="dynamic-suite-codelab.html#TOC-Overview"><strong>2 </strong>Overview</a><ol class="goog-toc"><li class="goog-toc"><a href="dynamic-suite-codelab.html#TOC-Objectives"><strong>2.1 </strong>Objectives</a></li><li class="goog-toc"><a href="dynamic-suite-codelab.html#TOC-Prerequisites"><strong>2.2 </strong>Prerequisites</a></li><li class="goog-toc"><a href="dynamic-suite-codelab.html#TOC-Non-Prerequisites"><strong>2.3 </strong>Non Prerequisites</a></li></ol></li><li class="goog-toc"><a href="dynamic-suite-codelab.html#TOC-Creating-The-Test"><strong>3 </strong>Creating The Test</a><ol class="goog-toc"><li class="goog-toc"><a href="dynamic-suite-codelab.html#TOC-Create-a-work-branch"><strong>3.1 </strong>Create a work branch</a></li><li class="goog-toc"><a href="dynamic-suite-codelab.html#TOC-Create-a-dynamic-suite"><strong>3.2 </strong>Create a dynamic suite</a></li><li class="goog-toc"><a href="dynamic-suite-codelab.html#TOC-Create-a-new-test-control-file"><strong>3.3 </strong>Create a new test control file</a></li><li class="goog-toc"><a href="dynamic-suite-codelab.html#TOC-Create-a-new-test-control-file-with-DEPENDENCIES"><strong>3.4 </strong>Create a new test control file with DEPENDENCIES</a></li><li class="goog-toc"><a href="dynamic-suite-codelab.html#TOC-Add-two-simple-existing-tests-to-the-suite"><strong>3.5 </strong>Add two simple existing tests to the suite</a></li><li class="goog-toc"><a href="dynamic-suite-codelab.html#TOC-Enumerate-the-suite-s-tests"><strong>3.6 </strong>Enumerate the suite’s tests</a></li><li class="goog-toc"><a href="dynamic-suite-codelab.html#TOC-Include-new-test-files-in-autotest-tests-ebuild"><strong>3.7 </strong>Include new test files in autotest-tests ebuild</a></li><li class="goog-toc"><a href="dynamic-suite-codelab.html#TOC-Commit-and-upload-changes"><strong>3.8 </strong>Commit and upload changes</a></li></ol></li><li class="goog-toc"><a href="dynamic-suite-codelab.html#TOC-Build-your-changes-into-a-new-image-using-cbuildbot"><strong>4 </strong>Build your changes into a new image using cbuildbot</a><ol class="goog-toc"><li class="goog-toc"><a href="dynamic-suite-codelab.html#TOC-Run-your-new-suite"><strong>4.1 </strong>Run your new suite</a></li></ol></li><li class="goog-toc"><a href="dynamic-suite-codelab.html#TOC-Add-suite-level-dependencies"><strong>5 </strong>Add suite-level dependencies</a></li><li class="goog-toc"><a href="dynamic-suite-codelab.html#TOC-Get-your-suite-into-the-regular-rotation-with-suite_scheduler"><strong>6 </strong>Get your suite into the regular rotation with suite_scheduler</a></li></ol></div></div></div></div>
<p><a href="http://goto.google.com/dynamic_suite_codelab">go/dynamic_suite_codelab</a></p>
<h2><a name="TOC-References-and-Further-Reading"></a>References and Further Reading</h2>
<ol><li><a href="http://www.chromium.org/chromium-os/testing/autotest-best-practices">Autotest Best Practices</a></li>
<li><a href="server-side-test.1.html">Codelab: Writing a server side test</a></li>
<li><a href="../../../system/errors/NodeNotFound%3Fsuri=wuid:gx:29c363e944d7787d.html" class="disabled">Codelab: Writing a client side test</a></li>
<li><a href="../dynamic-test-suites.html">Design Doc: Dynamic Test Suites</a></li>
<li><a href="../test-suites.html">Documentation: Working with Test Suites</a></li>
<li><a href="../test-dependencies-in-dynamic-suites.html">Test Dependencies in Dynamic Suites</a></li>
</ol>
<h2><a name="TOC-Overview"></a>Overview</h2>
<p>The Chrome OS version of Autotest introduces a new type of suite, known as a dynamic suite. Dynamic suites allow for the jobs in a suite to be sharded over a pool of DUTs, and the dynamic suite infrastructure takes care of all of the device imaging and test scheduling/sharding details.</p>
<p>Different tests in a suite may require different specific features of a DUT (for instance a certain type of cellular modem, or an attached <a href="../../servo.1.html">servo board</a>). These requirements can be specified as test <code>DEPENDENCIES</code>, so that the test in question will only be scheduled on DUTs that have the required labels. In addition, <code>DEPENDENCIES</code> can be specified at the suite level, causing all tests invoked through the suite to inherit any additional suite level <code>DEPENDENCIES</code>.</p>
<h3><a name="TOC-Objectives"></a>Objectives</h3>
<p>In this codelab, we will:</p>
<ul><li>Create a new dynamic suite.</li>
<li>Add 2 existing and 2 new tests to the suite.</li>
<li>Enumerate the tests in the suite.</li>
<li>Add some test level and suite-level dependencies.</li>
<li>Run the suite in the lab.</li>
<li>Learn how to schedule the suite to be run regularly.</li>
</ul>
<h3><a name="TOC-Prerequisites"></a>Prerequisites</h3>
<ul><li>This codelab assumes a full working checkout of the Chromium OS repo. To get started with a Chromium OS checkout, see <a href="https://sites.google.com/a/google.com/chromeos/resources/engineering/how-to-build">How to Build Chrome OS "Internally"</a>.</li>
<li>This codelab assumes a basic familiarity with use of <code>git</code> to stage files and commit changes.</li></ul>
<h3><a name="TOC-Non-Prerequisites"></a>Non Prerequisites</h3>
<ul><li>This codelab does NOT require a local instance of the Autotest server, or even the ability to build ChromiumOS locally (we will delegate the building to remote buildbots, and running our suite to the Test Lab server).</li>
<li>This codelab does NOT assume any familiarity with how to use <code>repo</code> or <code>cbuildbot</code>.</li></ul>
<h2><a name="TOC-Creating-The-Test"></a>Creating The Test</h2><h3><a name="TOC-Create-a-work-branch"></a>Create a work branch</h3>
<p>This codelab will involve touching or changing code in two git repositories within the ChromiumOS repo. Our suite will be named <b>peaches</b>, so we will start by creating a repo branch named peaches, associated with the two git repos we will be modifying:</p>
<div class="sites-codeblock sites-codesnippet-block">
<code>user@host:~/chromiumos$ repo start peaches src/third_party/autotest/files src/third_party/chromiumos-overlay</code></div>
<p>If this succeeds, then you should be able to see your newly created branch.</p>
<div class="sites-codeblock sites-codesnippet-block"><code>user@host:~/chromiumos$ repo branch<br />
*  peaches                   | in:<br />
                                   src/third_party/autotest/files<br />
                                   src/third_party/chromiumos-overlay<br />
</code></div>
<h3><a name="TOC-Create-a-dynamic-suite"></a>Create a dynamic suite</h3>
<p>Test suites are defined by Autotest control files (Made up of Python with some meta variables), similar to the control files used to define tests themselves. The suite control files live in the Chromium OS source tree it the <code>src/third_party/autotest/files/test_suites</code> directory. Poke around and take a look at some of them to see their basic structure.</p>
<p>Once you are satisfied, create a new file in this directory named <code>control.peaches</code>, with the contents given below. <b>Caution: copy-pasting from Google Docs has been known to convert consecutive whitespace characters into unicode characters, which will break your control file. Using CTRL-C + CTRL-V is safer than using middle-click pasting on Linux.</b></p>
<div class="sites-codeblock sites-codesnippet-block"><code># Copyright 2013 The Chromium OS Authors. All rights reserved.<br />

# Use of this source code is governed by a BSD-style license that can be<br />

# found in the LICENSE file.<br />
<br />

AUTHOR = "Chrome OS Team"<br />
<b>NAME = "peaches"</b><br />

PURPOSE = "A simple example suite."<br />

CRITERIA = "All tests with SUITE=peaches must pass."<br />
<br />

TIME = "SHORT"<br />

TEST_CATEGORY = "General"<br />

TEST_CLASS = "suite"<br />

TEST_TYPE = "Server"<br />
<br />

DOC = """<br />

This is an example of a dynamic test suite.<br />
<br />

@param build: The name of the image to test.<br />

          Ex: x86-mario-release/R17-1412.33.0-a1-b29<br />

@param board: The board to test on. Ex: x86-mario<br />

@param pool: The pool of machines to utilize for scheduling. If pool=None<br />

             board is used.<br />

@param check_hosts: require appropriate live hosts to exist in the lab.<br />

@param SKIP_IMAGE: (optional) If present and True, don't re-image devices.<br />

@param file_bugs: If True your suite will file bugs on failures.<br />

@param max_run_time: Amount of time each test shoud run in minutes.<br />

"""<br />
<br />

import common<br />

from autotest_lib.server.cros.dynamic_suite import dynamic_suite<br />
<br />

dynamic_suite.reimage_and_run(<br />
    build=build, board=board, name=NAME, job=job, pool=pool,<br />
    check_hosts=check_hosts, add_experimental=True, num=num,<br />
    file_bugs=file_bugs, skip_reimage=dynamic_suite.skip_reimage(globals()))</code></div>
<p>The suite control file’s <code>TEST_TYPE</code> is <code>Server</code>. This indicates simply that the suite control file is meant to run server side. This restriction does not apply to tests contained in the suite, the suite can contain both Client and Server side tests regardless of this line in the suite control file.</p>
<h3><a name="TOC-Create-a-new-test-control-file"></a>Create a new test control file</h3>
<p>Tests can declare themselves to be part of any number of suites. This is done by listing the suite in the test control file’s SUITE variable. To put a test into multiple suites, simply use a comma separated list. In this codelab, we will add two existing control files and two new control files to our suite. Let's start with two new dummy tests control files. Create the file <code>src/third_party/autotest/files/client/site_tests/peaches_DummyPass/control</code> with the contents below. <b>Caution: copy-pasting from Google Docs has been known to convert consecutive whitespace characters into unicode characters, which will break your control file. Using CTRL-C + CTRL-V is safer than using middle-click pasting on Linux.</b></p>
<div class="sites-codeblock sites-codesnippet-block"><code># Copyright 2013 The Chromium OS Authors. All rights reserved.<br />
# Use of this source code is governed by a BSD-style license that can be<br />
# found in the LICENSE file.<br />
<br />
AUTHOR = "Chrome OS Team"<br />
NAME = "peaches_DummyPass"<br />
PURPOSE = "Dummy test that passes immediately."<br />
SUITE = "peaches"<br />
TIME = "SHORT"<br />
TEST_CATEGORY = "General"<br />
<b>TEST_CLASS = "peaches"</b><br />
TEST_TYPE = "client"<br />
<br />
DOC = """<br />
Example test for peaches suite.<br />
"""<br />
<br />
job.run_test('dummy_Pass')</code></div>
<h3><a name="TOC-Create-a-new-test-control-file-with-DEPENDENCIES"></a>Create a new test control file with DEPENDENCIES</h3>
<p>In the same directory, create another file, <code>control.bluetooth</code> with the same contents, but with the test <code>NAME</code> changed to <code>peaches_DummyPass_BT</code> and with a line added near the other declarations at the top specifying:</p>
<div class="sites-codeblock sites-codesnippet-block"><code>. . .<br />
DEPENDENCIES = "bluetooth"<br />
. . .</code></div>
<p>This label tells the dynamic suite scheduler that this job may only run on DUTs with the bluetooth label.</p>
<h3><a name="TOC-Add-two-simple-existing-tests-to-the-suite"></a>Add two simple existing tests to the suite</h3>
<p>Let's also add some existing tests to the peaches suite. For instance, edit the <code>SUITE</code> lines of <code>src/third_party/autotest/files/client/site_tests/login_LoginSuccess/control</code> and <code>.../login_BadAuthentication/control</code> files to include <code>peaches</code>. If you need to add a test to multiple suites to accomplish this, you can use a comma separated list of the form <code>SUITE = "suite1, suite2, suite3"</code></p>
<h3><a name="TOC-Enumerate-the-suite-s-tests"></a>Enumerate the suite’s tests</h3>
<p>To verify that we have added these 4 tests to our suite, we can use the <code>suite_enumerator</code> utility, as follows:</p>
<div class="sites-codeblock sites-codesnippet-block"><code>user@host:~/chromiumos/src/third_party/autotest/files$ site_utils/suite_enumerator.py peaches -a .<br />
./client/site_tests/login_BadAuthentication/control<br />
./client/site_tests/peaches_DummyPass/control<br />
./client/site_tests/login_LoginSuccess/control<br />
./client/site_tests/peaches_DummyPass/control.bluetooth</code></div>
<h3><a name="TOC-Include-new-test-files-in-autotest-tests-ebuild"></a>Include new test files in autotest-tests ebuild</h3>
<p>Earlier, we added two new test control files for client-side tests. In order for the new test files to be available to the DUT at test time, they must be included in the appropriate overlay ebuild file. This procedure is explained in more detail in a separate codelab -- writing a client side test (not yet published).</p>
<p>Open the file <code>src/third_party/chromiumos-overlay/chromeos-base/autotest-tests/autotest-tests-9999.ebuild</code>. Near the bottom of the file, at the bottom of the long list of <code>IUSE_TESTS</code> entries, add the following:</p>
<div class="sites-codeblock sites-codesnippet-block"><code>. . .<br />
      +tests_peaches_DummyPass<br />
      +tests_peaches_DummyPass_BT<br />
. . .</code></div>
<h3><a name="TOC-Commit-and-upload-changes"></a>Commit and upload changes</h3>
<p>We need to commit our changes to two separate git repositories. The changes that we made to the ebuild are required in order for the suite to run properly on a DUT, so we need to make the Autotest repo changes depend on the ebuild changes. </p>
<p>First, from the chromiumos-overlay directory, create a commit with <code>git commit -a</code>. Write a commit message that suits your fancy.</p>
<p>Find the Change-ID for the commit you just created, using <code>git show --stat</code>. This will be some string similar in form to I515b9c4775f518b7b000f964a00df9845ed0c6f6, in the commit message for the commit you just created. You should also see in the output of that command that you have changed 1 file.</p>
<p>Change directory to the Autotest repository, and create another commit, but this time including in your commit message a line <code>CQ-DEPEND=CL:*****</code>, pasting in the Change-ID of the first commit. This tells the build system that in order to apply our patch to the Autotest repository, it must first apply our patch to the chromiumos-overlay repository. You should see that 5 files have changed. If not, you may have forgotten to add your new control files to the git repo! Run <code>git add .</code> and <code>git commit -a --amend</code> to fix that.</p>
<p>Now, upload both your changes to gerrit with <code>repo upload . -d</code> from each directory, or run <code>repo upload --br=&lt;branch&gt; -d</code> and uncomment the directories to upload. The <code>-d</code> flag here marks our upload as a draft, so no prying eyes will see our dirty hacking.</p>
<p>Once repo upload has finished its work, you will see links to your two new changes on chromium-review.googlesource.com.</p>
<h2><a name="TOC-Build-your-changes-into-a-new-image-using-cbuildbot"></a>Build your changes into a new image using cbuildbot</h2>
<p>Determine the Change-ID for your Autotest changes. Then, submit your patch to be built remotely:</p>
<div class="sites-codeblock sites-codesnippet-block"><code>user@host:~/chromiumos/chromite/bin$ ./cbuildbot --remote -g ***** lumpy-release</code></div>
<p>where you have pasted in the Change-ID of the changes to the Autotest repository.</p>
<p>The output of this command should give you a buildbot link where you can follow your build progress. The build will take about 90 minutes, so now is a good time to go have lunch.</p>
<h3><a name="TOC-Run-your-new-suite"></a>Run your new suite</h3>
<p>Once the building step in the previous section has concluded, you should receive an email to this effect from <b>cros.tryserver@chromium.org</b>. Follow the link in this email to your build results page, then drill down to the "Report stdio" link, and pull out the build number (which will be a string similar to "<b>trybot-lumpy-release/R26-3556.0.0-b683</b>"). </p>
<p>Now, run your suite with the command</p>
<div class="sites-codeblock sites-codesnippet-block"><code>user@host:~/chromiumos/src/third_party/autotest/files/site_utils$ ./run_suite.py -s peaches -b lumpy -i ***** -p try-bot</code></div>
<p>where ***** is the build number you just extracted.</p>
<p>Point your browser at <a href="http://cautotest.corp.google.com/">http://cautotest/</a>, and you should soon see your suite job appear in the job list. After the suite job has started to run, it will spawn sub-jobs for all the individual tests. Note that different tests may end up running on different DUTs.</p>
<h2><a name="TOC-Add-suite-level-dependencies"></a>Add suite-level dependencies</h2>
<p>One of the tests we created in the codelab, peaches_DummyPass_BT, made use of a DEPENDENCY to require that the test could only run on DUTs with the bluetooth label. In addition to specifying dependencies at the test level, they can also be specified at the suite level. When a suite with suite level dependencies is run, all the jobs kicked off by the suite will have any suite dependencies added in addition to the test level dependencies.</p>
<p>To add a suite level dependency, edit the control file for the suite. Add a named argument to the call to dynamic_suite.reimage_and_run, of the form suite_dependencies=’servo’, for example. Now, when the suite is run, all jobs will inherit an additional dependency on servo. The string can contain multiple dependencies as a comma separated list.</p>
<p>Suite-level dependencies can be useful when you want to run several closely related suites consisting of the same tests, but with slightly different dependencies. For example, if you want to run a suite focused on network3g connectivity, but separately on devices configured for different cellular carriers. See for instance <a href="https://chromium-review.googlesource.com/41260/">https://chromium-review.googlesource.com/41260/</a></p>
<h2><a name="TOC-Get-your-suite-into-the-regular-rotation-with-suite_scheduler"></a>Get your suite into the regular rotation with suite_scheduler</h2>
<p>Suites can be scheduled to run in the test lab automatically, either triggered by build events or at regular timed intervals. To add your suite to the schedule, edit suite_scheduler.ini in the root directory of the Autotest repo. Following in the footsteps of the other suites already in the file, it should be easy to add your suite.</p>
<p>To add peaches as a suite that runs nightly, add the following to suite_scheduler.ini</p>
<div class="sites-codeblock sites-codesnippet-block"><code>. . .<br />
[PeachesDaily]<br />
run_on: nightly<br />
suite: peaches<br />
branch_specs: &gt;=R21<br />
pool: suites<br />
num: 2<br />
. . .</code></div>
<p>The fields above specify when suite runs should be triggered, which suite should be run, which branches should trigger the suite to run, which machine pool the suite should be assigned to, and the number of DUTs that the suite should attempt to use. For more information on what pool to select refere to <a href="../test-suites.html#TOC-What-pool-should-I-select-">What pool should I select</a>.</p>
<p>If you have added a new suite to suite_scheduler.ini, one for which a suite control file did not exist before, you need to pay attention to the branch_specs attribute. Suite control files are picked up from the build artifacts (unlike other server-side control files). You can either backport your new suite control file to older maintained branches, or avoid scheduling this suite against those branches by using branch_specs to set a cutoff.</p>
<p>There are some subtleties in the num parameter, with respect to test dependencies. You must ensure that the num parameter is greater than or equal to the number of unique dependency sets over all the jobs in your suite. So, for instance, if you have a suite (like peaches) that has some jobs with no dependencies, and some jobs with 1 dependency (bluetooth), you must make use num &gt;= 2, otherwise the suite will fail immediately on running. There’s a handy sanity check script to make sure you’re satisfied this:</p>
<div class="sites-codeblock sites-codesnippet-block"><code>./site_utils/suite_scheduler/suite_scheduler.py --sanity</code></div>
<p>This sanity check will also run as a pre-submit hook, so even if you forget to run it yourself, you will be warned on repo upload that you have not fulfilled the num criteria.</p></div></td></tr></tbody></table>
</div> 
</div> 
<div id="sites-canvas-bottom-panel">
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_page-subpages"> </div>
<div id="sites-attachments-container">
</div>
<a xmlns="http://www.w3.org/1999/xhtml" name="page-comments"></a>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_page-comments"><div class="sites-comment-docos-wrapper"><div class="sites-comment-docos"><div class="sites-comment-docos-background"></div><div class="sites-comment-docos-header"><div class="sites-comment-docos-header-title">Comments</div></div><div id="sites-comment-docos-pane" class="sites-comment-docos-pane"></div></div></div></div>
</div>
</div> 
</td> 
</tr>
</table> 
</div> 
</div> 
<div id="sites-chrome-footer-wrapper">
<div id="sites-chrome-footer-wrapper-inside">
<div id="sites-chrome-footer">
</div>
</div>
</div>
</div> 
</div> 
<div id="sites-chrome-adminfooter-container">
<div xmlns="http://www.w3.org/1999/xhtml" class="sites-adminfooter" role="navigation"><p><a class="sites-system-link" href="https://www.google.com/a/UniversalLogin?service=jotspot&amp;continue=https://sites.google.com/a/chromium.org/dev/chromium-os/testing/test-code-labs/dynamic-suite-codelab">Sign in</a><span aria-hidden="true">|</span><a class="sites-system-link" href="../../../system/app/pages/recentChanges.html">Recent Site Activity</a><span aria-hidden="true">|</span><a class="sites-system-link" href="../../../system/app/pages/reportAbuse.html" target="_blank">Report Abuse</a><span aria-hidden="true">|</span><a class="sites-system-link" href="javascript:;" onclick="window.open(webspace.printUrl)">Print Page</a><span aria-hidden="true">|</span><span class="sites-system-link">Powered By</span> <b class="powered-by"><a href="http://sites.google.com">Google Sites</a></b></p></div>
</div>
</div> 
</div> 
<div id="sites-chrome-onebar-footer">
</div>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    window.jstiming.load.tick('sjl');
  </script>
<script xmlns="http://www.w3.org/1999/xhtml" src="https://ssl.gstatic.com/sites/p/56e332/system/js/jot_min_view__en.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    window.jstiming.load.tick('jl');
  </script>
<script xmlns="http://www.w3.org/1999/xhtml">
      
          sites.core.Analytics.createTracker();
          sites.core.Analytics.trackPageview();
        
    </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
                    sites.Searchbox.initialize(
                        'sites-searchbox-search-button',
                        {"object":[]}['object'],
                        'search-site',
                        {"label":"Configure search options...","url":"/system/app/pages/admin/settings"});
                  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
      gsites.HoverPopupMenu.createSiteDropdownMenus('sites-header-nav-dropdown', false);
    </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
            JOT_setupNav("7648876402527094", "Navigation", false);
            JOT_addListener('titleChange', 'JOT_NAVIGATION_titleChange', 'COMP_7648876402527094');
          </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
            JOT_setupNav("14720868319272995", "Quick links", false);
            JOT_addListener('titleChange', 'JOT_NAVIGATION_titleChange', 'COMP_14720868319272995');
          </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
            JOT_setupNav("19690813310444355", "Other sites", false);
            JOT_addListener('titleChange', 'JOT_NAVIGATION_titleChange', 'COMP_19690813310444355');
          </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
              new sites.CommentPane('//docs.google.com/comments/d/AAHRpnXvrAwjAfmld0ObrebBiGRq9KGl0YsASgzAtEmW0VIeXLoLQTnThKAN8b8UoAUPwV_yxUJN7CSV0NuVLuQt0dyGlM0Y-97wZRispfA_iSoDSgSFFP84z2fbPpnUdOeskS4ejYgJv/api/js?anon=true',
                  false, false);
            </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
  setTimeout(function() {
    var fingerprint = gsites.date.TimeZone.getFingerprint([]);
    gsites.Xhr.send('https://www.chromium.org/_/tz', null, null, 'GET', null, null, { afjstz: fingerprint });
  }, 500);
</script>
<script xmlns="http://www.w3.org/1999/xhtml">
                    window.onload = function() {
                      if (false) {
                        JOT_setMobilePreview();
                      }
                      var loadTimer = window.jstiming.load;
                      loadTimer.tick("ol");
                      loadTimer["name"] = "load," + webspace.page.type + ",user_page";
                      window.jstiming.report(loadTimer, {}, 'https://gg.google.com/csi');
                    }
                  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
        JOT_insertAnalyticsCode(false,
            false);
      </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    var maestroRunner = new gsites.pages.view.SitesMaestroRunner(
        webspace, "en");
    maestroRunner.initListeners();
    maestroRunner.installEditRender();
  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
  //<![CDATA[
    // Decorate any fastUI buttons on the page with a class of 'goog-button'.
    if (webspace.user.hasWriteAccess) {
      JOT_decorateButtons();
    }

    // Fires delayed events.
    (function() {
      JOT_fullyLoaded = true;
      var delayedEvents = JOT_delayedEvents;
      for (var x = 0; x < delayedEvents.length; x++) {
        var event = delayedEvents[x];
        JOT_postEvent(event.eventName, event.eventSrc, event.payload);
      }
      JOT_delayedEvents = null;
      JOT_postEvent('pageLoaded');
    })();
  //]]>
</script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    JOT_postEvent('decorateGvizCharts');
  </script>
<script type="text/javascript">
          JOT_setupPostRenderingManager();
        </script>
<script type="text/javascript">
          JOT_postEvent('renderPlus', null, 'sites-chrome-main');
        </script>
<div id="server-timer-div" style="display:none"> </div>
<script type="text/javascript">
          window.jstiming.load.tick('render');
          JOT_postEvent('usercontentrendered', this);
        </script>
</body>
</html>
