<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/WebPage">
<head>
<meta http-equiv="X-UA-Compatible" content="chrome=1" />
<script type="text/javascript">/* Copyright 2008 Google. */ (function() { var e="wtsrt_",g="tbsd_",h="tbnd_",k="start",l="_wtsrt",m="_tbnd",n="CSI/";(function(){function f(a){this.t={};this.tick=function(a,c,b){this.t[a]=[void 0!=b?b:(new Date).getTime(),c];if(void 0==b)try{window.console.timeStamp(n+a)}catch(d){}};this.tick(k,null,a)}var a;window.performance&&(a=window.performance.timing);var p=a?new f(a.responseStart):new f;window.jstiming={Timer:f,load:p};if(a){var c=a.navigationStart,d=a.responseStart;0<c&&d>=c&&(window.jstiming.srt=d-c)}if(a){var b=window.jstiming.load;0<c&&d>=c&&(b.tick(l,void 0,c),b.tick(e,l,d),b.tick(g,e))}try{a=null,
window.chrome&&window.chrome.csi&&(a=Math.floor(window.chrome.csi().pageT),b&&0<c&&(b.tick(m,void 0,window.chrome.csi().startE),b.tick(h,m,c))),null==a&&window.gtbExternal&&(a=window.gtbExternal.pageT()),null==a&&window.external&&(a=window.external.pageT,b&&0<c&&(b.tick(m,void 0,window.external.startE),b.tick(h,m,c))),a&&(window.jstiming.pt=a)}catch(q){}})(); })()
</script>
<link rel="shortcut icon" href="../../_/rsrc/1354323194313/favicon.ico" type="image/x-icon" />
<link rel="apple-touch-icon" href="https://ssl.gstatic.com/sites/p/56e332/system/app/images/apple-touch-icon.png" type="image/png" />
<script type="text/javascript">/* Copyright 2008 Google. */ (function() { var d="",g="__duration__",h="function";function k(c){return document.getElementById(c)}window.byId=k;function l(c){return c.replace(/^\s+|\s+$/g,d)}window.trim=l;var m=[],n=0;window.JOT_addListener=function(c,a,b){var e=new String(n++);c={eventName:c,handler:a,compId:b,key:e};m.push(c);return e};window.JOT_removeListenerByKey=function(c){for(var a=0;a<m.length;a++)if(m[a].key==c){m.splice(a,1);break}};
window.JOT_removeAllListenersForName=function(c){for(var a=0;a<m.length;a++)m[a].eventName==c&&m.splice(a,1)};window.JOT_postEvent=function(c,a,b){var e={eventName:c,eventSrc:a||{},payload:b||{}};if(window.JOT_fullyLoaded)for(a=m.length,b=0;b<a&&b<m.length;b++){var f=m[b];f&&f.eventName==c&&(e.listenerCompId=f.compId||d,(f=typeof f.handler==h?f.handler:window[f.handler])&&f(e))}else window.JOT_delayedEvents.push({eventName:c,eventSrc:a,payload:b})};window.JOT_delayedEvents=[];
window.JOT_fullyLoaded=!1;window.JOT_formatRelativeToNow=function(c,a){var b=((new Date).getTime()-c)/6E4;if(1440<=b||0>b)return null;var e=0;60<=b&&(b/=60,e=2);2<=b&&e++;return a?window.JOT_siteRelTimeStrs[e].replace(g,Math.floor(b)):window.JOT_userRelTimeStrs[e].replace(g,Math.floor(b))}; })()
</script>
<script>

  

  var breadcrumbs = [{"path":"/chromium-os","deleted":false,"title":"Chromium OS","dir":"ltr"},{"path":"/chromium-os/testing","deleted":false,"title":"Testing Home","dir":"ltr"},{"path":"/chromium-os/testing/autotest-best-practices","deleted":false,"title":"Autotest Best Practices","dir":"ltr"}];
  var JOT_clearDotPath = 'https://ssl.gstatic.com/sites/p/56e332/system/app/images/cleardot.gif';

  
  var JOT_userRelTimeStrs = ["a minute ago","__duration__ minutes ago","an hour ago","__duration__ hours ago"];

  
  

  

  var webspace = {"enableAnalytics":true,"pageSharingId":"jotspot_page","enableUniversalAnalytics":false,"sharingPolicy":"OPENED_WITH_INDICATOR","siteTitle":"The Chromium Projects","isStartPageEnabled":true,"adsensePublisherId":null,"features":{"languageSelectDefaultTextSetToDefault":true,"validateClientGvizDataSourceUrls":true,"moreMobileStyleImprovements":true,"newInsertMenuIcons":true,"accessibleSortingButtons":true,"domainAnalyticsInGAOnly":true,"noCaptcha":true,"fileCabinetScreenReaderFix":true,"updatedTosAndPrivacyLinks":null,"pageDrafts":false,"mobileOrientationFix":true,"plusBadge":false,"pdfEmbedSupport":false,"jsClickFix":true},"isPublic":true,"isConsumer":false,"serverFlags":{"cajaBaseUrl":"//www.gstatic.com/caja","cajaDebugMode":false},"onepickBaseUrl":"https://docs.google.com","domainAnalyticsAccountId":"","plusPageId":"","signInUrl":"https://www.google.com/a/SelectSession?continue\u003dhttps://sites.google.com/a/chromium.org/dev/chromium-os/testing/autotest-best-practices\u0026service\u003djotspot","analyticsAccountId":"UA-5484340-1","scottyUrl":"/_/upload","homePath":"/","siteNoticeUrlEnabled":null,"plusPageUrl":"","adsensePromoClickedOrSiteIneligible":true,"csiReportUri":"https://gg.google.com/csi","sharingId":"jotspot","termsUrl":"//www.google.com/intl/en/policies/terms/","gvizVersion":1,"editorResources":{"sitelayout":["https://ssl.gstatic.com/sites/p/56e332/system/app/css/sitelayouteditor.css"],"text":["https://ssl.gstatic.com/sites/p/56e332/system/js/codemirror.js","https://ssl.gstatic.com/sites/p/56e332/system/app/css/codemirror_css.css","https://ssl.gstatic.com/sites/p/56e332/system/js/trog_edit__en.js","https://ssl.gstatic.com/sites/p/56e332/system/app/css/trogedit.css","/_/rsrc/1441580320000/system/app/css/editor.css","https://ssl.gstatic.com/sites/p/56e332/system/app/css/codeeditor.css","/_/rsrc/1441580320000/system/app/css/camelot/editor-jfk-wlb.css"]},"sharingUrlPrefix":"/_/sharing","isAdsenseEnabled":true,"domain":"chromium.org","baseUri":"","name":"dev","siteTemplateId":false,"siteNoticeRevision":null,"siteNoticeUrlAddress":null,"siteNoticeMessage":null,"page":{"isRtlLocale":false,"canDeleteWebspace":null,"isPageDraft":null,"parentPath":"/chromium-os/testing","parentWuid":"wuid:gx:2e2ee5668f423109","siteLocale":"en","timeZone":"America/Los_Angeles","type":"text","title":"Autotest Best Practices","locale":"en","wuid":"wuid:gx:546653f30c90a9d2","revision":17,"path":"/chromium-os/testing/autotest-best-practices","isSiteRtlLocale":false,"pageInheritsPermissions":null,"name":"autotest-best-practices","canChangePath":true,"state":"","properties":{},"bidiEnabled":false,"currentTemplate":{"path":"/system/app/pagetemplates/text","title":"Web Page"}},"canPublishScriptToAnyone":true,"user":{"keyboardShortcuts":true,"sessionIndex":"","guest_":true,"displayNameOrEmail":"guest","userName":"guest","uid":"","renderMobile":false,"domain":"","namespace":"","hasWriteAccess":false,"namespaceUser":false,"primaryEmail":"guest","hasAdminAccess":false},"gadgets":{"baseUri":"/system/app/pages/gadgets"}};
  webspace.page.breadcrumbs = breadcrumbs;

  
  var JOT_siteRelTimeStrs = ["a minute ago","__duration__ minutes ago","an hour ago","__duration__ hours ago"];

</script>
<script type="text/javascript">
                window.jstiming.load.tick('scl');
              </script>
<meta name="title" content="Autotest Best Practices - The Chromium Projects" />
<meta itemprop="name" content="Autotest Best Practices - The Chromium Projects" />
<meta property="og:title" content="Autotest Best Practices - The Chromium Projects" />
<meta name="description" content="Home of the Chromium Open Source Project" />
<meta itemprop="description" content="Home of the Chromium Open Source Project" />
<meta id="meta-tag-description" property="og:description" content="Home of the Chromium Open Source Project" />
<style type="text/css">
</style>
<link rel="stylesheet" type="text/css" href="https://ssl.gstatic.com/sites/p/56e332/system/app/themes/beigeandblue/standard-css-beigeandblue-ltr-ltr.css" />
<link rel="stylesheet" type="text/css" href="../../_/rsrc/1441580320000/system/app/css/overlay.css%3Fcb=beigeandblueundefineda100%2525%2525150goog-ws-leftthemedefaultstandard.css" />
<link rel="stylesheet" type="text/css" href="../../_/rsrc/1441580320000/system/app/css/camelot/allthemes-view.css" />
<!--[if IE]>
          <link rel="stylesheet" type="text/css" href="/system/app/css/camelot/allthemes%2die.css" />
        <![endif]-->
<title>Autotest Best Practices - The Chromium Projects</title>
<meta itemprop="image" content="/_/rsrc/1438879449147/config/customLogo.gif?revision=3" />
<meta property="og:image" content="/_/rsrc/1438879449147/config/customLogo.gif?revision=3" />
<script type="text/javascript">
                window.jstiming.load.tick('cl');
              </script>
</head>
<body xmlns="http://www.google.com/ns/jotspot" id="body" class=" en            ">
<div id="sites-page-toolbar" class="sites-header-divider">
<div xmlns="http://www.w3.org/1999/xhtml" id="sites-status" class="sites-status" style="display:none;"><div id="sites-notice" class="sites-notice" role="status" aria-live="assertive"> </div></div>
</div>
<div id="sites-chrome-everything-scrollbar">
<div id="sites-chrome-everything" class="">
<div id="sites-chrome-page-wrapper" style="direction: ltr">
<div id="sites-chrome-page-wrapper-inside">
<div xmlns="http://www.w3.org/1999/xhtml" id="sites-chrome-header-wrapper" style="height:auto;">
<table id="sites-chrome-header" class="sites-layout-hbox" cellspacing="0" style="height:auto;">
<tr class="sites-header-primary-row" id="sites-chrome-userheader">
<td id="sites-header-title" class="" role="banner"><div class="sites-header-cell-buffer-wrapper"><a href="../../index.html" id="sites-chrome-userheader-logo"><img id="logo-img-id" src="../../_/rsrc/1438879449147/config/customLogo.gif%3Frevision=3" alt="The Chromium Projects" class="sites-logo  " /></a><h2><a href="../../index.html" dir="ltr" id="sites-chrome-userheader-title">The Chromium Projects</a></h2></div></td><td class="sites-layout-searchbox  "><div class="sites-header-cell-buffer-wrapper"><form id="sites-searchbox-form" action="https://www.chromium.org/system/app/pages/search" role="search"><input type="hidden" id="sites-searchbox-scope" name="scope" value="search-site" /><input type="text" id="jot-ui-searchInput" name="q" size="20" value="" aria-label="Search this site" /><div id="sites-searchbox-button-set" class="goog-inline-block"><div role="button" id="sites-searchbox-search-button" class="goog-inline-block jfk-button jfk-button-standard" tabindex="0">Search this site</div></div></form></div></td>
</tr>
<tr class="sites-header-secondary-row" id="sites-chrome-horizontal-nav">
<td colspan="2" id="sites-chrome-header-horizontal-nav-container" role="navigation">
</td>
</tr>
</table>
</div>
<div id="sites-chrome-main-wrapper">
<div id="sites-chrome-main-wrapper-inside">
<table id="sites-chrome-main" class="sites-layout-hbox" cellspacing="0" cellpadding="{scmCellpadding}" border="0">
<tr>
<td id="sites-chrome-sidebar-left" class="sites-layout-sidebar-left initial" style="width:150px">
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_7648876402527094" class="sites-embed" role="navigation"><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotId="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="../../chromium-projects.html" jotId="wuid:gx:10ae433dadbbab13" class="sites-navigation-link">Home</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="../../Home.1.html" jotId="wuid:gx:43582b9d2029d3af" class="sites-navigation-link">Chromium</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="../../chromium-os.1.html" jotId="wuid:gx:83df2ab1f8880ba" class="sites-navigation-link">Chromium OS</a></div></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_14720868319272995" class="sites-embed" role="navigation"><h4 class="sites-embed-title">Quick links</h4><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotId="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="../../for-testers/bug-reporting-guidelines.html" class="sites-navigation-link">Report bugs</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="../../developers/discussion-groups.html" class="sites-navigation-link">Discuss</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="../../system/app/pages/sitemap/hierarchy.html" jotId="wuid:gx:4b58a9a350ad12f" class="sites-navigation-link">网站地图</a></div></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_19690813310444355" class="sites-embed" role="navigation"><h4 class="sites-embed-title">Other sites</h4><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotId="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="http://blog.chromium.org/" class="sites-navigation-link">Chromium Blog</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="http://code.google.com/chrome/extensions/" class="sites-navigation-link">Google Chrome Extensions</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="https://developers.google.com/chrome/chrome-frame/" class="sites-navigation-link">Google Chrome Frame</a></div></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_19695218559354544" class="sites-embed" role="complementary"><h4 class="sites-embed-title"></h4><div class="sites-embed-content sites-embed-content-sidebar-textbox"><div dir="ltr"><span style="font-size:x-small">Except as otherwise </span><a href="http://developers.google.com/site-policies.html#restrictions"><span style="font-size:x-small">noted</span></a><span style="font-size:x-small">, the content of this page is licensed under a </span><a href="http://creativecommons.org/licenses/by/2.5/"><span style="font-size:x-small">Creative Commons Attribution 2.5 license</span></a><span style="font-size:x-small">, and examples are licensed under the </span><a href="http://src.chromium.org/viewvc/chrome/trunk/src/LICENSE" target="_blank"><span style="font-size:x-small">BSD License</span></a><span style="font-size:x-small">.<br /></span></div></div></div>
</td>
<td id="sites-canvas-wrapper">
<div id="sites-canvas" role="main">
<div id="goog-ws-editor-toolbar-container"> </div>
<div xmlns="http://www.w3.org/1999/xhtml" id="title-crumbs" style="">
<A href="../../chromium-os.1.html" dir="ltr">Chromium OS</A>‎ &gt; ‎<A href="../testing.1.html" dir="ltr">Testing Home</A>‎ &gt; ‎
  </div>
<h3 xmlns="http://www.w3.org/1999/xhtml" id="sites-page-title-header" style="" align="left">
<span id="sites-page-title" dir="ltr" tabindex="-1" style="outline: none">Autotest Best Practices</span>
</h3>
<div id="sites-canvas-main" class="sites-canvas-main">
<div id="sites-canvas-main-content">
<table xmlns="http://www.w3.org/1999/xhtml" cellspacing="0" class="sites-layout-name-one-column sites-layout-hbox"><tbody><tr><td class="sites-layout-tile sites-tile-name-content-1"><div dir="ltr"><b style="font-family:Times New Roman;font-size:medium;font-weight:normal"><div><div class="sites-embed-align-left-wrapping-off"><div class="sites-embed-border-off sites-embed" style="width:400px;"><div class="sites-embed-content sites-embed-type-toc"><div class="goog-toc sites-embed-toc-maxdepth-6"><p>Contents</p><ol class="goog-toc"><li class="goog-toc"><a href="autotest-best-practices.html#TOC-Quick-reference"><strong>1 </strong>Quick reference</a><ol class="goog-toc"><li class="goog-toc"><a href="autotest-best-practices.html#TOC-Upstream-documentation"><strong>1.1 </strong>Upstream documentation</a></li><li class="goog-toc"><a href="autotest-best-practices.html#TOC-Coding-style"><strong>1.2 </strong>Coding style</a></li><li class="goog-toc"><a href="autotest-best-practices.html#TOC-Where-should-my-code-live-"><strong>1.3 </strong>Where should my code live?</a></li></ol></li><li class="goog-toc"><a href="autotest-best-practices.html#TOC-Writing-tests"><strong>2 </strong>Writing tests</a><ol class="goog-toc"><li class="goog-toc"><a href="autotest-best-practices.html#TOC-Writing-a-test"><strong>2.1 </strong>Writing a test</a><ol class="goog-toc"><li class="goog-toc"><a href="autotest-best-practices.html#TOC-Control-files"><strong>2.1.1 </strong>Control files</a></li><li class="goog-toc"><a href="autotest-best-practices.html#TOC-Choosing-a-Suite"><strong>2.1.2 </strong>Choosing a Suite</a></li><li class="goog-toc"><a href="autotest-best-practices.html#TOC-Pure-python"><strong>2.1.3 </strong>Pure python</a></li><li class="goog-toc"><a href="autotest-best-practices.html#TOC-Reporting-failures"><strong>2.1.4 </strong>Reporting failures</a></li></ol></li><li class="goog-toc"><a href="autotest-best-practices.html#TOC-Considerations-when-writing-client-side-tests"><strong>2.2 </strong>Considerations when writing client-side tests</a><ol class="goog-toc"><li class="goog-toc"><a href="autotest-best-practices.html#TOC-Compiling-and-executing-binaries"><strong>2.2.1 </strong>Compiling and executing binaries</a></li><li class="goog-toc"><a href="autotest-best-practices.html#TOC-Reusing-code-fixtures-"><strong>2.2.2 </strong>Reusing code (“fixtures”)</a></li></ol></li><li class="goog-toc"><a href="autotest-best-practices.html#TOC-Considerations-when-writing-server-side-tests"><strong>2.3 </strong>Considerations when writing server-side tests</a><ol class="goog-toc"><li class="goog-toc"><a href="autotest-best-practices.html#TOC-When-why-to-write-a-server-side-test"><strong>2.3.1 </strong>When/why to write a server-side test</a></li><li class="goog-toc"><a href="autotest-best-practices.html#TOC-Control-files-for-server-side-tests"><strong>2.3.2 </strong>Control files for server-side tests</a></li><li class="goog-toc"><a href="autotest-best-practices.html#TOC-Operations-on-Host-objects"><strong>2.3.3 </strong>Operations on Host objects</a></li><li class="goog-toc"><a href="autotest-best-practices.html#TOC-Servo-based-tests"><strong>2.3.4 </strong>Servo-based tests</a></li><li class="goog-toc"><a href="autotest-best-practices.html#TOC-Calling-client-side-tests-from-a-server-side-test"><strong>2.3.5 </strong>Calling client-side tests from a server-side test</a></li></ol></li></ol></li><li class="goog-toc"><a href="autotest-best-practices.html#TOC-Writing-library-code"><strong>3 </strong>Writing library code</a></li><li class="goog-toc"><a href="autotest-best-practices.html#TOC-Adding-test-deps"><strong>4 </strong>Adding test deps</a><ol class="goog-toc"><li class="goog-toc"><a href="autotest-best-practices.html#TOC-Create-a-dep-from-a-third-party-package"><strong>4.1 </strong>Create a dep from a third-party package</a></li></ol></li></ol></div></div></div></div></div><br /><div><b style="font-weight:normal"><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">When the Chrome OS team started using autotest, we tried our best to figure out how to fit our code and our tests into the upstream style with little guidance and poor documentation.  This went poorly.  With the benefit of hindsight, we’re going to lay out some best-practices that we’d like to enforce going forward.  In many cases, there is legacy code that contradicts this style; we should go through and refactor that code to fit these guidelines as time allows.</span></b></div><h1><a name="TOC-Quick-reference"></a><span style="font-size:24px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Quick reference</span></h1><h2><a name="TOC-Upstream-documentation"></a><span style="font-size:19px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Upstream documentation</span></h2><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">There is a sizeable volume of general Autotest documentation available on github:</span><br /><a href="https://github.com/autotest/autotest/wiki"><span style="font-size:15px;font-family:Arial;color:rgb(17,85,204);background-color:transparent;vertical-align:baseline;white-space:pre-wrap">https://github.com/autotest/autotest/wiki</span></a><br /><h2><a name="TOC-Coding-style"></a><span style="font-size:19px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Coding style</span></h2><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Basically PEP-8.  Significant deviations/additions are discussed in </span><a href="https://chromium.googlesource.com/chromiumos/third_party/autotest/+/master/CODING_STYLE" target="_blank"><span style="font-size:15px;font-family:Arial;color:rgb(17,85,204);background-color:transparent;vertical-align:baseline;white-space:pre-wrap">CODING_STYLE</span></a><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> at the top level of the autotest repo.</span><br /><h2><a name="TOC-Where-should-my-code-live-"></a><span style="font-size:19px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Where should my code live?</span></h2><div dir="ltr"><table style="border:none;border-collapse:collapse;width:624px"><colgroup><col width="*" /><col width="*" /></colgroup><tbody><tr style="height:0px"><td style="border:1px solid rgb(0,0,0);padding:7px"><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">client-side tests</span></td><td style="border:1px solid rgb(0,0,0);padding:7px"><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">client/site_tests/</span></td></tr><tr style="height:0px"><td style="border:1px solid rgb(0,0,0);padding:7px"><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">server-side tests</span></td><td style="border:1px solid rgb(0,0,0);padding:7px"><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">server/site_tests</span></td></tr><tr style="height:0px"><td style="border:1px solid rgb(0,0,0);padding:7px"><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Common library code</span></td><td style="border:1px solid rgb(0,0,0);padding:7px"><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">client/common_lib/cros/</span></td></tr><tr style="height:0px"><td style="border:1px solid rgb(0,0,0);padding:7px"><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Server-only library code</span></td><td style="border:1px solid rgb(0,0,0);padding:7px"><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">server/cros</span></td></tr></tbody></table></div><br /><br /><h1><a name="TOC-Writing-tests"></a><span style="font-size:24px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Writing tests</span></h1><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">An autotest is really defined by its control file.  A control file contains important metadata about the test (name, author, description, duration, what suite it’s in, etc) and then pulls in and executes the actual test code.  This test code can be shared among multiple distinct test cases by parameterizing it and passing those parameters in from separate control files.</span><br /><br /><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Autotests </span><span style="font-size:15px;font-family:Arial;background-color:transparent;font-weight:bold;vertical-align:baseline;white-space:pre-wrap">must</span><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">:</span><br /><ul style="margin-top:0pt;margin-bottom:0pt"><li dir="ltr" style="list-style-type:disc;font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline"><span style="background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Be self-contained: assume nothing about the condition of the device</span></li><li dir="ltr" style="list-style-type:disc;font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline"><span style="background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Be hermetic: requiring the Internet to be reachable in order for your test to succeed is unacceptable.</span></li><li dir="ltr" style="list-style-type:disc;font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline"><span style="background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Be automatic: avoid user interaction and run-time specification of input values.</span></li><li dir="ltr" style="list-style-type:disc;font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline"><span style="background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Be integration tests: if you can test the feature in a unit test (or a chrome </span><a href="http://dev.chromium.org/developers/testing/browser-tests"><span style="color:rgb(17,85,204);background-color:transparent;vertical-align:baseline;white-space:pre-wrap">browser test</span></a><span style="background-color:transparent;vertical-align:baseline;white-space:pre-wrap">), do so.</span></li><li dir="ltr" style="list-style-type:disc;font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline"><span style="background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Prefer object composition to inheritance: avoid subclassing test.test to implement common functionality for multiple tests.  Instead, create a class that your tests can instantiate to perform common operations.  This enables us to write tests that use both PyAuto and <a href="../servo.1.html">Servo</a> without dealing with multiple inheritance, for example.</span></li><li dir="ltr" style="list-style-type:disc;font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline"><span style="background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Be deterministic: a test should not validate the timing of some operation.  Instead, write a test that records the timing in performance keyvals so that we can track the numbers over time.</span></li></ul><br /><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Autotests </span><span style="font-size:15px;font-family:Arial;background-color:transparent;font-weight:bold;vertical-align:baseline;white-space:pre-wrap">must not</span><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">:</span><br /><ul style="margin-top:0pt;margin-bottom:0pt"><li dir="ltr" style="list-style-type:disc;font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline"><span style="background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Put significant logic in the control file: control files are really just python, so one can put arbitrary logic in there.  Don’t.  Run your test code, perhaps with some parameters.</span></li></ul><br /><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Autotests </span><span style="font-size:15px;font-family:Arial;background-color:transparent;font-weight:bold;vertical-align:baseline;white-space:pre-wrap">may</span><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">:</span><br /><ul style="margin-top:0pt;margin-bottom:0pt"><li dir="ltr" style="list-style-type:disc;font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline"><span style="background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Share parameterized fixtures: a test is defined by a control file.  Control files import and run test code, and can pass simple parameters to the code they run through a well-specified interface.</span></li></ul><br /><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Autotest has a notion of both </span><span style="font-size:15px;font-family:Arial;background-color:transparent;font-style:italic;vertical-align:baseline;white-space:pre-wrap">client-side test</span><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">s and </span><span style="font-size:15px;font-family:Arial;background-color:transparent;font-style:italic;vertical-align:baseline;white-space:pre-wrap">server-side test</span><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">s.  Code in a client-side test runs only on the device under test (DUT), and as such isn’t capable of maintaining state across reboots or handling a failed suspend/resume and the like.  </span><span style="font-size:15px;font-family:Arial;background-color:transparent;font-weight:bold;vertical-align:baseline;white-space:pre-wrap">If possible, an autotest should be written as a client-side test.</span><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">  A ‘server’ test runs on the autotest server, but gets assigned a DUT just like a client-side test.  It can use various autotest primitives (and library code written by the CrOS team) to manipulate that device.  Most, if not all, tests that use Servo or remote power management should be server-side tests, as an example.</span><br /><br /><a href="https://github.com/autotest/autotest/wiki/AddingTest"><span style="font-size:15px;font-family:Arial;color:rgb(17,85,204);background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Adding a test </span></a><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">involves putting a control file and a properly-written test wrapper in the right place in the source tree.  There are conventions that must be followed, and a </span><a href="https://github.com/autotest/autotest/wiki/AutotestApi"><span style="font-size:15px;font-family:Arial;color:rgb(17,85,204);background-color:transparent;vertical-align:baseline;white-space:pre-wrap">variety of primitives </span></a><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">available for use.  When writing any code, whether client-side test, server-side test, or library, have a strong bias towards using </span><a href="existing-autotest-utilities.html"><span style="font-size:15px;font-family:Arial;color:rgb(17,85,204);background-color:transparent;vertical-align:baseline;white-space:pre-wrap">autotest utility code</span></a><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">.  This keeps the codebase consistent.</span><br /><h2><a name="TOC-Writing-a-test"></a><span style="font-size:19px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Writing a test</span></h2><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">This section explains considerations and requirements for any autotest, whether client or server.</span><br /><h3 dir="ltr"><a name="TOC-Control-files"></a><span style="font-size:16px;font-family:Arial;color:rgb(102,102,102);background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Control files</span></h3><a href="https://github.com/autotest/autotest/wiki/ControlRequirements"><span style="font-size:15px;font-family:Arial;color:rgb(17,85,204);background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Upstream documentation</span></a><br /><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Our local conventions for autotest control files deviate from the above a bit, but the indication about which fields are mandatory still holds.</span><br /><div dir="ltr"><table style="border:none;border-collapse:collapse"><colgroup><col width="157" /><col width="95" /><col width="373" /></colgroup><tbody><tr style="height:0px"><td style="border:1px solid rgb(0,0,0);padding:7px"><span style="font-size:15px;font-family:Arial;background-color:transparent;font-weight:bold;vertical-align:baseline;white-space:pre-wrap">Variable</span></td><td style="border:1px solid rgb(0,0,0);padding:7px"><span style="font-size:15px;font-family:Arial;background-color:transparent;font-weight:bold;vertical-align:baseline;white-space:pre-wrap">Required</span></td><td style="border:1px solid rgb(0,0,0);padding:7px"><span style="font-size:15px;font-family:Arial;background-color:transparent;font-weight:bold;vertical-align:baseline;white-space:pre-wrap">Value</span></td></tr><tr style="height:0px"><td style="border:1px solid rgb(0,0,0);padding:7px"><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">AUTHOR</span></td><td style="border:1px solid rgb(0,0,0);padding:7px"><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Yes</span></td><td style="border:1px solid rgb(0,0,0);padding:7px"><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">A comma-delimited string of at least one responsible engineer and a backup engineer -- or at worst a backup mailing list. i.e. AUTHOR = ‘msb, snanda’</span></td></tr><tr style="height:0px"><td style="border:1px solid rgb(0,0,0);padding:7px"><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">DEPENDENCIES</span></td><td style="border:1px solid rgb(0,0,0);padding:7px"><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">No</span></td><td style="border:1px solid rgb(0,0,0);padding:7px"><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">list of tags known to the HW test lab.</span></td></tr><tr style="height:0px"><td style="border:1px solid rgb(0,0,0);padding:7px"><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">DOC</span></td><td style="border:1px solid rgb(0,0,0);padding:7px"><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Yes</span></td><td style="border:1px solid rgb(0,0,0);padding:7px"><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Long description of the test, pass/fail criteria</span></td></tr><tr style="height:0px"><td style="border:1px solid rgb(0,0,0);padding:7px"><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">NAME</span></td><td style="border:1px solid rgb(0,0,0);padding:7px"><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Yes</span></td><td style="border:1px solid rgb(0,0,0);padding:7px"><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Display name of the test. Generally this is the directory where your test lives e.g. hardware_TPMCheck. </span><span style="font-size:15px;font-family:Arial;background-color:transparent;font-style:italic;vertical-align:baseline;white-space:pre-wrap">If you are using multiple run_test calls in the same control file or multiple control files with one test wrapper in the same suite, problems arise with the displaying of your test name. </span><a href="http://crosbug.com/35795"><span style="font-size:15px;font-family:Arial;color:rgb(17,85,204);background-color:transparent;font-style:italic;vertical-align:baseline;white-space:pre-wrap">crosbug.com/35795</span></a><span style="font-size:15px;font-family:Arial;background-color:transparent;font-style:italic;vertical-align:baseline;white-space:pre-wrap">. When in doubt ask. </span></td></tr><tr style="height:0px"><td style="border:1px solid rgb(0,0,0);padding:7px"><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">SYNC_COUNT</span></td><td style="border:1px solid rgb(0,0,0);padding:7px"><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">No</span></td><td style="border:1px solid rgb(0,0,0);padding:7px"><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Integer &gt;= 1.  Number of simultaneous devices needed for a test run.</span></td></tr><tr style="height:0px"><td style="border:1px solid rgb(0,0,0);padding:7px"><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">TIME</span></td><td style="border:1px solid rgb(0,0,0);padding:7px"><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Yes</span></td><td style="border:1px solid rgb(0,0,0);padding:7px"><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Test duration:</span><br /><p dir="ltr" style="margin-left:36pt;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">FAST &lt; 1m<br />SHORT &lt; 5m<br />MEDIUM &lt; 10m<br />LONG &lt; 20m<br />LENGTHY &gt;30m</span></p></td></tr><tr style="height:0px"><td style="border:1px solid rgb(0,0,0);padding:7px"><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">TEST_TYPE</span></td><td style="border:1px solid rgb(0,0,0);padding:7px"><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Yes</span></td><td style="border:1px solid rgb(0,0,0);padding:7px"><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Client or Server</span></td></tr><tr style="height:0px"><td style="border:1px solid rgb(0,0,0);padding:7px"><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">SUITE</span></td><td style="border:1px solid rgb(0,0,0);padding:7px"><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">No</span></td><td style="border:1px solid rgb(0,0,0);padding:7px"><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">A comma-delimited string of suite names that this test should be a part of.</span></td></tr></tbody></table></div><br /></b><h3><a name="TOC-Choosing-a-Suite"></a><font color="#666666" face="Arial"><span style="white-space:pre-wrap">Choosing a Suite</span></font></h3><b style="font-size:medium;font-weight:normal"><span style="font-size:15px;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"><font face="Arial">Currently existing suites are defined in the test_suites/ subdirectory at the top level of the autotest repo.  Read the docstrings there to see if your new test fits into one that’s already defined.</font></span></b><div><b style="font-size:medium;font-weight:normal"><span style="font-size:15px;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"><font face="Arial"><br /></font></span></b></div><div><b style="font-size:medium;font-weight:normal"><span style="font-size:15px;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"><font face="Arial">When first adding a test, it should not go into the BVT</font><code><font face="Arial"> </font></code></span></b><span style="font-size:medium"><span style="font-size:15px;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"><font face="Arial">suite.   A test should only be added to the BVT after it has been running in some non-BVT suite long enough to establish a track record showing that the test does not fail when run against working software.  A suite named <code>experimental</code> exists for tests intended for the BVT, and for which there is no more </font></span></span><span style="font-family:Arial;font-size:15px;white-space:pre-wrap">convenient</span><span style="font-size:medium"><span style="font-size:15px;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"><font face="Arial"> home.</font></span></span><div><div><b style="font-weight:normal"><h3 dir="ltr" style="font-family:Times New Roman;font-size:medium"><a name="TOC-Pure-python"></a><span style="font-size:16px;font-family:Arial;color:rgb(102,102,102);background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Pure python </span></h3><span style="font-family:Arial;font-size:15px;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Lie, cheat and steal to keep your tests in pure python.  It will be easier to debug failures, it will be easier to generate meaningful error output, it will be simpler to get your tests installed and run, and it will be simpler for the lab team to build tools that allow you to quickly iterate.</span><br /><br /><span style="font-family:Arial;font-size:15px;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Shelling out to existing command-line tools is done fairly often, and isn’t a terrible thing.  The test author can wind up having to do a lot of output parsing, which is often brittle, but this can be a decent tradeoff in lieu of having to reimplement large pieces of functionality in python.</span><br /><br /><span style="font-family:Arial;font-size:15px;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Note that you will need to be sure that any commands you use are installed on the host.  For a client-side test, “the host” means “the DUT”.  For a server-side test, “the host” typically means “the system running autoserv”; however, if you use </span><span style="font-family:Courier New;font-size:15px;color:rgb(56,118,29);background-color:transparent;vertical-align:baseline;white-space:pre-wrap">SiteHost.run()</span><span style="font-family:Arial;font-size:15px;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">, the command will run on the DUT.  On the server, your tests will have access to all tools common to both a typical CrOS chroot environment and standard Goobuntu.</span><br /><br /><span style="font-family:Arial;font-size:15px;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">If you want to use a tool on the DUT, it may be appropriate to include it as a dependency of the </span><span style="font-family:Courier New;font-size:15px;color:rgb(56,118,29);background-color:transparent;vertical-align:baseline;white-space:pre-wrap">chromeos-base/chromeos-test</span><span style="font-family:Arial;font-size:15px;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> package.  This ensures that the tool is pre-installed on every test image for every device, and will always be available for use.  Otherwise, the tool must be installed as an </span><a href="autotest-best-practices.html#TOC-Adding-test-deps" style="font-family:Times New Roman;font-size:medium"><span style="font-size:15px;font-family:Arial;color:rgb(17,85,204);background-color:transparent;vertical-align:baseline;white-space:pre-wrap">autotest “dep”</span></a><span style="font-family:Arial;font-size:15px;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">.</span><br /><br /><span style="font-family:Arial;font-size:15px;background-color:transparent;font-weight:bold;vertical-align:baseline;white-space:pre-wrap">Never install your own shell scripts and call them.</span><span style="font-family:Arial;font-size:15px;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">  Anything you can do in shell, you can do in python.</span><br /><h3 dir="ltr" style="font-family:Times New Roman;font-size:medium"><a name="TOC-Reporting-failures"></a><span style="font-size:16px;font-family:Arial;color:rgb(102,102,102);background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Reporting failures</span></h3><span style="font-family:Arial;font-size:15px;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Autotest supports several kinds of failure statuses:</span><br /><div dir="ltr" style="font-family:Times New Roman;font-size:medium"><table style="border:none;border-collapse:collapse"><colgroup><col width="87" /><col width="144" /><col width="393" /></colgroup><tbody><tr style="height:0px"><td style="border:1px solid rgb(0,0,0);padding:7px"><span style="font-size:15px;font-family:Arial;background-color:transparent;font-weight:bold;vertical-align:baseline;white-space:pre-wrap">Status</span></td><td style="border:1px solid rgb(0,0,0);padding:7px"><span style="font-size:15px;font-family:Arial;background-color:transparent;font-weight:bold;vertical-align:baseline;white-space:pre-wrap">Exception</span></td><td style="border:1px solid rgb(0,0,0);padding:7px"><span style="font-size:15px;font-family:Arial;background-color:transparent;font-weight:bold;vertical-align:baseline;white-space:pre-wrap">Reason</span></td></tr><tr style="height:0px"><td style="border:1px solid rgb(0,0,0);padding:7px"><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">WARN</span></td><td style="border:1px solid rgb(0,0,0);padding:7px"><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">error.TestWarn</span></td><td style="border:1px solid rgb(0,0,0);padding:7px"><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">error.TestWarn should be used when side effects to the test running are encountered but are not directly related to the test running. For example, if you are testing Wifi and powerd crashes. *</span><span style="font-size:15px;font-family:Arial;background-color:transparent;font-style:italic;vertical-align:baseline;white-space:pre-wrap">Currently there are not any clear usecases for this and error.TestWarn should be generally avoided until further notice.</span></td></tr><tr style="height:0px"><td style="border:1px solid rgb(0,0,0);padding:7px"><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">TEST_NA</span></td><td style="border:1px solid rgb(0,0,0);padding:7px"><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">error.TestNAError</span></td><td style="border:1px solid rgb(0,0,0);padding:7px"><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">This test does not apply in the current environment.</span></td></tr><tr style="height:0px"><td style="border:1px solid rgb(0,0,0);padding:7px"><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">ERROR</span></td><td style="border:1px solid rgb(0,0,0);padding:7px"><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">error.TestError</span></td><td style="border:1px solid rgb(0,0,0);padding:7px"><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">The test was unable to validate the desired behavior.</span></td></tr><tr style="height:0px"><td style="border:1px solid rgb(0,0,0);padding:7px"><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">FAIL</span></td><td style="border:1px solid rgb(0,0,0);padding:7px"><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">error.TestFail</span></td><td style="border:1px solid rgb(0,0,0);padding:7px"><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">The test determined the desired behavior failed to occur.</span></td></tr></tbody></table></div><br /><br /><h2 dir="ltr" style="font-family:Times New Roman;font-size:medium"><a name="TOC-Considerations-when-writing-client-side-tests"></a><span style="font-size:19px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Considerations when writing client-side tests</span></h2><span style="font-family:Arial;font-size:15px;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">All client-side tests authored at Google must live in the client/site_tests sub-directory of the autotest source tree.</span><br /><h3 dir="ltr" style="font-family:Times New Roman;font-size:medium"><a name="TOC-Compiling-and-executing-binaries"></a><span style="font-size:16px;font-family:Arial;color:rgb(102,102,102);background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Compiling and executing binaries</span></h3><span style="font-family:Arial;font-size:15px;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">It is possible to compile source that’s included with your test and use the products at test runtime.  The build infrastructure will compile this code for the appropriate target architecture and package it up along with the rest of your test’s resources, but this increases your development iteration time as you need to actually re-build and re-package your test to deploy it to the device.  While we hope to improve tooling support for this use case in the future, avoiding this issue is the ideal.</span><br /><br /><span style="font-family:Arial;font-size:15px;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">If you can’t avoid this, here’s how to get your code compiled and installed as a part of your test:</span><br /><ol style="font-family:Times New Roman;font-size:medium;margin-top:0pt;margin-bottom:0pt"><li dir="ltr" style="list-style-type:decimal;font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline"><span style="background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Create a src/ directory next to your control file.</span></li><li dir="ltr" style="list-style-type:decimal;font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline"><span style="background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Put your source, including its Makefile, in src/</span></li><li dir="ltr" style="list-style-type:decimal;font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline"><span style="background-color:transparent;vertical-align:baseline;white-space:pre-wrap">define a method in your test class called “setup(self)” that takes no arguments.</span></li><li dir="ltr" style="list-style-type:decimal;font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline"><span style="background-color:transparent;vertical-align:baseline;white-space:pre-wrap">setup(self) should perform all tasks necessary to build your tool.  There are some helpful utility functions in client/common_lib/base_utils.py.  Trivial example:</span></li></ol><div class="sites-codeblock sites-codesnippet-block" style="font-family:Times New Roman;font-size:medium"><p dir="ltr" style="margin-left:36pt;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Courier New;color:rgb(56,118,29);background-color:transparent;vertical-align:baseline;white-space:pre-wrap"><code>    def setup(self):</code></span></p><p dir="ltr" style="margin-left:36pt;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Courier New;color:rgb(56,118,29);background-color:transparent;vertical-align:baseline;white-space:pre-wrap"><code>        os.chdir(self.srcdir)</code></span></p><p dir="ltr" style="margin-left:36pt;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Courier New;color:rgb(56,118,29);background-color:transparent;vertical-align:baseline;white-space:pre-wrap"><code>        utils.make('OUT_DIR=.')</code></span></p></div><h3 dir="ltr" style="font-family:Times New Roman;font-size:medium"><a name="TOC-Reusing-code-fixtures-"></a><span style="font-size:16px;font-family:Arial;color:rgb(102,102,102);background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Reusing code (“fixtures”)</span></h3><span style="font-family:Arial;font-size:15px;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Any autotest is, essentially, a single usage of a re-usable test fixture.  This is because run_once() in your test wrapper can take any arguments you want.  As such, multiple control files can re-use the same wrapper -- and should, where it makes sense.</span><br /><h2 dir="ltr" style="font-family:Times New Roman;font-size:medium"><a name="TOC-Considerations-when-writing-server-side-tests"></a><span style="font-size:19px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Considerations when writing server-side tests</span></h2><span style="font-family:Arial;font-size:15px;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">All server-side tests authored at Google must live in the server/site_tests sub-directory of the autotest source tree.</span><br /><br /><span style="font-family:Arial;font-size:15px;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">It should be even easier to keep the server-side of a test in pure python, as you should simply be driving the DUT and verifying state.</span><br /><h3 dir="ltr" style="font-family:Times New Roman;font-size:medium"><a name="TOC-When-why-to-write-a-server-side-test"></a><span style="font-size:16px;font-family:Arial;color:rgb(102,102,102);background-color:transparent;vertical-align:baseline;white-space:pre-wrap">When/why to write a server-side test</span></h3><span style="font-family:Arial;font-size:15px;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Server-side tests are appropriate when some operation in the test can't be executed on the DUT.  The prototypical example is rebooting the DUT.  Other examples include tests that manipulate the network around the DUT (e.g. WiFi tests), tests that power off the DUT, and tests that rely on a Servo attached to the DUT.</span><br /><br /><span style="font-family:Arial;font-size:15px;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">One simple criterion for whether to write a server-side test is this:  Is the DUT an object that the test must manipulate?  If the answer is “yes”, then a server-side test makes sense.</span><br /><h3 dir="ltr" style="font-family:Times New Roman;font-size:medium"><a name="TOC-Control-files-for-server-side-tests"></a><span style="font-size:16px;font-family:Arial;color:rgb(102,102,102);background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Control files for server-side tests</span></h3></b><p><b style="font-family:Times New Roman;font-size:medium;font-weight:normal"><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Server-side tests commonly operate on the DUT as an object.  Autotest represents the DUT with an instance of class <code>Host</code>; the instance is constructed and passed to the test from the control file.  Creating the host object in the control file can be done using certain definitions present in the </span><a href="https://github.com/autotest/autotest/wiki/AutotestApi"><span style="font-size:15px;font-family:Arial;color:rgb(17,85,204);background-color:transparent;vertical-align:baseline;white-space:pre-wrap">global environment of every control file</span></a><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">:</span></b></p><b style="font-family:Times New Roman;font-size:medium;font-weight:normal"><ul style="margin-top:0pt;margin-bottom:0pt"><li dir="ltr" style="list-style-type:disc;font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline"><span style="background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Function </span><span style="font-family:Courier New;color:rgb(56,118,29);background-color:transparent;vertical-align:baseline;white-space:pre-wrap">hosts.create_host()</span><span style="font-family:Courier New;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> </span><span style="background-color:transparent;vertical-align:baseline;white-space:pre-wrap">will create a host object from a string with the name of the host (an IP address as a string is also acceptable).</span></li><li dir="ltr" style="list-style-type:disc;font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline"><span style="background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Variable </span><span style="font-family:Courier New;color:rgb(56,118,29);background-color:transparent;vertical-align:baseline;white-space:pre-wrap">machines</span><span style="background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> is a list of the host names available to the test.</span></li></ul><br /><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Below is a sample fragment for a control file that runs a simple server side test in parallel on all the hosts specified for the test.  The fragment is a complete control file, except for the missing boilerplate comments and documentation definitions required in all control files.</span><br /><div class="sites-codeblock sites-codesnippet-block"><p dir="ltr" style="margin-left:36pt;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Courier New;color:rgb(56,118,29);background-color:transparent;vertical-align:baseline;white-space:pre-wrap"><code>def run(machine):</code></span></p><p dir="ltr" style="margin-left:36pt;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Courier New;color:rgb(56,118,29);background-color:transparent;vertical-align:baseline;white-space:pre-wrap"><code>    host = hosts.create_host(machine)</code></span></p><p dir="ltr" style="margin-left:36pt;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Courier New;color:rgb(56,118,29);background-color:transparent;vertical-align:baseline;white-space:pre-wrap"><code>    job.run_test("platform_ServerTest", host=host)</code></span></p><br /><p dir="ltr" style="margin-left:36pt;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Courier New;color:rgb(56,118,29);background-color:transparent;vertical-align:baseline;white-space:pre-wrap"><code>parallel_simple(run, machines)</code></span></p></div><br /><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Note:  The sample above relies on a common convention that the </span><span style="font-size:15px;font-family:Courier New;color:rgb(56,118,29);background-color:transparent;vertical-align:baseline;white-space:pre-wrap">run_once()</span><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> method of a server-side test defines an argument named </span><span style="font-size:15px;font-family:Courier New;color:rgb(56,118,29);background-color:transparent;vertical-align:baseline;white-space:pre-wrap">host</span><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> with a default value, e.g.</span><br /><div class="sites-codeblock sites-codesnippet-block"><p dir="ltr" style="margin-left:36pt;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Courier New;color:rgb(56,118,29);background-color:transparent;vertical-align:baseline;white-space:pre-wrap"><code>def run_once(self, host=None):</code></span></p><p dir="ltr" style="margin-left:36pt;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Courier New;color:rgb(56,118,29);background-color:transparent;vertical-align:baseline;white-space:pre-wrap"><code>    # … test code goes here.</code></span></p></div><h3 dir="ltr"><a name="TOC-Operations-on-Host-objects"></a><span style="font-size:16px;font-family:Arial;color:rgb(102,102,102);background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Operations on Host objects</span></h3><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">A Host object supports various methods to operate on a DUT.  Below is a short list of important methods supported by instances of Host:</span><br /><ul style="margin-top:0pt;margin-bottom:0pt"><li dir="ltr" style="list-style-type:disc;font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline"><span style="background-color:transparent;vertical-align:baseline;white-space:pre-wrap">run(command) - run a shell command on the host</span></li></ul><ul style="margin-top:0pt;margin-bottom:0pt"><li dir="ltr" style="list-style-type:disc;font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline"><span style="background-color:transparent;vertical-align:baseline;white-space:pre-wrap">reboot() - reboot the host, and wait for it to be back on the network</span></li><li dir="ltr" style="list-style-type:disc;font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline"><span style="background-color:transparent;vertical-align:baseline;white-space:pre-wrap">wait_up() - wait for the host to be active on the network</span></li><li dir="ltr" style="list-style-type:disc;font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline"><span style="background-color:transparent;vertical-align:baseline;white-space:pre-wrap">wait_down() - wait until the host is no longer on the network, or until it is known to have rebooted.</span></li></ul><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">More details, including a longer list of available methods, and more about how they work can be found in the </span><a href="https://github.com/autotest/autotest/wiki/Autoserv"><span style="font-size:15px;font-family:Arial;color:rgb(17,85,204);background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Autotest documentation for autoserv</span></a><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> and </span><a href="https://github.com/autotest/autotest/wiki/UsingHostObjects"><span style="font-size:15px;font-family:Arial;color:rgb(17,85,204);background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Autotest documentation for Host</span></a><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">.</span><br /><h3 dir="ltr"><a name="TOC-Servo-based-tests"></a><span style="font-size:16px;font-family:Arial;color:rgb(102,102,102);background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Servo-based tests</span></h3><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">For server-side tests that use a servo-attached DUT, the </span><span style="font-size:15px;font-family:Courier New;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"><code>host</code></span><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> object has a </span><span style="font-size:15px;font-family:Courier New;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"><code>servo</code></span><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> attribute.  If Autotest determines that the DUT has a Servo attached, the <code>servo</code> attribute will be a valid instance of a <code>Servo</code> client object; otherwise the attribute will be <code>None</code>.</span></b><div><b style="font-family:Times New Roman;font-size:medium;font-weight:normal"><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"><br /></span></b></div><div><b style="font-family:Times New Roman;font-size:medium;font-weight:normal"><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">For a DUT in the lab, Autotest will automatically determine whether there is a servo available; however, if a test requires Servo, its control file must have additional code to guarantee a properly initialized servo object on the host.</span></b><div><div><span style="background-color:transparent;font-size:10pt"><font face="Arial"><span style="font-size:15px;white-space:pre-wrap"><br /></span></font></span></div><div><span style="background-color:transparent;font-size:10pt"><font face="Arial"><span style="font-size:15px;white-space:pre-wrap">Below is a code snippet outlining the requirements; portions of the control file have been omitted for brevity:</span></font></span></div><div><b style="font-weight:normal"><div class="sites-codeblock sites-codesnippet-block" style="font-family:Times New Roman;font-size:medium"><p style="margin-left:36pt;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Courier New;color:rgb(56,118,29);background-color:transparent;vertical-align:baseline;white-space:pre-wrap"><code># ... Standard boilerplate variable assignments...</code></span></p><p style="margin-left:36pt;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Courier New;color:rgb(56,118,29);background-color:transparent;vertical-align:baseline;white-space:pre-wrap"><code>DEPENDENCIES = "servo"</code></span></p><p style="margin-left:36pt;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Courier New;color:rgb(56,118,29);background-color:transparent;vertical-align:baseline;white-space:pre-wrap"><code># ... more standard boilerplate...</code></span></p><p style="margin-left:36pt;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Courier New;color:rgb(56,118,29);background-color:transparent;vertical-align:baseline;white-space:pre-wrap"><code><br /></code></span></p><p dir="ltr" style="margin-left:36pt;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Courier New;color:rgb(56,118,29);background-color:transparent;vertical-align:baseline;white-space:pre-wrap"><code>args_dict = utils.args_to_dict(args)</code></span></p><p dir="ltr" style="margin-left:36pt;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Courier New;color:rgb(56,118,29);background-color:transparent;vertical-align:baseline;white-space:pre-wrap"><code>servo_args = hosts.SiteHost.get_servo_arguments(args_dict)</code></span></p><br /><p dir="ltr" style="margin-left:36pt;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Courier New;color:rgb(56,118,29);background-color:transparent;vertical-align:baseline;white-space:pre-wrap"><code>def run(machine):</code></span></p><p dir="ltr" style="margin-left:36pt;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Courier New;color:rgb(56,118,29);background-color:transparent;vertical-align:baseline;white-space:pre-wrap"><code>    host = hosts.create_host(machine, servo_args=servo_args)</code></span></p><p dir="ltr" style="margin-left:36pt;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Courier New;color:rgb(56,118,29);background-color:transparent;vertical-align:baseline;white-space:pre-wrap"><code>    job.run_test("platform_SampleServoTest", host=host)</code></span></p><br /><p dir="ltr" style="margin-left:36pt;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Courier New;color:rgb(56,118,29);background-color:transparent;vertical-align:baseline;white-space:pre-wrap"><code>parallel_simple(run, machines)</code></span></p></div><br /><span style="font-family:Arial;font-size:15px;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">The <code>DEPENDENCIES</code> setting guarantees that if the test is scheduled in the lab, it will be assigned to a DUT that has a servo.</span></b></div><div><b style="font-weight:normal"><span style="font-family:Arial;font-size:15px;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"><br /></span></b></div><div><b style="font-weight:normal"><span style="font-family:Arial;font-size:15px;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">The setting of <code>servo_args</code> guarantees two distinct things:  First, it forces checks that will make sure that the Servo is functioning properly; this guarantees that the host's <code>servo</code> attribute will not be <code>None</code>.  Second, the code allows you to pass necessary servo specific command-line arguments to <code>test_that</code>.</span></b></div><div><b style="font-weight:normal"><span style="font-family:Arial;font-size:15px;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"><br /></span></b></div><div><b style="font-weight:normal"><span style="font-family:Arial;font-size:15px;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">If the test control file follows the formula above, the test can be reliably called in a variety of ways:</span><br /><ul style="font-family:Times New Roman;font-size:medium;margin-top:0pt;margin-bottom:0pt"><li dir="ltr" style="list-style-type:disc;font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline"><span style="background-color:transparent;vertical-align:baseline;white-space:pre-wrap">When used for hosts in the lab, the host’s servo object will use the servo attached to the host, and the test can assume that the servo object is not <code>None</code>.</span></li><li dir="ltr" style="list-style-type:disc;font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline"><span style="background-color:transparent;vertical-align:baseline;white-space:pre-wrap">If you start </span><span style="font-family:Courier New;color:rgb(56,118,29);background-color:transparent;vertical-align:baseline;white-space:pre-wrap">servod</span><span style="background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> manually on your desktop using the default port, you can use </span><span style="font-family:Courier New;color:rgb(56,118,29);background-color:transparent;vertical-align:baseline;white-space:pre-wrap">test_that</span><span style="background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> without any special options.</span></li></ul><ul style="font-family:Times New Roman;font-size:medium;margin-top:0pt;margin-bottom:0pt"><li dir="ltr" style="list-style-type:disc;font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline"><span style="background-color:transparent;vertical-align:baseline;white-space:pre-wrap">If you need to specify a non-default host or port number (e.g. because <code>servod</code> is remote, or because you have more than one servo board</span><span style="background-color:transparent;vertical-align:baseline;white-space:pre-wrap">), you can specify them with commands like these:</span></li></ul><p dir="ltr" style="font-family:Times New Roman;font-size:medium;margin-left:72pt;margin-top:0pt;margin-bottom:0pt;display:inline!important"><span style="font-size:15px;font-family:Courier New;color:rgb(56,118,29);background-color:transparent;vertical-align:baseline;white-space:pre-wrap">test_that --args=”servo_host=...” </span><span style="font-size:15px;font-family:Courier New;color:rgb(56,118,29);background-color:transparent;font-style:italic;vertical-align:baseline;white-space:pre-wrap">…</span></p></b><p dir="ltr" style="font-family:Times New Roman;font-size:medium;margin-left:72pt;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Courier New;color:rgb(56,118,29);background-color:transparent;vertical-align:baseline;white-space:pre-wrap">test_that --args=”servo_port=...” </span><span style="font-size:15px;font-family:Courier New;color:rgb(56,118,29);background-color:transparent;font-style:italic;vertical-align:baseline;white-space:pre-wrap">…</span></p><b style="font-weight:normal"><p dir="ltr" style="font-family:Times New Roman;font-size:medium;margin-left:72pt;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Courier New;color:rgb(56,118,29);background-color:transparent;vertical-align:baseline;white-space:pre-wrap"><span style="background-color:transparent">test_that</span> --args=”servo_host=... servo_port=...” </span><span style="font-size:15px;font-family:Courier New;color:rgb(56,118,29);background-color:transparent;font-style:italic;vertical-align:baseline;white-space:pre-wrap">...</span></p><h3 dir="ltr" style="font-family:Times New Roman;font-size:medium"><a name="TOC-Calling-client-side-tests-from-a-server-side-test"></a><span style="font-size:16px;font-family:Arial;color:rgb(102,102,102);background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Calling client-side tests from a server-side test</span></h3><span style="font-family:Arial;font-size:15px;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Commonly, server-side tests need to do more on the DUT than simply run short shell commands.  In those cases, a client-side test should be written and invoked from the server-side test.  In particular, a client side test allows the client side code to be written in Python that uses standard Autotest infrastructure, such as various utility modules or the logging infrastructure.</span><br /><br /><span style="font-family:Arial;font-size:15px;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Below is a short snippet showing the standard form for calling a client-side test from server-side code:</span><br /><div class="sites-codeblock sites-codesnippet-block" style="font-family:Times New Roman;font-size:medium"><p dir="ltr" style="margin-left:36pt;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Courier New;color:rgb(56,118,29);background-color:transparent;vertical-align:baseline;white-space:pre-wrap"><code>from autotest_lib.server import autotest</code></span></p><br /><p dir="ltr" style="margin-left:36pt;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Courier New;color:rgb(56,118,29);background-color:transparent;vertical-align:baseline;white-space:pre-wrap"><code>    # ... inside some function, e.g. in run_once()</code></span></p><p dir="ltr" style="margin-left:36pt;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Courier New;color:rgb(56,118,29);background-color:transparent;vertical-align:baseline;white-space:pre-wrap"><code>    client_at = autotest.Autotest(host)</code></span></p><p dir="ltr" style="margin-left:36pt;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Courier New;color:rgb(56,118,29);background-color:transparent;vertical-align:baseline;white-space:pre-wrap"><code>    client_at.run_test("platform_ClientTest")</code></span></p></div><h1 dir="ltr" style="font-family:Times New Roman;font-size:medium"><a name="TOC-Writing-library-code"></a><span style="font-size:24px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Writing library code</span></h1><span style="font-family:Arial;font-size:15px;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">There is a large quantity of Chromium OS specific code in the autotest codebase.  Much of this exists to provide re-usable modules that enable tests to talk to system services.  The guidelines from above apply here as well.  This code should be as pure python as possible, though it is reasonable to shell out to command line tools from time to time.  In some cases we’ve done this where we could (now) use the service’s DBus APIs directly.  If you’re adding code to allow tests to communicate with your service, it is </span><span style="font-family:Arial;font-size:15px;background-color:transparent;font-weight:bold;vertical-align:baseline;white-space:pre-wrap">strongly recommended that you use DBus where possible</span><span style="font-family:Arial;font-size:15px;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">, instead of munging config files directly or using command-line tools.</span><br /><br /><span style="font-family:Arial;font-size:15px;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Currently, our library code lives in a concerning variety of places in the autotest tree.  This is due to a poor initial understanding of how to do things, and new code should follow the following conventions instead:</span><br /><ul style="font-family:Times New Roman;font-size:medium;margin-top:0pt;margin-bottom:0pt"><li dir="ltr" style="list-style-type:disc;font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline"><span style="background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Used only in server-side tests: server/cros</span></li><li dir="ltr" style="list-style-type:disc;font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline"><span style="background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Used in both server- and client-side tests, or only client: client/common_lib/cros</span></li></ul><h1 dir="ltr" style="font-family:Times New Roman;font-size:medium"><a name="TOC-Adding-test-deps"></a><span style="font-size:24px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Adding test deps</span></h1><span style="font-family:Arial;font-size:15px;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">This does not refer to the optional DEPENDENCIES field in test control files.  Rather, this section discusses how and when to use code/data/tools that are not pre-installed on test images, and should (or can) not be included right in with the test source.</span><br /><br /><span style="font-family:Arial;font-size:15px;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Unfortunately, there is no hard-and-fast rule here.  Generally, if this is some small tool or blob of data you need for a single test, you should include it as discussed above in </span><span style="font-family:Arial;font-size:15px;background-color:transparent;font-weight:bold;vertical-align:baseline;white-space:pre-wrap">Writing client-side tests</span><span style="font-family:Arial;font-size:15px;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">.  If you’re writing the tool, and it has use for developers as well as in one or more tests that you’re writing, then make it a first-class CrOS project.  Write an ebuild, write unit tests, and then add it to the test image by default.  This can be done by </span><span style="font-family:Arial;font-size:15px;color:rgb(56,118,29);background-color:transparent;vertical-align:baseline;white-space:pre-wrap">RDEPEND</span><span style="font-family:Arial;font-size:15px;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">ing on your new test package from the chromeos-test ebuild.</span><br /><br /><span style="font-family:Arial;font-size:15px;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">If your code/data falls in the middle (useful to several tests, not to devs), and/or is large (hundreds of megabytes as opposed to tens) then using an autotest ‘dep’ may be the right choice.  Conceptually, an autotest test dep is simply another kind of archive that the autotest infrastructure knows how to fetch and unpack.  There are two components to including a dependency from an autotest test -- setup during build time and installing it on your DUT when running a test.  The setup phase must be run from your tests setup() method like so:</span><br /><br /><div class="sites-codeblock sites-codesnippet-block" style="font-family:Times New Roman;font-size:medium"><p dir="ltr" style="margin-left:36pt;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Courier New;color:rgb(56,118,29);background-color:transparent;vertical-align:baseline;white-space:pre-wrap"><code>def setup(self):</code></span></p><p dir="ltr" style="margin-left:36pt;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Courier New;color:rgb(56,118,29);background-color:transparent;vertical-align:baseline;white-space:pre-wrap"><code>  self.job.setup_dep([‘mydep’])</code></span></p><p dir="ltr" style="margin-left:36pt;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Courier New;color:rgb(56,118,29);background-color:transparent;vertical-align:baseline;white-space:pre-wrap"><code>  logging.debug(‘mydep is at %s’ % (os.path.join(self.autodir,</code></span></p><p dir="ltr" style="margin-left:36pt;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Courier New;color:rgb(56,118,29);background-color:transparent;vertical-align:baseline;white-space:pre-wrap"><code>                                                 ‘deps/mydep’))</code></span></p></div><br /><span style="font-family:Arial;font-size:15px;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">The above gets run when you “build” the test.</span><br /><br /><span style="font-family:Arial;font-size:15px;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">The other half of this equation is actually installing the dependency so you can use it while running a test.  To do this, add the following to either your run_once or initialize methods:</span><br /><br /><div class="sites-codeblock sites-codesnippet-block" style="font-family:Times New Roman;font-size:medium"><span style="font-size:15px;font-family:Courier New;color:rgb(56,118,29);background-color:transparent;vertical-align:baseline;white-space:pre-wrap"><code>        dep = dep_name</code></span><br /><span style="font-size:15px;font-family:Courier New;color:rgb(56,118,29);background-color:transparent;vertical-align:baseline;white-space:pre-wrap"><code>        dep_dir = os.path.join(self.autodir, 'deps', dep=dep)</code></span><br /><span style="font-size:15px;font-family:Courier New;color:rgb(56,118,29);background-color:transparent;vertical-align:baseline;white-space:pre-wrap"><code>        self.job.install_pkg(dep, 'dep', dep_dir)</code></span></div><br /><br /><span style="font-family:Arial;font-size:15px;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">You can now reference the content of your dep using </span><span style="font-family:Courier New;font-size:15px;color:rgb(56,118,29);background-color:transparent;vertical-align:baseline;white-space:pre-wrap">dep_dir</span><span style="font-family:Arial;font-size:15px;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">.</span><br /><br /><span style="font-family:Arial;font-size:15px;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Now that you know how to include a dep, the next question is how to write one. Before you read further, you should check out client/deps/* for many examples of deps in our autotest tree.</span><br /><br /><h2 dir="ltr" style="font-family:Times New Roman;font-size:medium"><a name="TOC-Create-a-dep-from-a-third-party-package"></a><span style="font-size:19px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Create a dep from a third-party package</span></h2><span style="font-family:Arial;font-size:15px;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">There are many examples of how to do this in the client/deps directory already. The key component is to check in a tarball of the version of the dependency you’d like to include under client/deps/your_dep.</span><br /><br /><span style="font-family:Arial;font-size:15px;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">All deps require a control file and an actual python module by the same name. They will also need a copy of </span><a href="autotest-developer-faq.1.html#TOC-A-word-about-imports" style="font-family:Times New Roman;font-size:medium"><span style="font-size:15px;font-family:Arial;color:rgb(17,85,204);background-color:transparent;vertical-align:baseline;white-space:pre-wrap">common.py</span></a><span style="font-family:Arial;font-size:15px;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> to import utils.update_version. Both the control and common are straightforward, the python module does all the magic.</span><br /><br /><span style="font-family:Arial;font-size:15px;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">The deps python module follows a standard convention: a </span><span style="font-family:Courier New;font-size:15px;color:rgb(56,118,29);background-color:transparent;vertical-align:baseline;white-space:pre-wrap">setup</span><span style="font-family:Arial;font-size:15px;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> function and a call to </span><span style="font-family:Courier New;font-size:15px;color:rgb(56,118,29);background-color:transparent;vertical-align:baseline;white-space:pre-wrap">utils.update_version</span><span style="font-family:Arial;font-size:15px;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">.  </span><span style="font-family:Courier New;font-size:15px;color:rgb(56,118,29);background-color:transparent;vertical-align:baseline;white-space:pre-wrap">update_version</span><span style="font-family:Arial;font-size:15px;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> is used instead of directly calling </span><span style="font-family:Courier New;font-size:15px;color:rgb(56,118,29);background-color:transparent;vertical-align:baseline;white-space:pre-wrap">setup</span><span style="font-family:Arial;font-size:15px;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> as it maintains additional versioning logic ensuring setup is only done 1x per dep. The following is its method signature:</span><br /><br /><br /><div class="sites-codeblock sites-codesnippet-block" style="font-family:Times New Roman;font-size:medium"><span style="font-size:15px;font-family:Courier New;color:rgb(56,118,29);background-color:transparent;vertical-align:baseline;white-space:pre-wrap"><code>def update_version(srcdir, preserve_srcdir, new_version, install, </code></span><br /><span style="font-size:15px;font-family:Courier New;color:rgb(56,118,29);background-color:transparent;vertical-align:baseline;white-space:pre-wrap"><code>                   *args, **dargs)</code></span></div><br /><br /><span style="font-family:Arial;font-size:15px;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Notably, </span><span style="font-family:Courier New;font-size:15px;color:rgb(56,118,29);background-color:transparent;vertical-align:baseline;white-space:pre-wrap">install</span><span style="font-family:Arial;font-size:15px;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> should be a pointer to your setup function and </span><span style="font-family:Courier New;font-size:15px;color:rgb(56,118,29);background-color:transparent;vertical-align:baseline;white-space:pre-wrap">*args</span><span style="font-family:Arial;font-size:15px;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> should be filled in with params to said setup function.</span><br /><br /><span style="font-family:Arial;font-size:15px;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">If you are using a tarball, your setup function should look something like:</span><br /><br /><div class="sites-codeblock sites-codesnippet-block" style="font-family:Times New Roman;font-size:medium"><span style="font-size:15px;font-family:Courier New;color:rgb(56,118,29);background-color:transparent;vertical-align:baseline;white-space:pre-wrap"><code>def setup(tarball, my_dir)</code></span><br /><span style="font-size:15px;font-family:Courier New;color:rgb(56,118,29);background-color:transparent;vertical-align:baseline;white-space:pre-wrap"><code>    utils.extract_tarball_to_dir(tarball, my_dir)</code></span><br /><span style="font-size:15px;font-family:Courier New;color:rgb(56,118,29);background-color:transparent;vertical-align:baseline;white-space:pre-wrap"><code>    os.chdir(my_dir)</code></span><br /><span style="font-size:15px;font-family:Courier New;color:rgb(56,118,29);background-color:transparent;vertical-align:baseline;white-space:pre-wrap"><code>    utils.make() # this assumes your tarball has a Makefile.</code></span><br /></div><br /><span style="font-family:Arial;font-size:15px;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">And you would invoke this with:</span><br /><br /><div class="sites-codeblock sites-codesnippet-block" style="font-family:Times New Roman;font-size:medium"><span style="font-size:15px;font-family:Courier New;color:rgb(56,118,29);background-color:transparent;vertical-align:baseline;white-space:pre-wrap"><code>utils.update_version(os.getcwd(), True, version, setup, tarball_path,</code></span><br /><span style="font-size:15px;font-family:Courier New;color:rgb(56,118,29);background-color:transparent;vertical-align:baseline;white-space:pre-wrap"><code>                     os.getcwd())</code></span></div><br /><br /><span style="font-family:Arial;font-size:15px;background-color:transparent;font-style:italic;vertical-align:baseline;white-space:pre-wrap">Note: The developer needs to call this because def setup is a function they are defining that can take any number of arguments or install the dep in any way they see fit. The above example uses tarballs but some are distributed as straight source under the src dir so their setup function only takes a top level path. We could avoid this by forcing a convention but that would be artificially constraining the deps mechanism. </span><br /><br /><span style="font-family:Arial;font-size:15px;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Once you’ve created the dep, you will also have to add the dep to the autotest-deps package in chromiumos-overlay/chromeos-base/autotest-deps, ‘cros_workon start’ it, and re-emerge it.</span><br /><br /><span style="font-family:Arial;font-size:19px;background-color:transparent;font-weight:bold;vertical-align:baseline;white-space:pre-wrap">Create a dep from other chrome-os packages</span><br /><br /><span style="font-family:Arial;font-size:15px;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">One can also create autotest deps from code that lives in other CrOS packages, or from build products generated by other packages.  This is similar as above but you can reference code using the CHROMEOS_ROOT env var that points to the root of the CrOS source checkout, or the SYSROOT env var (which points to /build/&lt;board&gt;) to refer to build products.  Again, read the above. Here’s an example of the former with the files I want in chromeos_tree/chromite/my_dep/* where this will be the python code in autotest/files/client/deps/my_dep/my_dep.py module.</span><br /><br /><div class="sites-codeblock sites-codesnippet-block" style="font-family:Times New Roman;font-size:medium"><span style="font-size:15px;font-family:Courier New;color:rgb(56,118,29);background-color:transparent;vertical-align:baseline;white-space:pre-wrap"><code>import common, os, shutil</code></span><br /><span style="font-size:15px;font-family:Courier New;color:rgb(56,118,29);background-color:transparent;vertical-align:baseline;white-space:pre-wrap"><code>from autotest_lib.client.bin import utils</code></span><br /><br /><span style="font-size:15px;font-family:Courier New;color:rgb(56,118,29);background-color:transparent;vertical-align:baseline;white-space:pre-wrap"><code>version = 1</code></span><br /><br /><span style="font-size:15px;font-family:Courier New;color:rgb(56,118,29);background-color:transparent;vertical-align:baseline;white-space:pre-wrap"><code>def setup(setup_dir):</code></span><br /><span style="font-size:15px;font-family:Courier New;color:rgb(56,118,29);background-color:transparent;vertical-align:baseline;white-space:pre-wrap"><code>    my_dep_dir = os.path.join(os.environ['CHROMEOS_ROOT'], 'chromite',</code></span><br /><span style="font-size:15px;font-family:Courier New;color:rgb(56,118,29);background-color:transparent;vertical-align:baseline;white-space:pre-wrap"><code>                              'buildbot')</code></span><br /><span style="font-size:15px;font-family:Courier New;color:rgb(56,118,29);background-color:transparent;vertical-align:baseline;white-space:pre-wrap"><code>    shutil.copytree(my_dep_dir, setup_dir)</code></span><br /><br /><br /><span style="font-size:15px;font-family:Courier New;color:rgb(56,118,29);background-color:transparent;vertical-align:baseline;white-space:pre-wrap"><code>work_dir = os.path.join(os.getcwd(), 'src')</code></span><br /><span style="font-size:15px;font-family:Courier New;color:rgb(56,118,29);background-color:transparent;vertical-align:baseline;white-space:pre-wrap"><code>utils.update_version(os.getcwd(), True, version, setup, work_dir)</code></span></div></b></div></div></div></div></div></div></div></td></tr></tbody></table>
</div> 
</div> 
<div id="sites-canvas-bottom-panel">
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_page-subpages"> </div>
<div id="sites-attachments-container">
</div>
<a xmlns="http://www.w3.org/1999/xhtml" name="page-comments"></a>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_page-comments"><div class="sites-comment-docos-wrapper"><div class="sites-comment-docos"><div class="sites-comment-docos-background"></div><div class="sites-comment-docos-header"><div class="sites-comment-docos-header-title">Comments</div></div><div id="sites-comment-docos-pane" class="sites-comment-docos-pane"></div></div></div></div>
</div>
</div> 
</td> 
</tr>
</table> 
</div> 
</div> 
<div id="sites-chrome-footer-wrapper">
<div id="sites-chrome-footer-wrapper-inside">
<div id="sites-chrome-footer">
</div>
</div>
</div>
</div> 
</div> 
<div id="sites-chrome-adminfooter-container">
<div xmlns="http://www.w3.org/1999/xhtml" class="sites-adminfooter" role="navigation"><p><a class="sites-system-link" href="https://www.google.com/a/UniversalLogin?service=jotspot&amp;continue=https://sites.google.com/a/chromium.org/dev/chromium-os/testing/autotest-best-practices">Sign in</a><span aria-hidden="true">|</span><a class="sites-system-link" href="../../system/app/pages/recentChanges.html">Recent Site Activity</a><span aria-hidden="true">|</span><a class="sites-system-link" href="../../system/app/pages/reportAbuse.html" target="_blank">Report Abuse</a><span aria-hidden="true">|</span><a class="sites-system-link" href="javascript:;" onclick="window.open(webspace.printUrl)">Print Page</a><span aria-hidden="true">|</span><span class="sites-system-link">Powered By</span> <b class="powered-by"><a href="http://sites.google.com">Google Sites</a></b></p></div>
</div>
</div> 
</div> 
<div id="sites-chrome-onebar-footer">
</div>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    window.jstiming.load.tick('sjl');
  </script>
<script xmlns="http://www.w3.org/1999/xhtml" src="https://ssl.gstatic.com/sites/p/56e332/system/js/jot_min_view__en.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    window.jstiming.load.tick('jl');
  </script>
<script xmlns="http://www.w3.org/1999/xhtml">
      
          sites.core.Analytics.createTracker();
          sites.core.Analytics.trackPageview();
        
    </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
                    sites.Searchbox.initialize(
                        'sites-searchbox-search-button',
                        {"object":[]}['object'],
                        'search-site',
                        {"label":"Configure search options...","url":"/system/app/pages/admin/settings"});
                  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
      gsites.HoverPopupMenu.createSiteDropdownMenus('sites-header-nav-dropdown', false);
    </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
            JOT_setupNav("7648876402527094", "Navigation", false);
            JOT_addListener('titleChange', 'JOT_NAVIGATION_titleChange', 'COMP_7648876402527094');
          </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
            JOT_setupNav("14720868319272995", "Quick links", false);
            JOT_addListener('titleChange', 'JOT_NAVIGATION_titleChange', 'COMP_14720868319272995');
          </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
            JOT_setupNav("19690813310444355", "Other sites", false);
            JOT_addListener('titleChange', 'JOT_NAVIGATION_titleChange', 'COMP_19690813310444355');
          </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
              new sites.CommentPane('//docs.google.com/comments/d/AAHRpnXvrAwjAfmld0ObrebBiGRq9tjKv2GYQ5QNdNFn5-vLXSyAzZWSIMDYgwvHFuVFASnl11WwYhMqOxC2abIpZV3F18TUVvi2RL125hKJbp8-voIHiMMjTzf6zpaHmq9dN6TiQgTtl/api/js?anon=true',
                  false, false);
            </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
  setTimeout(function() {
    var fingerprint = gsites.date.TimeZone.getFingerprint([]);
    gsites.Xhr.send('https://www.chromium.org/_/tz', null, null, 'GET', null, null, { afjstz: fingerprint });
  }, 500);
</script>
<script xmlns="http://www.w3.org/1999/xhtml">
                    window.onload = function() {
                      if (false) {
                        JOT_setMobilePreview();
                      }
                      var loadTimer = window.jstiming.load;
                      loadTimer.tick("ol");
                      loadTimer["name"] = "load," + webspace.page.type + ",user_page";
                      window.jstiming.report(loadTimer, {}, 'https://gg.google.com/csi');
                    }
                  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
        JOT_insertAnalyticsCode(false,
            false);
      </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    var maestroRunner = new gsites.pages.view.SitesMaestroRunner(
        webspace, "en");
    maestroRunner.initListeners();
    maestroRunner.installEditRender();
  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
  //<![CDATA[
    // Decorate any fastUI buttons on the page with a class of 'goog-button'.
    if (webspace.user.hasWriteAccess) {
      JOT_decorateButtons();
    }

    // Fires delayed events.
    (function() {
      JOT_fullyLoaded = true;
      var delayedEvents = JOT_delayedEvents;
      for (var x = 0; x < delayedEvents.length; x++) {
        var event = delayedEvents[x];
        JOT_postEvent(event.eventName, event.eventSrc, event.payload);
      }
      JOT_delayedEvents = null;
      JOT_postEvent('pageLoaded');
    })();
  //]]>
</script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    JOT_postEvent('decorateGvizCharts');
  </script>
<script type="text/javascript">
          JOT_setupPostRenderingManager();
        </script>
<script type="text/javascript">
          JOT_postEvent('renderPlus', null, 'sites-chrome-main');
        </script>
<div id="server-timer-div" style="display:none"> </div>
<script type="text/javascript">
          window.jstiming.load.tick('render');
          JOT_postEvent('usercontentrendered', this);
        </script>
</body>
</html>
