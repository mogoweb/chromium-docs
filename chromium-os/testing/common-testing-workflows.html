<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/WebPage">
<head>
<meta http-equiv="X-UA-Compatible" content="chrome=1" />
<script type="text/javascript">/* Copyright 2008 Google. */ (function() { var e="wtsrt_",g="tbsd_",h="tbnd_",k="start",l="_wtsrt",m="_tbnd",n="CSI/";(function(){function f(a){this.t={};this.tick=function(a,c,b){this.t[a]=[void 0!=b?b:(new Date).getTime(),c];if(void 0==b)try{window.console.timeStamp(n+a)}catch(d){}};this.tick(k,null,a)}var a;window.performance&&(a=window.performance.timing);var p=a?new f(a.responseStart):new f;window.jstiming={Timer:f,load:p};if(a){var c=a.navigationStart,d=a.responseStart;0<c&&d>=c&&(window.jstiming.srt=d-c)}if(a){var b=window.jstiming.load;0<c&&d>=c&&(b.tick(l,void 0,c),b.tick(e,l,d),b.tick(g,e))}try{a=null,
window.chrome&&window.chrome.csi&&(a=Math.floor(window.chrome.csi().pageT),b&&0<c&&(b.tick(m,void 0,window.chrome.csi().startE),b.tick(h,m,c))),null==a&&window.gtbExternal&&(a=window.gtbExternal.pageT()),null==a&&window.external&&(a=window.external.pageT,b&&0<c&&(b.tick(m,void 0,window.external.startE),b.tick(h,m,c))),a&&(window.jstiming.pt=a)}catch(q){}})(); })()
</script>
<link rel="shortcut icon" href="../../_/rsrc/1354323194313/favicon.ico" type="image/x-icon" />
<link rel="apple-touch-icon" href="https://ssl.gstatic.com/sites/p/56e332/system/app/images/apple-touch-icon.png" type="image/png" />
<script type="text/javascript">/* Copyright 2008 Google. */ (function() { var d="",g="__duration__",h="function";function k(c){return document.getElementById(c)}window.byId=k;function l(c){return c.replace(/^\s+|\s+$/g,d)}window.trim=l;var m=[],n=0;window.JOT_addListener=function(c,a,b){var e=new String(n++);c={eventName:c,handler:a,compId:b,key:e};m.push(c);return e};window.JOT_removeListenerByKey=function(c){for(var a=0;a<m.length;a++)if(m[a].key==c){m.splice(a,1);break}};
window.JOT_removeAllListenersForName=function(c){for(var a=0;a<m.length;a++)m[a].eventName==c&&m.splice(a,1)};window.JOT_postEvent=function(c,a,b){var e={eventName:c,eventSrc:a||{},payload:b||{}};if(window.JOT_fullyLoaded)for(a=m.length,b=0;b<a&&b<m.length;b++){var f=m[b];f&&f.eventName==c&&(e.listenerCompId=f.compId||d,(f=typeof f.handler==h?f.handler:window[f.handler])&&f(e))}else window.JOT_delayedEvents.push({eventName:c,eventSrc:a,payload:b})};window.JOT_delayedEvents=[];
window.JOT_fullyLoaded=!1;window.JOT_formatRelativeToNow=function(c,a){var b=((new Date).getTime()-c)/6E4;if(1440<=b||0>b)return null;var e=0;60<=b&&(b/=60,e=2);2<=b&&e++;return a?window.JOT_siteRelTimeStrs[e].replace(g,Math.floor(b)):window.JOT_userRelTimeStrs[e].replace(g,Math.floor(b))}; })()
</script>
<script>

  

  var breadcrumbs = [{"path":"/chromium-os","deleted":false,"title":"Chromium OS","dir":"ltr"},{"path":"/chromium-os/testing","deleted":false,"title":"Testing Home","dir":"ltr"},{"path":"/chromium-os/testing/common-testing-workflows","deleted":false,"title":"Common Testing Workflows","dir":"ltr"}];
  var JOT_clearDotPath = 'https://ssl.gstatic.com/sites/p/56e332/system/app/images/cleardot.gif';

  
  var JOT_userRelTimeStrs = ["a minute ago","__duration__ minutes ago","an hour ago","__duration__ hours ago"];

  
  

  

  var webspace = {"enableAnalytics":true,"pageSharingId":"jotspot_page","enableUniversalAnalytics":false,"sharingPolicy":"OPENED_WITH_INDICATOR","siteTitle":"The Chromium Projects","isStartPageEnabled":true,"adsensePublisherId":null,"features":{"languageSelectDefaultTextSetToDefault":true,"validateClientGvizDataSourceUrls":true,"moreMobileStyleImprovements":true,"newInsertMenuIcons":true,"accessibleSortingButtons":true,"domainAnalyticsInGAOnly":true,"noCaptcha":true,"fileCabinetScreenReaderFix":true,"updatedTosAndPrivacyLinks":null,"pageDrafts":false,"mobileOrientationFix":true,"plusBadge":false,"pdfEmbedSupport":false,"jsClickFix":true},"isPublic":true,"isConsumer":false,"serverFlags":{"cajaBaseUrl":"//www.gstatic.com/caja","cajaDebugMode":false},"onepickBaseUrl":"https://docs.google.com","domainAnalyticsAccountId":"","plusPageId":"","signInUrl":"https://www.google.com/a/SelectSession?continue\u003dhttps://sites.google.com/a/chromium.org/dev/chromium-os/testing/common-testing-workflows\u0026service\u003djotspot","analyticsAccountId":"UA-5484340-1","scottyUrl":"/_/upload","homePath":"/","siteNoticeUrlEnabled":null,"plusPageUrl":"","adsensePromoClickedOrSiteIneligible":true,"csiReportUri":"https://gg.google.com/csi","sharingId":"jotspot","termsUrl":"//www.google.com/intl/en/policies/terms/","gvizVersion":1,"editorResources":{"sitelayout":["https://ssl.gstatic.com/sites/p/56e332/system/app/css/sitelayouteditor.css"],"text":["https://ssl.gstatic.com/sites/p/56e332/system/js/codemirror.js","https://ssl.gstatic.com/sites/p/56e332/system/app/css/codemirror_css.css","https://ssl.gstatic.com/sites/p/56e332/system/js/trog_edit__en.js","https://ssl.gstatic.com/sites/p/56e332/system/app/css/trogedit.css","/_/rsrc/1441580320000/system/app/css/editor.css","https://ssl.gstatic.com/sites/p/56e332/system/app/css/codeeditor.css","/_/rsrc/1441580320000/system/app/css/camelot/editor-jfk-wlb.css"]},"sharingUrlPrefix":"/_/sharing","isAdsenseEnabled":true,"domain":"chromium.org","baseUri":"","name":"dev","siteTemplateId":false,"siteNoticeRevision":null,"siteNoticeUrlAddress":null,"siteNoticeMessage":null,"page":{"isRtlLocale":false,"canDeleteWebspace":null,"isPageDraft":null,"parentPath":"/chromium-os/testing","parentWuid":"wuid:gx:2e2ee5668f423109","siteLocale":"en","timeZone":"America/Los_Angeles","type":"text","title":"Common Testing Workflows","locale":"en","wuid":"wuid:gx:26e05fe244caca85","revision":6,"path":"/chromium-os/testing/common-testing-workflows","isSiteRtlLocale":false,"pageInheritsPermissions":null,"name":"common-testing-workflows","canChangePath":true,"state":"","properties":{},"bidiEnabled":false,"currentTemplate":{"path":"/system/app/pagetemplates/text","title":"Web Page"}},"canPublishScriptToAnyone":true,"user":{"keyboardShortcuts":true,"sessionIndex":"","guest_":true,"displayNameOrEmail":"guest","userName":"guest","uid":"","renderMobile":false,"domain":"","namespace":"","hasWriteAccess":false,"namespaceUser":false,"primaryEmail":"guest","hasAdminAccess":false},"gadgets":{"baseUri":"/system/app/pages/gadgets"}};
  webspace.page.breadcrumbs = breadcrumbs;

  
  var JOT_siteRelTimeStrs = ["a minute ago","__duration__ minutes ago","an hour ago","__duration__ hours ago"];

</script>
<script type="text/javascript">
                window.jstiming.load.tick('scl');
              </script>
<meta name="title" content="Common Testing Workflows - The Chromium Projects" />
<meta itemprop="name" content="Common Testing Workflows - The Chromium Projects" />
<meta property="og:title" content="Common Testing Workflows - The Chromium Projects" />
<meta name="description" content="Home of the Chromium Open Source Project" />
<meta itemprop="description" content="Home of the Chromium Open Source Project" />
<meta id="meta-tag-description" property="og:description" content="Home of the Chromium Open Source Project" />
<style type="text/css">
</style>
<link rel="stylesheet" type="text/css" href="https://ssl.gstatic.com/sites/p/56e332/system/app/themes/beigeandblue/standard-css-beigeandblue-ltr-ltr.css" />
<link rel="stylesheet" type="text/css" href="../../_/rsrc/1441580320000/system/app/css/overlay.css%3Fcb=beigeandblueundefineda100%2525%2525150goog-ws-leftthemedefaultstandard.css" />
<link rel="stylesheet" type="text/css" href="../../_/rsrc/1441580320000/system/app/css/camelot/allthemes-view.css" />
<!--[if IE]>
          <link rel="stylesheet" type="text/css" href="/system/app/css/camelot/allthemes%2die.css" />
        <![endif]-->
<title>Common Testing Workflows - The Chromium Projects</title>
<meta itemprop="image" content="/_/rsrc/1438879449147/config/customLogo.gif?revision=3" />
<meta property="og:image" content="/_/rsrc/1438879449147/config/customLogo.gif?revision=3" />
<script type="text/javascript">
                window.jstiming.load.tick('cl');
              </script>
</head>
<body xmlns="http://www.google.com/ns/jotspot" id="body" class=" en            ">
<div id="sites-page-toolbar" class="sites-header-divider">
<div xmlns="http://www.w3.org/1999/xhtml" id="sites-status" class="sites-status" style="display:none;"><div id="sites-notice" class="sites-notice" role="status" aria-live="assertive"> </div></div>
</div>
<div id="sites-chrome-everything-scrollbar">
<div id="sites-chrome-everything" class="">
<div id="sites-chrome-page-wrapper" style="direction: ltr">
<div id="sites-chrome-page-wrapper-inside">
<div xmlns="http://www.w3.org/1999/xhtml" id="sites-chrome-header-wrapper" style="height:auto;">
<table id="sites-chrome-header" class="sites-layout-hbox" cellspacing="0" style="height:auto;">
<tr class="sites-header-primary-row" id="sites-chrome-userheader">
<td id="sites-header-title" class="" role="banner"><div class="sites-header-cell-buffer-wrapper"><a href="../../index.html" id="sites-chrome-userheader-logo"><img id="logo-img-id" src="../../_/rsrc/1438879449147/config/customLogo.gif%3Frevision=3" alt="The Chromium Projects" class="sites-logo  " /></a><h2><a href="../../index.html" dir="ltr" id="sites-chrome-userheader-title">The Chromium Projects</a></h2></div></td><td class="sites-layout-searchbox  "><div class="sites-header-cell-buffer-wrapper"><form id="sites-searchbox-form" action="https://www.chromium.org/system/app/pages/search" role="search"><input type="hidden" id="sites-searchbox-scope" name="scope" value="search-site" /><input type="text" id="jot-ui-searchInput" name="q" size="20" value="" aria-label="Search this site" /><div id="sites-searchbox-button-set" class="goog-inline-block"><div role="button" id="sites-searchbox-search-button" class="goog-inline-block jfk-button jfk-button-standard" tabindex="0">Search this site</div></div></form></div></td>
</tr>
<tr class="sites-header-secondary-row" id="sites-chrome-horizontal-nav">
<td colspan="2" id="sites-chrome-header-horizontal-nav-container" role="navigation">
</td>
</tr>
</table>
</div>
<div id="sites-chrome-main-wrapper">
<div id="sites-chrome-main-wrapper-inside">
<table id="sites-chrome-main" class="sites-layout-hbox" cellspacing="0" cellpadding="{scmCellpadding}" border="0">
<tr>
<td id="sites-chrome-sidebar-left" class="sites-layout-sidebar-left initial" style="width:150px">
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_7648876402527094" class="sites-embed" role="navigation"><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotId="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="../../chromium-projects.html" jotId="wuid:gx:10ae433dadbbab13" class="sites-navigation-link">Home</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="../../Home.1.html" jotId="wuid:gx:43582b9d2029d3af" class="sites-navigation-link">Chromium</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="../../chromium-os.1.html" jotId="wuid:gx:83df2ab1f8880ba" class="sites-navigation-link">Chromium OS</a></div></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_14720868319272995" class="sites-embed" role="navigation"><h4 class="sites-embed-title">Quick links</h4><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotId="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="../../for-testers/bug-reporting-guidelines.html" class="sites-navigation-link">Report bugs</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="../../developers/discussion-groups.html" class="sites-navigation-link">Discuss</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="../../system/app/pages/sitemap/hierarchy.html" jotId="wuid:gx:4b58a9a350ad12f" class="sites-navigation-link">网站地图</a></div></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_19690813310444355" class="sites-embed" role="navigation"><h4 class="sites-embed-title">Other sites</h4><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotId="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="http://blog.chromium.org/" class="sites-navigation-link">Chromium Blog</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="http://code.google.com/chrome/extensions/" class="sites-navigation-link">Google Chrome Extensions</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="https://developers.google.com/chrome/chrome-frame/" class="sites-navigation-link">Google Chrome Frame</a></div></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_19695218559354544" class="sites-embed" role="complementary"><h4 class="sites-embed-title"></h4><div class="sites-embed-content sites-embed-content-sidebar-textbox"><div dir="ltr"><span style="font-size:x-small">Except as otherwise </span><a href="http://developers.google.com/site-policies.html#restrictions"><span style="font-size:x-small">noted</span></a><span style="font-size:x-small">, the content of this page is licensed under a </span><a href="http://creativecommons.org/licenses/by/2.5/"><span style="font-size:x-small">Creative Commons Attribution 2.5 license</span></a><span style="font-size:x-small">, and examples are licensed under the </span><a href="http://src.chromium.org/viewvc/chrome/trunk/src/LICENSE" target="_blank"><span style="font-size:x-small">BSD License</span></a><span style="font-size:x-small">.<br /></span></div></div></div>
</td>
<td id="sites-canvas-wrapper">
<div id="sites-canvas" role="main">
<div id="goog-ws-editor-toolbar-container"> </div>
<div xmlns="http://www.w3.org/1999/xhtml" id="title-crumbs" style="">
<A href="../../chromium-os.1.html" dir="ltr">Chromium OS</A>‎ &gt; ‎<A href="../testing.1.html" dir="ltr">Testing Home</A>‎ &gt; ‎
  </div>
<h3 xmlns="http://www.w3.org/1999/xhtml" id="sites-page-title-header" style="" align="left">
<span id="sites-page-title" dir="ltr" tabindex="-1" style="outline: none">Common Testing Workflows</span>
</h3>
<div id="sites-canvas-main" class="sites-canvas-main">
<div id="sites-canvas-main-content">
<table xmlns="http://www.w3.org/1999/xhtml" cellspacing="0" class="sites-layout-name-one-column sites-layout-hbox"><tbody><tr><td class="sites-layout-tile sites-tile-name-content-1"><div dir="ltr"><div><div><div class="sites-embed-align-left-wrapping-off"><div class="sites-embed-border-off sites-embed" style="width:350px;"><div class="sites-embed-content sites-embed-type-toc"><div class="goog-toc sites-embed-toc-maxdepth-6"><p>Contents</p><ol class="goog-toc"><li class="goog-toc"><a href="common-testing-workflows.html#TOC-Workflow-1"><strong>1 </strong>Workflow 1</a><ol class="goog-toc"><li class="goog-toc"><a href="common-testing-workflows.html#TOC-Developer-already-has-a-built-system-using-build-instructions.-Developer-wants-to-create-a-copy-of-their-image-for-testing-and-build-Chromium-OS-tests-without-re-running-build_packages."><strong>1.1 </strong>Developer already has a built system using build instructions. Developer wants to create a copy of their image for testing and build Chromium OS tests without re-running build_packages.</a></li><li class="goog-toc"><a href="common-testing-workflows.html#TOC-cros_sdk-and-run-mod_image_for_test-on-the-chromiumos_image.bin-if-you-get-complaints-of-unmount-errors-sudo-umount-media-outside-the-chroot-."><strong>1.2 </strong>cros_sdk and run mod_image_for_test on the chromiumos_image.bin (if you get complaints of unmount errors, sudo umount /media/* outside the chroot).</a></li></ol></li><li class="goog-toc"><a href="common-testing-workflows.html#TOC-Workflow-2"><strong>2 </strong>Workflow 2</a></li><li class="goog-toc"><a href="common-testing-workflows.html#TOC-Workflow-3"><strong>3 </strong>Workflow 3</a><ol class="goog-toc"><li class="goog-toc"><a href="common-testing-workflows.html#TOC-Developer-wants-to-run-a-test-with-certain-conditions-met-on-the-host-system-before-the-system-is-ready-for-that-test-e.g.-browser-is-not-running-and-has-never-run-since-boot-."><strong>3.1 </strong>Developer wants to run a test with certain conditions met on the host system before the system is ready for that test e.g. "browser is not running and has never run since boot".</a></li><li class="goog-toc"><a href="common-testing-workflows.html#TOC-For-tests-that-require-system-wide-setup-and-system-wide-cleanup-the-best-approach-is-probably-to-create-a-server-side-test-that-sets-up-the-environment-reboots-the-system-runs-the-test-and-cleans-up-the-system.-This-should-not-be-done-for-very-small-tests"><strong>3.2 </strong>For tests that require system-wide setup and system-wide cleanup, the best approach is probably to create a server-side test that sets up the environment, reboots the system, runs the test and cleans up the system.  This should not be done for very small tests as rebooting is rather expensive.  Take a look at BootPerfServer as an example to write such a test.</a></li></ol></li><li class="goog-toc"><a href="common-testing-workflows.html#TOC-Workflow-4"><strong>4 </strong>Workflow 4</a><ol class="goog-toc"><li class="goog-toc"><a href="common-testing-workflows.html#TOC-W1.-Develop-and-iterate-on-a-test"><strong>4.1 </strong>W1. Develop and iterate on a test</a></li><li class="goog-toc"><a href="common-testing-workflows.html#TOC-W2.-Creating-a-test---steps-and-checklist"><strong>4.2 </strong>W2. Creating a test - steps and checklist</a></li><li class="goog-toc"><a href="common-testing-workflows.html#TOC-W3.-Splitting-autotest-ebuild-into-two"><strong>4.3 </strong>W3. Splitting autotest ebuild into two</a></li><li class="goog-toc"><a href="common-testing-workflows.html#TOC-W4.-Create-and-run-a-test-enabled-image-on-your-device"><strong>4.4 </strong>W4. Create and run a test-enabled image on your device</a></li></ol></li></ol></div></div></div></div></div><div><br /></div><br /></div>There are a lot of common developer workflows when it comes to testing.  This document details those.<h2><a name="TOC-Workflow-1"></a>Workflow 1</h2><h3><a name="TOC-Developer-already-has-a-built-system-using-build-instructions.-Developer-wants-to-create-a-copy-of-their-image-for-testing-and-build-Chromium-OS-tests-without-re-running-build_packages."></a><span style="font-weight:normal;font-size:13px"><i>Developer already has a built system using build instructions. Developer wants to create a copy of their image for testing and build Chromium OS tests without re-running build_packages.</i></span></h3><h3><a name="TOC-cros_sdk-and-run-mod_image_for_test-on-the-chromiumos_image.bin-if-you-get-complaints-of-unmount-errors-sudo-umount-media-outside-the-chroot-."></a><font size="3"><span style="font-size:13px;font-weight:normal">cros_sdk and run mod_image_for_test on the chromiumos_image.bin (if you get complaints of unmount errors, sudo umount /media/* outside the chroot).</span></font></h3><h2><a name="TOC-Workflow-2"></a>Workflow 2</h2><i>Developer has a testable image on their device. Developer makes modifications to the python component of a test and wants to re-run the test on the target system.</i><div><i><br /></i><div>If the user makes modifications on the host system, the easiest way to re-run the tests is to re-run run_remote_tests.  That script takes local changes from third_party/autotest before running tests.  However, if the developer wants to make changes to dependencies of their tests, the developer must re-run build_autotest.sh</div><h2><a name="TOC-Workflow-3"></a>Workflow 3</h2><h3><a name="TOC-Developer-wants-to-run-a-test-with-certain-conditions-met-on-the-host-system-before-the-system-is-ready-for-that-test-e.g.-browser-is-not-running-and-has-never-run-since-boot-."></a><span style="font-weight:normal;font-size:13px"><i>Developer wants to run a test with certain conditions met on the host system before the system is ready for that test e.g. "browser is not running and has never run since boot".</i></span></h3><h3><a name="TOC-For-tests-that-require-system-wide-setup-and-system-wide-cleanup-the-best-approach-is-probably-to-create-a-server-side-test-that-sets-up-the-environment-reboots-the-system-runs-the-test-and-cleans-up-the-system.-This-should-not-be-done-for-very-small-tests"></a><span style="font-weight:normal;font-size:13px">For tests that require system-wide setup and system-wide cleanup, the best approach is probably to create a server-side test that sets up the environment, reboots the system, runs the test and cleans up the system.  This should not be done for very small tests as rebooting is rather expensive.  Take a look at <a href="http://git.chromium.org/cgi-bin/gitweb.cgi?p=autotest.git;a=tree;f=server/site_tests/platform_BootPerfServer;h=2362958081700ed3e243935641ebe69b17890045;hb=HEAD">BootPerfServer</a> as an example to write such a test.</span></h3><div><br /></div><div><i>Note in the long run we want to create utilities that verify certain conditions.  If you are interested in writing one of these utilities, please email the dev list.</i></div><h2><a name="TOC-Workflow-4"></a>Workflow 4</h2><i>Developer wants to run a test that requires a user to be logged in.</i></div><div><i><br /></i><div>Subclass your test from site_ui_test.UITest</div><div><br /></div><div><i>Note we are trying to create a utility for such pre-req's as login, so make sure to leave a big todo with DoLogin in it so that we can update your tests once they the utility libraries are ready.</i></div></div><div><i><br /></i></div><div><div><span style="font-family:Times New Roman"><h3><a name="TOC-W1.-Develop-and-iterate-on-a-test"></a><span style="font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"><font size="4">W1. Develop and iterate on a test</font></span></h3><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">0. Set up environment</span><br /><div class="sites-codeblock sites-codesnippet-block" style="font-weight:bold;font-size:medium"><span style="font-size:15px;font-family:Arial;color:rgb(0,0,255);background-color:transparent;font-weight:normal;vertical-align:baseline;white-space:pre-wrap"><code>$ cd ~/trunk/src/third_party/autotest/files/</code></span><br /><span style="font-size:15px;font-family:Arial;color:rgb(0,0,255);background-color:transparent;font-weight:normal;vertical-align:baseline;white-space:pre-wrap"><code>$ export TESTS=”&lt;the test cases to iterate on&gt;”</code></span><br /><span style="font-size:15px;font-family:Arial;color:rgb(0,0,255);background-color:transparent;font-weight:normal;vertical-align:baseline;white-space:pre-wrap"><code>$ EBUILD=&lt;the ebuild that contains TEST&gt;</code></span><br /><span style="font-size:15px;font-family:Arial;color:rgb(0,0,255);background-color:transparent;font-weight:normal;vertical-align:baseline;white-space:pre-wrap"><code>$ board=&lt;the board on which to develop&gt;</code></span></div><br /><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">1. Ensure cros_workon is started</span><br /><div class="sites-codeblock sites-codesnippet-block" style="font-weight:bold;font-size:medium"><span style="font-size:15px;font-family:Arial;color:rgb(0,0,255);background-color:transparent;font-weight:normal;vertical-align:baseline;white-space:pre-wrap"><code>$ cros_workon --board=${board} start ${EBUILD}</code></span><br /><span style="font-size:15px;font-family:Arial;color:rgb(0,0,255);background-color:transparent;font-weight:normal;vertical-align:baseline;white-space:pre-wrap"><code>$ repo sync # Necessary only if you use minilayout.</code></span></div><br /><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">2. Make modifications (on first run, you may want to just do 3,4 to verify everything works before you touch it &amp; break it)</span><br /><span style="font-size:15px;font-family:Arial;color:rgb(0,0,255);background-color:transparent;vertical-align:baseline;white-space:pre-wrap"><div class="sites-codeblock sites-codesnippet-block"><code>$ …</code></div></span><br /><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">3. Build test (TESTS= is not necessary if you exported it before)</span><br /><span style="font-size:15px;font-family:Arial;color:rgb(0,0,255);background-color:transparent;vertical-align:baseline;white-space:pre-wrap"><div class="sites-codeblock sites-codesnippet-block"><code>$ emerge-$board $EBUILD</code></div></span><br /><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">4. Run test to make sure it works before you touch it</span><br /><div class="sites-codeblock sites-codesnippet-block" style="font-weight:bold;font-size:medium"><span style="font-size:15px;font-family:Arial;color:rgb(0,0,255);background-color:transparent;font-weight:normal;vertical-align:baseline;white-space:pre-wrap"><code>$ run_remote_tests --remote=&lt;machine IP&gt; --use_emerged ${TEST</code></span><span style="font-size:15px;font-family:Arial;background-color:transparent;font-weight:normal;vertical-align:baseline;white-space:pre-wrap"><code>S}</code></span></div><br /><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">5. Go to 2) to iterate</span><br /><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">6. Clean up environment</span><br /><div class="sites-codeblock sites-codesnippet-block" style="font-weight:bold;font-size:medium"><span style="font-size:15px;font-family:Arial;color:rgb(0,0,255);background-color:transparent;font-weight:normal;vertical-align:baseline;white-space:pre-wrap"><code>$ cros_workon --board=${board} stop ${EBUILD}</code></span><br /><span style="font-size:15px;font-family:Arial;color:rgb(0,0,255);background-color:transparent;font-weight:normal;vertical-align:baseline;white-space:pre-wrap"><code>$ unset TESTS</code></span></div><br /><br /><h3 style="font-size:medium"><a name="TOC-W2.-Creating-a-test---steps-and-checklist"></a><span style="font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">W2. Creating a test - steps and checklist</span></h3><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">When creating a test, the following steps should be done/verified.</span><br /><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">1. Create the actual test directory, main test files/sources, at least one control file</span><br /><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">2. Find the appropriate ebuild package and start working on it:</span><br /><span style="font-size:15px;font-family:Arial;color:rgb(0,0,255);background-color:transparent;vertical-align:baseline;white-space:pre-wrap"><div class="sites-codeblock sites-codesnippet-block"><code>$ cros_workon --board=${board} start &lt;package&gt;</code></div></span><br /><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">3. Add the new test into the IUSE_TESTS list of 9999 ebuild</span><br /><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">4. Try building: (make sure it’s the 9999 version being built)</span><br /><span style="font-size:15px;font-family:Arial;color:rgb(0,0,255);background-color:transparent;vertical-align:baseline;white-space:pre-wrap"><div class="sites-codeblock sites-codesnippet-block"><code>$ TESTS=&lt;test&gt; emerge-$board &lt;package&gt;</code></div></span></span><font size="3"><div><font size="3"><br /></font></div>5. Try running:</font><b style="font-size:medium;font-family:Times New Roman"><div class="sites-codeblock sites-codesnippet-block"><span style="font-size:15px;font-family:Arial;color:rgb(0,0,255);background-color:transparent;font-weight:normal;vertical-align:baseline;white-space:pre-wrap"><code>$ run_remote_tests.sh --remote=&lt;IP&gt; --use_emerged &lt;test&gt;</code></span></div><span style="font-size:15px;font-family:Arial;background-color:transparent;font-weight:normal;vertical-align:baseline;white-space:pre-wrap"><div><b style="font-size:medium;font-family:Times New Roman"><span style="font-size:15px;font-family:Arial;background-color:transparent;font-weight:normal;vertical-align:baseline"><br /></span></b></div>6. Iterate on 4,5 and modify source until happy with the initial version.</span><br /><span style="font-size:15px;font-family:Arial;background-color:transparent;font-weight:normal;vertical-align:baseline;white-space:pre-wrap">7. Commit test source first, when it is safely in, commit the 9999 ebuild version change.</span><br /><span style="font-size:15px;font-family:Arial;background-color:transparent;font-weight:normal;vertical-align:baseline;white-space:pre-wrap">8. Cleanup</span><br /><span style="font-size:15px;font-family:Arial;color:rgb(0,0,255);background-color:transparent;font-weight:normal;vertical-align:baseline;white-space:pre-wrap"><div class="sites-codeblock sites-codesnippet-block"><code>$ cros_workon --board=${board} stop &lt;package&gt;</code></div></span><br /><br /><h3><a name="TOC-W3.-Splitting-autotest-ebuild-into-two"></a><span style="font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">W3. Splitting autotest ebuild into two</span></h3><span style="font-size:15px;font-family:Arial;background-color:transparent;font-weight:normal;vertical-align:baseline;white-space:pre-wrap">Removing a test from one ebuild and adding to another in the same revision causes portage file collisions unless counter-measures are taken. Generally, some things routinely go wrong in this process, so this checklist should serve to help that.</span><br /><span style="font-size:15px;font-family:Arial;background-color:transparent;font-weight:normal;vertical-align:baseline;white-space:pre-wrap">0. We have ebuild </span><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">foo-0.0.1-r100</span><span style="font-size:15px;font-family:Arial;background-color:transparent;font-weight:normal;vertical-align:baseline;white-space:pre-wrap"> with </span><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">test</span><span style="font-size:15px;font-family:Arial;background-color:transparent;font-weight:normal;vertical-align:baseline;white-space:pre-wrap"> and would like to split that test off into ebuild</span><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> bar-0.0.1-r1</span><span style="font-size:15px;font-family:Arial;background-color:transparent;font-weight:normal;vertical-align:baseline;white-space:pre-wrap">.</span><br /><span style="font-size:15px;font-family:Arial;background-color:transparent;font-weight:normal;vertical-align:baseline;white-space:pre-wrap">Assume that:</span><br /><span style="font-size:15px;font-family:Arial;background-color:transparent;font-weight:normal;vertical-align:baseline;white-space:pre-wrap">- both ebuilds are using cros-workon (because it’s likely the case).</span><br /><span style="font-size:15px;font-family:Arial;background-color:transparent;font-weight:normal;vertical-align:baseline;white-space:pre-wrap">- foo is used globally (eg. autotest-all depends on it), rather than just some personal ebuild</span><br /><span style="font-size:15px;font-family:Arial;background-color:transparent;font-weight:normal;vertical-align:baseline;white-space:pre-wrap">1. Remove </span><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">test</span><span style="font-size:15px;font-family:Arial;background-color:transparent;font-weight:normal;vertical-align:baseline;white-space:pre-wrap"> from foo-{0.0.1-r100,9999}; uprev foo-0.0.1-r100 (to -r101)</span><br /><span style="font-size:15px;font-family:Arial;background-color:transparent;font-weight:normal;vertical-align:baseline;white-space:pre-wrap">2. Create bar-9999 (making a copy of foo and replacing IUSE_TESTS may be a good start), with IUSE_TESTS containing just the entry for </span><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">test</span><br /><span style="font-size:15px;font-family:Arial;background-color:transparent;font-weight:normal;vertical-align:baseline;white-space:pre-wrap">3. Verify package dependencies of test. Make bar-9999 only depend on what is needed for test, remove the dependencies from foo-9999, unless they are needed by tests that remained.</span><br /><span style="font-size:15px;font-family:Arial;background-color:transparent;font-weight:normal;vertical-align:baseline;white-space:pre-wrap">4. Add a blocker. Since bar installs files owned by foo-0.0.1-r100 and earlier, the blocker’s format will be:</span><br /><span style="font-size:15px;font-family:Arial;color:rgb(0,0,255);background-color:transparent;font-weight:normal;vertical-align:baseline;white-space:pre-wrap"><div class="sites-codeblock sites-codesnippet-block"><code>RDEPEND=”!&lt;=foo-0.0.1-r100”</code></div></span><span style="font-size:15px;font-family:Arial;background-color:transparent;font-weight:normal;vertical-align:baseline;white-space:pre-wrap">5. Add a dependency to the new version of bar into chromeos-base/autotest-all-0.0.1</span><br /><span style="font-size:15px;font-family:Arial;background-color:transparent;font-weight:normal;vertical-align:baseline;white-space:pre-wrap"><div class="sites-codeblock sites-codesnippet-block"><code>RDEPEND=”bar”</code></div></span><span style="font-size:15px;font-family:Arial;background-color:transparent;font-weight:normal;vertical-align:baseline;white-space:pre-wrap">6. Change the dependency of foo in chromeos-base/autotest-all-0.0.1 to be version locked to the new rev:</span><br /><span style="font-size:15px;font-family:Arial;background-color:transparent;font-weight:normal;vertical-align:baseline;white-space:pre-wrap"><div class="sites-codeblock sites-codesnippet-block"><code>RDEPEND=”&gt;foo-0.0.1-r100”</code></div></span><span style="font-size:15px;font-family:Arial;background-color:transparent;font-weight:normal;vertical-align:baseline;white-space:pre-wrap">7. Uprev (move) autotest-all-0.0.1-rX symlink by one.</span><br /><span style="font-size:15px;font-family:Arial;background-color:transparent;font-weight:normal;vertical-align:baseline;white-space:pre-wrap">8. Publish all as the same change list, have it reviewed, push.</span></b></div><div><span style="background-color:transparent;vertical-align:baseline;white-space:pre-wrap"><font face="Arial"><h3 style="font-size:15px"><a name="TOC-10"></a><br /></h3><h3><a name="TOC-W4.-Create-and-run-a-test-enabled-image-on-your-device"></a><font size="4"><a name="TOC-W4.-Create-and-run-a-test-enabled-image-on-your-device"></a>W4. Create and run a test-enabled image on your device</font></h3><div style="font-size:15px"><br /></div><div style="font-size:15px">1. Choose which board you want to build for (we'll refer to this as ${BOARD}, which is for example "x86-generic").</div><div style="font-size:15px">2. Set up a proper portage build chroot setup.  Go through the normal process of setup_board if you haven't already. </div><div style="font-size:15px"><div class="sites-codeblock sites-codesnippet-block"><code>$ ./build_packages --board=${BOARD}</code></div></div><div style="font-size:15px">3. Build test image.</div><div style="font-size:15px"><div class="sites-codeblock sites-codesnippet-block"><code>$ ./build_image --board=${BOARD} test</code></div></div><div style="font-size:15px">4. Install the Chromium OS testing image to your target machine.  This is through the standard mechanisms: either USB, or by reimaging a device currently running a previously built Chromium OS image modded for test, or by entering the shell on the machine and forcing an auto update to your machine when it's running a dev server.  For clarity we'll walk through two common ways below, but if you already know about this, just do what you normally do.</div><div style="font-size:15px">4a. If you choose to use a USB boot, you first put the image on USB and run this from outside the chroot.</div><div style="font-size:15px"><div class="sites-codeblock sites-codesnippet-block"><code>$ cros flash --board=${BOARD} usb:// chromiumos_test_image.bin</code></div></div><div style="font-size:15px">4b. Alternatively, if you happen to already have a machine running an image modified for test and you know its IP address (${REMOTE_IP}), you can avoid using a USB key and reimage it with a freshly built image by running this from outside the chroot:</div><div style="font-size:15px"><div class="sites-codeblock sites-codesnippet-block"><code>$ ./image_to_live.sh --remote=${REMOTE_IP} --image=`./get_latest_image.sh --board=${BOARD}`/chromiumos_test_image.bin</code></div></div><div style="font-size:15px">This will automatically start dev server, ssh to your machine, cause it to update to from that dev server using memento_updater, reboot, wait for reboot, print out the new version updated to, and shut down your dev server.</div></font></span></div></div></div></td></tr></tbody></table>
</div> 
</div> 
<div id="sites-canvas-bottom-panel">
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_page-subpages"> </div>
<div id="sites-attachments-container">
</div>
<a xmlns="http://www.w3.org/1999/xhtml" name="page-comments"></a>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_page-comments"><div class="sites-comment-docos-wrapper"><div class="sites-comment-docos"><div class="sites-comment-docos-background"></div><div class="sites-comment-docos-header"><div class="sites-comment-docos-header-title">Comments</div></div><div id="sites-comment-docos-pane" class="sites-comment-docos-pane"></div></div></div></div>
</div>
</div> 
</td> 
</tr>
</table> 
</div> 
</div> 
<div id="sites-chrome-footer-wrapper">
<div id="sites-chrome-footer-wrapper-inside">
<div id="sites-chrome-footer">
</div>
</div>
</div>
</div> 
</div> 
<div id="sites-chrome-adminfooter-container">
<div xmlns="http://www.w3.org/1999/xhtml" class="sites-adminfooter" role="navigation"><p><a class="sites-system-link" href="https://www.google.com/a/UniversalLogin?service=jotspot&amp;continue=https://sites.google.com/a/chromium.org/dev/chromium-os/testing/common-testing-workflows">Sign in</a><span aria-hidden="true">|</span><a class="sites-system-link" href="../../system/app/pages/recentChanges.html">Recent Site Activity</a><span aria-hidden="true">|</span><a class="sites-system-link" href="../../system/app/pages/reportAbuse.html" target="_blank">Report Abuse</a><span aria-hidden="true">|</span><a class="sites-system-link" href="javascript:;" onclick="window.open(webspace.printUrl)">Print Page</a><span aria-hidden="true">|</span><span class="sites-system-link">Powered By</span> <b class="powered-by"><a href="http://sites.google.com">Google Sites</a></b></p></div>
</div>
</div> 
</div> 
<div id="sites-chrome-onebar-footer">
</div>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    window.jstiming.load.tick('sjl');
  </script>
<script xmlns="http://www.w3.org/1999/xhtml" src="https://ssl.gstatic.com/sites/p/56e332/system/js/jot_min_view__en.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    window.jstiming.load.tick('jl');
  </script>
<script xmlns="http://www.w3.org/1999/xhtml">
      
          sites.core.Analytics.createTracker();
          sites.core.Analytics.trackPageview();
        
    </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
                    sites.Searchbox.initialize(
                        'sites-searchbox-search-button',
                        {"object":[]}['object'],
                        'search-site',
                        {"label":"Configure search options...","url":"/system/app/pages/admin/settings"});
                  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
      gsites.HoverPopupMenu.createSiteDropdownMenus('sites-header-nav-dropdown', false);
    </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
            JOT_setupNav("7648876402527094", "Navigation", false);
            JOT_addListener('titleChange', 'JOT_NAVIGATION_titleChange', 'COMP_7648876402527094');
          </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
            JOT_setupNav("14720868319272995", "Quick links", false);
            JOT_addListener('titleChange', 'JOT_NAVIGATION_titleChange', 'COMP_14720868319272995');
          </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
            JOT_setupNav("19690813310444355", "Other sites", false);
            JOT_addListener('titleChange', 'JOT_NAVIGATION_titleChange', 'COMP_19690813310444355');
          </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
              new sites.CommentPane('//docs.google.com/comments/d/AAHRpnXvrAwjAfmld0ObrebBiGRq9ujfx4MflDqvrvk6eegbxT3lJu8LYen0GzhNygfw0c3qyZwmHlIq-X3QtlFYzeNRN_ffFs7yyDugJcWWM5Sa-tfCdnlbVioBq7c6zKk5XKRlkwCq_/api/js?anon=true',
                  false, false);
            </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
  setTimeout(function() {
    var fingerprint = gsites.date.TimeZone.getFingerprint([]);
    gsites.Xhr.send('https://www.chromium.org/_/tz', null, null, 'GET', null, null, { afjstz: fingerprint });
  }, 500);
</script>
<script xmlns="http://www.w3.org/1999/xhtml">
                    window.onload = function() {
                      if (false) {
                        JOT_setMobilePreview();
                      }
                      var loadTimer = window.jstiming.load;
                      loadTimer.tick("ol");
                      loadTimer["name"] = "load," + webspace.page.type + ",user_page";
                      window.jstiming.report(loadTimer, {}, 'https://gg.google.com/csi');
                    }
                  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
        JOT_insertAnalyticsCode(false,
            false);
      </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    var maestroRunner = new gsites.pages.view.SitesMaestroRunner(
        webspace, "en");
    maestroRunner.initListeners();
    maestroRunner.installEditRender();
  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
  //<![CDATA[
    // Decorate any fastUI buttons on the page with a class of 'goog-button'.
    if (webspace.user.hasWriteAccess) {
      JOT_decorateButtons();
    }

    // Fires delayed events.
    (function() {
      JOT_fullyLoaded = true;
      var delayedEvents = JOT_delayedEvents;
      for (var x = 0; x < delayedEvents.length; x++) {
        var event = delayedEvents[x];
        JOT_postEvent(event.eventName, event.eventSrc, event.payload);
      }
      JOT_delayedEvents = null;
      JOT_postEvent('pageLoaded');
    })();
  //]]>
</script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    JOT_postEvent('decorateGvizCharts');
  </script>
<script type="text/javascript">
          JOT_setupPostRenderingManager();
        </script>
<script type="text/javascript">
          JOT_postEvent('renderPlus', null, 'sites-chrome-main');
        </script>
<div id="server-timer-div" style="display:none"> </div>
<script type="text/javascript">
          window.jstiming.load.tick('render');
          JOT_postEvent('usercontentrendered', this);
        </script>
</body>
</html>
