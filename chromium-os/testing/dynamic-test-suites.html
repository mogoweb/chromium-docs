<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/WebPage">
<head>
<meta http-equiv="X-UA-Compatible" content="chrome=1" />
<script type="text/javascript">/* Copyright 2008 Google. */ (function() { var e="wtsrt_",g="tbsd_",h="tbnd_",k="start",l="_wtsrt",m="_tbnd",n="CSI/";(function(){function f(a){this.t={};this.tick=function(a,c,b){this.t[a]=[void 0!=b?b:(new Date).getTime(),c];if(void 0==b)try{window.console.timeStamp(n+a)}catch(d){}};this.tick(k,null,a)}var a;window.performance&&(a=window.performance.timing);var p=a?new f(a.responseStart):new f;window.jstiming={Timer:f,load:p};if(a){var c=a.navigationStart,d=a.responseStart;0<c&&d>=c&&(window.jstiming.srt=d-c)}if(a){var b=window.jstiming.load;0<c&&d>=c&&(b.tick(l,void 0,c),b.tick(e,l,d),b.tick(g,e))}try{a=null,
window.chrome&&window.chrome.csi&&(a=Math.floor(window.chrome.csi().pageT),b&&0<c&&(b.tick(m,void 0,window.chrome.csi().startE),b.tick(h,m,c))),null==a&&window.gtbExternal&&(a=window.gtbExternal.pageT()),null==a&&window.external&&(a=window.external.pageT,b&&0<c&&(b.tick(m,void 0,window.external.startE),b.tick(h,m,c))),a&&(window.jstiming.pt=a)}catch(q){}})(); })()
</script>
<link rel="shortcut icon" href="../../_/rsrc/1354323194313/favicon.ico" type="image/x-icon" />
<link rel="apple-touch-icon" href="https://ssl.gstatic.com/sites/p/56e332/system/app/images/apple-touch-icon.png" type="image/png" />
<script type="text/javascript">/* Copyright 2008 Google. */ (function() { var d="",g="__duration__",h="function";function k(c){return document.getElementById(c)}window.byId=k;function l(c){return c.replace(/^\s+|\s+$/g,d)}window.trim=l;var m=[],n=0;window.JOT_addListener=function(c,a,b){var e=new String(n++);c={eventName:c,handler:a,compId:b,key:e};m.push(c);return e};window.JOT_removeListenerByKey=function(c){for(var a=0;a<m.length;a++)if(m[a].key==c){m.splice(a,1);break}};
window.JOT_removeAllListenersForName=function(c){for(var a=0;a<m.length;a++)m[a].eventName==c&&m.splice(a,1)};window.JOT_postEvent=function(c,a,b){var e={eventName:c,eventSrc:a||{},payload:b||{}};if(window.JOT_fullyLoaded)for(a=m.length,b=0;b<a&&b<m.length;b++){var f=m[b];f&&f.eventName==c&&(e.listenerCompId=f.compId||d,(f=typeof f.handler==h?f.handler:window[f.handler])&&f(e))}else window.JOT_delayedEvents.push({eventName:c,eventSrc:a,payload:b})};window.JOT_delayedEvents=[];
window.JOT_fullyLoaded=!1;window.JOT_formatRelativeToNow=function(c,a){var b=((new Date).getTime()-c)/6E4;if(1440<=b||0>b)return null;var e=0;60<=b&&(b/=60,e=2);2<=b&&e++;return a?window.JOT_siteRelTimeStrs[e].replace(g,Math.floor(b)):window.JOT_userRelTimeStrs[e].replace(g,Math.floor(b))}; })()
</script>
<script>

  

  var breadcrumbs = [{"path":"/chromium-os","deleted":false,"title":"Chromium OS","dir":"ltr"},{"path":"/chromium-os/testing","deleted":false,"title":"Testing Home","dir":"ltr"},{"path":"/chromium-os/testing/dynamic-test-suites","deleted":false,"title":"Dynamic Test Suites","dir":"ltr"}];
  var JOT_clearDotPath = 'https://ssl.gstatic.com/sites/p/56e332/system/app/images/cleardot.gif';

  
  var JOT_userRelTimeStrs = ["a minute ago","__duration__ minutes ago","an hour ago","__duration__ hours ago"];

  
  

  

  var webspace = {"enableAnalytics":true,"pageSharingId":"jotspot_page","enableUniversalAnalytics":false,"sharingPolicy":"OPENED_WITH_INDICATOR","siteTitle":"The Chromium Projects","isStartPageEnabled":true,"adsensePublisherId":null,"features":{"languageSelectDefaultTextSetToDefault":true,"validateClientGvizDataSourceUrls":true,"moreMobileStyleImprovements":true,"newInsertMenuIcons":true,"accessibleSortingButtons":true,"domainAnalyticsInGAOnly":true,"noCaptcha":true,"fileCabinetScreenReaderFix":true,"updatedTosAndPrivacyLinks":null,"pageDrafts":false,"mobileOrientationFix":true,"plusBadge":false,"pdfEmbedSupport":false,"jsClickFix":true},"isPublic":true,"isConsumer":false,"serverFlags":{"cajaBaseUrl":"//www.gstatic.com/caja","cajaDebugMode":false},"onepickBaseUrl":"https://docs.google.com","domainAnalyticsAccountId":"","plusPageId":"","signInUrl":"https://www.google.com/a/SelectSession?continue\u003dhttps://sites.google.com/a/chromium.org/dev/chromium-os/testing/dynamic-test-suites\u0026service\u003djotspot","analyticsAccountId":"UA-5484340-1","scottyUrl":"/_/upload","homePath":"/","siteNoticeUrlEnabled":null,"plusPageUrl":"","adsensePromoClickedOrSiteIneligible":true,"csiReportUri":"https://gg.google.com/csi","sharingId":"jotspot","termsUrl":"//www.google.com/intl/en/policies/terms/","gvizVersion":1,"editorResources":{"sitelayout":["https://ssl.gstatic.com/sites/p/56e332/system/app/css/sitelayouteditor.css"],"text":["https://ssl.gstatic.com/sites/p/56e332/system/js/codemirror.js","https://ssl.gstatic.com/sites/p/56e332/system/app/css/codemirror_css.css","https://ssl.gstatic.com/sites/p/56e332/system/js/trog_edit__en.js","https://ssl.gstatic.com/sites/p/56e332/system/app/css/trogedit.css","/_/rsrc/1441580320000/system/app/css/editor.css","https://ssl.gstatic.com/sites/p/56e332/system/app/css/codeeditor.css","/_/rsrc/1441580320000/system/app/css/camelot/editor-jfk-wlb.css"]},"sharingUrlPrefix":"/_/sharing","isAdsenseEnabled":true,"domain":"chromium.org","baseUri":"","name":"dev","siteTemplateId":false,"siteNoticeRevision":null,"siteNoticeUrlAddress":null,"siteNoticeMessage":null,"page":{"isRtlLocale":false,"canDeleteWebspace":null,"isPageDraft":null,"parentPath":"/chromium-os/testing","parentWuid":"wuid:gx:2e2ee5668f423109","siteLocale":"en","timeZone":"America/Los_Angeles","type":"text","title":"Dynamic Test Suites","locale":"en","wuid":"wuid:gx:601463f231cf5a04","revision":12,"path":"/chromium-os/testing/dynamic-test-suites","isSiteRtlLocale":false,"pageInheritsPermissions":null,"name":"dynamic-test-suites","canChangePath":true,"state":"","properties":{},"bidiEnabled":false,"currentTemplate":{"path":"/system/app/pagetemplates/text","title":"Web Page"}},"canPublishScriptToAnyone":true,"user":{"keyboardShortcuts":true,"sessionIndex":"","guest_":true,"displayNameOrEmail":"guest","userName":"guest","uid":"","renderMobile":false,"domain":"","namespace":"","hasWriteAccess":false,"namespaceUser":false,"primaryEmail":"guest","hasAdminAccess":false},"gadgets":{"baseUri":"/system/app/pages/gadgets"}};
  webspace.page.breadcrumbs = breadcrumbs;

  
  var JOT_siteRelTimeStrs = ["a minute ago","__duration__ minutes ago","an hour ago","__duration__ hours ago"];

</script>
<script type="text/javascript">
                window.jstiming.load.tick('scl');
              </script>
<meta name="title" content="Dynamic Test Suites - The Chromium Projects" />
<meta itemprop="name" content="Dynamic Test Suites - The Chromium Projects" />
<meta property="og:title" content="Dynamic Test Suites - The Chromium Projects" />
<meta name="description" content="Home of the Chromium Open Source Project" />
<meta itemprop="description" content="Home of the Chromium Open Source Project" />
<meta id="meta-tag-description" property="og:description" content="Home of the Chromium Open Source Project" />
<style type="text/css">
</style>
<link rel="stylesheet" type="text/css" href="https://ssl.gstatic.com/sites/p/56e332/system/app/themes/beigeandblue/standard-css-beigeandblue-ltr-ltr.css" />
<link rel="stylesheet" type="text/css" href="../../_/rsrc/1441580320000/system/app/css/overlay.css%3Fcb=beigeandblueundefineda100%2525%2525150goog-ws-leftthemedefaultstandard.css" />
<link rel="stylesheet" type="text/css" href="../../_/rsrc/1441580320000/system/app/css/camelot/allthemes-view.css" />
<!--[if IE]>
          <link rel="stylesheet" type="text/css" href="/system/app/css/camelot/allthemes%2die.css" />
        <![endif]-->
<title>Dynamic Test Suites - The Chromium Projects</title>
<meta itemprop="image" content="/_/rsrc/1438879449147/config/customLogo.gif?revision=3" />
<meta property="og:image" content="/_/rsrc/1438879449147/config/customLogo.gif?revision=3" />
<script type="text/javascript">
                window.jstiming.load.tick('cl');
              </script>
</head>
<body xmlns="http://www.google.com/ns/jotspot" id="body" class=" en            ">
<div id="sites-page-toolbar" class="sites-header-divider">
<div xmlns="http://www.w3.org/1999/xhtml" id="sites-status" class="sites-status" style="display:none;"><div id="sites-notice" class="sites-notice" role="status" aria-live="assertive"> </div></div>
</div>
<div id="sites-chrome-everything-scrollbar">
<div id="sites-chrome-everything" class="">
<div id="sites-chrome-page-wrapper" style="direction: ltr">
<div id="sites-chrome-page-wrapper-inside">
<div xmlns="http://www.w3.org/1999/xhtml" id="sites-chrome-header-wrapper" style="height:auto;">
<table id="sites-chrome-header" class="sites-layout-hbox" cellspacing="0" style="height:auto;">
<tr class="sites-header-primary-row" id="sites-chrome-userheader">
<td id="sites-header-title" class="" role="banner"><div class="sites-header-cell-buffer-wrapper"><a href="../../index.html" id="sites-chrome-userheader-logo"><img id="logo-img-id" src="../../_/rsrc/1438879449147/config/customLogo.gif%3Frevision=3" alt="The Chromium Projects" class="sites-logo  " /></a><h2><a href="../../index.html" dir="ltr" id="sites-chrome-userheader-title">The Chromium Projects</a></h2></div></td><td class="sites-layout-searchbox  "><div class="sites-header-cell-buffer-wrapper"><form id="sites-searchbox-form" action="https://www.chromium.org/system/app/pages/search" role="search"><input type="hidden" id="sites-searchbox-scope" name="scope" value="search-site" /><input type="text" id="jot-ui-searchInput" name="q" size="20" value="" aria-label="Search this site" /><div id="sites-searchbox-button-set" class="goog-inline-block"><div role="button" id="sites-searchbox-search-button" class="goog-inline-block jfk-button jfk-button-standard" tabindex="0">Search this site</div></div></form></div></td>
</tr>
<tr class="sites-header-secondary-row" id="sites-chrome-horizontal-nav">
<td colspan="2" id="sites-chrome-header-horizontal-nav-container" role="navigation">
</td>
</tr>
</table>
</div>
<div id="sites-chrome-main-wrapper">
<div id="sites-chrome-main-wrapper-inside">
<table id="sites-chrome-main" class="sites-layout-hbox" cellspacing="0" cellpadding="{scmCellpadding}" border="0">
<tr>
<td id="sites-chrome-sidebar-left" class="sites-layout-sidebar-left initial" style="width:150px">
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_7648876402527094" class="sites-embed" role="navigation"><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotId="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="../../chromium-projects.html" jotId="wuid:gx:10ae433dadbbab13" class="sites-navigation-link">Home</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="../../Home.1.html" jotId="wuid:gx:43582b9d2029d3af" class="sites-navigation-link">Chromium</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="../../chromium-os.1.html" jotId="wuid:gx:83df2ab1f8880ba" class="sites-navigation-link">Chromium OS</a></div></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_14720868319272995" class="sites-embed" role="navigation"><h4 class="sites-embed-title">Quick links</h4><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotId="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="../../for-testers/bug-reporting-guidelines.html" class="sites-navigation-link">Report bugs</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="../../developers/discussion-groups.html" class="sites-navigation-link">Discuss</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="../../system/app/pages/sitemap/hierarchy.html" jotId="wuid:gx:4b58a9a350ad12f" class="sites-navigation-link">网站地图</a></div></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_19690813310444355" class="sites-embed" role="navigation"><h4 class="sites-embed-title">Other sites</h4><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotId="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="http://blog.chromium.org/" class="sites-navigation-link">Chromium Blog</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="http://code.google.com/chrome/extensions/" class="sites-navigation-link">Google Chrome Extensions</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="https://developers.google.com/chrome/chrome-frame/" class="sites-navigation-link">Google Chrome Frame</a></div></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_19695218559354544" class="sites-embed" role="complementary"><h4 class="sites-embed-title"></h4><div class="sites-embed-content sites-embed-content-sidebar-textbox"><div dir="ltr"><span style="font-size:x-small">Except as otherwise </span><a href="http://developers.google.com/site-policies.html#restrictions"><span style="font-size:x-small">noted</span></a><span style="font-size:x-small">, the content of this page is licensed under a </span><a href="http://creativecommons.org/licenses/by/2.5/"><span style="font-size:x-small">Creative Commons Attribution 2.5 license</span></a><span style="font-size:x-small">, and examples are licensed under the </span><a href="http://src.chromium.org/viewvc/chrome/trunk/src/LICENSE" target="_blank"><span style="font-size:x-small">BSD License</span></a><span style="font-size:x-small">.<br /></span></div></div></div>
</td>
<td id="sites-canvas-wrapper">
<div id="sites-canvas" role="main">
<div id="goog-ws-editor-toolbar-container"> </div>
<div xmlns="http://www.w3.org/1999/xhtml" id="title-crumbs" style="">
<A href="../../chromium-os.1.html" dir="ltr">Chromium OS</A>‎ &gt; ‎<A href="../testing.1.html" dir="ltr">Testing Home</A>‎ &gt; ‎
  </div>
<h3 xmlns="http://www.w3.org/1999/xhtml" id="sites-page-title-header" style="" align="left">
<span id="sites-page-title" dir="ltr" tabindex="-1" style="outline: none">Dynamic Test Suites</span>
</h3>
<div id="sites-canvas-main" class="sites-canvas-main">
<div id="sites-canvas-main-content">
<table xmlns="http://www.w3.org/1999/xhtml" cellspacing="0" class="sites-layout-name-one-column sites-layout-hbox"><tbody><tr><td class="sites-layout-tile sites-tile-name-content-1"><div dir="ltr"><span style="font-family:Times New Roman"><h2 style="font-size:medium;font-weight:bold"><a name="TOC-Autotest-Dynamic-Test-Suites"></a><span style="font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Autotest Dynamic Test Suites</span></h2><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">The next iteration of CrOS testing in Autotest is more dynamic and requires fewer manual changes with respect to adding and disabling tests.  The first pass at this required suites to be manually defined by hardcoding a list of tests, and added infrastructure to find a set of machines on which to run those tests.  The former required manual management, and the latter can already be done by appropriately using autotest. Dynamic suites, in contrast, are defined by looking over all existing control files at runtime, and rely on the autotest infrastructure to shard the tests across all available, appropriate machines.</span><br /><br /><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">As far as someone scheduling a BVT run is concerned, sending an RPC to the autotest frontend telling it to schedule ‘control.bvt’ for a certain build on a certain board is sufficient; all other logic exists inside of the Autotest frontend (AFE).</span><br /><h3 dir="ltr" style="font-size:medium;font-weight:bold"><a name="TOC-Detailed-Design"></a><span style="font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Detailed Design</span></h3><h4 dir="ltr" style="font-size:medium;font-weight:bold"><a name="TOC-Specifying-job-dependencies"></a><span style="font-size:16px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Specifying job dependencies</span></h4><h4 dir="ltr" style="font-size:medium"><a name="TOC-This-is-how-a-single-test-specifies-the-kind-of-machine-on-which-it-can-be-run.-DEPENDENCIES-is-just-a-list-of-labels.-A-machine-satisfying-all-of-them-must-be-found-in-order-for-the-job-to-be-successfully-scheduled.DEPENDENCIES-CDMA-POWER-GOBI3K-X86-All-c"></a><span style="font-size:16px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap;font-weight:normal"><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">This is how a single test specifies the kind of machine on which it can be run.  DEPENDENCIES is just a list of labels.  A machine satisfying all of them must be found in order for the job to be successfully scheduled.</span><br /><ul style="margin-top:0pt;margin-bottom:0pt"><li style="list-style-type:disc;font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline"><span style="background-color:transparent;vertical-align:baseline;white-space:pre-wrap">DEPENDENCIES=‘CDMA’, ‘POWER’, ‘GOBI3K’, ‘X86’</span></li></ul><br /><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">All current tests need to be re-evaluated and updated to encapsulate required dependencies. e.g. GSM, CDMA, POWER, GOBI3K, BLUETOOTH etc etc.  For architecture-dependent tests, we can also include labels like ARM, TEGRA2, TEGRA3, X86, etc.</span><br /></span></h4><h4 dir="ltr" style="font-size:medium;font-weight:bold"><a name="TOC-Board-compatibility"></a><span style="font-size:16px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Board compatibility</span></h4><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">We ultimately decided against specifically expressing which boards a test should and should not run on.  We couldn’t come up with a reason we’d need to avoid a specific board or class of boards that could not be expressed with DEPENDENCIES.  Bluetooth tests don’t apply to Alex?  Well, no Alex device will have BLUETOOTH.  ACPI tests don’t apply to ARM?  Well, they’ll DEPEND on x86. </span><br /><br /><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Instead, we will rely on dynamic_suite code in the AFE to distinguish between a test that has unsatisfiable dependencies at the time of scheduling, and one that can be scheduled, but does not run in the time allotted.  In the latter case, the job will be ABORTed.  In the former case, we will fail the test with TEST_NA.  In the Alex case above, for example, all tests with a BLUETOOTH dep will be TEST_NA.  As a more complicated example, consider a GOBI3K test on Mario, and assume we have only one Mario with that modem in it.  If all is well, the test can be scheduled in the time allowed and things are good.  If the device is down, the AFE still knows that it should have a machine that meets the test’s DEPENDENCIES, but discovers that the device is not currently ready.  That’s fine, and it schedules the test.  When the time allotted for the suite is up, the test would be ABORTed and included as a failure in the test results. </span><br /><h4 dir="ltr" style="font-size:medium;font-weight:bold"><a name="TOC-Job-reporting"></a><span style="font-size:16px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Job reporting</span></h4><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">For TPM’s, one can provide a view of test results per-build-per-board that shows all jobs that could be scheduled, and the results of those tests.  Specifically, jobs that are TEST_NA can be ignored if the customers of the dashboard so-desire.</span><br /><br /><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">For the lab team, we can show all jobs that we tried to schedule, so that we can see which jobs are getting starved and detect new, unexpected starvation.</span><br /><h4 dir="ltr" style="font-size:medium;font-weight:bold"><a name="TOC-Defining-suites"></a><span style="font-size:16px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Defining suites</span></h4><span style="font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"><span style="font-size:15px"><div><span style="font-family:Times New Roman"><span style="font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"><span style="font-size:15px">*** For more updated information, please see the <a href="test-code-labs/dynamic-suite-codelab.html">Dynamic Suites Code Lab</a>.</span></span></span></div><div><span style="font-family:Times New Roman"><span style="font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"><span style="font-size:15px"><br /></span></span></span></div>We've added a custom variable to control files called SUITE.  SUITE can contain a comma-delineated list of arbitrary strings.  Only suite names that have an associated control file will actually be usable in any meaningful way.  By convention, we put all suite control files in a top-level directory called 'test_suites', and name the files appropriately.  For example, </span><code><font color="#38761d" size="3">test_suites/control.bvt</font></code><span style="font-size:15px"> is the control file for the BVT suite.</span></span></span><div><b style="font-family:Times New Roman;font-size:medium;font-weight:normal"><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"><br /></span></b></div><div><b style="font-family:Times New Roman;font-size:medium;font-weight:normal"><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">This does require parser changes, and does make including upstream tests in our suites a bit complex.  The former is not that difficult (and probably upstreamable).  We could likely address the latter by adding a level of control-file-indirection, and having a site-specific file that uses SUITE and references the upstream test.</span></b></div><div><b style="font-family:Times New Roman;font-size:medium;font-weight:normal"><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"><br /></span></b></div><div><b style="font-family:Times New Roman;font-size:medium;font-weight:normal"><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">We use the already-existing “EXPERIMENTAL” flag to mark tests as candidates for inclusion in a suite, and will run them along with the non-experimental tests -- but tag them separately so that results can be separated out in the final report.</span><br /><br /><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">We considered making </span><span style="font-size:15px;font-family:Arial;background-color:transparent;font-style:italic;vertical-align:baseline;white-space:pre-wrap">all</span><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> test suites a query of sorts over the labels defined in control files (the BVT would be all SHORT, functional tests that are not experimental, for example), which would avoid these issues, but decided that this smacked too much of magical side effects for use in our primary test suites.  However, we will provide a library of code that teams can use to create their own suite control files.  For example, ‘kernel.soak’ could simply be a one-liner that found and scheduled jobs for all SHORT, MEDIUM, and LONG functional and stress tests in the “kernel” category.</span></b></div><div><b style="font-family:Times New Roman;font-size:medium;font-weight:normal"><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"><br /></span></b></div><div><b style="font-weight:normal"><h3 dir="ltr" style="font-family:Times New Roman;font-size:medium"><a name="TOC-The-code"></a><span style="font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">The code</span></h3><h4 dir="ltr" style="font-family:Times New Roman;font-size:medium"><a name="TOC-Scheduling-a-suite-for-a-given-board-and-image"></a><span style="font-size:16px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Scheduling a suite for a given board and image</span></h4><span style="font-family:Arial;font-size:15px;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">We defined a new autotest RPC for this, with the following interface:</span></b><div class="sites-codeblock sites-codesnippet-block"><span style="background-color:transparent;vertical-align:baseline"><p><font face="Courier New"><span style="white-space:pre-wrap"><code>def create_suite_job(suite_name, board, build, pool, check_hosts=True,</code></span></font></p><p><font face="Courier New"><span style="white-space:pre-wrap"><code>                     num=None, file_bugs=False, timeout=24, timeout_mins=None,</code></span></font></p><p><font face="Courier New"><span style="white-space:pre-wrap"><code>                     priority=priorities.Priority.DEFAULT,</code></span></font></p><p><font face="Courier New"><span style="white-space:pre-wrap"><code>                     suite_args=None, wait_for_results=True):</code></span></font></p><p><font face="Courier New"><span style="white-space:pre-wrap"><code>    """</code></span></font></p><p><font face="Courier New"><span style="white-space:pre-wrap"><code>    Create a job to run a test suite on the given device with the given image.</code></span></font></p><p><font face="Courier New"><span style="white-space:pre-wrap"><code><br /></code></span></font></p><p><font face="Courier New"><span style="white-space:pre-wrap"><code>    When the timeout specified in the control file is reached, the</code></span></font></p><p><font face="Courier New"><span style="white-space:pre-wrap"><code>    job is guaranteed to have completed and results will be available.</code></span></font></p><p><font face="Courier New"><span style="white-space:pre-wrap"><br /></span></font></p><p><font face="Courier New"><span style="white-space:pre-wrap"><code>    @param suite_name: the test suite to run, e.g. 'bvt'.</code></span></font></p><p><font face="Courier New"><span style="white-space:pre-wrap"><code>    @param board: the kind of device to run the tests on.</code></span></font></p><p><font face="Courier New"><span style="white-space:pre-wrap"><code>    @param build: unique name by which to refer to the image from now on.</code></span></font></p><p><font face="Courier New"><span style="white-space:pre-wrap"><code>    @param pool: Specify the pool of machines to use for scheduling</code></span></font></p><p><font face="Courier New"><span style="white-space:pre-wrap"><code>            purposes.</code></span></font></p><p><font face="Courier New"><span style="white-space:pre-wrap"><code>    @param check_hosts: require appropriate live hosts to exist in the lab.</code></span></font></p><p><font face="Courier New"><span style="white-space:pre-wrap"><code>    @param num: Specify the number of machines to schedule across.</code></span></font></p><p><font face="Courier New"><span style="white-space:pre-wrap"><code>    @param file_bugs: File a bug on each test failure in this suite.</code></span></font></p><p><font color="#006000" face="monospace"><span style="white-space:pre-wrap">    @param timeout: The max lifetime of this suite, in hours.</span></font></p><p><font color="#006000" face="monospace"><span style="white-space:pre-wrap">    @param timeout_mins: The max lifetime of this suite, in minutes. Takes</span></font></p><p><font color="#006000" face="monospace"><span style="white-space:pre-wrap">                         priority over timeout.</span></font></p><p><font color="#006000" face="monospace"><span style="white-space:pre-wrap">    @param priority: Integer denoting priority. Higher is more important.</span></font></p><p><font color="#006000" face="monospace"><span style="white-space:pre-wrap">    @param suite_args: Optional arguments which will be parsed by the suite</span></font></p><p><font color="#006000" face="monospace"><span style="white-space:pre-wrap">                       control file. Used by control.test_that_wrapper to</span></font></p><p><font color="#006000" face="monospace"><span style="white-space:pre-wrap">                       determine which tests to run.</span></font></p><p><font color="#006000" face="monospace"><span style="white-space:pre-wrap">    @param wait_for_results: Set to False to run the suite job without waiting</span></font></p><p><font color="#006000" face="monospace"><span style="white-space:pre-wrap">                             for test jobs to finish. Default is True.</span></font></p><p><font face="Courier New"><span style="white-space:pre-wrap"><br /></span></font></p><p><font face="Courier New"><span style="white-space:pre-wrap"><code>    @raises ControlFileNotFound: if a unique suite control file doesn't exist.</code></span></font></p><p><font face="Courier New"><span style="white-space:pre-wrap"><code>    @raises NoControlFileList: if we can't list the control files at all.</code></span></font></p><p><font face="Courier New"><span style="white-space:pre-wrap"><code>    @raises StageBuildFailure: if the dev server throws 500 while staging build.</code></span></font></p><p><font face="Courier New"><span style="white-space:pre-wrap"><code>    @raises ControlFileEmpty: if the control file exists on the server, but</code></span></font></p><p><font face="Courier New"><span style="white-space:pre-wrap"><code>                              can't be read.</code></span></font></p><p><font face="Courier New"><span style="white-space:pre-wrap"><br /></span></font></p><p><font face="Courier New"><span style="white-space:pre-wrap"><code>    @return: the job ID of the suite; -1 on error.</code></span></font></p><p><font face="Courier New"><span style="white-space:pre-wrap"><code>    """</code></span></font></p><div style="font-family:Courier New;font-size:13px;font-weight:bold;white-space:pre-wrap"><br /></div></span></div><div><span style="background-color:transparent;font-size:medium"><h4 dir="ltr" style="font-family:Times New Roman;display:inline!important"><a name="TOC-1"></a><span style="font-size:16px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"><br /></span></h4></span></div><div><ul><li><span style="font-family:arial,sans-serif;background-color:transparent;font-size:15px;white-space:pre-wrap"><b>Change priority:</b> The arg priority is an integer denoting priority, used by our scheduler to decide how to prioritize jobs. You can find all valid priority options in autotest_lib.client.common_lib.priorities. Currently, the priority ladder looks like - Weekly &lt; Daily &lt;PostBuild &lt; Default &lt; Build &lt; PFQ &lt; CQ.</span></li><li><span style="background-color:transparent;font-size:15px;white-space:pre-wrap"><font face="arial, sans-serif"><b>Wait or not wait for results: </b>Use the arg wait_for_results=True/False to tell the suite job whether you want it to wait for all test jobs to finish or not. Not waiting for the results can reduce the load burden to our rpc server, so it is recommended whenever it is possible.</font></span><span style="background-color:transparent;font-size:medium"><font face="arial, sans-serif"><span style="font-size:15px;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> </span></font></span></li></ul></div><div><span style="background-color:transparent;font-size:medium"><h4 dir="ltr" style="font-family:Times New Roman;display:inline!important"><a name="TOC-2"></a><span style="font-size:16px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"><br /></span></h4></span></div><div><span style="background-color:transparent;font-size:medium"><h4 dir="ltr" style="font-family:Times New Roman;display:inline!important"><a name="TOC-Running-the-suite"></a><span style="font-size:16px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Running the suite</span></h4></span></div><b style="font-size:medium;font-weight:normal"><font face="arial, sans-serif"><span style="font-size:15px;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">create_suite_job() starts by telling the dev server to fetch the image to be tested, and its associated autotest bundle, from the URL provided.  </span><span style="font-size:15px;background-color:transparent;font-weight:bold;vertical-align:baseline;white-space:pre-wrap">Clients of autotest will no longer need to be aware of the dev server</span><span style="font-size:15px;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">.  The details of this may change going forward, but all this work will be handled by this RPC.  </span><br /><br /><span style="font-size:15px;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Once the image and autotest bundle are staged on dev server, it goes through all the control files associated with the build being tested, and schedule the proper jobs.  At that point, we let the autotest scheduler take responsibility for all the async scheduling/dependency scheduling. It is important that all jobs are scheduled via rpc calls with a name that associates them all together so that when we want to look at results we can aggregate them all in a query.  This will allow callers (like the buildbot-autotest connection) to poll for the status of all jobs kicked off by the BVT suite control file, and eventually find and gather up results for reporting purposes</span></font><br /><br /><br /></b></div></div></td></tr></tbody></table>
</div> 
</div> 
<div id="sites-canvas-bottom-panel">
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_page-subpages"> </div>
<div id="sites-attachments-container">
</div>
<a xmlns="http://www.w3.org/1999/xhtml" name="page-comments"></a>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_page-comments"><div class="sites-comment-docos-wrapper"><div class="sites-comment-docos"><div class="sites-comment-docos-background"></div><div class="sites-comment-docos-header"><div class="sites-comment-docos-header-title">Comments</div></div><div id="sites-comment-docos-pane" class="sites-comment-docos-pane"></div></div></div></div>
</div>
</div> 
</td> 
</tr>
</table> 
</div> 
</div> 
<div id="sites-chrome-footer-wrapper">
<div id="sites-chrome-footer-wrapper-inside">
<div id="sites-chrome-footer">
</div>
</div>
</div>
</div> 
</div> 
<div id="sites-chrome-adminfooter-container">
<div xmlns="http://www.w3.org/1999/xhtml" class="sites-adminfooter" role="navigation"><p><a class="sites-system-link" href="https://www.google.com/a/UniversalLogin?service=jotspot&amp;continue=https://sites.google.com/a/chromium.org/dev/chromium-os/testing/dynamic-test-suites">Sign in</a><span aria-hidden="true">|</span><a class="sites-system-link" href="../../system/app/pages/recentChanges.html">Recent Site Activity</a><span aria-hidden="true">|</span><a class="sites-system-link" href="../../system/app/pages/reportAbuse.html" target="_blank">Report Abuse</a><span aria-hidden="true">|</span><a class="sites-system-link" href="javascript:;" onclick="window.open(webspace.printUrl)">Print Page</a><span aria-hidden="true">|</span><span class="sites-system-link">Powered By</span> <b class="powered-by"><a href="http://sites.google.com">Google Sites</a></b></p></div>
</div>
</div> 
</div> 
<div id="sites-chrome-onebar-footer">
</div>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    window.jstiming.load.tick('sjl');
  </script>
<script xmlns="http://www.w3.org/1999/xhtml" src="https://ssl.gstatic.com/sites/p/56e332/system/js/jot_min_view__en.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    window.jstiming.load.tick('jl');
  </script>
<script xmlns="http://www.w3.org/1999/xhtml">
      
          sites.core.Analytics.createTracker();
          sites.core.Analytics.trackPageview();
        
    </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
                    sites.Searchbox.initialize(
                        'sites-searchbox-search-button',
                        {"object":[]}['object'],
                        'search-site',
                        {"label":"Configure search options...","url":"/system/app/pages/admin/settings"});
                  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
      gsites.HoverPopupMenu.createSiteDropdownMenus('sites-header-nav-dropdown', false);
    </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
            JOT_setupNav("7648876402527094", "Navigation", false);
            JOT_addListener('titleChange', 'JOT_NAVIGATION_titleChange', 'COMP_7648876402527094');
          </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
            JOT_setupNav("14720868319272995", "Quick links", false);
            JOT_addListener('titleChange', 'JOT_NAVIGATION_titleChange', 'COMP_14720868319272995');
          </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
            JOT_setupNav("19690813310444355", "Other sites", false);
            JOT_addListener('titleChange', 'JOT_NAVIGATION_titleChange', 'COMP_19690813310444355');
          </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
              new sites.CommentPane('//docs.google.com/comments/d/AAHRpnXvrAwjAfmld0ObrebBiGRq9Nfh9yryhsOEBD5HIsime1E_-Az2M7lQ7Kd93jDAeDCBHYZdccTlX__-gfWkm2b-dGS-3NypJ4yoYUSNPgn34-40UZTzSOYmjXGvPQVELgbdgxbIy/api/js?anon=true',
                  false, false);
            </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
  setTimeout(function() {
    var fingerprint = gsites.date.TimeZone.getFingerprint([]);
    gsites.Xhr.send('https://www.chromium.org/_/tz', null, null, 'GET', null, null, { afjstz: fingerprint });
  }, 500);
</script>
<script xmlns="http://www.w3.org/1999/xhtml">
                    window.onload = function() {
                      if (false) {
                        JOT_setMobilePreview();
                      }
                      var loadTimer = window.jstiming.load;
                      loadTimer.tick("ol");
                      loadTimer["name"] = "load," + webspace.page.type + ",user_page";
                      window.jstiming.report(loadTimer, {}, 'https://gg.google.com/csi');
                    }
                  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
        JOT_insertAnalyticsCode(false,
            false);
      </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    var maestroRunner = new gsites.pages.view.SitesMaestroRunner(
        webspace, "en");
    maestroRunner.initListeners();
    maestroRunner.installEditRender();
  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
  //<![CDATA[
    // Decorate any fastUI buttons on the page with a class of 'goog-button'.
    if (webspace.user.hasWriteAccess) {
      JOT_decorateButtons();
    }

    // Fires delayed events.
    (function() {
      JOT_fullyLoaded = true;
      var delayedEvents = JOT_delayedEvents;
      for (var x = 0; x < delayedEvents.length; x++) {
        var event = delayedEvents[x];
        JOT_postEvent(event.eventName, event.eventSrc, event.payload);
      }
      JOT_delayedEvents = null;
      JOT_postEvent('pageLoaded');
    })();
  //]]>
</script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    JOT_postEvent('decorateGvizCharts');
  </script>
<script type="text/javascript">
          JOT_setupPostRenderingManager();
        </script>
<script type="text/javascript">
          JOT_postEvent('renderPlus', null, 'sites-chrome-main');
        </script>
<div id="server-timer-div" style="display:none"> </div>
<script type="text/javascript">
          window.jstiming.load.tick('render');
          JOT_postEvent('usercontentrendered', this);
        </script>
</body>
</html>
