<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/WebPage">
<head>
<meta http-equiv="X-UA-Compatible" content="chrome=1" />
<script type="text/javascript">/* Copyright 2008 Google. */ (function() { var e="wtsrt_",g="tbsd_",h="tbnd_",k="start",l="_wtsrt",m="_tbnd",n="CSI/";(function(){function f(a){this.t={};this.tick=function(a,c,b){this.t[a]=[void 0!=b?b:(new Date).getTime(),c];if(void 0==b)try{window.console.timeStamp(n+a)}catch(d){}};this.tick(k,null,a)}var a;window.performance&&(a=window.performance.timing);var p=a?new f(a.responseStart):new f;window.jstiming={Timer:f,load:p};if(a){var c=a.navigationStart,d=a.responseStart;0<c&&d>=c&&(window.jstiming.srt=d-c)}if(a){var b=window.jstiming.load;0<c&&d>=c&&(b.tick(l,void 0,c),b.tick(e,l,d),b.tick(g,e))}try{a=null,
window.chrome&&window.chrome.csi&&(a=Math.floor(window.chrome.csi().pageT),b&&0<c&&(b.tick(m,void 0,window.chrome.csi().startE),b.tick(h,m,c))),null==a&&window.gtbExternal&&(a=window.gtbExternal.pageT()),null==a&&window.external&&(a=window.external.pageT,b&&0<c&&(b.tick(m,void 0,window.external.startE),b.tick(h,m,c))),a&&(window.jstiming.pt=a)}catch(q){}})(); })()
</script>
<link rel="shortcut icon" href="../../_/rsrc/1354323194313/favicon.ico" type="image/x-icon" />
<link rel="apple-touch-icon" href="https://ssl.gstatic.com/sites/p/56e332/system/app/images/apple-touch-icon.png" type="image/png" />
<script type="text/javascript">/* Copyright 2008 Google. */ (function() { var d="",g="__duration__",h="function";function k(c){return document.getElementById(c)}window.byId=k;function l(c){return c.replace(/^\s+|\s+$/g,d)}window.trim=l;var m=[],n=0;window.JOT_addListener=function(c,a,b){var e=new String(n++);c={eventName:c,handler:a,compId:b,key:e};m.push(c);return e};window.JOT_removeListenerByKey=function(c){for(var a=0;a<m.length;a++)if(m[a].key==c){m.splice(a,1);break}};
window.JOT_removeAllListenersForName=function(c){for(var a=0;a<m.length;a++)m[a].eventName==c&&m.splice(a,1)};window.JOT_postEvent=function(c,a,b){var e={eventName:c,eventSrc:a||{},payload:b||{}};if(window.JOT_fullyLoaded)for(a=m.length,b=0;b<a&&b<m.length;b++){var f=m[b];f&&f.eventName==c&&(e.listenerCompId=f.compId||d,(f=typeof f.handler==h?f.handler:window[f.handler])&&f(e))}else window.JOT_delayedEvents.push({eventName:c,eventSrc:a,payload:b})};window.JOT_delayedEvents=[];
window.JOT_fullyLoaded=!1;window.JOT_formatRelativeToNow=function(c,a){var b=((new Date).getTime()-c)/6E4;if(1440<=b||0>b)return null;var e=0;60<=b&&(b/=60,e=2);2<=b&&e++;return a?window.JOT_siteRelTimeStrs[e].replace(g,Math.floor(b)):window.JOT_userRelTimeStrs[e].replace(g,Math.floor(b))}; })()
</script>
<script>

  

  var breadcrumbs = [{"path":"/chromium-os","deleted":false,"title":"Chromium OS","dir":"ltr"},{"path":"/chromium-os/ec-development","deleted":false,"title":"Chromium Embedded Controller (EC) Development","dir":"ltr"},{"path":"/chromium-os/ec-development/ec-image-geometry-spec","deleted":false,"title":"EC Image Geometry Spec","dir":"ltr"}];
  var JOT_clearDotPath = 'https://ssl.gstatic.com/sites/p/56e332/system/app/images/cleardot.gif';

  
  var JOT_userRelTimeStrs = ["a minute ago","__duration__ minutes ago","an hour ago","__duration__ hours ago"];

  
  

  

  var webspace = {"enableAnalytics":true,"pageSharingId":"jotspot_page","enableUniversalAnalytics":false,"sharingPolicy":"OPENED_WITH_INDICATOR","siteTitle":"The Chromium Projects","isStartPageEnabled":true,"adsensePublisherId":null,"features":{"languageSelectDefaultTextSetToDefault":true,"validateClientGvizDataSourceUrls":true,"moreMobileStyleImprovements":true,"newInsertMenuIcons":true,"accessibleSortingButtons":true,"domainAnalyticsInGAOnly":true,"noCaptcha":true,"fileCabinetScreenReaderFix":true,"updatedTosAndPrivacyLinks":null,"pageDrafts":false,"mobileOrientationFix":true,"plusBadge":false,"pdfEmbedSupport":false,"jsClickFix":true},"isPublic":true,"isConsumer":false,"serverFlags":{"cajaBaseUrl":"//www.gstatic.com/caja","cajaDebugMode":false},"onepickBaseUrl":"https://docs.google.com","domainAnalyticsAccountId":"","plusPageId":"","signInUrl":"https://www.google.com/a/SelectSession?continue\u003dhttps://sites.google.com/a/chromium.org/dev/chromium-os/ec-development/ec-image-geometry-spec\u0026service\u003djotspot","analyticsAccountId":"UA-5484340-1","scottyUrl":"/_/upload","homePath":"/","siteNoticeUrlEnabled":null,"plusPageUrl":"","adsensePromoClickedOrSiteIneligible":true,"csiReportUri":"https://gg.google.com/csi","sharingId":"jotspot","termsUrl":"//www.google.com/intl/en/policies/terms/","gvizVersion":1,"editorResources":{"sitelayout":["https://ssl.gstatic.com/sites/p/56e332/system/app/css/sitelayouteditor.css"],"text":["https://ssl.gstatic.com/sites/p/56e332/system/js/codemirror.js","https://ssl.gstatic.com/sites/p/56e332/system/app/css/codemirror_css.css","https://ssl.gstatic.com/sites/p/56e332/system/js/trog_edit__en.js","https://ssl.gstatic.com/sites/p/56e332/system/app/css/trogedit.css","/_/rsrc/1441580320000/system/app/css/editor.css","https://ssl.gstatic.com/sites/p/56e332/system/app/css/codeeditor.css","/_/rsrc/1441580320000/system/app/css/camelot/editor-jfk-wlb.css"]},"sharingUrlPrefix":"/_/sharing","isAdsenseEnabled":true,"domain":"chromium.org","baseUri":"","name":"dev","siteTemplateId":false,"siteNoticeRevision":null,"siteNoticeUrlAddress":null,"siteNoticeMessage":null,"page":{"isRtlLocale":false,"canDeleteWebspace":null,"isPageDraft":null,"parentPath":"/chromium-os/ec-development","parentWuid":"wuid:gx:3ac9dfd5b19509d3","siteLocale":"en","timeZone":"America/Los_Angeles","type":"text","title":"EC Image Geometry Spec","locale":"en","wuid":"wuid:gx:566b6f21eac2d876","revision":10,"path":"/chromium-os/ec-development/ec-image-geometry-spec","isSiteRtlLocale":false,"pageInheritsPermissions":null,"name":"ec-image-geometry-spec","canChangePath":true,"state":"","properties":{},"bidiEnabled":false,"currentTemplate":{"path":"/system/app/pagetemplates/text","title":"Web Page"}},"canPublishScriptToAnyone":true,"user":{"keyboardShortcuts":true,"sessionIndex":"","guest_":true,"displayNameOrEmail":"guest","userName":"guest","uid":"","renderMobile":false,"domain":"","namespace":"","hasWriteAccess":false,"namespaceUser":false,"primaryEmail":"guest","hasAdminAccess":false},"gadgets":{"baseUri":"/system/app/pages/gadgets"}};
  webspace.page.breadcrumbs = breadcrumbs;

  
  var JOT_siteRelTimeStrs = ["a minute ago","__duration__ minutes ago","an hour ago","__duration__ hours ago"];

</script>
<script type="text/javascript">
                window.jstiming.load.tick('scl');
              </script>
<meta name="title" content="EC Image Geometry Spec - The Chromium Projects" />
<meta itemprop="name" content="EC Image Geometry Spec - The Chromium Projects" />
<meta property="og:title" content="EC Image Geometry Spec - The Chromium Projects" />
<meta name="description" content="Home of the Chromium Open Source Project" />
<meta itemprop="description" content="Home of the Chromium Open Source Project" />
<meta id="meta-tag-description" property="og:description" content="Home of the Chromium Open Source Project" />
<style type="text/css">
</style>
<link rel="stylesheet" type="text/css" href="https://ssl.gstatic.com/sites/p/56e332/system/app/themes/beigeandblue/standard-css-beigeandblue-ltr-ltr.css" />
<link rel="stylesheet" type="text/css" href="../../_/rsrc/1441580320000/system/app/css/overlay.css%3Fcb=beigeandblueundefineda100%2525%2525150goog-ws-leftthemedefaultstandard.css" />
<link rel="stylesheet" type="text/css" href="../../_/rsrc/1441580320000/system/app/css/camelot/allthemes-view.css" />
<!--[if IE]>
          <link rel="stylesheet" type="text/css" href="/system/app/css/camelot/allthemes%2die.css" />
        <![endif]-->
<title>EC Image Geometry Spec - The Chromium Projects</title>
<meta itemprop="image" content="https://www.chromium.org/_/rsrc/1442968224934/chromium-os/ec-development/ec-image-geometry-spec/storage2.png" />
<meta property="og:image" content="https://www.chromium.org/_/rsrc/1442968224934/chromium-os/ec-development/ec-image-geometry-spec/storage2.png" />
<script type="text/javascript">
                window.jstiming.load.tick('cl');
              </script>
</head>
<body xmlns="http://www.google.com/ns/jotspot" id="body" class=" en            ">
<div id="sites-page-toolbar" class="sites-header-divider">
<div xmlns="http://www.w3.org/1999/xhtml" id="sites-status" class="sites-status" style="display:none;"><div id="sites-notice" class="sites-notice" role="status" aria-live="assertive"> </div></div>
</div>
<div id="sites-chrome-everything-scrollbar">
<div id="sites-chrome-everything" class="">
<div id="sites-chrome-page-wrapper" style="direction: ltr">
<div id="sites-chrome-page-wrapper-inside">
<div xmlns="http://www.w3.org/1999/xhtml" id="sites-chrome-header-wrapper" style="height:auto;">
<table id="sites-chrome-header" class="sites-layout-hbox" cellspacing="0" style="height:auto;">
<tr class="sites-header-primary-row" id="sites-chrome-userheader">
<td id="sites-header-title" class="" role="banner"><div class="sites-header-cell-buffer-wrapper"><a href="../../index.html" id="sites-chrome-userheader-logo"><img id="logo-img-id" src="../../_/rsrc/1438879449147/config/customLogo.gif%3Frevision=3" alt="The Chromium Projects" class="sites-logo  " /></a><h2><a href="../../index.html" dir="ltr" id="sites-chrome-userheader-title">The Chromium Projects</a></h2></div></td><td class="sites-layout-searchbox  "><div class="sites-header-cell-buffer-wrapper"><form id="sites-searchbox-form" action="https://www.chromium.org/system/app/pages/search" role="search"><input type="hidden" id="sites-searchbox-scope" name="scope" value="search-site" /><input type="text" id="jot-ui-searchInput" name="q" size="20" value="" aria-label="Search this site" /><div id="sites-searchbox-button-set" class="goog-inline-block"><div role="button" id="sites-searchbox-search-button" class="goog-inline-block jfk-button jfk-button-standard" tabindex="0">Search this site</div></div></form></div></td>
</tr>
<tr class="sites-header-secondary-row" id="sites-chrome-horizontal-nav">
<td colspan="2" id="sites-chrome-header-horizontal-nav-container" role="navigation">
</td>
</tr>
</table>
</div>
<div id="sites-chrome-main-wrapper">
<div id="sites-chrome-main-wrapper-inside">
<table id="sites-chrome-main" class="sites-layout-hbox" cellspacing="0" cellpadding="{scmCellpadding}" border="0">
<tr>
<td id="sites-chrome-sidebar-left" class="sites-layout-sidebar-left initial" style="width:150px">
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_7648876402527094" class="sites-embed" role="navigation"><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotId="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="../../chromium-projects.html" jotId="wuid:gx:10ae433dadbbab13" class="sites-navigation-link">Home</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="../../Home.1.html" jotId="wuid:gx:43582b9d2029d3af" class="sites-navigation-link">Chromium</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="../../chromium-os.1.html" jotId="wuid:gx:83df2ab1f8880ba" class="sites-navigation-link">Chromium OS</a></div></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_14720868319272995" class="sites-embed" role="navigation"><h4 class="sites-embed-title">Quick links</h4><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotId="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="../../for-testers/bug-reporting-guidelines.html" class="sites-navigation-link">Report bugs</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="../../developers/discussion-groups.html" class="sites-navigation-link">Discuss</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="../../system/app/pages/sitemap/hierarchy.html" jotId="wuid:gx:4b58a9a350ad12f" class="sites-navigation-link">网站地图</a></div></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_19690813310444355" class="sites-embed" role="navigation"><h4 class="sites-embed-title">Other sites</h4><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotId="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="http://blog.chromium.org/" class="sites-navigation-link">Chromium Blog</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="http://code.google.com/chrome/extensions/" class="sites-navigation-link">Google Chrome Extensions</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="https://developers.google.com/chrome/chrome-frame/" class="sites-navigation-link">Google Chrome Frame</a></div></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_19695218559354544" class="sites-embed" role="complementary"><h4 class="sites-embed-title"></h4><div class="sites-embed-content sites-embed-content-sidebar-textbox"><div dir="ltr"><span style="font-size:x-small">Except as otherwise </span><a href="http://developers.google.com/site-policies.html#restrictions"><span style="font-size:x-small">noted</span></a><span style="font-size:x-small">, the content of this page is licensed under a </span><a href="http://creativecommons.org/licenses/by/2.5/"><span style="font-size:x-small">Creative Commons Attribution 2.5 license</span></a><span style="font-size:x-small">, and examples are licensed under the </span><a href="http://src.chromium.org/viewvc/chrome/trunk/src/LICENSE" target="_blank"><span style="font-size:x-small">BSD License</span></a><span style="font-size:x-small">.<br /></span></div></div></div>
</td>
<td id="sites-canvas-wrapper">
<div id="sites-canvas" role="main">
<div id="goog-ws-editor-toolbar-container"> </div>
<div xmlns="http://www.w3.org/1999/xhtml" id="title-crumbs" style="">
<A href="../../chromium-os.1.html" dir="ltr">Chromium OS</A>‎ &gt; ‎<A href="../ec-development.1.html" dir="ltr">Chromium Embedded Controller (EC) Development</A>‎ &gt; ‎
  </div>
<h3 xmlns="http://www.w3.org/1999/xhtml" id="sites-page-title-header" style="" align="left">
<span id="sites-page-title" dir="ltr" tabindex="-1" style="outline: none">EC Image Geometry Spec</span>
</h3>
<div id="sites-canvas-main" class="sites-canvas-main">
<div id="sites-canvas-main-content">
<table xmlns="http://www.w3.org/1999/xhtml" cellspacing="0" class="sites-layout-name-one-column sites-layout-hbox"><tbody><tr><td class="sites-layout-tile sites-tile-name-content-1"><div dir="ltr"><p><span style="background-color:transparent"><font size="5"><b>Introduction</b></font></span></p>
<p>The EC codebase currently supports the following chips:</p>
<p>lm4, stm32: Internal memory-mapped flash storage</p><p>cr50: Internal memory-mapped flash storage, with image signature preceding RO image</p>
<p>npcx: External memory-mapped flash storage dedicated for EC, code copied to
SRAM before execution</p>
<p>mec1322: External unmapped flash storage dedicated for EC, code is copied to
SRAM before execution</p>
<p>For memory-mapped flash storage, contents are read from a chip-defined region
in memory. Contents are written though SPI commands. For unmapped flash
storage, contents are read and written through SPI commands.</p>
<p>There is currently no support in the codebase for shared external storage, but
we’d like to support it in the near future.</p>
<p>With three different storage categories supported, there is a lack of
uniformity within our code base. Certain geometry CONFIGs (ex.
CONFIG_FLASH_BASE, which originated when we had only internal memory-mapped
flash) no longer have meanings consistent with names. In other cases (ex.
CONFIG_CDRAM_BASE) the meaning of CONFIGs are too narrow and can be more
broadly defined among all three categories. In addition, a few CONFIGs (ex.
CONFIG_RO_MEM_OFF) no longer have any consistent meaning at all. This
discontinuity makes it extremely difficult to change higher-level code without
breaking one or more chip categories, or writing separate code to accommodate
corner-cases for each category.</p>
<p>The goal of the changes described here is to make our CONFIGs uniform and
understandable among all chip categories.</p>
<ul>
<li> CONFIGs will be defined and clearly described here for programmer reference.
  </li><li> Modifying higher-level code that touches image geometry will become much less
painful since all CONFIGs will have clear and consistent meaning.
  </li><li> Bringing up new chips will be simplified since our clear and consistent CONFIGs
can be followed.
</li></ul>
<h1><a name="TOC-Supported-Configurations"></a>Supported Configurations</h1>
<p>With the changes proposed here, we aim to support ECs with the following
configurations:</p>
<ul>
<li> Internal mapped storage
  </li><li> External mapped storage (shared or dedicated)
  </li><li> External unmapped storage (shared or dedicated)
  </li><li> Code executed directly from mapped storage
  </li><li> Code copied to SRAM before use
</li></ul>
<ul>
<li> One RO EC image
  </li><li> One contiguous region of storage belonging to the EC, containing the RO EC
image, that can be write protected
  </li><li> Up to one RW EC image
  </li><li> Up to one contiguous region of storage belonging to the EC, containing the RW
EC image, that will not be write protected
  </li><li> Support for any number of chip-specific non-image data pieces (<em>NIDs</em>) as part of the storage regions (loaders, headers, etc - any piece of data on
EC storage that isn’t part of the RO or RW image)
  </li><li> Write protected and writable EC storage regions need not be mutually contiguous
</li></ul>
<h1><a name="TOC-Chip-Definition-CONFIGs"></a>Chip Definition CONFIGs</h1><div><div style="text-align:center;display:block"><a href="ec-image-geometry-spec/storage2.png%3Fattredirects=0" imageanchor="1"><img border="0" src="../../_/rsrc/1442968224934/chromium-os/ec-development/ec-image-geometry-spec/storage2.png" /></a></div><br /></div>
<p>The following CONFIGs are defined entirely based upon chip architecture with no
flexibility to change them based upon image / loader arrangement.</p>
<p>CONFIG_INTERNAL_STORAGE - Indicates that chip uses internal storage</p>
<p>CONFIG_EXTERNAL_STORAGE - Indicates that chip uses external storage</p>
<p>CONFIG_MAPPED_STORAGE - Indicates that storage is mapped into the EC's address
space</p>
<p><font color="#cccccc">CONFIG_CDRAM_ARCH and CONFIG_FLASH_MAPPED previously encompassed these defines.</font></p>
<p>CONFIG_PROGRAM_MEMORY_BASE - Base address of program memory</p>
<p>CONFIG_MAPPED_STORAGE_BASE - Base address of memory-mapped flash storage (if
present)</p>
<p><font color="#cccccc">CONFIG_FLASH_BASE and CONFIG_CDRAM_BASE previously encompassed these defines.</font></p>
<p>Examples:</p>
<p>lm4 will define CONFIG_INTERNAL_STORAGE and CONFIG_MAPPED_STORAGE, and set
CONFIG_PROGRAM_MEMORY_BASE = CONFIG_MAPPED_STORAGE_BASE = 0.</p>
<pre><div class="sites-codeblock sites-codesnippet-block"><code>/* Internal, mapped storage */
#define CONFIG_INTERNAL_STORAGE
#define CONFIG_MAPPED_STORAGE

/* Program is directly run from storage */
#define CONFIG_PROGRAM_MEMORY_BASE 0
#define CONFIG_MAPPED_STORAGE_BASE 0</code></div>
</pre>
<p style="font-size:13.3333330154419px">cr50 will define CONFIG_INTERNAL_STORAGE and CONFIG_MAPPED_STORAGE, and set CONFIG_PROGRAM_MEMORY_BASE = CONFIG_MAPPED_STORAGE_BASE = 0x40000.</p><pre style="font-size:13.3333330154419px"><div class="sites-codeblock sites-codesnippet-block"><code>/* Internal, mapped storage */
#define CONFIG_INTERNAL_STORAGE
#define CONFIG_MAPPED_STORAGE

/* Program is directly run from storage */
#define CONFIG_PROGRAM_MEMORY_BASE 0x40000
#define CONFIG_MAPPED_STORAGE_BASE 0x40000</code></div><div><code><br /></code></div></pre><p>npcx will define CONFIG_EXTERNAL_STORAGE and CONFIG_MAPPED_STORAGE, and set
CONFIG_PROGRAM_MEMORY_BASE = 0x10088000, CONFIG_MAPPED_STORAGE_BASE =
0x64000000.</p>
<pre><div class="sites-codeblock sites-codesnippet-block"><code>/* External, mapped storage */
#define CONFIG_EXTERNAL_STORAGE
#define CONFIG_MAPPED_STORAGE

/* Storage is memory-mapped, but program runs from SRAM */
#define CONFIG_PROGRAM_MEMORY_BASE 0x10088000
#define CONFIG_MAPPED_STORAGE_BASE 0x64000000</code></div>

</pre>
<p>mec1322 will define CONFIG_EXTERNAL_STORAGE, and set CONFIG_PROGRAM_MEMORY_BASE
= 0x100000. CONFIG_MAPPED_STORAGE_BASE will not be defined, since storage is
not memory mapped.</p>
<div class="sites-codeblock sites-codesnippet-block"><pre><code>/* External storage */
#define CONFIG_EXTERNAL_STORAGE

/* Program memory in SRAM */
#define CONFIG_PROGRAM_MEMORY_BASE 0x100000

/* Storage is not memory mapped */
#undef CONFIG_MAPPED_STORAGE
#undef CONFIG_MAPPED_STORAGE_BASE
</code></pre>
</div>Layout / Geometry Configs


<p>The following configs represent the Chrome EC implementation for a given chip
and will normally be defined at the chip-level. There is flexibility to change
these configs based upon needs. For example, the RO image on storage could
reside at the beginning or the end of storage, based upon protection
capabilities. Image sizes could grow or shrink if program memory space is
dedicated to a loader.</p>
<p>Since external storage may be shared between the EC and the AP, only a certain
region of storage may “belong” to the EC.</p>
<p>-------------------------------------</p>
<p><font color="#9900ff">Color</font> <font color="#ff0000">coding</font> <font color="#0000ff">key</font>:</p>
<p><font color="#9900ff">Relative to address zero / beginning of external storage</font><font color="#00ff00">.</font></p>
<p><font color="#ff0000">Relative to CONFIG_PROGRAM_MEMORY_BASE.</font></p>
<p><font color="#0000ff">Relative to CONFIG_PROTECTED_STORAGE_OFF.</font></p>
<p><font color="#ff00ff">Relative to CONFIG_WRITABLE_STORAGE_OFF.</font></p>
<p>-------------------------------------</p>
<p><font color="#9900ff">CONFIG_EC_PROTECTED_STORAGE_OFF</font> - Offset of protected region of storage
belonging to the EC.</p>
<p>CONFIG_EC_PROTECTED_STORAGE_SIZE - Size of protected region of storage
belonging to the EC.</p>
<p><font color="#9900ff">CONFIG_EC_WRITABLE_STORAGE_OFF</font> - Offset of the writable region of storage (the
region that will be field auto-updated, when write protection is enabled)
belonging to the EC.</p>
<p>CONFIG_EC_WRITABLE_STORAGE_SIZE - Size of the writable region of storage
belonging to the EC.</p>
<p><font color="#cccccc">CONFIG_FLASH_BASE_SPI was previously used to indicate the offset to storage
region belonging to EC. We now need multiple defines, because we can no longer
assume that there is one contiguous region of storage that belongs to the EC.</font></p>
<p><font color="#ff0000">CONFIG_RO_MEM_OFF</font> - RO image offset in program memory, when loaded.</p>
<p><font color="#0000ff">CONFIG_RO_STORAGE_OFF</font> - RO image offset on storage, relative to the start of
the EC protected storage region.</p>
<p>CONFIG_RO_SIZE - Size of RO image (in both program memory and storage).</p>
<p><font color="#ff0000">CONFIG_RW_MEM_OFF</font> - RW image offset in program memory, when loaded.</p>
<p><font color="#ff00ff">CONFIG_RW_STORAGE_OFF</font> - RW image offset on storage, relative to the start of
the EC writable storage region.</p>
<p>CONFIG_RW_SIZE - Size of RW image (in both program memory and storage).</p>
<p><font color="#9900ff">CONFIG_WP_STORAGE_OFF</font> - Start of write protect region (the region that will be
write protected, when write protection is enabled) on EC storage. This may
exceed CONFIG_EC_PROTECTED_STORAGE_OFF if more than just the region belonging
to the EC must be protected.</p>
<p>CONFIG_WP_STORAGE_SIZE - Size of write protect region on EC storage. This may
be greater than CONFIG_EC_PROTECTED_STORAGE_SIZE for the same reason.</p>
<p><font color="#cccccc">CONFIG_FW_R*_OFF, CONFIG_FW_R*_SPI_OFF and CONFIG_FW_R*_SIZE previously
encompassed these defines.</font></p>
<p>Example:</p>
<p><span><span style="font-size:14.6666666666667px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent"><img alt="lm4.png" height="317px;" src="https://lh3.googleusercontent.com/GtIICh7nWQFutGqAKRwZPOHKW15XMxUcj0OxydmlFDgwHPG-sp1tORd5aa2jDqccqTVoYMmB4pvPeHILgNdETa-Ayle6aBcCJk5TRmTair12eYUIKokrlKwCI_H8g4xf3HhuzYI" style="border:none;display:block;margin-right:auto;margin-left:auto;text-align:center" width="507px;" /></span></span></p><p>lm4:</p>
<pre><div class="sites-codeblock sites-codesnippet-block"><code>/* Protected region is first half, followed by writable */
#define CONFIG_EC_PROTECTED_STORAGE_OFF 0
#define CONFIG_EC_PROTECTED_STORAGE_SIZE 0x20000
#define CONFIG_EC_WRITABLE_STORAGE_OFF 0x20000
#define CONFIG_EC_WRITABLE_STORAGE_SIZE 0x20000

/* RO image fills protected region, less pstate at end */
#define CONFIG_RO_MEM_OFF 0
#define CONFIG_RO_STORAGE_OFF 0
#define CONFIG_RO_SIZE (0x20000 - PSTATE_SIZE)

/* RW image fills writable region */
#define CONFIG_RW_MEM_OFF 0x20000
#define CONFIG_RW_STORAGE_OFF 0
#define CONFIG_RW_SIZE 0x20000

/* Protect first half of storage: RO image + pstate */
#define CONFIG_WP_STORAGE_OFF 0
#define CONFIG_WP_STORAGE_SIZE 0x20000</code></div><span><div style="font-family:Arial;font-size:14.6666666666667px;line-height:1.38;white-space:pre-wrap;display:block;text-align:center;margin-right:auto;margin-left:auto"><br /></div><div style="font-family:Arial;font-size:14.6666666666667px;line-height:1.38;white-space:pre-wrap;display:block;text-align:center;margin-right:auto;margin-left:auto"><a href="ec-image-geometry-spec/cr50.png%3Fattredirects=0" imageanchor="1"><img border="0" src="../../_/rsrc/1441138094167/chromium-os/ec-development/ec-image-geometry-spec/cr50.png" /></a></div><div style="font-family:Arial;font-size:14.6666666666667px;line-height:1.38;white-space:pre-wrap;display:block;text-align:center;margin-right:auto;margin-left:auto"><br /></div></span><p style="font-family:Arial,Verdana,sans-serif;font-size:13.3333330154419px;white-space:normal">cr50:</p><div class="sites-codeblock sites-codesnippet-block"><font color="#006000">/* Protected region is first half, followed by writable */
#define CONFIG_EC_PROTECTED_STORAGE_OFF 0
#define CONFIG_EC_PROTECTED_STORAGE_SIZE 0x20000
#define CONFIG_EC_WRITABLE_STORAGE_OFF 0x20000
#define CONFIG_EC_WRITABLE_STORAGE_SIZE 0x20000

/* Signature is first 1024 bytes of protected region */
#define SIG_STORAGE_OFF 0 /* Not a globally defined config */
#define SIG_SIZE 1024 /* Not a globally defined config */

/* RO image fills remainder protected region, less pstate at end */
#define CONFIG_RO_MEM_OFF SIG_SIZE
#define CONFIG_RO_STORAGE_OFF SIG_SIZE
#define CONFIG_RO_SIZE (0x20000 - SIG_SIZE - PSTATE_SIZE)

/* RW image fills writable region */
#define CONFIG_RW_MEM_OFF 0x20000
#define CONFIG_RW_STORAGE_OFF 0
#define CONFIG_RW_SIZE 0x20000

/* Protect first half of storage: sig + RO image + pstate */
#define CONFIG_WP_STORAGE_OFF CONFIG_EC_PROTECTED_STORAGE_OFF
#define CONFIG_WP_STORAGE_SIZE CONFIG_EC_PROTECTED_STORAGE_SIZ</font></div><div style="font-family:Arial;font-size:14.6666666666667px;line-height:1.38;white-space:pre-wrap;text-align:center;margin-right:auto;margin-left:auto"><br /></div><p dir="ltr" style="line-height:1.38;margin-top:0pt;margin-bottom:0pt;text-align:center"><span style="font-size:14.6666666666667px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent"><img alt="mec1322_storage.png" height="273px;" src="https://lh4.googleusercontent.com/nXQXaXn8UaC_gUB-JGk_vuje4hwOevjlnu1M5jhzltfsYyE0hvN_3xKRSBT-SNL_smeF-IB6LgEpbjU2bXvHgSusY666rHp5IS70KYWRLblQ2F0RFzJFEsxyq2G1tTI2rB3Sr2U" style="border:none;display:block;margin-right:auto;text-align:center;margin-left:auto" width="579px;" /></span></p><span style="font-size:14.6666666666667px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent"><img alt="mec1322_program_memory.png" height="236px;" src="https://lh6.googleusercontent.com/dOVZvS9j3m23lCmKvRPMoAUpDx9X0WWj5i4X4sx9tVFUHLbsxJypKpwms-4kehSnnJxI63s2aKMYxoekijpP1eL3w9Ux6ZwhFoksdvj0qbOHh3JUlZO2t9FMdeMg7pKKKZklRLc" style="border:none;display:block;margin-right:auto;margin-left:auto;text-align:center" width="513px;" /></span>
</pre>
<p>mec1322 (cyan):</p>
<pre><div class="sites-codeblock sites-codesnippet-block"><code>/* External unmapped storage, only second half belongs to EC */
/* RW EC region followed by RO EC region */
#define EC_STORAGE_START 0x40000 /* Not a globally defined config */
#define CONFIG_EC_PROTECTED_STORAGE_OFF EC_STORAGE_START + 0x20000
#define CONFIG_EC_PROTECTED_STORAGE_SIZE 0x20000
#define CONFIG_EC_WRITABLE_STORAGE_OFF EC_STORAGE_START
#define CONFIG_EC_WRITABLE_STORAGE_SIZE 0x20000

/* Loader lives at beginning of program memory */
#define CONFIG_RO_MEM_OFF (0 + LOADER_SIZE)
/* RO image resides after loader in protected EC storage region */
#define CONFIG_RO_STORAGE_OFF (0 + LOADER_SIZE)
/* Image size is 96k minus loader, bounded by program memory */
#define CONFIG_RO_SIZE (1024 * 96 - LOADER_SIZE)

/* RW image lives at same program memory location as RO */
#define CONFIG_RW_MEM_OFF (0 + LOADER_SIZE)
/* RW image resides at beginning of writable EC storage region */
#define CONFIG_RW_STORAGE_OFF 0
#define CONFIG_RW_SIZE (1024 * 96 - LOADER_SIZE)

/* WP region corresponds to EC protected storage region */
#define CONFIG_WP_STORAGE_OFF CONFIG_EC_PROTECTED_STORAGE_OFF
#define CONFIG_WP_STORAGE_SIZE CONFIG_EC_PROTECTED_STORAGE_SIZE</code></div><span><p dir="ltr" style="line-height:1.38;margin-top:0pt;margin-bottom:0pt;text-align:center"><span style="font-size:14.6666666666667px;font-family:Courier New;vertical-align:baseline;white-space:pre-wrap;background-color:transparent"><img height="167px;" src="https://lh4.googleusercontent.com/NuXt7Tq-8pzO_pLLyZ-_Drf1VbRnimdPBKuFJGvoBwUorNeqgZ7NPUIl-SbqXqeQaYqsyChFn3xw6_YmO5fpdiXXus_4b1ibKn6JuhGnfRH3GSb33IBhgqs-YJdWWxh7LB3QeYE" style="border:none" width="553px;" /></span></p><span style="font-size:14.6666666666667px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent"><img height="139px;" src="https://lh5.googleusercontent.com/EuHdkHp1XBXK1yCWL9ogJrZJkXjzLrK3tLORPPXP3CWFezWL3t8B4l1SnA24Hvtx4a-MFHsJPnL_yQJd5OiKzqMTSppt8wpRpMRpGRsdKmwSdEbnO_-YJv7MfP6FT9T0qvZtk0Y" style="border:none;display:block;margin-right:auto;margin-left:auto;text-align:center" width="342px;" /></span></span><p style="color:red"><span style="color:rgb(0,0,0);font-family:Arial,Verdana,sans-serif;font-size:10pt;background-color:transparent">npcx (npcx_evb):</span></p></pre>
<pre><div class="sites-codeblock sites-codesnippet-block"><code>/* External mapped storage, only first half belongs to EC */
/* RO EC region followed by RW EC region */
#define EC_STORAGE_START 0 
#define CONFIG_EC_PROTECTED_STORAGE_OFF EC_STORAGE_START
#define CONFIG_EC_PROTECTED_STORAGE_SIZE 0x20000
#define CONFIG_EC_WRITABLE_STORAGE_OFF EC_STORAGE_START + 0x20000
#define CONFIG_EC_WRITABLE_STORAGE_SIZE 0x20000

/* RO image will reside at beginning of program memory */
#define CONFIG_RO_MEM_OFF 0
/* RO image resides after loader in protected EC storage region */
#define CONFIG_RO_STORAGE_OFF (0 + CONFIG_BOOTHEADER_SIZE)
/* Image size is 96k minus header, bounded by program memory */
#define CONFIG_RO_SIZE (1024 * 96 - CONFIG_BOOTHEADER_SIZE)

/* RW image lives at same program memory location as RO */
#define CONFIG_RW_MEM_OFF 0
/* RW image resides at beginning of writable EC storage region */
#define CONFIG_RW_STORAGE_OFF 0
#define CONFIG_RW_SIZE (1024 * 96)

/* WP region corresponds to EC protected storage region */
#define CONFIG_WP_STORAGE_OFF CONFIG_EC_PROTECTED_STORAGE_OFF
#define CONFIG_WP_STORAGE_SIZE CONFIG_EC_PROTECTED_STORAGE_SIZE</code></div><span><span style="font-size:14.6666666666667px;font-family:Courier New;vertical-align:baseline;white-space:pre-wrap;background-color:transparent"><img alt="SharedSpi.png" height="360px;" src="https://lh4.googleusercontent.com/qtVOKTuf4Irw2bpitHmMFzINVKkA54Xfsmb6terAPANSs0MmUUeVQraK3zWbhG_HG6ZgyvVBaEs9I-o3GItjGAceqpz_LOv0ksMxIlME9_F___QJZr5kWxhQPYEQm8ohBNH-2O4" style="border:none;display:block;margin-right:auto;margin-left:auto;text-align:center" width="624px;" /></span></span></pre><pre><span style="font-family:Arial,Verdana,sans-serif;font-size:10pt;background-color:transparent">Hypothetical shared SPI platform (see Appendix):</span>
</pre>
<pre><div class="sites-codeblock sites-codesnippet-block"><code>/* Non-contiguous RO + RW images on storage */
#define CONFIG_EC_PROTECTED_STORAGE_OFF 0x7e0000
#define CONFIG_EC_PROTECTED_STORAGE_SIZE 0x20000
#define CONFIG_EC_WRITABLE_STORAGE_OFF 0x1e0000
#define CONFIG_EC_WRITABLE_STORAGE_SIZE 0x20000

...
#define CONFIG_RO_STORAGE_OFF (0 + LOADER_SIZE)
#define CONFIG_RW_STORAGE_OFF 0
...

/* Protected region includes non-EC data */
#define CONFIG_WP_STORAGE_OFF 0x600000
#define CONFIG_PROTECTED_SIZE 0x200000</code></div>
</pre>
<h1><a name="TOC-Handling-Non-Image-Data-Pieces-NIDs-"></a>Handling Non-Image Data Pieces (NIDs)</h1>
<p>Different chips may have different NIDs, such as boot headers and bootloaders.
Since these NIDs may have chip-specific requirements, we will not attempt to
standardize their layouts. It is suggested to keep uniform naming for NID
geometry configs, such as:</p>
<pre><div class="sites-codeblock sites-codesnippet-block"><code>#define CONFIG_BOOTLOADER_OFF
#define CONFIG_BOOTLOADER_SIZE

#define CONFIG_BOOTHEADER_OFF
#define CONFIG_BOOTHEADER_SIZE</code></div>
</pre>
<p>These chip-specific NID-related CONFIGs may be used in chip folders as
required. They should <strong>NEVER</strong> be used outside of chip folders (except to describe them in config.h) since
their precise meanings are not standardized.</p>
<h1><a name="TOC-Linking"></a>Linking</h1>
<p>Our linker scripts were originally written to support internal memory-mapped
storage with only RO and RW images (no NIDs). The scripts will be extended to
support the new configs defined above. For example, the linker will produce a
unified image with the RW image at the appropriate offset, as defined by
CONFIG_RW_STORAGE_OFF / CONFIG_RW_STORAGE_SIZE.</p>
<p>If NIDs are required, they will need to be copied to the appropriate location
by a chip-specific packing script. Such a script has already been implemented
for mec1322 in chip/mec1322/util/pack_ec.py. We may consider implementing a
generic version of pack_ec.py in the future, with only custom parameters for
each chip.</p>
<p>NIDs should not be copied by modifying the global, non-chip linker scripts. For
example, the NPCX-custom changes related to NPCX_RO_HEADER in
core/cortex-m/ec.lds.S are not acceptable and will need to be removed.</p>
<h1><a name="TOC-FMAP"></a>FMAP</h1>
<p>FMAP is a data structure (authoritative copy today lives inside the RO image,
but copies exist in both images) that describes the layout of EC storage.</p>
<p>Its header defines the following values of significance:</p>
<p>fmap_base</p>
<p>fmap_size</p>
<p>In addition, boundaries for seven regions are defined.</p>
<p>Currently, CONFIG_PROGRAM_MEMORY_BASE is written to fmap_base, and
CONFIG_EC_STORAGE_SIZE is written to fmap_size. This design makes no sense for
an FMAP intended to be read outside of the EC, since CONFIG_PROGRAM_MEMORY_BASE
is only meaningful to the EC. Instead, the following changes are proposed:</p>
<p>fmap_base: Offset to storage region described by FMAP</p>
<p>fmap_size: Size of storage region described by FMAP</p>
<p>When protected and writable storage regions are contiguous, the FMAP in RO and
RW (if present) images will be identical and describe both regions, with the RO
copy being authoritative. This is entirely consistent with the way FMAP works
today (all current platforms have contiguous readable + writable storage
regions).</p>
<h2><a name="TOC-Shared-SPI"></a>Shared SPI</h2>
<p>When protected and writable storage regions are non-contiguous (in certain
future shared SPI designs), the FMAP in RO and RW images will be different and
will each describe the EC protected and writable storage regions, respectfully.</p>
<p>For shared SPI, there will also be <em>master FMAP </em>(today known as the FW SPI FMAP), outside the EC storage regions,<em> </em>that describes all regions of SPI storage, including FW romstage images,
ramstage images, vendor blobs, and EC storage regions.</p>
<p>The workings of the <em>master FMAP</em> are outside the scope of the document, but it’s anticipated that EC FW updates
could work as follows:</p>
<p>The <em>master FMAP </em>has separate entries for the EC RO update region, the EC RW update region, and
the SPI write protect region. Therefore, the EC regions can be flashed without
parsing the EC FMAP. If desired, the EC FMAP can be parsed to ensure
consistency before flashing.</p>
<h2><a name="TOC-FMAP-Regions"></a>FMAP Regions</h2>
<p>The seven regions are unchanged and will keep their overall meaning (though
some corrections still must be made in code). Note that all region start
addresses are relative to fmap_base.</p>
<p>EC_RO - Region that will be updated on an RO update (equivalent to the
CONFIG_EC_PROTECTED_STORAGE region). This region includes the RO image and any
other meaningful NIDs in the RO region. Note that RO FW update is a feature not
supported on production devices, yet it is important for pre-MP updates and
factory flow.</p>
<p>FR_MAIN - Region consisting only of RO image (CONFIG_RO_STORAGE region)</p>
<p>RO_FRID - Region consisting of version struct inside RO image (generally start
of FR_MAIN + constant offset)</p>
<p>FMAP - Region consisting of the FMAP inside RO image, or the FMAP inside the RW
image, if the RO image doesn’t exist.</p>
<p>WP_RO - EC region that will be write protected at the factory before shipping
PVT / production devices. Equivalent to EC_RO. Note that if the protect region
exceeds the fmap_base / fmap_size region (when the CONFIG_WP_STORAGE exceeds
the CONFIG_EC_PROTECTED_STORAGE region, such as with shared SPI) then WP_RO
doesn’t describe the entire SPI region that must be protected. The <em>master FMAP</em> must describe that region separately.</p>
<p>EC_RW - Region that will be updated on an RW update (CONFIG_EC_WRITABLE_STORAGE
region).</p>
<p>RW_FWID - Region consisting of version struct inside RW image.</p>
<p>FR_MAIN (EC RO image) &lt;= EC_RO (RO update region / CONFIG_EC_PROTECTED_STORAGE
region) = WP_RO (EC write protect region)</p>
<p>EC RW IMAGE (not defined by FMAP) &lt;= EC_RW (RW update region /
CONFIG_WRITABLE_STORAGE region)</p>
<p>EC_RO + EC_RW == fmap_base + fmap_size, for contiguous EC_RO + EC_RW</p>
<h1><a name="TOC-Appendix"></a>Appendix</h1>
<h2><a name="TOC-Hypothetical-Shared-SPI-Platform"></a>Hypothetical Shared SPI Platform</h2>
<ul>
<li> Uses hypothetical MEC1322 (actual shared SPI implementation details not
consulted)
  </li><li> 8 MB (0x800000) SPI ROM
  </li><li> EC writable region 128K resides at [0x1e0000, 0x200000)
  </li><li> EC protected region 128K resides at [0x7e0000, 0x800000)
  </li><li> Remaining non-EC regions belong to system FW / BIOS
  </li><li> SPI protected region 2MB resides at [0x600000, 0x800000)

</li></ul></div></td></tr></tbody></table>
</div> 
</div> 
<div id="sites-canvas-bottom-panel">
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_page-subpages"> </div>
<div id="sites-attachments-container">
</div>
<a xmlns="http://www.w3.org/1999/xhtml" name="page-comments"></a>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_page-comments"><div class="sites-comment-docos-wrapper"><div class="sites-comment-docos"><div class="sites-comment-docos-background"></div><div class="sites-comment-docos-header"><div class="sites-comment-docos-header-title">Comments</div></div><div id="sites-comment-docos-pane" class="sites-comment-docos-pane"></div></div></div></div>
</div>
</div> 
</td> 
</tr>
</table> 
</div> 
</div> 
<div id="sites-chrome-footer-wrapper">
<div id="sites-chrome-footer-wrapper-inside">
<div id="sites-chrome-footer">
</div>
</div>
</div>
</div> 
</div> 
<div id="sites-chrome-adminfooter-container">
<div xmlns="http://www.w3.org/1999/xhtml" class="sites-adminfooter" role="navigation"><p><a class="sites-system-link" href="https://www.google.com/a/UniversalLogin?service=jotspot&amp;continue=https://sites.google.com/a/chromium.org/dev/chromium-os/ec-development/ec-image-geometry-spec">Sign in</a><span aria-hidden="true">|</span><a class="sites-system-link" href="../../system/app/pages/recentChanges.html">Recent Site Activity</a><span aria-hidden="true">|</span><a class="sites-system-link" href="../../system/app/pages/reportAbuse.html" target="_blank">Report Abuse</a><span aria-hidden="true">|</span><a class="sites-system-link" href="javascript:;" onclick="window.open(webspace.printUrl)">Print Page</a><span aria-hidden="true">|</span><span class="sites-system-link">Powered By</span> <b class="powered-by"><a href="http://sites.google.com">Google Sites</a></b></p></div>
</div>
</div> 
</div> 
<div id="sites-chrome-onebar-footer">
</div>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    window.jstiming.load.tick('sjl');
  </script>
<script xmlns="http://www.w3.org/1999/xhtml" src="https://ssl.gstatic.com/sites/p/56e332/system/js/jot_min_view__en.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    window.jstiming.load.tick('jl');
  </script>
<script xmlns="http://www.w3.org/1999/xhtml">
      
          sites.core.Analytics.createTracker();
          sites.core.Analytics.trackPageview();
        
    </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
                    sites.Searchbox.initialize(
                        'sites-searchbox-search-button',
                        {"object":[]}['object'],
                        'search-site',
                        {"label":"Configure search options...","url":"/system/app/pages/admin/settings"});
                  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
      gsites.HoverPopupMenu.createSiteDropdownMenus('sites-header-nav-dropdown', false);
    </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
            JOT_setupNav("7648876402527094", "Navigation", false);
            JOT_addListener('titleChange', 'JOT_NAVIGATION_titleChange', 'COMP_7648876402527094');
          </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
            JOT_setupNav("14720868319272995", "Quick links", false);
            JOT_addListener('titleChange', 'JOT_NAVIGATION_titleChange', 'COMP_14720868319272995');
          </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
            JOT_setupNav("19690813310444355", "Other sites", false);
            JOT_addListener('titleChange', 'JOT_NAVIGATION_titleChange', 'COMP_19690813310444355');
          </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
              new sites.CommentPane('//docs.google.com/comments/d/AAHRpnXvrAwjAfmld0ObrebBiGRq9_cryGv6IPam7eBsNX_n2DMnkB-p90Piw_3JSypRp4uqYUi-dEej6G1fGq4Z6QNILxs-9Ii9OqgDBNT6mTBHFnGxenU3IEQR-qlklo5hcBNt_sKtk/api/js?anon=true',
                  false, false);
            </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
  setTimeout(function() {
    var fingerprint = gsites.date.TimeZone.getFingerprint([]);
    gsites.Xhr.send('https://www.chromium.org/_/tz', null, null, 'GET', null, null, { afjstz: fingerprint });
  }, 500);
</script>
<script xmlns="http://www.w3.org/1999/xhtml">
                    window.onload = function() {
                      if (false) {
                        JOT_setMobilePreview();
                      }
                      var loadTimer = window.jstiming.load;
                      loadTimer.tick("ol");
                      loadTimer["name"] = "load," + webspace.page.type + ",user_page";
                      window.jstiming.report(loadTimer, {}, 'https://gg.google.com/csi');
                    }
                  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
        JOT_insertAnalyticsCode(false,
            false);
      </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    var maestroRunner = new gsites.pages.view.SitesMaestroRunner(
        webspace, "en");
    maestroRunner.initListeners();
    maestroRunner.installEditRender();
  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
  //<![CDATA[
    // Decorate any fastUI buttons on the page with a class of 'goog-button'.
    if (webspace.user.hasWriteAccess) {
      JOT_decorateButtons();
    }

    // Fires delayed events.
    (function() {
      JOT_fullyLoaded = true;
      var delayedEvents = JOT_delayedEvents;
      for (var x = 0; x < delayedEvents.length; x++) {
        var event = delayedEvents[x];
        JOT_postEvent(event.eventName, event.eventSrc, event.payload);
      }
      JOT_delayedEvents = null;
      JOT_postEvent('pageLoaded');
    })();
  //]]>
</script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    JOT_postEvent('decorateGvizCharts');
  </script>
<script type="text/javascript">
          JOT_setupPostRenderingManager();
        </script>
<script type="text/javascript">
          JOT_postEvent('renderPlus', null, 'sites-chrome-main');
        </script>
<div id="server-timer-div" style="display:none"> </div>
<script type="text/javascript">
          window.jstiming.load.tick('render');
          JOT_postEvent('usercontentrendered', this);
        </script>
</body>
</html>
