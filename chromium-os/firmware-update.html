<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/WebPage">
<head>
<meta http-equiv="X-UA-Compatible" content="chrome=1" />
<script type="text/javascript">/* Copyright 2008 Google. */ (function() { var e="wtsrt_",g="tbsd_",h="tbnd_",k="start",l="_wtsrt",m="_tbnd",n="CSI/";(function(){function f(a){this.t={};this.tick=function(a,c,b){this.t[a]=[void 0!=b?b:(new Date).getTime(),c];if(void 0==b)try{window.console.timeStamp(n+a)}catch(d){}};this.tick(k,null,a)}var a;window.performance&&(a=window.performance.timing);var p=a?new f(a.responseStart):new f;window.jstiming={Timer:f,load:p};if(a){var c=a.navigationStart,d=a.responseStart;0<c&&d>=c&&(window.jstiming.srt=d-c)}if(a){var b=window.jstiming.load;0<c&&d>=c&&(b.tick(l,void 0,c),b.tick(e,l,d),b.tick(g,e))}try{a=null,
window.chrome&&window.chrome.csi&&(a=Math.floor(window.chrome.csi().pageT),b&&0<c&&(b.tick(m,void 0,window.chrome.csi().startE),b.tick(h,m,c))),null==a&&window.gtbExternal&&(a=window.gtbExternal.pageT()),null==a&&window.external&&(a=window.external.pageT,b&&0<c&&(b.tick(m,void 0,window.external.startE),b.tick(h,m,c))),a&&(window.jstiming.pt=a)}catch(q){}})(); })()
</script>
<link rel="shortcut icon" href="../_/rsrc/1354323194313/favicon.ico" type="image/x-icon" />
<link rel="apple-touch-icon" href="https://ssl.gstatic.com/sites/p/56e332/system/app/images/apple-touch-icon.png" type="image/png" />
<script type="text/javascript">/* Copyright 2008 Google. */ (function() { var d="",g="__duration__",h="function";function k(c){return document.getElementById(c)}window.byId=k;function l(c){return c.replace(/^\s+|\s+$/g,d)}window.trim=l;var m=[],n=0;window.JOT_addListener=function(c,a,b){var e=new String(n++);c={eventName:c,handler:a,compId:b,key:e};m.push(c);return e};window.JOT_removeListenerByKey=function(c){for(var a=0;a<m.length;a++)if(m[a].key==c){m.splice(a,1);break}};
window.JOT_removeAllListenersForName=function(c){for(var a=0;a<m.length;a++)m[a].eventName==c&&m.splice(a,1)};window.JOT_postEvent=function(c,a,b){var e={eventName:c,eventSrc:a||{},payload:b||{}};if(window.JOT_fullyLoaded)for(a=m.length,b=0;b<a&&b<m.length;b++){var f=m[b];f&&f.eventName==c&&(e.listenerCompId=f.compId||d,(f=typeof f.handler==h?f.handler:window[f.handler])&&f(e))}else window.JOT_delayedEvents.push({eventName:c,eventSrc:a,payload:b})};window.JOT_delayedEvents=[];
window.JOT_fullyLoaded=!1;window.JOT_formatRelativeToNow=function(c,a){var b=((new Date).getTime()-c)/6E4;if(1440<=b||0>b)return null;var e=0;60<=b&&(b/=60,e=2);2<=b&&e++;return a?window.JOT_siteRelTimeStrs[e].replace(g,Math.floor(b)):window.JOT_userRelTimeStrs[e].replace(g,Math.floor(b))}; })()
</script>
<script>

  

  var breadcrumbs = [{"path":"/chromium-os","deleted":false,"title":"Chromium OS","dir":"ltr"},{"path":"/chromium-os/firmware-update","deleted":false,"title":"Firmware Update","dir":"ltr"}];
  var JOT_clearDotPath = 'https://ssl.gstatic.com/sites/p/56e332/system/app/images/cleardot.gif';

  
  var JOT_userRelTimeStrs = ["a minute ago","__duration__ minutes ago","an hour ago","__duration__ hours ago"];

  
  

  

  var webspace = {"enableAnalytics":true,"pageSharingId":"jotspot_page","enableUniversalAnalytics":false,"sharingPolicy":"OPENED_WITH_INDICATOR","siteTitle":"The Chromium Projects","isStartPageEnabled":true,"adsensePublisherId":null,"features":{"languageSelectDefaultTextSetToDefault":true,"validateClientGvizDataSourceUrls":true,"moreMobileStyleImprovements":true,"newInsertMenuIcons":true,"accessibleSortingButtons":true,"domainAnalyticsInGAOnly":true,"noCaptcha":true,"fileCabinetScreenReaderFix":true,"updatedTosAndPrivacyLinks":null,"pageDrafts":false,"mobileOrientationFix":true,"plusBadge":false,"pdfEmbedSupport":false,"jsClickFix":true},"isPublic":true,"isConsumer":false,"serverFlags":{"cajaBaseUrl":"//www.gstatic.com/caja","cajaDebugMode":false},"onepickBaseUrl":"https://docs.google.com","domainAnalyticsAccountId":"","plusPageId":"","signInUrl":"https://www.google.com/a/SelectSession?continue\u003dhttps://sites.google.com/a/chromium.org/dev/chromium-os/firmware-update\u0026service\u003djotspot","analyticsAccountId":"UA-5484340-1","scottyUrl":"/_/upload","homePath":"/","siteNoticeUrlEnabled":null,"plusPageUrl":"","adsensePromoClickedOrSiteIneligible":true,"csiReportUri":"https://gg.google.com/csi","sharingId":"jotspot","termsUrl":"//www.google.com/intl/en/policies/terms/","gvizVersion":1,"editorResources":{"sitelayout":["https://ssl.gstatic.com/sites/p/56e332/system/app/css/sitelayouteditor.css"],"text":["https://ssl.gstatic.com/sites/p/56e332/system/js/codemirror.js","https://ssl.gstatic.com/sites/p/56e332/system/app/css/codemirror_css.css","https://ssl.gstatic.com/sites/p/56e332/system/js/trog_edit__en.js","https://ssl.gstatic.com/sites/p/56e332/system/app/css/trogedit.css","/_/rsrc/1441580320000/system/app/css/editor.css","https://ssl.gstatic.com/sites/p/56e332/system/app/css/codeeditor.css","/_/rsrc/1441580320000/system/app/css/camelot/editor-jfk-wlb.css"]},"sharingUrlPrefix":"/_/sharing","isAdsenseEnabled":true,"domain":"chromium.org","baseUri":"","name":"dev","siteTemplateId":false,"siteNoticeRevision":null,"siteNoticeUrlAddress":null,"siteNoticeMessage":null,"page":{"isRtlLocale":false,"canDeleteWebspace":null,"isPageDraft":null,"parentPath":"/chromium-os","parentWuid":"wuid:gx:83df2ab1f8880ba","siteLocale":"en","timeZone":"America/Los_Angeles","type":"text","title":"Firmware Update","locale":"en","wuid":"wuid:gx:70afe215c501daf1","revision":26,"path":"/chromium-os/firmware-update","isSiteRtlLocale":false,"pageInheritsPermissions":null,"name":"firmware-update","canChangePath":true,"state":"","properties":{},"bidiEnabled":false,"currentTemplate":{"path":"/system/app/pagetemplates/text","title":"Web Page"}},"canPublishScriptToAnyone":true,"user":{"keyboardShortcuts":true,"sessionIndex":"","guest_":true,"displayNameOrEmail":"guest","userName":"guest","uid":"","renderMobile":false,"domain":"","namespace":"","hasWriteAccess":false,"namespaceUser":false,"primaryEmail":"guest","hasAdminAccess":false},"gadgets":{"baseUri":"/system/app/pages/gadgets"}};
  webspace.page.breadcrumbs = breadcrumbs;

  
  var JOT_siteRelTimeStrs = ["a minute ago","__duration__ minutes ago","an hour ago","__duration__ hours ago"];

</script>
<script type="text/javascript">
                window.jstiming.load.tick('scl');
              </script>
<meta name="title" content="Firmware Update - The Chromium Projects" />
<meta itemprop="name" content="Firmware Update - The Chromium Projects" />
<meta property="og:title" content="Firmware Update - The Chromium Projects" />
<meta name="description" content="Home of the Chromium Open Source Project" />
<meta itemprop="description" content="Home of the Chromium Open Source Project" />
<meta id="meta-tag-description" property="og:description" content="Home of the Chromium Open Source Project" />
<style type="text/css">
</style>
<link rel="stylesheet" type="text/css" href="https://ssl.gstatic.com/sites/p/56e332/system/app/themes/beigeandblue/standard-css-beigeandblue-ltr-ltr.css" />
<link rel="stylesheet" type="text/css" href="../_/rsrc/1441580320000/system/app/css/overlay.css%3Fcb=beigeandblueundefineda100%2525%2525150goog-ws-leftthemedefaultstandard.css" />
<link rel="stylesheet" type="text/css" href="../_/rsrc/1441580320000/system/app/css/camelot/allthemes-view.css" />
<!--[if IE]>
          <link rel="stylesheet" type="text/css" href="/system/app/css/camelot/allthemes%2die.css" />
        <![endif]-->
<title>Firmware Update - The Chromium Projects</title>
<meta itemprop="image" content="/_/rsrc/1438879449147/config/customLogo.gif?revision=3" />
<meta property="og:image" content="/_/rsrc/1438879449147/config/customLogo.gif?revision=3" />
<script type="text/javascript">
                window.jstiming.load.tick('cl');
              </script>
</head>
<body xmlns="http://www.google.com/ns/jotspot" id="body" class=" en            ">
<div id="sites-page-toolbar" class="sites-header-divider">
<div xmlns="http://www.w3.org/1999/xhtml" id="sites-status" class="sites-status" style="display:none;"><div id="sites-notice" class="sites-notice" role="status" aria-live="assertive"> </div></div>
</div>
<div id="sites-chrome-everything-scrollbar">
<div id="sites-chrome-everything" class="">
<div id="sites-chrome-page-wrapper" style="direction: ltr">
<div id="sites-chrome-page-wrapper-inside">
<div xmlns="http://www.w3.org/1999/xhtml" id="sites-chrome-header-wrapper" style="height:auto;">
<table id="sites-chrome-header" class="sites-layout-hbox" cellspacing="0" style="height:auto;">
<tr class="sites-header-primary-row" id="sites-chrome-userheader">
<td id="sites-header-title" class="" role="banner"><div class="sites-header-cell-buffer-wrapper"><a href="../index.html" id="sites-chrome-userheader-logo"><img id="logo-img-id" src="../_/rsrc/1438879449147/config/customLogo.gif%3Frevision=3" alt="The Chromium Projects" class="sites-logo  " /></a><h2><a href="../index.html" dir="ltr" id="sites-chrome-userheader-title">The Chromium Projects</a></h2></div></td><td class="sites-layout-searchbox  "><div class="sites-header-cell-buffer-wrapper"><form id="sites-searchbox-form" action="https://www.chromium.org/system/app/pages/search" role="search"><input type="hidden" id="sites-searchbox-scope" name="scope" value="search-site" /><input type="text" id="jot-ui-searchInput" name="q" size="20" value="" aria-label="Search this site" /><div id="sites-searchbox-button-set" class="goog-inline-block"><div role="button" id="sites-searchbox-search-button" class="goog-inline-block jfk-button jfk-button-standard" tabindex="0">Search this site</div></div></form></div></td>
</tr>
<tr class="sites-header-secondary-row" id="sites-chrome-horizontal-nav">
<td colspan="2" id="sites-chrome-header-horizontal-nav-container" role="navigation">
</td>
</tr>
</table>
</div>
<div id="sites-chrome-main-wrapper">
<div id="sites-chrome-main-wrapper-inside">
<table id="sites-chrome-main" class="sites-layout-hbox" cellspacing="0" cellpadding="{scmCellpadding}" border="0">
<tr>
<td id="sites-chrome-sidebar-left" class="sites-layout-sidebar-left initial" style="width:150px">
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_7648876402527094" class="sites-embed" role="navigation"><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotId="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="../chromium-projects.html" jotId="wuid:gx:10ae433dadbbab13" class="sites-navigation-link">Home</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="../Home.1.html" jotId="wuid:gx:43582b9d2029d3af" class="sites-navigation-link">Chromium</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="../chromium-os.1.html" jotId="wuid:gx:83df2ab1f8880ba" class="sites-navigation-link">Chromium OS</a></div></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_14720868319272995" class="sites-embed" role="navigation"><h4 class="sites-embed-title">Quick links</h4><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotId="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="../for-testers/bug-reporting-guidelines.html" class="sites-navigation-link">Report bugs</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="../developers/discussion-groups.html" class="sites-navigation-link">Discuss</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="../system/app/pages/sitemap/hierarchy.html" jotId="wuid:gx:571d8fbd499df20e" class="sites-navigation-link">Sitemap</a></div></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_19690813310444355" class="sites-embed" role="navigation"><h4 class="sites-embed-title">Other sites</h4><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotId="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="http://blog.chromium.org/" class="sites-navigation-link">Chromium Blog</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="http://code.google.com/chrome/extensions/" class="sites-navigation-link">Google Chrome Extensions</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="https://developers.google.com/chrome/chrome-frame/" class="sites-navigation-link">Google Chrome Frame</a></div></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_19695218559354544" class="sites-embed" role="complementary"><h4 class="sites-embed-title"></h4><div class="sites-embed-content sites-embed-content-sidebar-textbox"><div dir="ltr"><span style="font-size:x-small">Except as otherwise </span><a href="http://developers.google.com/site-policies.html#restrictions"><span style="font-size:x-small">noted</span></a><span style="font-size:x-small">, the content of this page is licensed under a </span><a href="http://creativecommons.org/licenses/by/2.5/"><span style="font-size:x-small">Creative Commons Attribution 2.5 license</span></a><span style="font-size:x-small">, and examples are licensed under the </span><a href="http://src.chromium.org/viewvc/chrome/trunk/src/LICENSE" target="_blank"><span style="font-size:x-small">BSD License</span></a><span style="font-size:x-small">.<br /></span></div></div></div>
</td>
<td id="sites-canvas-wrapper">
<div id="sites-canvas" role="main">
<div id="goog-ws-editor-toolbar-container"> </div>
<div xmlns="http://www.w3.org/1999/xhtml" id="title-crumbs" style="">
<A href="../chromium-os.1.html" dir="ltr">Chromium OS</A>‎ &gt; ‎
  </div>
<h3 xmlns="http://www.w3.org/1999/xhtml" id="sites-page-title-header" style="" align="left">
<span id="sites-page-title" dir="ltr" tabindex="-1" style="outline: none">Firmware Update</span>
</h3>
<div id="sites-canvas-main" class="sites-canvas-main">
<div id="sites-canvas-main-content">
<table xmlns="http://www.w3.org/1999/xhtml" cellspacing="0" class="sites-layout-name-one-column sites-layout-hbox"><tbody><tr><td class="sites-layout-tile sites-tile-name-content-1"><div dir="ltr"><div><div class="sites-embed-align-right-wrapping-on"><div class="sites-embed-border-off sites-embed" style="width:250px;"><div class="sites-embed-content sites-embed-type-toc"><div class="goog-toc sites-embed-toc-maxdepth-6"><p>Contents</p><ol class="goog-toc"><li class="goog-toc"><a href="firmware-update.html#TOC-WARNING:-Remember-to-backup-your-original-firmware-The-flash-memory-contains-some-device-information-that-cannot-be-recovered-if-overwritten."><strong>1 </strong>WARNING: Remember to backup your original firmware! The flash memory contains some device information that cannot be recovered if overwritten.</a></li><li class="goog-toc"><a href="firmware-update.html#TOC-Glossary"><strong>2 </strong>Glossary</a></li><li class="goog-toc"><a href="firmware-update.html#TOC-cros_bundle_firmware"><strong>3 </strong>cros_bundle_firmware</a><ol class="goog-toc"><li class="goog-toc"><a href="firmware-update.html#TOC-Summary"><strong>3.1 </strong>Summary</a></li><li class="goog-toc"><a href="firmware-update.html#TOC-Usage"><strong>3.2 </strong>Usage</a></li><li class="goog-toc"><a href="firmware-update.html#TOC-Options"><strong>3.3 </strong>Options</a></li></ol></li><li class="goog-toc"><a href="firmware-update.html#TOC-cros_write_firmware"><strong>4 </strong>cros_write_firmware</a></li><li class="goog-toc"><a href="firmware-update.html#TOC-Updating-your-U-Boot-to-2011.12-on-Daisy"><strong>5 </strong>Updating your U-Boot to 2011.12 on Daisy</a></li><li class="goog-toc"><a href="firmware-update.html#TOC-x86-Development-Flow"><strong>6 </strong>x86 Development Flow</a></li></ol></div></div></div></div></div>
<h2><a name="TOC-WARNING:-Remember-to-backup-your-original-firmware-The-flash-memory-contains-some-device-information-that-cannot-be-recovered-if-overwritten."></a>
<div style="font-weight:normal">
<p><font size="3"><font color="#990000">WARNING: Remember to backup your original firmware! The flash memory contains some </font><span style="color:rgb(153,0,0)">device information</span><font color="#990000"> that cannot be recovered if overwritten.</font></font></p>
</div>
</h2>
<h2><a name="TOC-Glossary"></a>Glossary</h2>
<ul><li><b>BCT (Binary Chip Timings)</b></li>
<ul><li><b>BCT</b> contains timing parameters for the<b> </b>SOC and it used to set up its memory and basic peripherals, to allow it to read the boot loader. The BCT is packaged together with U-Boot for reading by the SOC on boot.</li></ul>
<li><b>Boot ROM</b></li>
<ul><li>An SOC's <b>Boot ROM</b> is responsible for setting up the SOC to a very basic level (using the<b> </b>BCT), setting up SDRAM and figuring out where the boot loader is. This is typically capable of loading the boot loader from USB, SPI flash, UART, eMMC / SD card and NAND flash. The Boot ROM is part of the SOC and cannot be changed other than by making a new chip. Some Boot ROMs include security features which require that boot code be signed by a special tool. Typically, Boot ROM consists of 16-32 KB of code.</li></ul>
<li><b>Device tree</b> </li>
<ul><li>see <b>FDT</b>.</li></ul>
<li><b>DTB file (Device Tree Binary)</b></li>
<ul><li>A file containing a binary representation of a device tree created by the <i>device tree compiler</i> from the source <i>DTS file</i>.</li></ul>
<li><b>DTS file </b><b>(Device Tree Source)</b></li>
<ul><li>A file containing a source representation of the device tee. This file is compiled into binary form for use by U-Boot and kernel.</li></ul>
<li><b>FDT (Flattened Device Tree)</b></li>
<ul><li>A <i>flattened device tree</i> describes the hardware that is seen by U-Boot and the kernel. The device tree consists of a number of nodes containing properties like memory addresses, interrupts, size, width / height (for LCD), etc. Each node also contains a <code>compatible</code> property which indicates which device driver should be used to implement the features provided by that node. We also use the FDT to pass provide configuration and verified boot information from U-Boot to the kernel. There is a different FDT for each board type, and even for each SKU (since a particular manufacturing run may change the chips that are used in some cases).</li></ul>
<li><b>GBB (Google Binary Block)</b></li>
<ul><li>This read-only area contains screen images for recovery mode and keys for both normal and recovery mode.</li></ul>
<li><b>SOC (System on Chip)</b></li>
<ul><li>A name for the integrated chips common in the ARM world. They include most peripherals on chip including SDRAM,control, SPI buses, NAND, USB and LCD. Roughly speaking a basic system can be created with an SOC, some SDRAM, some Flash and a power controller</li></ul>
<li><b>U-Boot</b></li>
<ul><li>The boot loader is responsible for setting up all required peripherals (such as LCD, SPI flash, UARTs, eMMC) and then loading and starting the kernel. On Chrome OS this includes security requirements, so we split U-Boot into two parts: a read only image that we ship with, and a read write image which can override this when we need to update the boot loader in the field. U-Boot is linked with the VBoot library which provides its security features. U-Boot is also responsible for taking the kernel's FDT, updating it with security and boot parameters, and presenting it to the kernel. There is a single U-Boot image for all boards for a single SOC type. For example, for Tegra2 we have one U-Boot image. All run-time configuration of U-Boot is done through the FDT.</li></ul>
<li><b>VBoot</b></li>
<ul><li>The verified boot library includes routines for accessing and checking keys and signatures. A detailed description of how this works <a href="chromiumos-design-docs/verified-boot-data-structures.1.html">is provided here</a>.</li></ul></ul>
<h2><a name="TOC-cros_bundle_firmware"></a><code>cros_bundle_firmware</code></h2>
<h3><a name="TOC-Summary"></a>Summary</h3>
This is a tool for creating a firmware image and writing it to your board. It can handle the following tasks:<br />
<ul><li>Package together U-Boot (the boot loader) and a FDT to produce a boot image</li>
<li>Package together the boot image, a BCT and appropriate signature to product a signed image</li>
<li>Create a GBB with appropriate keys and images<br />
</li>
<li>Create a full firmware image containing all the sections required for boot</li>
<li>Write this image to a board through the USB A-A cable</li></ul>
<h3><a name="TOC-Usage"></a>Usage</h3>
<p>To create an image for a particular board, use:</p>
<div class="sites-codeblock sites-codesnippet-block"><code>cros_bundle_firmware -b &lt;board&gt; -o &lt;filename&gt;</code></div>
<br />
<p>This will generate an image <code>&lt;filename&gt;</code> for the board. The tool finds files it needs in <code>/build/&lt;board&gt;/firmware</code>, things like <code>u-boot.bin</code>, the device tree source files (in dts subdir) and so on. There are options to specify each of these manually if you want to, and this is what the ebuild does. However, it does make for a very long command line. If you are unsure what files it is picking up, use -v3.</p>
<p>By default <code>cros_bundle_firmware</code> is quiet. Unless there are warnings/errors, all you will see is progress, and a command prompt when done. Use -v2, -v3 or even -v4 to change that.</p>
<p>Things you can do with this tool, which involve adding options:</p>
<ul><li>Specify your own U-Boot image: <br />
</li>
<ul><li><code>-u u-boot.bin</code></li></ul>
<li>Specify the U-Boot used for flashing (if your U-Boot doesn't support it)</li>
<ul><li><code>-U /build/&lt;board&gt;/firmware/u-boot.bin</code><br />
</li></ul>
<li>Specify your own FDT source file: <br />
</li>
<ul style="text-align:left"><li><code>-d my-board.dts</code></li>
<li>Note you will need to add a -I &lt;dir&gt; option for each include directory needed by your fdt. For example, <code>-I arch/arm/dts -I board/samsung/dts</code></li>
<li>The FDT file is automatically compiled<br />
</li></ul>
<li>Write the firmware to an SD card:</li>
<ul><li><code>-w sd:.</code></li>
<li>The <code>.</code> means to write to the only SD card connected to your machine. You can explicitly name the card if you like. Try <code>-w sd</code> to get a list of options.</li></ul>
<li>Write the firmware over USB to the board</li>
<ul><li><code>-w usb</code></li>
<li>Note this works for Tegra, but currently (Apr-12) gives checksum errors for Exynos</li></ul>
<li>Generate a minimal image just for testing with none of the GBB and other Chrome OS stuff</li>
<ul><li><code>-s</code></li></ul>
<li>Save all the temporary files so you can see what happened:</li>
<ul><li><code>-O &lt;dir&gt;</code></li></ul></ul>
<p>A full list of options is below, or use the --help flag.<br />
</p>
<h3><a name="TOC-Options"></a>Options</h3>
<div class="sites-codeblock sites-codesnippet-block"><code>Usage: cros_bundle_firmware [options]</code><br />
<br />
<code>Options:</code><br />
<code>  -h, --help            show this help message and exit</code><br />
<code>  --add-config-str=ADD_CONFIG_STR</code><br />
<code>                        Add a /config string to the U-Boot fdt</code><br />
<code>  --add-config-int=ADD_CONFIG_INT</code><br />
<code>                        Add a /config integer to the U-Boot fdt</code><br />
<code>  -b BOARD, --board=BOARD</code><br />
<code>                        Board name to use (e.g. tegra2_kaen)</code><br />
<code>  --bootcmd=BOOTCMD     Set U-Boot boot command</code><br />
<code>  --bootsecure          Boot command is simple (no arguments) and not</code><br />
<code>                        interruptible</code><br />
<code>  -c BCT, --bct=BCT     Path to BCT source file: only one can be given</code><br />
<code>  -d FDT, --dt=FDT      Path to fdt binary blob .dtb file to use</code><br />
<code>  --bl1=EXYNOS_BL1      Exynos preboot (BL1) file</code><br />
<code>  --bl2=EXYNOS_BL2      Exynos Secondary Program Loader (SPL / BL2) file</code><br />
<code>  --hwid=HARDWARE_ID    Hardware ID string to use</code><br />
<code>  -B BMPBLK, --bmpblk=BMPBLK</code><br />
<code>                        Bitmap block to use</code><br />
<code>  -F FLASH_DEST, --flash=FLASH_DEST</code><br />
<code>                        Create a flasher to flash the device (spi, mmc)</code><br />
<code>  -k KEY, --key=KEY     Path to signing key directory (default to dev key)</code><br />
<code>  -I INCLUDEDIRS, --includedir=INCLUDEDIRS</code><br />
<code>                        Include directory to search for files</code><br />
<code>  -m, --map             Output a flash map summary</code><br />
<code>  -o OUTPUT, --output=OUTPUT</code><br />
<code>                        Filename of final output image</code><br />
<code>  -O OUTDIR, --outdir=OUTDIR</code><br />
<code>                        Path to directory to use for intermediate and output</code><br />
<code>                        files</code><br />
<code>  -p, --preserve        Preserve temporary output directory</code><br />
<code>  -P POSTLOAD, --postload=POSTLOAD</code><br />
<code>                        Path to post-load portion of U-Boot (u-boot-post.bin)</code><br />
<code>  -s, --small           Create/write only the signed U-Boot binary (not the</code><br />
<code>                        full image)</code><br />
<code>  -S SEABIOS, --seabios=SEABIOS</code><br />
<code>                        Legacy BIOS (SeaBIOS)</code><br />
<code>  -u UBOOT, --uboot=UBOOT</code><br />
<code>                        Executable bootloader file (U-Boot)</code><br />
<code>  -U UBOOT_FLASHER, --uboot-flasher=UBOOT_FLASHER</code><br />
<code>                        Executable bootloader file (U-Boot) to use for</code><br />
<code>                        flashing (defaults to the same as --uboot)</code><br />
<code>  -C COREBOOT, --coreboot=COREBOOT</code><br />
<code>                        Executable lowlevel init file (coreboot)</code><br />
<code>  -v VERBOSITY, --verbosity=VERBOSITY</code><br />
<code>                        Control verbosity: 0=silent, 1=progress, 3=full,</code><br />
<code>                        4=debug</code><br />
<code>  -w WRITE, --write=WRITE</code><br />
<code>                        Write firmware to device (usb, sd)</code></div>
<h2><a name="TOC-cros_write_firmware"></a><code>cros_write_firmware</code></h2>
<p>If you already have an image, you can use this tool to write it to an SD card or over USB. However, you might find '<code>cros_bundle_firmware -w</code>' more flexible.</p>
<div class="sites-codeblock sites-codesnippet-block"><code>cros_write_firmware</code><code> -b daisy -</code><code>i &lt;image&gt; -w sd:.</code></div>
<br />
<h2><a name="TOC-Updating-your-U-Boot-to-2011.12-on-Daisy"></a>Updating your U-Boot to 2011.12 on Daisy<br />
</h2>
<p>You can do this without USB download using an SD card if you like. Please follow these steps:</p>
<ol><li>Get an SD card and put it into your card reader. The contents of this will be overwritten.</li>
<li>Get the latest source:<br />
<br />
<div class="sites-codeblock sites-codesnippet-block"><code>$ repo sync</code></div>
<br />
</li>
<li>Build everything<br />
<br />
<div class="sites-codeblock sites-codesnippet-block"><code>$ build_packages --board daisy</code></div>
<div class="sites-codeblock sites-codesnippet-block"><code>$ emerge-daisy chromeos-u-boot<br />
</code></div>
<div class="sites-codeblock sites-codesnippet-block"><code>$ emerge-daisy sys-boot/chromeos-bootimage</code></div>
<br />
</li>
<li>Write the firmware to your SD card (-F means to create an automatic flasher)<br />
<br />
<div class="sites-codeblock sites-codesnippet-block"><code>$ </code><span><code>cros_bundle_firmware --add-config-int load_env 1 -b daisy -w sd:. -F spi<br />
<br />
# Add '-d exynos5250-snow' for snow<br />
</code></span></div>
</li>
<li>Insert the SD card into your daisy board<br />
<br />
</li>
<li>Hold down the button which is labelled T20_REC / FW_DEBUG / DFU_REC depending on whether you are using <a href="servo.1.html">Servo 2</a>, Daisy or Min-Servo.<br />
<br />
</li>
<li>Press COLD_RST_L / KBC_RST / C_RST, then PWR_BUTTON to switch on, to boot from the SD card.<br />
<br />
</li>
<li>When it starts up, you should see a console on your servo UART, and it will start flashing your board.<br />
<br />
</li>
<li>When finished, type 'reset' into the terminal, or <span>press COLD_RST_L / KBC_RST / C_RST again, then PWR_BUTTON to switch on.</span></li>
</ol>
<div><br />
</div>
Steps 8  can also be done via servod:
<div>
<div class="sites-codeblock sites-codesnippet-block"><code>dut-control fw_up:on fw_up cold_reset:on cold_reset cold_reset:off cold_reset \</code>
<div><code>            pwr_button:press pwr_button sleep:2 pwr_button:release pwr_button \</code></div>
<div><code>            cold_reset:off cold_reset fw_up:off fw_up cpu_uart_en:on </code></div>
<br />
</div>
<div>
<h2><a name="TOC-x86-Development-Flow"></a>x86 Development Flow</h2>
<div style="color:rgb(0,0,0);font-family:arial;font-style:normal;font-variant:normal;letter-spacing:normal;line-height:normal;text-align:-webkit-auto;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px"><b style="font-size:medium">Building from the firmware branch</b></div>
<div style="color:rgb(0,0,0);font-family:arial;font-style:normal;font-variant:normal;letter-spacing:normal;line-height:normal;text-align:-webkit-auto;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px"><b style="font-size:medium"><br />
</b></div>
<div style="color:rgb(0,0,0);font-family:arial;font-style:normal;font-variant:normal;letter-spacing:normal;line-height:normal;text-align:-webkit-auto;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px"><font size="2">The ToT is not guaranteed to build usable firmware for older boards, so it is often necessary to retrieve an old branch to do so.  These steps were used to build the Link firmware from source:</font></div></div><div style="color:rgb(0,0,0);font-family:arial;font-style:normal;font-variant:normal;letter-spacing:normal;line-height:normal;text-align:-webkit-auto;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px"><font size="2"><br /></font></div><div class="sites-codeblock sites-codesnippet-block"><div><code>repo init -u <i>&lt;internal-manifest-url&gt;</i> \</code><br /><code>    --repo-url='https://chromium.googlesource.com/external/repo.git'</code><br /><code>    -b firmware-link-2695.B </code><br /><code>repo sync</code></div><div><br /></div><div><div><code>cros_workon-link start chromeos-base/chromeos-ec \</code></div><div><code>    sys-boot/chromeos-u-boot \</code></div><div><code>    chromeos-base/vboot_reference \</code></div><div><code>    chromeos-base/vboot_reference-firmware \</code></div><div><code>    sys-boot/chromeos-coreboot-link \</code></div><div><code>    sys-boot/chromeos-seabios \</code></div><div><code>    chromeos-base/chromeos-firmware-link</code></div></div><div><br /></div><div><div><code>emerge-link chromeos-ec \</code></div><div><code>    vboot_reference-firmware \</code></div><div><code>    chromeos-u-boot \</code></div><div><code>    chromeos-coreboot-link \</code></div><div><code>    chromeos-bootimage</code></div></div><div></div></div><div><br /></div>This should create <code>image-link.bin</code> in <code>/build/link/firmware</code> under the chroot.<br /><div><br /></div><div><br /></div><div>
<div style="color:rgb(0,0,0);font-family:arial;font-style:normal;font-variant:normal;letter-spacing:normal;line-height:normal;text-align:-webkit-auto;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px"><b style="font-size:medium">Using flashrom</b></div>
<div style="color:rgb(0,0,0);font-family:arial;font-style:normal;font-variant:normal;letter-spacing:normal;line-height:normal;text-align:-webkit-auto;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px"><font size="3"><b><br />
</b></font></div>
<div><font size="2" style="color:rgb(0,0,0);font-style:normal;font-variant:normal;letter-spacing:normal;line-height:normal;text-transform:none;white-space:normal;word-spacing:0px"><font face="arial">The </font></font><code>flashrom</code><font size="2" style="color:rgb(0,0,0);font-style:normal;font-variant:normal;letter-spacing:normal;line-height:normal;text-transform:none;white-space:normal;word-spacing:0px"><font face="arial"> command can be run from a root shell on the device, or it can be used from a development PC connected via servo.  See <a href="packages/cros-flashrom.html">here</a> for more detailed instructions on usage.</font></font></div>
<div style="color:rgb(0,0,0);font-style:normal;font-variant:normal;letter-spacing:normal;line-height:normal;text-align:-webkit-auto;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px"><font size="2"><font face="arial"><br />
</font></font></div>
<div style="color:rgb(0,0,0);font-style:normal;font-variant:normal;letter-spacing:normal;line-height:normal;text-align:-webkit-auto;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px"><b style="font-size:medium;font-family:arial;text-align:-webkit-auto;background-color:transparent">Using the SPI flash emulator</b></div>
<div style="color:rgb(0,0,0);font-family:arial;font-size:small;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;line-height:normal;text-align:-webkit-auto;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px"><br />
</div>
<div style="color:rgb(0,0,0);font-family:arial;font-size:small;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;line-height:normal;text-align:-webkit-auto;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px">The instructions in this section assume that you have a <a href="http://www.dediprog.com/pd/spi-flash-solution/em100pro" target="_blank">Dediprog EM100</a> hooked up to the system.  This hardware allows for downloading a new firmware image to the board in mere seconds, rather than waiting a few minutes to reflash a physical SPI memory device.</div>
<div style="color:rgb(0,0,0);font-family:arial;font-size:small;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;line-height:normal;text-align:-webkit-auto;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px"><br />
</div>
<div style="color:rgb(0,0,0);font-family:arial;font-size:small;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;line-height:normal;text-align:-webkit-auto;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px">To build a new firmware image, write it to your em100 and reset your link (using servo2):</div>
<div style="color:rgb(0,0,0);font-family:arial;font-size:small;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;line-height:normal;text-align:-webkit-auto;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px"><br />
</div>
<div style="color:rgb(0,0,0);font-family:arial;font-size:small;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;line-height:normal;text-align:-webkit-auto;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px"></div>
<div class="sites-codeblock sites-codesnippet-block">
<div style="color:rgb(0,0,0);font-family:arial;font-size:small;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;line-height:normal;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px"><code>$ USE=dev emerge-link chromeos-u-boot</code></div>
<div style="color:rgb(0,0,0);font-family:arial;font-size:small;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;line-height:normal;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px"><code>$ cros_bundle_firmware -b link --bootcmd vboot_twostop -w em100</code></div>
</div>
<div style="color:rgb(0,0,0);font-family:arial;font-size:small;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;line-height:normal;text-align:-webkit-auto;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px"><br />
</div>
<div style="color:rgb(0,0,0);font-family:arial;font-size:small;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;line-height:normal;text-align:-webkit-auto;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px">(the 'dev' flag reduces the 870KB of spew from the U-Boot ebuild, printing only warnings and errors)</div>
<div style="color:rgb(0,0,0);font-family:arial;font-size:small;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;line-height:normal;text-align:-webkit-auto;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px"><br />
</div>
<div style="color:rgb(0,0,0);font-family:arial;font-size:small;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;line-height:normal;text-align:-webkit-auto;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px">If you want a U-Boot serial console, but don't want to coreboot to print out all its serial info, you can build a coreboot WITHOUT the <code>USE=pcserial</code> flag, and then:</div>
<div style="color:rgb(0,0,0);font-family:arial;font-size:small;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;line-height:normal;text-align:-webkit-auto;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px"><br />
</div>
<div style="color:rgb(0,0,0);font-family:arial;font-size:small;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;line-height:normal;text-align:-webkit-auto;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px">
<div>
<div class="sites-codeblock sites-codesnippet-block"><code>$ cros_bundle_firmware -b link --add-node-enable console 1 --bootcmd vboot_twostop -w em100</code></div>
</div>
</div>
<div style="color:rgb(0,0,0);font-family:arial;font-size:small;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;line-height:normal;text-align:-webkit-auto;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px"><br />
</div>
<div style="color:rgb(0,0,0);font-family:arial;font-size:small;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;line-height:normal;text-align:-webkit-auto;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px">This enables the console node in the device tree, thus turning on the serial console in U-Boot.</div>
<br />
</div>
</div></div></td></tr></tbody></table>
</div> 
</div> 
<div id="sites-canvas-bottom-panel">
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_page-subpages"> </div>
<div id="sites-attachments-container">
</div>
<a xmlns="http://www.w3.org/1999/xhtml" name="page-comments"></a>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_page-comments"><div class="sites-comment-docos-wrapper"><div class="sites-comment-docos"><div class="sites-comment-docos-background"></div><div class="sites-comment-docos-header"><div class="sites-comment-docos-header-title">Comments</div></div><div id="sites-comment-docos-pane" class="sites-comment-docos-pane"></div></div></div></div>
</div>
</div> 
</td> 
</tr>
</table> 
</div> 
</div> 
<div id="sites-chrome-footer-wrapper">
<div id="sites-chrome-footer-wrapper-inside">
<div id="sites-chrome-footer">
</div>
</div>
</div>
</div> 
</div> 
<div id="sites-chrome-adminfooter-container">
<div xmlns="http://www.w3.org/1999/xhtml" class="sites-adminfooter" role="navigation"><p><a class="sites-system-link" href="https://www.google.com/a/UniversalLogin?service=jotspot&amp;continue=https://sites.google.com/a/chromium.org/dev/chromium-os/firmware-update">Sign in</a><span aria-hidden="true">|</span><a class="sites-system-link" href="../system/app/pages/recentChanges.html">Recent Site Activity</a><span aria-hidden="true">|</span><a class="sites-system-link" href="../system/app/pages/reportAbuse.html" target="_blank">Report Abuse</a><span aria-hidden="true">|</span><a class="sites-system-link" href="javascript:;" onclick="window.open(webspace.printUrl)">Print Page</a><span aria-hidden="true">|</span><span class="sites-system-link">Powered By</span> <b class="powered-by"><a href="http://sites.google.com">Google Sites</a></b></p></div>
</div>
</div> 
</div> 
<div id="sites-chrome-onebar-footer">
</div>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    window.jstiming.load.tick('sjl');
  </script>
<script xmlns="http://www.w3.org/1999/xhtml" src="https://ssl.gstatic.com/sites/p/56e332/system/js/jot_min_view__en.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    window.jstiming.load.tick('jl');
  </script>
<script xmlns="http://www.w3.org/1999/xhtml">
      
          sites.core.Analytics.createTracker();
          sites.core.Analytics.trackPageview();
        
    </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
                    sites.Searchbox.initialize(
                        'sites-searchbox-search-button',
                        {"object":[]}['object'],
                        'search-site',
                        {"label":"Configure search options...","url":"/system/app/pages/admin/settings"});
                  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
      gsites.HoverPopupMenu.createSiteDropdownMenus('sites-header-nav-dropdown', false);
    </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
            JOT_setupNav("7648876402527094", "Navigation", false);
            JOT_addListener('titleChange', 'JOT_NAVIGATION_titleChange', 'COMP_7648876402527094');
          </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
            JOT_setupNav("14720868319272995", "Quick links", false);
            JOT_addListener('titleChange', 'JOT_NAVIGATION_titleChange', 'COMP_14720868319272995');
          </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
            JOT_setupNav("19690813310444355", "Other sites", false);
            JOT_addListener('titleChange', 'JOT_NAVIGATION_titleChange', 'COMP_19690813310444355');
          </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
              new sites.CommentPane('//docs.google.com/comments/d/AAHRpnXvrAwjAfmld0ObrebBiGRq97JqT3iupkG7qY6mbqGBTXYErm6XX-5i0nkz22g24O5YkHdN5jgC-9obhSDDfZIIBKAGUDm0G97ypuIMuB_ZoYX81DvC0i-xzdjpaFfkahYmY9-a5/api/js?anon=true',
                  false, false);
            </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
  setTimeout(function() {
    var fingerprint = gsites.date.TimeZone.getFingerprint([]);
    gsites.Xhr.send('https://www.chromium.org/_/tz', null, null, 'GET', null, null, { afjstz: fingerprint });
  }, 500);
</script>
<script xmlns="http://www.w3.org/1999/xhtml">
                    window.onload = function() {
                      if (false) {
                        JOT_setMobilePreview();
                      }
                      var loadTimer = window.jstiming.load;
                      loadTimer.tick("ol");
                      loadTimer["name"] = "load," + webspace.page.type + ",user_page";
                      window.jstiming.report(loadTimer, {}, 'https://gg.google.com/csi');
                    }
                  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
        JOT_insertAnalyticsCode(false,
            false);
      </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    var maestroRunner = new gsites.pages.view.SitesMaestroRunner(
        webspace, "en");
    maestroRunner.initListeners();
    maestroRunner.installEditRender();
  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
  //<![CDATA[
    // Decorate any fastUI buttons on the page with a class of 'goog-button'.
    if (webspace.user.hasWriteAccess) {
      JOT_decorateButtons();
    }

    // Fires delayed events.
    (function() {
      JOT_fullyLoaded = true;
      var delayedEvents = JOT_delayedEvents;
      for (var x = 0; x < delayedEvents.length; x++) {
        var event = delayedEvents[x];
        JOT_postEvent(event.eventName, event.eventSrc, event.payload);
      }
      JOT_delayedEvents = null;
      JOT_postEvent('pageLoaded');
    })();
  //]]>
</script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    JOT_postEvent('decorateGvizCharts');
  </script>
<script type="text/javascript">
          JOT_setupPostRenderingManager();
        </script>
<script type="text/javascript">
          JOT_postEvent('renderPlus', null, 'sites-chrome-main');
        </script>
<div id="server-timer-div" style="display:none"> </div>
<script type="text/javascript">
          window.jstiming.load.tick('render');
          JOT_postEvent('usercontentrendered', this);
        </script>
</body>
</html>
