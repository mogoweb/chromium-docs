<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/WebPage">
<head>
<meta http-equiv="X-UA-Compatible" content="chrome=1" />
<script type="text/javascript">/* Copyright 2008 Google. */ (function() { var e="wtsrt_",g="tbsd_",h="tbnd_",k="start",l="_wtsrt",m="_tbnd",n="CSI/";(function(){function f(a){this.t={};this.tick=function(a,c,b){this.t[a]=[void 0!=b?b:(new Date).getTime(),c];if(void 0==b)try{window.console.timeStamp(n+a)}catch(d){}};this.tick(k,null,a)}var a;window.performance&&(a=window.performance.timing);var p=a?new f(a.responseStart):new f;window.jstiming={Timer:f,load:p};if(a){var c=a.navigationStart,d=a.responseStart;0<c&&d>=c&&(window.jstiming.srt=d-c)}if(a){var b=window.jstiming.load;0<c&&d>=c&&(b.tick(l,void 0,c),b.tick(e,l,d),b.tick(g,e))}try{a=null,
window.chrome&&window.chrome.csi&&(a=Math.floor(window.chrome.csi().pageT),b&&0<c&&(b.tick(m,void 0,window.chrome.csi().startE),b.tick(h,m,c))),null==a&&window.gtbExternal&&(a=window.gtbExternal.pageT()),null==a&&window.external&&(a=window.external.pageT,b&&0<c&&(b.tick(m,void 0,window.external.startE),b.tick(h,m,c))),a&&(window.jstiming.pt=a)}catch(q){}})(); })()
</script>
<link rel="shortcut icon" href="../_/rsrc/1354323194313/favicon.ico" type="image/x-icon" />
<link rel="apple-touch-icon" href="https://ssl.gstatic.com/sites/p/56e332/system/app/images/apple-touch-icon.png" type="image/png" />
<script type="text/javascript">/* Copyright 2008 Google. */ (function() { var d="",g="__duration__",h="function";function k(c){return document.getElementById(c)}window.byId=k;function l(c){return c.replace(/^\s+|\s+$/g,d)}window.trim=l;var m=[],n=0;window.JOT_addListener=function(c,a,b){var e=new String(n++);c={eventName:c,handler:a,compId:b,key:e};m.push(c);return e};window.JOT_removeListenerByKey=function(c){for(var a=0;a<m.length;a++)if(m[a].key==c){m.splice(a,1);break}};
window.JOT_removeAllListenersForName=function(c){for(var a=0;a<m.length;a++)m[a].eventName==c&&m.splice(a,1)};window.JOT_postEvent=function(c,a,b){var e={eventName:c,eventSrc:a||{},payload:b||{}};if(window.JOT_fullyLoaded)for(a=m.length,b=0;b<a&&b<m.length;b++){var f=m[b];f&&f.eventName==c&&(e.listenerCompId=f.compId||d,(f=typeof f.handler==h?f.handler:window[f.handler])&&f(e))}else window.JOT_delayedEvents.push({eventName:c,eventSrc:a,payload:b})};window.JOT_delayedEvents=[];
window.JOT_fullyLoaded=!1;window.JOT_formatRelativeToNow=function(c,a){var b=((new Date).getTime()-c)/6E4;if(1440<=b||0>b)return null;var e=0;60<=b&&(b/=60,e=2);2<=b&&e++;return a?window.JOT_siteRelTimeStrs[e].replace(g,Math.floor(b)):window.JOT_userRelTimeStrs[e].replace(g,Math.floor(b))}; })()
</script>
<script>

  

  var breadcrumbs = [{"path":"/for-testers","deleted":false,"title":"For Testers","dir":"ltr"},{"path":"/for-testers/saft","deleted":false,"title":"SAFT","dir":"ltr"}];
  var JOT_clearDotPath = 'https://ssl.gstatic.com/sites/p/56e332/system/app/images/cleardot.gif';

  
  var JOT_userRelTimeStrs = ["a minute ago","__duration__ minutes ago","an hour ago","__duration__ hours ago"];

  
  

  

  var webspace = {"enableAnalytics":true,"pageSharingId":"jotspot_page","enableUniversalAnalytics":false,"sharingPolicy":"OPENED_WITH_INDICATOR","siteTitle":"The Chromium Projects","isStartPageEnabled":true,"adsensePublisherId":null,"features":{"languageSelectDefaultTextSetToDefault":true,"validateClientGvizDataSourceUrls":true,"moreMobileStyleImprovements":true,"newInsertMenuIcons":true,"accessibleSortingButtons":true,"domainAnalyticsInGAOnly":true,"noCaptcha":true,"fileCabinetScreenReaderFix":true,"updatedTosAndPrivacyLinks":null,"pageDrafts":false,"mobileOrientationFix":true,"plusBadge":false,"pdfEmbedSupport":false,"jsClickFix":true},"isPublic":true,"isConsumer":false,"serverFlags":{"cajaBaseUrl":"//www.gstatic.com/caja","cajaDebugMode":false},"onepickBaseUrl":"https://docs.google.com","domainAnalyticsAccountId":"","plusPageId":"","signInUrl":"https://www.google.com/a/SelectSession?continue\u003dhttps://sites.google.com/a/chromium.org/dev/for-testers/saft\u0026service\u003djotspot","analyticsAccountId":"UA-5484340-1","scottyUrl":"/_/upload","homePath":"/","siteNoticeUrlEnabled":null,"plusPageUrl":"","adsensePromoClickedOrSiteIneligible":true,"csiReportUri":"https://gg.google.com/csi","sharingId":"jotspot","termsUrl":"//www.google.com/intl/en/policies/terms/","gvizVersion":1,"editorResources":{"sitelayout":["https://ssl.gstatic.com/sites/p/56e332/system/app/css/sitelayouteditor.css"],"text":["https://ssl.gstatic.com/sites/p/56e332/system/js/codemirror.js","https://ssl.gstatic.com/sites/p/56e332/system/app/css/codemirror_css.css","https://ssl.gstatic.com/sites/p/56e332/system/js/trog_edit__en.js","https://ssl.gstatic.com/sites/p/56e332/system/app/css/trogedit.css","/_/rsrc/1441580320000/system/app/css/editor.css","https://ssl.gstatic.com/sites/p/56e332/system/app/css/codeeditor.css","/_/rsrc/1441580320000/system/app/css/camelot/editor-jfk-wlb.css"]},"sharingUrlPrefix":"/_/sharing","isAdsenseEnabled":true,"domain":"chromium.org","baseUri":"","name":"dev","siteTemplateId":false,"siteNoticeRevision":null,"siteNoticeUrlAddress":null,"siteNoticeMessage":null,"page":{"isRtlLocale":false,"canDeleteWebspace":null,"isPageDraft":null,"parentPath":"/for-testers","parentWuid":"wuid:gx:2ad851395cafd499","siteLocale":"en","timeZone":"America/Los_Angeles","type":"text","title":"SAFT","locale":"en","wuid":"wuid:gx:3964268b53e277a3","revision":20,"path":"/for-testers/saft","isSiteRtlLocale":false,"pageInheritsPermissions":null,"name":"saft","canChangePath":true,"state":"","properties":{},"bidiEnabled":false,"currentTemplate":{"path":"/system/app/pagetemplates/text","title":"Web Page"}},"canPublishScriptToAnyone":true,"user":{"keyboardShortcuts":true,"sessionIndex":"","guest_":true,"displayNameOrEmail":"guest","userName":"guest","uid":"","renderMobile":false,"domain":"","namespace":"","hasWriteAccess":false,"namespaceUser":false,"primaryEmail":"guest","hasAdminAccess":false},"gadgets":{"baseUri":"/system/app/pages/gadgets"}};
  webspace.page.breadcrumbs = breadcrumbs;

  
  var JOT_siteRelTimeStrs = ["a minute ago","__duration__ minutes ago","an hour ago","__duration__ hours ago"];

</script>
<script type="text/javascript">
                window.jstiming.load.tick('scl');
              </script>
<meta name="title" content="SAFT - The Chromium Projects" />
<meta itemprop="name" content="SAFT - The Chromium Projects" />
<meta property="og:title" content="SAFT - The Chromium Projects" />
<meta name="description" content="Home of the Chromium Open Source Project" />
<meta itemprop="description" content="Home of the Chromium Open Source Project" />
<meta id="meta-tag-description" property="og:description" content="Home of the Chromium Open Source Project" />
<style type="text/css">
</style>
<link rel="stylesheet" type="text/css" href="https://ssl.gstatic.com/sites/p/56e332/system/app/themes/beigeandblue/standard-css-beigeandblue-ltr-ltr.css" />
<link rel="stylesheet" type="text/css" href="../_/rsrc/1441580320000/system/app/css/overlay.css%3Fcb=beigeandblueundefineda100%2525%2525150goog-ws-leftthemedefaultstandard.css" />
<link rel="stylesheet" type="text/css" href="../_/rsrc/1441580320000/system/app/css/camelot/allthemes-view.css" />
<!--[if IE]>
          <link rel="stylesheet" type="text/css" href="/system/app/css/camelot/allthemes%2die.css" />
        <![endif]-->
<title>SAFT - The Chromium Projects</title>
<meta itemprop="image" content="/_/rsrc/1438879449147/config/customLogo.gif?revision=3" />
<meta property="og:image" content="/_/rsrc/1438879449147/config/customLogo.gif?revision=3" />
<script type="text/javascript">
                window.jstiming.load.tick('cl');
              </script>
</head>
<body xmlns="http://www.google.com/ns/jotspot" id="body" class=" en            ">
<div id="sites-page-toolbar" class="sites-header-divider">
<div xmlns="http://www.w3.org/1999/xhtml" id="sites-status" class="sites-status" style="display:none;"><div id="sites-notice" class="sites-notice" role="status" aria-live="assertive"> </div></div>
</div>
<div id="sites-chrome-everything-scrollbar">
<div id="sites-chrome-everything" class="">
<div id="sites-chrome-page-wrapper" style="direction: ltr">
<div id="sites-chrome-page-wrapper-inside">
<div xmlns="http://www.w3.org/1999/xhtml" id="sites-chrome-header-wrapper" style="height:auto;">
<table id="sites-chrome-header" class="sites-layout-hbox" cellspacing="0" style="height:auto;">
<tr class="sites-header-primary-row" id="sites-chrome-userheader">
<td id="sites-header-title" class="" role="banner"><div class="sites-header-cell-buffer-wrapper"><a href="../index.html" id="sites-chrome-userheader-logo"><img id="logo-img-id" src="../_/rsrc/1438879449147/config/customLogo.gif%3Frevision=3" alt="The Chromium Projects" class="sites-logo  " /></a><h2><a href="../index.html" dir="ltr" id="sites-chrome-userheader-title">The Chromium Projects</a></h2></div></td><td class="sites-layout-searchbox  "><div class="sites-header-cell-buffer-wrapper"><form id="sites-searchbox-form" action="https://www.chromium.org/system/app/pages/search" role="search"><input type="hidden" id="sites-searchbox-scope" name="scope" value="search-site" /><input type="text" id="jot-ui-searchInput" name="q" size="20" value="" aria-label="Search this site" /><div id="sites-searchbox-button-set" class="goog-inline-block"><div role="button" id="sites-searchbox-search-button" class="goog-inline-block jfk-button jfk-button-standard" tabindex="0">Search this site</div></div></form></div></td>
</tr>
<tr class="sites-header-secondary-row" id="sites-chrome-horizontal-nav">
<td colspan="2" id="sites-chrome-header-horizontal-nav-container" role="navigation">
</td>
</tr>
</table>
</div>
<div id="sites-chrome-main-wrapper">
<div id="sites-chrome-main-wrapper-inside">
<table id="sites-chrome-main" class="sites-layout-hbox" cellspacing="0" cellpadding="{scmCellpadding}" border="0">
<tr>
<td id="sites-chrome-sidebar-left" class="sites-layout-sidebar-left initial" style="width:150px">
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_7648876402527094" class="sites-embed" role="navigation"><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotId="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="../chromium-projects.html" jotId="wuid:gx:10ae433dadbbab13" class="sites-navigation-link">Home</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="../Home.1.html" jotId="wuid:gx:43582b9d2029d3af" class="sites-navigation-link">Chromium</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="../chromium-os.1.html" jotId="wuid:gx:83df2ab1f8880ba" class="sites-navigation-link">Chromium OS</a></div></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_14720868319272995" class="sites-embed" role="navigation"><h4 class="sites-embed-title">Quick links</h4><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotId="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="bug-reporting-guidelines.html" class="sites-navigation-link">Report bugs</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="../developers/discussion-groups.html" class="sites-navigation-link">Discuss</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="../system/app/pages/sitemap/hierarchy.html" jotId="wuid:gx:571d8fbd499df20e" class="sites-navigation-link">Sitemap</a></div></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_19690813310444355" class="sites-embed" role="navigation"><h4 class="sites-embed-title">Other sites</h4><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotId="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="http://blog.chromium.org/" class="sites-navigation-link">Chromium Blog</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="http://code.google.com/chrome/extensions/" class="sites-navigation-link">Google Chrome Extensions</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="https://developers.google.com/chrome/chrome-frame/" class="sites-navigation-link">Google Chrome Frame</a></div></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_19695218559354544" class="sites-embed" role="complementary"><h4 class="sites-embed-title"></h4><div class="sites-embed-content sites-embed-content-sidebar-textbox"><div dir="ltr"><span style="font-size:x-small">Except as otherwise </span><a href="http://developers.google.com/site-policies.html#restrictions"><span style="font-size:x-small">noted</span></a><span style="font-size:x-small">, the content of this page is licensed under a </span><a href="http://creativecommons.org/licenses/by/2.5/"><span style="font-size:x-small">Creative Commons Attribution 2.5 license</span></a><span style="font-size:x-small">, and examples are licensed under the </span><a href="http://src.chromium.org/viewvc/chrome/trunk/src/LICENSE" target="_blank"><span style="font-size:x-small">BSD License</span></a><span style="font-size:x-small">.<br /></span></div></div></div>
</td>
<td id="sites-canvas-wrapper">
<div id="sites-canvas" role="main">
<div id="goog-ws-editor-toolbar-container"> </div>
<div xmlns="http://www.w3.org/1999/xhtml" id="title-crumbs" style="">
<A href="../for-testers.1.html" dir="ltr">For Testers</A>‎ &gt; ‎
  </div>
<h3 xmlns="http://www.w3.org/1999/xhtml" id="sites-page-title-header" style="" align="left">
<span id="sites-page-title" dir="ltr" tabindex="-1" style="outline: none">SAFT</span>
</h3>
<div id="sites-canvas-main" class="sites-canvas-main">
<div id="sites-canvas-main-content">
<table xmlns="http://www.w3.org/1999/xhtml" cellspacing="0" class="sites-layout-name-one-column sites-layout-hbox"><tbody><tr><td class="sites-layout-tile sites-tile-name-content-1"><div dir="ltr"><div><div class="sites-embed-align-left-wrapping-off"><div class="sites-embed-border-off sites-embed" style="width:250px;"><div class="sites-embed-content sites-embed-type-toc"><div class="goog-toc sites-embed-toc-maxdepth-4"><p>Contents</p><ol class="goog-toc"><li class="goog-toc"><a href="saft.html#TOC-Theory-of-operation"><strong>1 </strong>Theory of operation</a></li><li class="goog-toc"><a href="saft.html#TOC-Running-SAFT"><strong>2 </strong>Running SAFT</a></li><li class="goog-toc"><a href="saft.html#TOC-Tests-implemented-so-far"><strong>3 </strong>Tests implemented so far</a></li><li class="goog-toc"><a href="saft.html#TOC-Enhancing-SAFT"><strong>4 </strong>Enhancing SAFT</a></li><li class="goog-toc"><a href="saft.html#TOC-Interpreting-SAFT-errors"><strong>5 </strong>Interpreting SAFT errors</a></li></ol></div></div></div></div>
<h3><a name="TOC-Theory-of-operation"></a>Theory of operation</h3>
</div>
<div>SAFT stands for Semi Automated Firmware Test. It is a Python and BASH based Linux application enabled in the <a href="../chromium-os.1.html">ChromeOS</a> test distribution. On the target system SAFT code is placed in <code>/usr/sbin/firmware/saft<font color="#000000" face="Arial, Verdana, sans-serif">. The source code is controlled by a separate <a href="https://www.chromium.org/for-testers/goog_880557684">git</a></font></code><a href="https://www.chromium.org/for-testers/goog_880557684"> </a><code><font color="#000000" face="Arial, Verdana, sans-serif"><a href="http://gerrit.chromium.org/gerrit/gitweb?p=chromiumos%2Fplatform%2Fsaft.git;a=shortlog;h=HEAD">repository</a>. </font></code></div>
<div><br />
</div>
<div>SAFT is designed to verify BIOS functionality, including different aspects of <a href="../chromium-os/chromiumos-design-docs/verified-boot.1.html">Verified Boot</a> and <a href="https://docs.google.com/a/google.com/Doc?docid=0AbUTgMyqR_XeZGRuaDd4OXdfODJkbTRjZzJjdA&amp;hl=en" target="_blank">Google Chrome OS Firmware - High Level Specification</a>. To test this thoroughly multiple system restarts are needed, some including booting in recovery mode. This is why <b>SAFT requires the flash drive to be present on the system under test</b>, both to keep state between reboots and to provide recovery mode boot medium. Recovery mode boot requires operator involvement (unplugging and plugging in the flash drive), which makes SAFT a 'semi automated' test. SAFT is meant to be run by the firmware vendors, and is required to be easy to set up and run.  This is why it is not using the autotest framework, all what's needed is a target netbook and a flash memory stick.</div>
<div><br />
</div>
<div>The Chrome OS root file system is immutable, so there is a need to enable or disable SAFT execution without modifying the root fs contents. The SAFT <a href="http://upstart.ubuntu.com/getting-started.html">upstart</a> script <code>/etc/init/saft.conf</code> is executed on every reboot. It checks if the flash drive is present, and a "follow up" script <code>/var/saft.sh</code> exists on it. If the follow up script does not exist, SAFT execution terminates, if it does exist, the follow up script is invoked. This allows to enable/disable SAFT execution without modifying the root file system.</div>
<div><br />
</div>
<div>When SAFT is not running, the upstart script terminates after logging the state in <code>/tmp/saft.conf</code>:</div>
<div><br />
</div>
<div>
<div></div>
</div>
<div class="sites-codeblock sites-codesnippet-block">
<div>
<div><code>localhost ~ # cat /tmp/saft.log</code></div>
<div><code>Found sdc after 0 seconds</code></div>
<div><code>No SAFT in progress</code></div>
</div>
</div>
<div><br />
</div>
<div>To enable SAFT execution on a system, the 'follow up' script is created and the system is reset. On the next and all following startups until the 'follow up' script is deleted, SAFT application is invoked.</div>
<div><br />
</div>
<div>SAFT needs some means of representing the target boot state (what firmware and kernel were used, what was the reason for reboot, where the root file system is hosted, etc.). A so called boot state vector is used for that, which is a string described as follows in the source code:</div>
<div><br />
</div>
<div class="sites-codeblock sites-codesnippet-block"><code>The string has a form of x:x:x:&lt;removable&gt;:&lt;partition_number&gt;, where x' represent contents of the appropriate BINF files as reported by ACPI, &lt;removable&gt; is set to 1 or 0 depending if the root device is removable or not, and &lt;partition number&gt; is the last element of the root device name, designating the partition where the root fs is mounted. </code>
<div><br />
</div>
<div><code>This vector fully describes the way the system came up.</code></div>
<div>
<div></div>
</div>
</div>
<br />
<div>
<div>When executed on start up, the 'follow up' script creates the necessary environment and starts the actual SAFT Python application located in<code> &lt;flash drive mount point&gt;/usr/sbin/firmware/saft/saft_utility.py</code><font color="#000000" face="Arial, Verdana, sans-serif">. This application is a state machine, where</font> e<font color="#000000" face="Arial, Verdana, sans-serif">ach state introduces a unique defect in the system (corrupted firmware or kernel, different CGPT attributes, etc., etc.).</font></div>
<div><br />
</div>
<div>In each step the application checks if the current boot state vector matches the expected state, and if so corrects the previously introduced defect, introduces the next one and reboots again. This continues until all steps are passed, provided every state is processed properly. If SAFT application detects that the target state vector does not match the expected state, it terminates immediately. <font color="#000000" face="Arial, Verdana, sans-serif">The sequence of defect introducing actions is stored in the <code style="color:rgb(0,96,0)">saft_utility.py:</code></font><span style="font-family:monospace;font-size:medium;white-space:pre-wrap"><code style="color:rgb(0,96,0)">TEST_STATE_SEQUENCE</code></span><span style="font-family:monospace;font-size:medium;white-space:pre-wrap"> table.</span></div>
<div><br />
</div>
<div>On termination the SAFT application removes the 'follow up' script and copies the SAFT log into the <code>/var/fw_test_log.txt</code>, which allows the operator to examine the test results.</div>
<h3><a name="TOC-Running-SAFT"></a>Running SAFT</h3>
<div>Two important conditions have to be met before SAFT can run properly:</div>
<div>
<ul><li>both kernels/root fs pairs need to be populated on the main storage device</li>
<li>the flash device needs to be configured not to use verified root fs, because it gets mounted in course of SAFT execution, which causes verified root fs control structures to go out of sync. </li></ul>
</div>
<div>Neither of these conditions are met by default in the recent ChromeOS distributions, so before SAFT can run, they need to be taken care of. The SAFT wrapper script<code> /usr/sbin/firmware/saft/runtests.sh</code> does that. The wrapper script checks if both partiton pairs exist, and if not - it duplicates the firs pair on the second pair's devices (<code>/dev/sda2</code> gets copied to <code>/dev/sda4</code> and <code>/dev/sda3</code> gets copied to <code>/dev/sda5</code>) and checks the command line of the flash device hosted recovery kernel. If it is configured to run with verified root fs, the kernel command line is edited to bring the recovery image up without verified root fs protection.</div>
<div><br />
</div>
<div>So, a typical procedure to invoke SAFT is as follows:</div>
<div>
<ul><li>download ChromeOS test distribution and put it on the flash drive</li>
<li>install ChromeOS on the target using the flash drive</li>
<li>reboot the target, enter the shell dialog and type</li></ul>
</div>
<div class="sites-codeblock sites-codesnippet-block">
<div><code>sudo /usr/sbin/firmware/saft/runtests.sh [&lt;BIOS image to test&gt;]</code></div>
<div></div>
</div>
<div><br />
</div>
If <code>runtests.sh</code> is invoked without any parameters, it just verifies the environment (modifies it as described above, if required), copies SAFT code into the removable device (into<code style="color:rgb(0,96,0)"> &lt;flash drive mount point&gt;</code><code style="color:rgb(0,96,0)">/usr/sbin/firmware/saft)</code> and runs SAFT unit tests. The actual SAFT starts if <code>runtests.sh</code> is invoked with a command line parameter, the name of the file containing the firmware image to test.
<div><br />
</div>
<div>It is presumed that the flash device (carrying the recovery image from which the system has been installed) is plugged in into the target and gets instantiated as <code>/dev/sdb</code>. If the flash device is plugged in into a USB hub or is instantiated as a different device for some other reason, the environment variable <code>FLASH_DEVICE </code>can be used to communicate it to the script, for instance:</div>
<div><br />
</div>
<div>
<div class="sites-codeblock sites-codesnippet-block"><code>FLASH_DEVICE=sdc /usr/sbin/firmware/saft/runtests.sh [&lt;BIOS image to test&gt;]</code></div>
</div>
<div><br />
</div>
<div>When invoked with the BIOS image file name, it is verified that the image has proper keys in it and would be able to bring up the existing kernels. If verification succeeds, SAFT gets under way, rebooting the target a few times (as many times as there are steps in <font color="#000000" face="Arial, Verdana, sans-serif"><code style="color:rgb(0,96,0)">saft_utility.py:</code></font><span style="font-family:monospace;font-size:medium;white-space:pre-wrap"><code style="color:rgb(0,96,0)">TEST_STATE_SEQUENCE</code><code><font color="#000000" face="Arial, Verdana, sans-serif"><span style="white-space:normal">)</span></font></code><code><font color="#000000" face="Arial, Verdana, sans-serif"><span style="white-space:normal">.</span></font></code></span></div>
<div><br />
</div>
<div>Certain steps take a long time between restarts (for instance, when a step involves reprogramming of the flashrom). It is easy to tell if SAFT is completed or not by examining the SAFT temp file in <code>/tmp/saft.log</code>. When SAFT completes, this file would have either an error message or the phrase 'we are done' in the end. This file includes only messages generated since the most recent startup. The full SAFT log can be found in <code>/var/fw_test.log.txt<font color="#000000" face="Arial, Verdana, sans-serif"> <b>after </b>the test completes.</font></code></div>
<h3><a name="TOC-Tests-implemented-so-far"></a><code><font color="#000000" face="Arial, Verdana, sans-serif">Tests implemented so</font></code> far</h3>
<div>The following tests are implemented as of commit <code>6cabd80 Introduce gpt tests in SAFT</code>. (make sure to update this string when editing this section).</div>
<div><br />
</div>
<div>
<table border="1" bordercolor="#888" cellspacing="0" style="border-collapse:collapse;border-top-color:rgb(136,136,136);border-right-color:rgb(136,136,136);border-bottom-color:rgb(136,136,136);border-left-color:rgb(136,136,136);border-top-width:1px;border-right-width:1px;border-bottom-width:1px;border-left-width:1px">
<tbody>
<tr>
<td style="width:270px;height:23px"> Test</td>
<td colspan="3" style="text-align:center;width:324px;height:23px">      System state after reboot</td>
</tr>
<tr>
<td style="width:270px;height:15px"> </td>
<td style="text-align:center;width:70px;height:15px"> Firmware</td>
<td style="text-align:center;width:52px;height:15px"> Kernel</td>
<td style="text-align:center;width:202px;height:15px"> GPT attributes</td>
</tr>
<tr>
<td style="width:270px;height:15px"> Set 'try FW B' in NV ram</td>
<td style="text-align:center;width:70px;height:15px">  B</td>
<td style="text-align:center;width:52px;height:15px"> A </td>
<td style="width:202px;height:15px"> </td>
</tr>
<tr>
<td style="width:270px;height:15px"> Corrupt FW A</td>
<td style="text-align:center;width:70px;height:15px"> B</td>
<td style="text-align:center;width:52px;height:15px"> A</td>
<td style="width:202px;height:15px"> </td>
</tr>
<tr>
<td style="width:270px;height:15px"> Restore FW A</td>
<td style="text-align:center;width:70px;height:15px">  A</td>
<td style="text-align:center;width:52px;height:15px"> A</td>
<td style="width:202px;height:15px"> </td>
</tr>
<tr>
<td style="width:270px;height:15px"> Corrupt both FW A and B</td>
<td style="text-align:center;width:70px;height:15px"> Recovery</td>
<td style="width:52px;height:15px"><span style="border-collapse:separate">Recovery</span></td>
<td style="width:202px;height:15px"> </td>
</tr>
<tr>
<td style="width:270px;height:15px"> Restore FW A and B</td>
<td style="text-align:center;width:70px;height:15px">A</td>
<td style="text-align:center;width:52px;height:15px"> A</td>
<td style="width:202px;height:15px"> </td>
</tr>
<tr>
<td style="width:270px;height:15px"> Corrupt kernel A</td>
<td style="text-align:center;width:70px;height:15px">  A<span> </span></td>
<td style="text-align:center;width:52px;height:15px"> B</td>
<td style="width:202px;height:15px"> </td>
</tr>
<tr>
<td style="width:270px;height:15px"> Corrupt kernel B</td>
<td style="text-align:center;width:70px;height:15px"> Recovery</td>
<td style="width:52px;height:15px">Recovery</td>
<td style="width:202px;height:15px"> </td>
</tr>
<tr>
<td style="width:270px;height:15px"> Restore kernels A and B</td>
<td style="text-align:center;width:70px;height:15px"> A</td>
<td style="text-align:center;width:52px;height:15px"> A</td>
<td style="width:202px;height:15px"> </td>
</tr>
<tr>
<td style="width:270px;height:15px"> Set GPT A[S:0 T:15 P:10] B[S:0 T=15 P=9]</td>
<td style="text-align:center;width:70px;height:15px"> A</td>
<td style="text-align:center;width:52px;height:15px"> A</td>
<td style="text-align:center;width:202px;height:15px">A[S:0 T:14 P:10] B[S:0 T=15 P=9] </td>
</tr>
</tbody></table>
<div><span style="font-size:16px;font-weight:bold"><br />
</span></div>
<h3><a name="TOC-Enhancing-SAFT"></a>Enhancing SAFT</h3></div>
</div>
<div><br />
</div>
<div>It is easy to add new steps to SAFT by extending <font color="#000000" face="Arial, Verdana, sans-serif"><code style="color:rgb(0,96,0)">saft_utility.py:</code></font><span style="font-family:monospace;font-size:medium;white-space:pre-wrap"><code style="color:rgb(0,96,0)">TEST_STATE_SEQUENCE</code></span> table with new steps. The format of the table is simple, each line is a tri-tuple of</div>
<div><br />
</div>
<div>
<div class="sites-codeblock sites-codesnippet-block"><code>(&lt;boot_state_vector&gt;, &lt;function&gt;, &lt;argument&gt;),</code></div>
</div>
<div><br />
</div>
<div>where <code>boot_state_vector</code> is the expected boot state after the previous step, and <code>function</code> with argument <code>argument</code> will implement the new step of SAFT.</div><h3><a name="TOC-Interpreting-SAFT-errors"></a>Interpreting SAFT errors</h3><div>One of the common SAFT errors is 'wrong boot vector'</div><div><br /></div>
<div><br />
</div></div></td></tr></tbody></table>
</div> 
</div> 
<div id="sites-canvas-bottom-panel">
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_page-subpages"> </div>
<div id="sites-attachments-container">
</div>
<a xmlns="http://www.w3.org/1999/xhtml" name="page-comments"></a>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_page-comments"><div class="sites-comment-docos-wrapper"><div class="sites-comment-docos"><div class="sites-comment-docos-background"></div><div class="sites-comment-docos-header"><div class="sites-comment-docos-header-title">Comments</div></div><div id="sites-comment-docos-pane" class="sites-comment-docos-pane"></div></div></div></div>
</div>
</div> 
</td> 
</tr>
</table> 
</div> 
</div> 
<div id="sites-chrome-footer-wrapper">
<div id="sites-chrome-footer-wrapper-inside">
<div id="sites-chrome-footer">
</div>
</div>
</div>
</div> 
</div> 
<div id="sites-chrome-adminfooter-container">
<div xmlns="http://www.w3.org/1999/xhtml" class="sites-adminfooter" role="navigation"><p><a class="sites-system-link" href="https://www.google.com/a/UniversalLogin?service=jotspot&amp;continue=https://sites.google.com/a/chromium.org/dev/for-testers/saft">Sign in</a><span aria-hidden="true">|</span><a class="sites-system-link" href="../system/app/pages/recentChanges.html">Recent Site Activity</a><span aria-hidden="true">|</span><a class="sites-system-link" href="../system/app/pages/reportAbuse.html" target="_blank">Report Abuse</a><span aria-hidden="true">|</span><a class="sites-system-link" href="javascript:;" onclick="window.open(webspace.printUrl)">Print Page</a><span aria-hidden="true">|</span><span class="sites-system-link">Powered By</span> <b class="powered-by"><a href="http://sites.google.com">Google Sites</a></b></p></div>
</div>
</div> 
</div> 
<div id="sites-chrome-onebar-footer">
</div>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    window.jstiming.load.tick('sjl');
  </script>
<script xmlns="http://www.w3.org/1999/xhtml" src="https://ssl.gstatic.com/sites/p/56e332/system/js/jot_min_view__en.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    window.jstiming.load.tick('jl');
  </script>
<script xmlns="http://www.w3.org/1999/xhtml">
      
          sites.core.Analytics.createTracker();
          sites.core.Analytics.trackPageview();
        
    </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
                    sites.Searchbox.initialize(
                        'sites-searchbox-search-button',
                        {"object":[]}['object'],
                        'search-site',
                        {"label":"Configure search options...","url":"/system/app/pages/admin/settings"});
                  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
      gsites.HoverPopupMenu.createSiteDropdownMenus('sites-header-nav-dropdown', false);
    </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
            JOT_setupNav("7648876402527094", "Navigation", false);
            JOT_addListener('titleChange', 'JOT_NAVIGATION_titleChange', 'COMP_7648876402527094');
          </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
            JOT_setupNav("14720868319272995", "Quick links", false);
            JOT_addListener('titleChange', 'JOT_NAVIGATION_titleChange', 'COMP_14720868319272995');
          </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
            JOT_setupNav("19690813310444355", "Other sites", false);
            JOT_addListener('titleChange', 'JOT_NAVIGATION_titleChange', 'COMP_19690813310444355');
          </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
              new sites.CommentPane('//docs.google.com/comments/d/AAHRpnXvrAwjAfmld0ObrebBiGRq9-Rm_00OH4jaWBjVWRLx8h6ogFXtGA4t07iy4cx2c-blUB1d4Tm_ZqAGsB4v-1-tNvsDvYQDeJT8A5OtLUXRKlns4FjuXq8AEEu1zbj7P4AHM9nqZ/api/js?anon=true',
                  false, false);
            </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
  setTimeout(function() {
    var fingerprint = gsites.date.TimeZone.getFingerprint([]);
    gsites.Xhr.send('https://www.chromium.org/_/tz', null, null, 'GET', null, null, { afjstz: fingerprint });
  }, 500);
</script>
<script xmlns="http://www.w3.org/1999/xhtml">
                    window.onload = function() {
                      if (false) {
                        JOT_setMobilePreview();
                      }
                      var loadTimer = window.jstiming.load;
                      loadTimer.tick("ol");
                      loadTimer["name"] = "load," + webspace.page.type + ",user_page";
                      window.jstiming.report(loadTimer, {}, 'https://gg.google.com/csi');
                    }
                  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
        JOT_insertAnalyticsCode(false,
            false);
      </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    var maestroRunner = new gsites.pages.view.SitesMaestroRunner(
        webspace, "en");
    maestroRunner.initListeners();
    maestroRunner.installEditRender();
  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
  //<![CDATA[
    // Decorate any fastUI buttons on the page with a class of 'goog-button'.
    if (webspace.user.hasWriteAccess) {
      JOT_decorateButtons();
    }

    // Fires delayed events.
    (function() {
      JOT_fullyLoaded = true;
      var delayedEvents = JOT_delayedEvents;
      for (var x = 0; x < delayedEvents.length; x++) {
        var event = delayedEvents[x];
        JOT_postEvent(event.eventName, event.eventSrc, event.payload);
      }
      JOT_delayedEvents = null;
      JOT_postEvent('pageLoaded');
    })();
  //]]>
</script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    JOT_postEvent('decorateGvizCharts');
  </script>
<script type="text/javascript">
          JOT_setupPostRenderingManager();
        </script>
<script type="text/javascript">
          JOT_postEvent('renderPlus', null, 'sites-chrome-main');
        </script>
<div id="server-timer-div" style="display:none"> </div>
<script type="text/javascript">
          window.jstiming.load.tick('render');
          JOT_postEvent('usercontentrendered', this);
        </script>
</body>
</html>
