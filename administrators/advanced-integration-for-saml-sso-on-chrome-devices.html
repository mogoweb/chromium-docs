<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/WebPage">
<head>
<meta http-equiv="X-UA-Compatible" content="chrome=1" />
<script type="text/javascript">/* Copyright 2008 Google. */ (function() { var e="wtsrt_",g="tbsd_",h="tbnd_",k="start",l="_wtsrt",m="_tbnd",n="CSI/";(function(){function f(a){this.t={};this.tick=function(a,c,b){this.t[a]=[void 0!=b?b:(new Date).getTime(),c];if(void 0==b)try{window.console.timeStamp(n+a)}catch(d){}};this.tick(k,null,a)}var a;window.performance&&(a=window.performance.timing);var p=a?new f(a.responseStart):new f;window.jstiming={Timer:f,load:p};if(a){var c=a.navigationStart,d=a.responseStart;0<c&&d>=c&&(window.jstiming.srt=d-c)}if(a){var b=window.jstiming.load;0<c&&d>=c&&(b.tick(l,void 0,c),b.tick(e,l,d),b.tick(g,e))}try{a=null,
window.chrome&&window.chrome.csi&&(a=Math.floor(window.chrome.csi().pageT),b&&0<c&&(b.tick(m,void 0,window.chrome.csi().startE),b.tick(h,m,c))),null==a&&window.gtbExternal&&(a=window.gtbExternal.pageT()),null==a&&window.external&&(a=window.external.pageT,b&&0<c&&(b.tick(m,void 0,window.external.startE),b.tick(h,m,c))),a&&(window.jstiming.pt=a)}catch(q){}})(); })()
</script>
<link rel="shortcut icon" href="../_/rsrc/1354323194313/favicon.ico" type="image/x-icon" />
<link rel="apple-touch-icon" href="https://ssl.gstatic.com/sites/p/56e332/system/app/images/apple-touch-icon.png" type="image/png" />
<script type="text/javascript">/* Copyright 2008 Google. */ (function() { var d="",g="__duration__",h="function";function k(c){return document.getElementById(c)}window.byId=k;function l(c){return c.replace(/^\s+|\s+$/g,d)}window.trim=l;var m=[],n=0;window.JOT_addListener=function(c,a,b){var e=new String(n++);c={eventName:c,handler:a,compId:b,key:e};m.push(c);return e};window.JOT_removeListenerByKey=function(c){for(var a=0;a<m.length;a++)if(m[a].key==c){m.splice(a,1);break}};
window.JOT_removeAllListenersForName=function(c){for(var a=0;a<m.length;a++)m[a].eventName==c&&m.splice(a,1)};window.JOT_postEvent=function(c,a,b){var e={eventName:c,eventSrc:a||{},payload:b||{}};if(window.JOT_fullyLoaded)for(a=m.length,b=0;b<a&&b<m.length;b++){var f=m[b];f&&f.eventName==c&&(e.listenerCompId=f.compId||d,(f=typeof f.handler==h?f.handler:window[f.handler])&&f(e))}else window.JOT_delayedEvents.push({eventName:c,eventSrc:a,payload:b})};window.JOT_delayedEvents=[];
window.JOT_fullyLoaded=!1;window.JOT_formatRelativeToNow=function(c,a){var b=((new Date).getTime()-c)/6E4;if(1440<=b||0>b)return null;var e=0;60<=b&&(b/=60,e=2);2<=b&&e++;return a?window.JOT_siteRelTimeStrs[e].replace(g,Math.floor(b)):window.JOT_userRelTimeStrs[e].replace(g,Math.floor(b))}; })()
</script>
<script>

  

  var breadcrumbs = [{"path":"/administrators","deleted":false,"title":"Documentation for Administrators","dir":"ltr"},{"path":"/administrators/advanced-integration-for-saml-sso-on-chrome-devices","deleted":false,"title":"Advanced Integration for SAML SSO on Chrome Devices","dir":"ltr"}];
  var JOT_clearDotPath = 'https://ssl.gstatic.com/sites/p/56e332/system/app/images/cleardot.gif';

  
  var JOT_userRelTimeStrs = ["a minute ago","__duration__ minutes ago","an hour ago","__duration__ hours ago"];

  
  

  

  var webspace = {"enableAnalytics":true,"pageSharingId":"jotspot_page","enableUniversalAnalytics":false,"sharingPolicy":"OPENED_WITH_INDICATOR","siteTitle":"The Chromium Projects","isStartPageEnabled":true,"adsensePublisherId":null,"features":{"languageSelectDefaultTextSetToDefault":true,"validateClientGvizDataSourceUrls":true,"moreMobileStyleImprovements":true,"newInsertMenuIcons":true,"accessibleSortingButtons":true,"domainAnalyticsInGAOnly":true,"noCaptcha":true,"fileCabinetScreenReaderFix":true,"updatedTosAndPrivacyLinks":null,"pageDrafts":false,"mobileOrientationFix":true,"plusBadge":false,"pdfEmbedSupport":false,"jsClickFix":true},"isPublic":true,"isConsumer":false,"serverFlags":{"cajaBaseUrl":"//www.gstatic.com/caja","cajaDebugMode":false},"onepickBaseUrl":"https://docs.google.com","domainAnalyticsAccountId":"","plusPageId":"","signInUrl":"https://www.google.com/a/SelectSession?continue\u003dhttps://sites.google.com/a/chromium.org/dev/administrators/advanced-integration-for-saml-sso-on-chrome-devices\u0026service\u003djotspot","analyticsAccountId":"UA-5484340-1","scottyUrl":"/_/upload","homePath":"/","siteNoticeUrlEnabled":null,"plusPageUrl":"","adsensePromoClickedOrSiteIneligible":true,"csiReportUri":"https://gg.google.com/csi","sharingId":"jotspot","termsUrl":"//www.google.com/intl/en/policies/terms/","gvizVersion":1,"editorResources":{"sitelayout":["https://ssl.gstatic.com/sites/p/56e332/system/app/css/sitelayouteditor.css"],"text":["https://ssl.gstatic.com/sites/p/56e332/system/js/codemirror.js","https://ssl.gstatic.com/sites/p/56e332/system/app/css/codemirror_css.css","https://ssl.gstatic.com/sites/p/56e332/system/js/trog_edit__en.js","https://ssl.gstatic.com/sites/p/56e332/system/app/css/trogedit.css","/_/rsrc/1441580320000/system/app/css/editor.css","https://ssl.gstatic.com/sites/p/56e332/system/app/css/codeeditor.css","/_/rsrc/1441580320000/system/app/css/camelot/editor-jfk-wlb.css"]},"sharingUrlPrefix":"/_/sharing","isAdsenseEnabled":true,"domain":"chromium.org","baseUri":"","name":"dev","siteTemplateId":false,"siteNoticeRevision":null,"siteNoticeUrlAddress":null,"siteNoticeMessage":null,"page":{"isRtlLocale":false,"canDeleteWebspace":null,"isPageDraft":null,"parentPath":"/administrators","parentWuid":"wuid:gx:6c7bc6ab28ba6c28","siteLocale":"en","timeZone":"America/Los_Angeles","type":"text","title":"Advanced Integration for SAML SSO on Chrome Devices","locale":"en","wuid":"wuid:gx:1f6022ace10da103","revision":10,"path":"/administrators/advanced-integration-for-saml-sso-on-chrome-devices","isSiteRtlLocale":false,"pageInheritsPermissions":null,"name":"advanced-integration-for-saml-sso-on-chrome-devices","canChangePath":true,"state":"","properties":{},"bidiEnabled":false,"currentTemplate":{"path":"/system/app/pagetemplates/text","title":"Web Page"}},"canPublishScriptToAnyone":true,"user":{"keyboardShortcuts":true,"sessionIndex":"","guest_":true,"displayNameOrEmail":"guest","userName":"guest","uid":"","renderMobile":false,"domain":"","namespace":"","hasWriteAccess":false,"namespaceUser":false,"primaryEmail":"guest","hasAdminAccess":false},"gadgets":{"baseUri":"/system/app/pages/gadgets"}};
  webspace.page.breadcrumbs = breadcrumbs;

  
  var JOT_siteRelTimeStrs = ["a minute ago","__duration__ minutes ago","an hour ago","__duration__ hours ago"];

</script>
<script type="text/javascript">
                window.jstiming.load.tick('scl');
              </script>
<meta name="title" content="Advanced Integration for SAML SSO on Chrome Devices - The Chromium Projects" />
<meta itemprop="name" content="Advanced Integration for SAML SSO on Chrome Devices - The Chromium Projects" />
<meta property="og:title" content="Advanced Integration for SAML SSO on Chrome Devices - The Chromium Projects" />
<meta name="description" content="Home of the Chromium Open Source Project" />
<meta itemprop="description" content="Home of the Chromium Open Source Project" />
<meta id="meta-tag-description" property="og:description" content="Home of the Chromium Open Source Project" />
<style type="text/css">
</style>
<link rel="stylesheet" type="text/css" href="https://ssl.gstatic.com/sites/p/56e332/system/app/themes/beigeandblue/standard-css-beigeandblue-ltr-ltr.css" />
<link rel="stylesheet" type="text/css" href="../_/rsrc/1441580320000/system/app/css/overlay.css%3Fcb=beigeandblueundefineda100%2525%2525150goog-ws-leftthemedefaultstandard.css" />
<link rel="stylesheet" type="text/css" href="../_/rsrc/1441580320000/system/app/css/camelot/allthemes-view.css" />
<!--[if IE]>
          <link rel="stylesheet" type="text/css" href="/system/app/css/camelot/allthemes%2die.css" />
        <![endif]-->
<title>Advanced Integration for SAML SSO on Chrome Devices - The Chromium Projects</title>
<meta itemprop="image" content="/_/rsrc/1438879449147/config/customLogo.gif?revision=3" />
<meta property="og:image" content="/_/rsrc/1438879449147/config/customLogo.gif?revision=3" />
<script type="text/javascript">
                window.jstiming.load.tick('cl');
              </script>
</head>
<body xmlns="http://www.google.com/ns/jotspot" id="body" class=" en            ">
<div id="sites-page-toolbar" class="sites-header-divider">
<div xmlns="http://www.w3.org/1999/xhtml" id="sites-status" class="sites-status" style="display:none;"><div id="sites-notice" class="sites-notice" role="status" aria-live="assertive"> </div></div>
</div>
<div id="sites-chrome-everything-scrollbar">
<div id="sites-chrome-everything" class="">
<div id="sites-chrome-page-wrapper" style="direction: ltr">
<div id="sites-chrome-page-wrapper-inside">
<div xmlns="http://www.w3.org/1999/xhtml" id="sites-chrome-header-wrapper" style="height:auto;">
<table id="sites-chrome-header" class="sites-layout-hbox" cellspacing="0" style="height:auto;">
<tr class="sites-header-primary-row" id="sites-chrome-userheader">
<td id="sites-header-title" class="" role="banner"><div class="sites-header-cell-buffer-wrapper"><a href="../index.html" id="sites-chrome-userheader-logo"><img id="logo-img-id" src="../_/rsrc/1438879449147/config/customLogo.gif%3Frevision=3" alt="The Chromium Projects" class="sites-logo  " /></a><h2><a href="../index.html" dir="ltr" id="sites-chrome-userheader-title">The Chromium Projects</a></h2></div></td><td class="sites-layout-searchbox  "><div class="sites-header-cell-buffer-wrapper"><form id="sites-searchbox-form" action="https://www.chromium.org/system/app/pages/search" role="search"><input type="hidden" id="sites-searchbox-scope" name="scope" value="search-site" /><input type="text" id="jot-ui-searchInput" name="q" size="20" value="" aria-label="Search this site" /><div id="sites-searchbox-button-set" class="goog-inline-block"><div role="button" id="sites-searchbox-search-button" class="goog-inline-block jfk-button jfk-button-standard" tabindex="0">Search this site</div></div></form></div></td>
</tr>
<tr class="sites-header-secondary-row" id="sites-chrome-horizontal-nav">
<td colspan="2" id="sites-chrome-header-horizontal-nav-container" role="navigation">
</td>
</tr>
</table>
</div>
<div id="sites-chrome-main-wrapper">
<div id="sites-chrome-main-wrapper-inside">
<table id="sites-chrome-main" class="sites-layout-hbox" cellspacing="0" cellpadding="{scmCellpadding}" border="0">
<tr>
<td id="sites-chrome-sidebar-left" class="sites-layout-sidebar-left initial" style="width:150px">
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_7648876402527094" class="sites-embed" role="navigation"><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotId="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="../chromium-projects.html" jotId="wuid:gx:10ae433dadbbab13" class="sites-navigation-link">Home</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="../Home.1.html" jotId="wuid:gx:43582b9d2029d3af" class="sites-navigation-link">Chromium</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="../chromium-os.1.html" jotId="wuid:gx:83df2ab1f8880ba" class="sites-navigation-link">Chromium OS</a></div></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_14720868319272995" class="sites-embed" role="navigation"><h4 class="sites-embed-title">Quick links</h4><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotId="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="../for-testers/bug-reporting-guidelines.html" class="sites-navigation-link">Report bugs</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="../developers/discussion-groups.html" class="sites-navigation-link">Discuss</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="../system/app/pages/sitemap/hierarchy.html" jotId="wuid:gx:571d8fbd499df20e" class="sites-navigation-link">Sitemap</a></div></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_19690813310444355" class="sites-embed" role="navigation"><h4 class="sites-embed-title">Other sites</h4><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotId="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="http://blog.chromium.org/" class="sites-navigation-link">Chromium Blog</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="http://code.google.com/chrome/extensions/" class="sites-navigation-link">Google Chrome Extensions</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="https://developers.google.com/chrome/chrome-frame/" class="sites-navigation-link">Google Chrome Frame</a></div></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_19695218559354544" class="sites-embed" role="complementary"><h4 class="sites-embed-title"></h4><div class="sites-embed-content sites-embed-content-sidebar-textbox"><div dir="ltr"><span style="font-size:x-small">Except as otherwise </span><a href="http://developers.google.com/site-policies.html#restrictions"><span style="font-size:x-small">noted</span></a><span style="font-size:x-small">, the content of this page is licensed under a </span><a href="http://creativecommons.org/licenses/by/2.5/"><span style="font-size:x-small">Creative Commons Attribution 2.5 license</span></a><span style="font-size:x-small">, and examples are licensed under the </span><a href="http://src.chromium.org/viewvc/chrome/trunk/src/LICENSE" target="_blank"><span style="font-size:x-small">BSD License</span></a><span style="font-size:x-small">.<br /></span></div></div></div>
</td>
<td id="sites-canvas-wrapper">
<div id="sites-canvas" role="main">
<div id="goog-ws-editor-toolbar-container"> </div>
<div xmlns="http://www.w3.org/1999/xhtml" id="title-crumbs" style="">
<A href="../administrators.1.html" dir="ltr">Documentation for Administrators</A>‎ &gt; ‎
  </div>
<h3 xmlns="http://www.w3.org/1999/xhtml" id="sites-page-title-header" style="" align="left">
<span id="sites-page-title" dir="ltr" tabindex="-1" style="outline: none">Advanced Integration for SAML SSO on Chrome Devices</span>
</h3>
<div id="sites-canvas-main" class="sites-canvas-main">
<div id="sites-canvas-main-content">
<table xmlns="http://www.w3.org/1999/xhtml" cellspacing="0" class="sites-layout-name-one-column sites-layout-hbox"><tbody><tr><td class="sites-layout-tile sites-tile-name-content-1"><div dir="ltr"><span><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">This page describes the advanced integration that <b>may</b> be done in enabling SAML SSO on Chrome Devices. This article is intended for partners, SAML SSO vendors and IT administrators. The integration described in this document is not mandatory for the feature to work. For basic information on how SAML SSO can be enabled for Chrome Devices, please refer to <a href="https://support.google.com/chrome/a/answer/6060880" target="_blank">this article</a>.</span></span><div><span><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"><br /></span></span></div><div><span><h3 style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><a name="TOC-Chrome-Credentials-Passing-API"></a><span style="background-color:transparent;vertical-align:baseline;white-space:pre-wrap"><font face="arial, sans-serif" size="4">Chrome Credentials Passing API</font></span></h3><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">API version 1.0 - 3rd June 2014</span></p><div></div></span><h4><a name="TOC-Motivation"></a><font size="4">Motivation<br /></font></h4><span style="background-color:transparent;font-family:Arial;font-size:15px;white-space:pre-wrap;line-height:1.15;font-weight:normal">Users can sign in to Chrome with their Google accounts. The password is verified by Google’s authentication servers but is also used locally in Chrome to provide features such as session lock/unlock, Chrome Device offline sign-in and Chrome Device user data encryption. For SAML users, authentication is performed by a third-party identity provider (IdP). This document describes an API that SAML IdPs can use to securely provide Chrome with the user credentials required to implement the session lock/unlock, offline sign-in, and data encryption features.</span><span><h4><a name="TOC-Overview"></a><span style="vertical-align:baseline"><br /></span><font size="4"><span style="vertical-align:baseline">Overview</span><span style="vertical-align:baseline"><br /></span></font></h4><span style="vertical-align:baseline"><font face="Arial"><span style="font-size:15px;font-weight:normal;line-height:1.15;white-space:pre-wrap">The Chrome sign-in flow is entirely web-based. Google’s authentication service redirects to the IdP, the IdP guides the user through the authentication process and eventually redirects back to a Google URL, reporting success or failure (see the </span></font></span><a href="https://developers.google.com/google-apps/sso/saml_reference_implementation" style="line-height:1.15;background-color:transparent;font-size:10pt;font-weight:normal;text-decoration:none"><span style="font-size:15px;font-family:Arial;color:rgb(17,85,204);background-color:transparent;text-decoration:underline;vertical-align:baseline;white-space:pre-wrap">Google developer documentation</span></a><span style="line-height:1.15;background-color:transparent;font-weight:normal;font-size:15px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap">). The IdP’s authentication flow typically consists of at least three steps:</span><ol style="margin-top:0pt;margin-bottom:0pt"><li dir="ltr" style="list-style-type:decimal;font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline"><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="background-color:transparent;vertical-align:baseline;white-space:pre-wrap">an HTML login form collects user credentials</span></p></li><li dir="ltr" style="list-style-type:decimal;font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline"><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="background-color:transparent;vertical-align:baseline;white-space:pre-wrap">the IdP verifies that the credentials submitted are correct</span></p></li><li dir="ltr" style="list-style-type:decimal;font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline"><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="background-color:transparent;vertical-align:baseline;white-space:pre-wrap">an HTML page performs the redirect to the Google URL, indicating success/failure</span></p></li></ol><br /><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">This document introduces a JavaScript API via which the IdP can pass user credentials to Chrome in step 1 and can inform Chrome when the credentials have been verified in step 3. The API works locally: API methods are called by a script that is executed by Chrome as part of the SAML IdP’s web-based authentication flow and are processed by the same instance of Chrome. They do not flow through any server. The API methods are provided by a JavaScript file that handles the lower-level communication with Chrome. This file is hosted by Google at:</span></p><br /><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><a href="https://ssl.gstatic.com/accounts/chrome/users-1.0.js" style="text-decoration:none"><span style="font-size:15px;font-family:Arial;color:rgb(17,85,204);background-color:transparent;text-decoration:underline;vertical-align:baseline;white-space:pre-wrap">https://ssl.gstatic.com/accounts/chrome/users-1.0.js</span></a></p><br /><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">We recommend that SAML IdPs reference this file at the above location in their scripts. This way, any improvements and bug fixes to the file will be picked up automatically. We will make every effort to keep the API provided by this file stable.</span></p></span><h4><a name="TOC-Key-Types"></a><span><font size="4">Key Types</font></span></h4><span><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">To support session lock/unlock, offline sign-in and user data encryption, Chrome must be able to authenticate a returning user without contacting any servers. This is done by deriving a key from the user’s password via a one-way hash function during initial authentication. When the user returns and enters his/her password again, the same one-way hash function is applied to this password. If the resulting keys match, the password entered was correct and the user is authenticated.</span></p><br /><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Chrome uses a built-in one-way hash function to derive keys from passwords for non-SAML users. The same one-way hash function is used when a SAML IdP passes a user’s password to Chrome via the API described in this document. Chrome discards the password after hashing and does not store it anywhere. An alternative is for the IdP to apply a one-way hash function and pass the derived key to Chrome. When the user returns and enters his/her password, Chrome must apply the same one-way hash function to determine whether the password entered is correct. The IdP must therefore use a one-way hash function supported by Chrome and must also pass Chrome any additional metadata required to repeat the hashing, such as a salt.</span></p><br /><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Chrome provides the SAML IdP with a list of supported key derivation mechanisms when the IdP initializes the API. </span><span style="font-family:Consolas;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">KEY_TYPE_PASSWORD_PLAIN</span><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> is always supported. For this key type, the IdP passes the password to Chrome and Chrome applies its built-in one-way hash function to it. Additional key types, in which the IdP applies a one-way hash function and passes the key and metadata to Chrome, will be added in the future.</span></p></span><span><h4><a name="TOC-API-Methods"></a><br /><font size="4">API Methods<br /></font></h4><span style="line-height:1.15;background-color:transparent;font-family:Arial;font-size:15px;white-space:pre-wrap;font-weight:normal">The API consists of three JavaScript methods:</span><ul style="margin-top:0pt;margin-bottom:0pt"><li dir="ltr" style="list-style-type:disc;font-family:Consolas;background-color:transparent;vertical-align:baseline"><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="background-color:transparent;vertical-align:baseline;white-space:pre-wrap">initialize(callback)</span></p></li><li dir="ltr" style="list-style-type:disc;font-family:Consolas;background-color:transparent;vertical-align:baseline"><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="background-color:transparent;vertical-align:baseline;white-space:pre-wrap">add(details, callback)</span></p></li><li dir="ltr" style="list-style-type:disc;font-family:Consolas;background-color:transparent;vertical-align:baseline"><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="background-color:transparent;vertical-align:baseline;white-space:pre-wrap">complete(details, callback)</span></p></li></ul><br /><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">All methods are asynchronous. Each method will invoke the </span><span style="font-family:Consolas;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">callback</span><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> passed to it when its work is done. The </span><span style="font-family:Consolas;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">initialize</span><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> method must be called first to initialize the API. The </span><span style="font-family:Consolas;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">add</span><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> method is then used to pass credentials to Chrome and the </span><span style="font-family:Consolas;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">complete</span><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> method is used to inform Chrome that the passed credentials have been verified. IdP login flows typically span multiple HTML login pages. The API supports this by allowing its methods to be called from different pages.</span></p><br /><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">However, the API must correlate the </span><span style="font-family:Consolas;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">complete</span><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> call that indicates authentication success with the </span><span style="font-family:Consolas;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">add</span><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> call that passed the corresponding credentials. This correlation is established using the </span><span style="font-family:Consolas;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">token</span><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> argument: The SAML IdP passes a </span><span style="font-family:Consolas;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">token</span><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> of its choosing in the </span><span style="font-family:Consolas;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">details</span><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> provided to the </span><span style="font-family:Consolas;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">add</span><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> call and must then pass the same </span><span style="font-family:Consolas;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">token</span><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> in the </span><span style="font-family:Consolas;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">details</span><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> of the corresponding </span><span style="font-family:Consolas;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">complete</span><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> call. The API uses the </span><span style="font-family:Consolas;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">token</span><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> to correlate these method calls only. The </span><span style="font-family:Consolas;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">token</span><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> is treated as opaque, is not interpreted in any way and is discarded at the end of the sign-in process.</span></p><br /><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">If authentication fails, Chrome may return to the sign-in form, asking the user to try signing in again. A sign-in process can thus encompass multiple authentication attempts. To ensure that method calls are correlated correctly, the SAML IdP should use a different </span><span style="font-family:Consolas;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">token</span><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> for each of these authentication attempts. </span><span style="font-size:15px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">The IdP must then choose a </span><span style="line-height:1.15;font-size:10pt;font-family:Consolas;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">token</span><span style="font-size:15px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent"> when calling </span><span style="line-height:1.15;font-size:10pt;font-family:Consolas;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">add</span><span style="font-size:15px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent"> and must keep this token as part of its internal state until </span><span style="line-height:1.15;font-size:10pt;font-family:Consolas;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">complete</span><span style="font-size:15px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent"> is called. The need to generate and keep track of a suitable </span><span style="line-height:1.15;font-size:10pt;font-family:Consolas;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">token</span><span style="font-size:15px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent"> can be avoided by using the </span><span style="line-height:1.15;font-size:10pt;font-family:Consolas;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">RelayState</span><span style="font-size:15px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent"> (see the </span><a href="https://developers.google.com/google-apps/sso/saml_reference_implementation" style="line-height:1.15;font-size:10pt;text-decoration:none;background-color:transparent"><span style="font-size:15px;font-family:Arial;color:rgb(17,85,204);background-color:transparent;text-decoration:underline;vertical-align:baseline;white-space:pre-wrap">Google SAML developer documentation</span></a><span style="font-size:15px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent"> for a definition) as the </span><span style="line-height:1.15;font-size:10pt;font-family:Consolas;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">token</span><span style="font-size:15px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">. The </span><span style="line-height:1.15;font-size:10pt;font-family:Consolas;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">RelayState</span><span style="font-size:15px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent"> meets all requirements that the </span><span style="line-height:1.15;font-size:10pt;font-family:Consolas;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">token</span><span style="font-size:15px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent"> must fulfill:</span></p><ul style="margin-top:0pt;margin-bottom:0pt"><li dir="ltr" style="list-style-type:disc;font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline"><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="background-color:transparent;vertical-align:baseline;white-space:pre-wrap">The </span><span style="font-size:13px;font-family:Consolas;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">RelayState</span><span style="background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> remains constant throughout an authentication attempt</span></p></li><li dir="ltr" style="list-style-type:disc;font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline"><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="background-color:transparent;vertical-align:baseline;white-space:pre-wrap">The </span><span style="font-size:13px;font-family:Consolas;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">RelayState</span><span style="background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> is different for each authentication attempt</span></p></li><li dir="ltr" style="list-style-type:disc;font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline"><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="background-color:transparent;vertical-align:baseline;white-space:pre-wrap">The </span><span style="font-size:13px;font-family:Consolas;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">RelayState</span><span style="background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> must be passed through from the start to the end of the authentication flow so that it will be available in steps 1 and 3 of the flow</span></p></li></ul><br /><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">While the </span><span style="font-family:Consolas;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">RelayState</span><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> is an obvious choice for the </span><span style="font-family:Consolas;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">token</span><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">, a SAML IdP is free to choose any other </span><span style="font-family:Consolas;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">token</span><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> instead, as long as it allows the </span><span style="font-family:Consolas;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">add</span><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> and </span><span style="font-family:Consolas;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">complete</span><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> calls to be correlated.</span></p></span></div><blockquote style="margin:0 0 0 40px;border:none;padding:0px"><div><span><h2 dir="ltr" style="line-height:1.15;margin-top:10pt;margin-bottom:0pt"><a name="TOC-initialize-callback-"></a><span style="font-size:17px;font-family:Trebuchet MS;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">initialize(callback)</span></h2></span></div><div><span><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">The </span><span style="font-family:Consolas;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">initialize</span><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> method should be invoked once at the start of the authentication flow. While the API is currently implemented by Chrome only, a SAML IdP is not required to (and should not) interpret the user agent string to determine whether the API is available or not. Instead, the </span><span style="font-family:Consolas;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">initialize</span><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> method should always be called at the start of the authentication flow, regardless of user agent.</span></p></span></div><div><span><br /></span></div><div><span><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">If the authentication attempt is part of a sign-in process on a version of Chrome that provides the API, Chrome will invoke the </span><span style="font-family:Consolas;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">callback</span><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> with a list of supported key types. Once the </span><span style="font-family:Consolas;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">callback</span><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> has been invoked by Chrome, the IdP may use the API by calling the </span><span style="font-family:Consolas;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">add</span><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> and </span><span style="font-family:Consolas;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">complete</span><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> methods.</span></p></span></div><div><span><br /></span></div><div><span><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">In all other cases (e.g., not Chrome, older version of Chrome, not part of the sign-in process), the </span><span style="font-family:Consolas;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">callback</span><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> will not be invoked. If the </span><span style="font-family:Consolas;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">callback</span><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> is not invoked, the API is not available and the IdP must not call any of its other methods. If the IdP’s authentication flow spans multiple HTML pages, the IdP must keep track of the initialization result across these pages. If the API is available, the IdP should call the </span><span style="font-family:Consolas;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">add</span><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> and </span><span style="font-family:Consolas;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">complete</span><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> methods at the appropriate points in the authentication flow. Otherwise, the </span><span style="font-family:Consolas;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">add</span><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> and </span><span style="font-family:Consolas;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">complete</span><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> methods must not be called.</span></p></span></div><div><span><br /></span></div><div><span><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">The </span><span style="font-family:Consolas;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">callback</span><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> should be a function that takes a single argument, </span><span style="font-family:Consolas;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">keyTypes</span><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">. Chrome passes an array of string constants indicating the supported key derivation mechanisms via this argument (see the key types section </span><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">for details). The constant </span><span style="font-family:Consolas;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">’KEY_TYPE_PASSWORD_PLAIN’</span><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> will always be present in this array. Additional constants indicating further key derivation mechanisms will be added in the future.</span></p></span></div><div><span><h2 dir="ltr" style="line-height:1.15;margin-top:10pt;margin-bottom:0pt"><a name="TOC-add-details-callback-"></a><span style="font-size:17px;font-family:Trebuchet MS;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">add(details, callback)</span></h2></span></div><div><span><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">This method should be invoked when the user has finished entering his/her credentials. The </span><span style="font-family:Consolas;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">details</span><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> should be a JavaScript object that contains the following fields:</span></p></span></div><span style="background-color:transparent;vertical-align:baseline;white-space:pre-wrap">token<br /></span><span style="background-color:transparent;vertical-align:baseline;white-space:pre-wrap">user<br /></span><span style="background-color:transparent;vertical-align:baseline;white-space:pre-wrap">passwordBytes<br /></span><span style="background-color:transparent;vertical-align:baseline;white-space:pre-wrap">keyType</span><div><span><br /></span></div><div><span><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">The </span><span style="font-family:Consolas;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">token</span><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> is used to correlate the </span><span style="font-family:Consolas;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">add</span><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> call with a subsequent </span><span style="font-family:Consolas;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">complete</span><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> call. It is not interpreted by the API in any way and may be freely chosen by the IdP (see the API methods section </span><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">for details). The </span><span style="font-family:Consolas;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">user</span><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> field should be set to the user’s e-mail address. If the IdP does not know the user’s e-mail address, an empty string should be passed.</span></p></span></div><div><span><br /></span></div><div><span><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">The next two fields are used to pass a key to Chrome. </span><span style="font-family:Consolas;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">keyType</span><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> indicates the key derivation mechanism that the IdP used to derive the key from the user’s password. It must be one of the string constants that the API returned in the </span><span style="font-family:Consolas;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">keyTypes</span><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> array during initialization (see the previous section </span><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">for details). </span><span style="font-family:Consolas;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">passwordBytes</span><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> contains the key and any metadata required to repeat the hashing process that was used to derive the key.</span></p></span></div><div><span><br /></span></div><div><span><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">When the </span><span style="font-family:Consolas;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">keyType</span><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> is </span><span style="font-family:Consolas;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">’KEY_TYPE_PASSWORD_PLAIN’</span><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">, </span><span style="font-family:Consolas;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">passwordBytes</span><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> contains the password itself. For other key types that will be added in the future, </span><span style="font-family:Consolas;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">passwordBytes</span><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> will contain the metadata, such as a salt, and the key, separated by a delimiter.</span></p></span></div><div><span><br /></span></div><div><span><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">The </span><span style="font-family:Consolas;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">callback</span><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> will be invoked when Chrome has received the credentials. Since the user has not been authenticated yet, Chrome keeps the credentials in memory only and does not store them permanently until the corresponding </span><span style="font-family:Consolas;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">complete</span><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> method is called.</span></p></span></div><div><span><br /></span></div><div><span><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">The </span><span style="font-family:Consolas;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">add</span><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> method will typically be called when the HTML login form is about to submitted. It is important to not actually submit the form until after the </span><span style="font-family:Consolas;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">callback</span><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> has been invoked. If the IdP calls the </span><span style="font-family:Consolas;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">add</span><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> method and submits the form without waiting for the </span><span style="font-family:Consolas;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">callback</span><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">, the HTML page containing the login form and any scripts it is running it will be torn down immediately, preventing the credentials from reaching Chrome. The recommended way to handle form submission is to set the </span><span style="font-family:Consolas;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">callback</span><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> to </span><span style="font-family:Consolas;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">form.submit.bind(form)</span><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">, where </span><span style="font-family:Consolas;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">form</span><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> is the DOM node representing the login form. This way, the form will be submitted automatically when Chrome has received the credentials and invokes the </span><span style="font-family:Consolas;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">callback</span><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">.</span></p></span></div><div><span><br /></span></div><div><span><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">If the credentials entered are incorrect, the IdP will typically end the authentication flow with a </span><span style="font-family:Consolas;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">SAMLResponse</span><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> indicating failure. However, an IdP may also redirect back to the IdP’s login form, allowing the user to try entering his/her credentials again. If the IdP implements this flow, the </span><span style="font-family:Consolas;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">add</span><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> method should be called whenever new credentials are entered. It is permissible to reuse the same </span><span style="font-family:Consolas;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">token</span><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> in this case. When the </span><span style="font-family:Consolas;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">add</span><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> method is called with new credentials, any credentials previously passed with the same </span><span style="font-family:Consolas;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">token</span><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> are superseded and replaced.</span></p></span></div><div><span><h2 dir="ltr" style="line-height:1.15;margin-top:10pt;margin-bottom:0pt"><a name="TOC-complete-details-callback-"></a><span style="font-size:17px;font-family:Trebuchet MS;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">complete(details, callback)</span></h2></span></div><div><span><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">The </span><span style="font-family:Consolas;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">complete</span><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> method should be invoked when the user’s credentials have been verified by the SAML IdP and the user is authenticated. The </span><span style="font-family:Consolas;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">details</span><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> should be a JavaScript object that contains one field, </span><span style="font-family:Consolas;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">token</span><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">. The </span><span style="font-family:Consolas;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">token</span><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> must match the one that was passed to the </span><span style="font-family:Consolas;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">add</span><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> call for this authentication attempt, allowing the two calls to be correlated. The </span><span style="font-family:Consolas;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">complete</span><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> call indicates that the credentials which the IdP had passed to the corresponding </span><span style="font-family:Consolas;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">add</span><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> call are valid. Chrome will use these credentials to provide the session lock/unlock, offline sign-in, and data encryption features for this user. The </span><span style="font-family:Consolas;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">callback</span><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> will be invoked when Chrome has processed the credentials and has stored them permanently.</span></p></span></div><div><span><br /></span></div><div><span><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">After verifying the user’s credentials, an IdP needs to redirect to a Google URL, passing the </span><span style="font-family:Consolas;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">RelayState</span><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> and </span><span style="font-family:Consolas;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">SAMLResponse</span><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">. This is typically done by serving an HTML page that contains a hidden form which is submitted to the Google URL automatically upon page load. It is important to not actually submit the form until after the </span><span style="font-family:Consolas;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">callback</span><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> has been invoked. The recommended way to handle this is to call the </span><span style="font-family:Consolas;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">complete</span><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> method upon page load, setting the </span><span style="font-family:Consolas;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">callback</span><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> to </span><span style="font-family:Consolas;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">form.submit.bind(form)</span><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">, where </span><span style="font-family:Consolas;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">form</span><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> is the DOM node representing the hidden form. This way, the form will be submitted automatically when Chrome has processed the credential and invokes the </span><span style="font-family:Consolas;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">callback</span><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">.</span></p></span></div><div><span><br /></span></div><div><span><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">If the credentials provided are incorrect, the IdP must not call the </span><span style="font-family:Consolas;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">complete</span><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> method. When the SAML authentication flow completes with a </span><span style="font-family:Consolas;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">SAMLResponse</span><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> indicating authentication failure, Chrome will inform the user of the authentication failure and will allow him/her to try again, starting a new authentication flow.</span></p></span></div></blockquote><div><h4><a name="TOC-Limitations"></a><span><font size="4">Limitations</font></span></h4><span><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">The API can be used to securely pass a key derived from the user’s password to Chrome. If the user authenticates using other means (e.g., smart card, biometrics, single-use codes) and does not have a password, the API cannot be used as no key can be derived. Support for other authentication types is a separate problem outside the scope of the API at this time.</span></p><br /><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">The API is available in Chrome 36 and higher. Earlier Chrome versions behave like other user agents that do not support the API: It is safe to call the </span><span style="font-family:Consolas;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">initialize</span><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> method. Since the API is not supported, the </span><span style="font-family:Consolas;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">callback</span><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> passed to </span><span style="font-family:Consolas;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">initialize</span><span style="font-size:15px;font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> will never be invoked.</span></span></div></div></td></tr></tbody></table>
</div> 
</div> 
<div id="sites-canvas-bottom-panel">
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_page-subpages"> </div>
<div id="sites-attachments-container">
</div>
<a xmlns="http://www.w3.org/1999/xhtml" name="page-comments"></a>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_page-comments"><div class="sites-comment-docos-wrapper"><div class="sites-comment-docos"><div class="sites-comment-docos-background"></div><div class="sites-comment-docos-header"><div class="sites-comment-docos-header-title">Comments</div></div><div id="sites-comment-docos-pane" class="sites-comment-docos-pane"></div></div></div></div>
</div>
</div> 
</td> 
</tr>
</table> 
</div> 
</div> 
<div id="sites-chrome-footer-wrapper">
<div id="sites-chrome-footer-wrapper-inside">
<div id="sites-chrome-footer">
</div>
</div>
</div>
</div> 
</div> 
<div id="sites-chrome-adminfooter-container">
<div xmlns="http://www.w3.org/1999/xhtml" class="sites-adminfooter" role="navigation"><p><a class="sites-system-link" href="https://www.google.com/a/UniversalLogin?service=jotspot&amp;continue=https://sites.google.com/a/chromium.org/dev/administrators/advanced-integration-for-saml-sso-on-chrome-devices">Sign in</a><span aria-hidden="true">|</span><a class="sites-system-link" href="../system/app/pages/recentChanges.html">Recent Site Activity</a><span aria-hidden="true">|</span><a class="sites-system-link" href="../system/app/pages/reportAbuse.html" target="_blank">Report Abuse</a><span aria-hidden="true">|</span><a class="sites-system-link" href="javascript:;" onclick="window.open(webspace.printUrl)">Print Page</a><span aria-hidden="true">|</span><span class="sites-system-link">Powered By</span> <b class="powered-by"><a href="http://sites.google.com">Google Sites</a></b></p></div>
</div>
</div> 
</div> 
<div id="sites-chrome-onebar-footer">
</div>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    window.jstiming.load.tick('sjl');
  </script>
<script xmlns="http://www.w3.org/1999/xhtml" src="https://ssl.gstatic.com/sites/p/56e332/system/js/jot_min_view__en.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    window.jstiming.load.tick('jl');
  </script>
<script xmlns="http://www.w3.org/1999/xhtml">
      
          sites.core.Analytics.createTracker();
          sites.core.Analytics.trackPageview();
        
    </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
                    sites.Searchbox.initialize(
                        'sites-searchbox-search-button',
                        {"object":[]}['object'],
                        'search-site',
                        {"label":"Configure search options...","url":"/system/app/pages/admin/settings"});
                  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
      gsites.HoverPopupMenu.createSiteDropdownMenus('sites-header-nav-dropdown', false);
    </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
            JOT_setupNav("7648876402527094", "Navigation", false);
            JOT_addListener('titleChange', 'JOT_NAVIGATION_titleChange', 'COMP_7648876402527094');
          </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
            JOT_setupNav("14720868319272995", "Quick links", false);
            JOT_addListener('titleChange', 'JOT_NAVIGATION_titleChange', 'COMP_14720868319272995');
          </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
            JOT_setupNav("19690813310444355", "Other sites", false);
            JOT_addListener('titleChange', 'JOT_NAVIGATION_titleChange', 'COMP_19690813310444355');
          </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
              new sites.CommentPane('//docs.google.com/comments/d/AAHRpnXvrAwjAfmld0ObrebBiGRq9PRj6ABxQjzRmbupMW24BHF3tc9vQq6weGW23XW4QkBGZCm_YYla6zOAyaGBsgvSaWt8mjfLq4sSB1ScSZcdT1gfiVsFXbEHqFSLeThsUb2MzTvEp/api/js?anon=true',
                  false, false);
            </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
  setTimeout(function() {
    var fingerprint = gsites.date.TimeZone.getFingerprint([]);
    gsites.Xhr.send('https://www.chromium.org/_/tz', null, null, 'GET', null, null, { afjstz: fingerprint });
  }, 500);
</script>
<script xmlns="http://www.w3.org/1999/xhtml">
                    window.onload = function() {
                      if (false) {
                        JOT_setMobilePreview();
                      }
                      var loadTimer = window.jstiming.load;
                      loadTimer.tick("ol");
                      loadTimer["name"] = "load," + webspace.page.type + ",user_page";
                      window.jstiming.report(loadTimer, {}, 'https://gg.google.com/csi');
                    }
                  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
        JOT_insertAnalyticsCode(false,
            false);
      </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    var maestroRunner = new gsites.pages.view.SitesMaestroRunner(
        webspace, "en");
    maestroRunner.initListeners();
    maestroRunner.installEditRender();
  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
  //<![CDATA[
    // Decorate any fastUI buttons on the page with a class of 'goog-button'.
    if (webspace.user.hasWriteAccess) {
      JOT_decorateButtons();
    }

    // Fires delayed events.
    (function() {
      JOT_fullyLoaded = true;
      var delayedEvents = JOT_delayedEvents;
      for (var x = 0; x < delayedEvents.length; x++) {
        var event = delayedEvents[x];
        JOT_postEvent(event.eventName, event.eventSrc, event.payload);
      }
      JOT_delayedEvents = null;
      JOT_postEvent('pageLoaded');
    })();
  //]]>
</script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    JOT_postEvent('decorateGvizCharts');
  </script>
<script type="text/javascript">
          JOT_setupPostRenderingManager();
        </script>
<script type="text/javascript">
          JOT_postEvent('renderPlus', null, 'sites-chrome-main');
        </script>
<div id="server-timer-div" style="display:none"> </div>
<script type="text/javascript">
          window.jstiming.load.tick('render');
          JOT_postEvent('usercontentrendered', this);
        </script>
</body>
</html>
