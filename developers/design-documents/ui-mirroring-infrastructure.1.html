<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/WebPage">
<head>
<meta http-equiv="X-UA-Compatible" content="chrome=1" />
<script type="text/javascript">/* Copyright 2008 Google. */ (function() { var e="wtsrt_",g="tbsd_",h="tbnd_",k="start",l="_wtsrt",m="_tbnd",n="CSI/";(function(){function f(a){this.t={};this.tick=function(a,c,b){this.t[a]=[void 0!=b?b:(new Date).getTime(),c];if(void 0==b)try{window.console.timeStamp(n+a)}catch(d){}};this.tick(k,null,a)}var a;window.performance&&(a=window.performance.timing);var p=a?new f(a.responseStart):new f;window.jstiming={Timer:f,load:p};if(a){var c=a.navigationStart,d=a.responseStart;0<c&&d>=c&&(window.jstiming.srt=d-c)}if(a){var b=window.jstiming.load;0<c&&d>=c&&(b.tick(l,void 0,c),b.tick(e,l,d),b.tick(g,e))}try{a=null,
window.chrome&&window.chrome.csi&&(a=Math.floor(window.chrome.csi().pageT),b&&0<c&&(b.tick(m,void 0,window.chrome.csi().startE),b.tick(h,m,c))),null==a&&window.gtbExternal&&(a=window.gtbExternal.pageT()),null==a&&window.external&&(a=window.external.pageT,b&&0<c&&(b.tick(m,void 0,window.external.startE),b.tick(h,m,c))),a&&(window.jstiming.pt=a)}catch(q){}})(); })()
</script>
<link rel="shortcut icon" href="../../_/rsrc/1354323194313/favicon.ico" type="image/x-icon" />
<link rel="apple-touch-icon" href="https://ssl.gstatic.com/sites/p/56e332/system/app/images/apple-touch-icon.png" type="image/png" />
<script type="text/javascript">/* Copyright 2008 Google. */ (function() { var d="",g="__duration__",h="function";function k(c){return document.getElementById(c)}window.byId=k;function l(c){return c.replace(/^\s+|\s+$/g,d)}window.trim=l;var m=[],n=0;window.JOT_addListener=function(c,a,b){var e=new String(n++);c={eventName:c,handler:a,compId:b,key:e};m.push(c);return e};window.JOT_removeListenerByKey=function(c){for(var a=0;a<m.length;a++)if(m[a].key==c){m.splice(a,1);break}};
window.JOT_removeAllListenersForName=function(c){for(var a=0;a<m.length;a++)m[a].eventName==c&&m.splice(a,1)};window.JOT_postEvent=function(c,a,b){var e={eventName:c,eventSrc:a||{},payload:b||{}};if(window.JOT_fullyLoaded)for(a=m.length,b=0;b<a&&b<m.length;b++){var f=m[b];f&&f.eventName==c&&(e.listenerCompId=f.compId||d,(f=typeof f.handler==h?f.handler:window[f.handler])&&f(e))}else window.JOT_delayedEvents.push({eventName:c,eventSrc:a,payload:b})};window.JOT_delayedEvents=[];
window.JOT_fullyLoaded=!1;window.JOT_formatRelativeToNow=function(c,a){var b=((new Date).getTime()-c)/6E4;if(1440<=b||0>b)return null;var e=0;60<=b&&(b/=60,e=2);2<=b&&e++;return a?window.JOT_siteRelTimeStrs[e].replace(g,Math.floor(b)):window.JOT_userRelTimeStrs[e].replace(g,Math.floor(b))}; })()
</script>
<script>

  

  var breadcrumbs = [{"path":"/developers","deleted":false,"title":"For Developers","dir":"ltr"},{"path":"/developers/design-documents","deleted":false,"title":"Design Documents","dir":"ltr"},{"path":"/developers/design-documents/ui-mirroring-infrastructure","deleted":false,"title":"UI Mirroring Infrastructure","dir":"ltr"}];
  var JOT_clearDotPath = 'https://ssl.gstatic.com/sites/p/56e332/system/app/images/cleardot.gif';

  
  var JOT_userRelTimeStrs = ["a minute ago","__duration__ minutes ago","an hour ago","__duration__ hours ago"];

  
  

  

  var webspace = {"enableAnalytics":true,"pageSharingId":"jotspot_page","enableUniversalAnalytics":false,"sharingPolicy":"OPENED_WITH_INDICATOR","siteTitle":"The Chromium Projects","isStartPageEnabled":true,"adsensePublisherId":null,"features":{"languageSelectDefaultTextSetToDefault":true,"validateClientGvizDataSourceUrls":true,"moreMobileStyleImprovements":true,"newInsertMenuIcons":true,"accessibleSortingButtons":true,"domainAnalyticsInGAOnly":true,"noCaptcha":true,"fileCabinetScreenReaderFix":true,"updatedTosAndPrivacyLinks":null,"pageDrafts":false,"mobileOrientationFix":true,"plusBadge":false,"pdfEmbedSupport":false,"jsClickFix":true},"isPublic":true,"isConsumer":false,"serverFlags":{"cajaBaseUrl":"//www.gstatic.com/caja","cajaDebugMode":false},"onepickBaseUrl":"https://docs.google.com","domainAnalyticsAccountId":"","plusPageId":"","signInUrl":"https://www.google.com/a/SelectSession?continue\u003dhttps://sites.google.com/a/chromium.org/dev/developers/design-documents/ui-mirroring-infrastructure\u0026service\u003djotspot","analyticsAccountId":"UA-5484340-1","scottyUrl":"/_/upload","homePath":"/","siteNoticeUrlEnabled":null,"plusPageUrl":"","adsensePromoClickedOrSiteIneligible":true,"csiReportUri":"https://gg.google.com/csi","sharingId":"jotspot","termsUrl":"//www.google.com/intl/en/policies/terms/","gvizVersion":1,"editorResources":{"sitelayout":["https://ssl.gstatic.com/sites/p/56e332/system/app/css/sitelayouteditor.css"],"text":["https://ssl.gstatic.com/sites/p/56e332/system/js/codemirror.js","https://ssl.gstatic.com/sites/p/56e332/system/app/css/codemirror_css.css","https://ssl.gstatic.com/sites/p/56e332/system/js/trog_edit__en.js","https://ssl.gstatic.com/sites/p/56e332/system/app/css/trogedit.css","/_/rsrc/1441580320000/system/app/css/editor.css","https://ssl.gstatic.com/sites/p/56e332/system/app/css/codeeditor.css","/_/rsrc/1441580320000/system/app/css/camelot/editor-jfk-wlb.css"]},"sharingUrlPrefix":"/_/sharing","isAdsenseEnabled":true,"domain":"chromium.org","baseUri":"","name":"dev","siteTemplateId":false,"siteNoticeRevision":null,"siteNoticeUrlAddress":null,"siteNoticeMessage":null,"page":{"isRtlLocale":false,"canDeleteWebspace":null,"isPageDraft":null,"parentPath":"/developers/design-documents","parentWuid":"wuid:gx:359ef223e0fb14ac","siteLocale":"en","timeZone":"America/Los_Angeles","type":"text","title":"UI Mirroring Infrastructure","locale":"en","wuid":"wuid:gx:42c7bcdf7635ae1","revision":2,"path":"/developers/design-documents/ui-mirroring-infrastructure","isSiteRtlLocale":false,"pageInheritsPermissions":null,"name":"ui-mirroring-infrastructure","canChangePath":true,"state":"","properties":{},"bidiEnabled":false,"currentTemplate":{"path":"/system/app/pagetemplates/text","title":"Web Page"}},"canPublishScriptToAnyone":true,"user":{"keyboardShortcuts":true,"sessionIndex":"","guest_":true,"displayNameOrEmail":"guest","userName":"guest","uid":"","renderMobile":false,"domain":"","namespace":"","hasWriteAccess":false,"namespaceUser":false,"primaryEmail":"guest","hasAdminAccess":false},"gadgets":{"baseUri":"/system/app/pages/gadgets"}};
  webspace.page.breadcrumbs = breadcrumbs;

  
  var JOT_siteRelTimeStrs = ["a minute ago","__duration__ minutes ago","an hour ago","__duration__ hours ago"];

</script>
<script type="text/javascript">
                window.jstiming.load.tick('scl');
              </script>
<meta name="title" content="UI Mirroring Infrastructure - The Chromium Projects" />
<meta itemprop="name" content="UI Mirroring Infrastructure - The Chromium Projects" />
<meta property="og:title" content="UI Mirroring Infrastructure - The Chromium Projects" />
<meta name="description" content="Home of the Chromium Open Source Project" />
<meta itemprop="description" content="Home of the Chromium Open Source Project" />
<meta id="meta-tag-description" property="og:description" content="Home of the Chromium Open Source Project" />
<style type="text/css">
</style>
<link rel="stylesheet" type="text/css" href="https://ssl.gstatic.com/sites/p/56e332/system/app/themes/beigeandblue/standard-css-beigeandblue-ltr-ltr.css" />
<link rel="stylesheet" type="text/css" href="../../_/rsrc/1441580320000/system/app/css/overlay.css%3Fcb=beigeandblueundefineda100%2525%2525150goog-ws-leftthemedefaultstandard.css" />
<link rel="stylesheet" type="text/css" href="../../_/rsrc/1441580320000/system/app/css/camelot/allthemes-view.css" />
<!--[if IE]>
          <link rel="stylesheet" type="text/css" href="/system/app/css/camelot/allthemes%2die.css" />
        <![endif]-->
<title>UI Mirroring Infrastructure - The Chromium Projects</title>
<meta itemprop="image" content="https://www.chromium.org/_/rsrc/1220197834541/developers/design-documents/ui-mirroring-infrastructure/explorer_window_en_us.jpg" />
<meta property="og:image" content="https://www.chromium.org/_/rsrc/1220197834541/developers/design-documents/ui-mirroring-infrastructure/explorer_window_en_us.jpg" />
<script type="text/javascript">
                window.jstiming.load.tick('cl');
              </script>
</head>
<body xmlns="http://www.google.com/ns/jotspot" id="body" class=" en            ">
<div id="sites-page-toolbar" class="sites-header-divider">
<div xmlns="http://www.w3.org/1999/xhtml" id="sites-status" class="sites-status" style="display:none;"><div id="sites-notice" class="sites-notice" role="status" aria-live="assertive"> </div></div>
</div>
<div id="sites-chrome-everything-scrollbar">
<div id="sites-chrome-everything" class="">
<div id="sites-chrome-page-wrapper" style="direction: ltr">
<div id="sites-chrome-page-wrapper-inside">
<div xmlns="http://www.w3.org/1999/xhtml" id="sites-chrome-header-wrapper" style="height:auto;">
<table id="sites-chrome-header" class="sites-layout-hbox" cellspacing="0" style="height:auto;">
<tr class="sites-header-primary-row" id="sites-chrome-userheader">
<td id="sites-header-title" class="" role="banner"><div class="sites-header-cell-buffer-wrapper"><a href="../../index.html" id="sites-chrome-userheader-logo"><img id="logo-img-id" src="../../_/rsrc/1438879449147/config/customLogo.gif%3Frevision=3" alt="The Chromium Projects" class="sites-logo  " /></a><h2><a href="../../index.html" dir="ltr" id="sites-chrome-userheader-title">The Chromium Projects</a></h2></div></td><td class="sites-layout-searchbox  "><div class="sites-header-cell-buffer-wrapper"><form id="sites-searchbox-form" action="https://www.chromium.org/system/app/pages/search" role="search"><input type="hidden" id="sites-searchbox-scope" name="scope" value="search-site" /><input type="text" id="jot-ui-searchInput" name="q" size="20" value="" aria-label="Search this site" /><div id="sites-searchbox-button-set" class="goog-inline-block"><div role="button" id="sites-searchbox-search-button" class="goog-inline-block jfk-button jfk-button-standard" tabindex="0">Search this site</div></div></form></div></td>
</tr>
<tr class="sites-header-secondary-row" id="sites-chrome-horizontal-nav">
<td colspan="2" id="sites-chrome-header-horizontal-nav-container" role="navigation">
</td>
</tr>
</table>
</div>
<div id="sites-chrome-main-wrapper">
<div id="sites-chrome-main-wrapper-inside">
<table id="sites-chrome-main" class="sites-layout-hbox" cellspacing="0" cellpadding="{scmCellpadding}" border="0">
<tr>
<td id="sites-chrome-sidebar-left" class="sites-layout-sidebar-left initial" style="width:150px">
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_7648876402527094" class="sites-embed" role="navigation"><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotId="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="../../chromium-projects.html" jotId="wuid:gx:10ae433dadbbab13" class="sites-navigation-link">Home</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="../../Home.1.html" jotId="wuid:gx:43582b9d2029d3af" class="sites-navigation-link">Chromium</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="../../chromium-os.1.html" jotId="wuid:gx:83df2ab1f8880ba" class="sites-navigation-link">Chromium OS</a></div></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_14720868319272995" class="sites-embed" role="navigation"><h4 class="sites-embed-title">Quick links</h4><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotId="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="../../for-testers/bug-reporting-guidelines.html" class="sites-navigation-link">Report bugs</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="../discussion-groups.html" class="sites-navigation-link">Discuss</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="../../system/app/pages/sitemap/hierarchy.html" jotId="wuid:gx:4b58a9a350ad12f" class="sites-navigation-link">网站地图</a></div></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_19690813310444355" class="sites-embed" role="navigation"><h4 class="sites-embed-title">Other sites</h4><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotId="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="http://blog.chromium.org/" class="sites-navigation-link">Chromium Blog</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="http://code.google.com/chrome/extensions/" class="sites-navigation-link">Google Chrome Extensions</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="https://developers.google.com/chrome/chrome-frame/" class="sites-navigation-link">Google Chrome Frame</a></div></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_19695218559354544" class="sites-embed" role="complementary"><h4 class="sites-embed-title"></h4><div class="sites-embed-content sites-embed-content-sidebar-textbox"><div dir="ltr"><span style="font-size:x-small">Except as otherwise </span><a href="http://developers.google.com/site-policies.html#restrictions"><span style="font-size:x-small">noted</span></a><span style="font-size:x-small">, the content of this page is licensed under a </span><a href="http://creativecommons.org/licenses/by/2.5/"><span style="font-size:x-small">Creative Commons Attribution 2.5 license</span></a><span style="font-size:x-small">, and examples are licensed under the </span><a href="http://src.chromium.org/viewvc/chrome/trunk/src/LICENSE" target="_blank"><span style="font-size:x-small">BSD License</span></a><span style="font-size:x-small">.<br /></span></div></div></div>
</td>
<td id="sites-canvas-wrapper">
<div id="sites-canvas" role="main">
<div id="goog-ws-editor-toolbar-container"> </div>
<div xmlns="http://www.w3.org/1999/xhtml" id="title-crumbs" style="">
<A href="../../developers.1.html" dir="ltr">For Developers</A>‎ &gt; ‎<A href="../design-documents.1.html" dir="ltr">Design Documents</A>‎ &gt; ‎
  </div>
<h3 xmlns="http://www.w3.org/1999/xhtml" id="sites-page-title-header" style="" align="left">
<span id="sites-page-title" dir="ltr" tabindex="-1" style="outline: none">UI Mirroring Infrastructure</span>
</h3>
<div id="sites-canvas-main" class="sites-canvas-main">
<div id="sites-canvas-main-content">
<table xmlns="http://www.w3.org/1999/xhtml" cellspacing="0" class="sites-layout-name-one-column sites-layout-hbox"><tbody><tr><td class="sites-layout-tile sites-tile-name-content-1"><div dir="ltr"><div dir="ltr"><div dir="ltr"><div dir="ltr"><div dir="ltr"><div dir="ltr">
<div dir="ltr">
<div class="sites-embed-align-left-wrapping-on"><div class="sites-embed-border-off sites-embed" style="width:250px;"><div class="sites-embed-content sites-embed-type-toc"><div class="goog-toc sites-embed-toc-maxdepth-6"><p>Contents</p><ol class="goog-toc"><li class="goog-toc"><a href="ui-mirroring-infrastructure.1.html#TOC-Objective"><strong>1 </strong>Objective</a></li><li class="goog-toc"><a href="ui-mirroring-infrastructure.1.html#TOC-Windows-UI-mirroring-architecture"><strong>2 </strong>Windows UI mirroring architecture</a><ol class="goog-toc"><li class="goog-toc"><a href="ui-mirroring-infrastructure.1.html#TOC-An-example"><strong>2.1 </strong>An example</a></li><li class="goog-toc"><a href="ui-mirroring-infrastructure.1.html#TOC-How-does-Windows-do-it-"><strong>2.2 </strong>How does Windows do it?</a></li></ol></li><li class="goog-toc"><a href="ui-mirroring-infrastructure.1.html#TOC-ChromeViews-mirroring-infrastructure"><strong>3 </strong>ChromeViews mirroring infrastructure</a><ol class="goog-toc"><li class="goog-toc"><a href="ui-mirroring-infrastructure.1.html#TOC-ChromeViews::View-mirroring-support"><strong>3.1 </strong>ChromeViews::View mirroring support</a></li><li class="goog-toc"><a href="ui-mirroring-infrastructure.1.html#TOC-Chromium-support-for-native-mirroring"><strong>3.2 </strong>Chromium support for native mirroring</a></li></ol></li><li class="goog-toc"><a href="ui-mirroring-infrastructure.1.html#TOC-How-to-write-RTL-ready-Chromium-UI"><strong>4 </strong>How to write RTL-ready Chromium UI</a></li><li class="goog-toc"><a href="ui-mirroring-infrastructure.1.html#TOC-How-to-test-a-mirrored-Chromium-UI-element"><strong>5 </strong>How to test a mirrored Chromium UI element</a></li></ol></div></div></div></div>
<h2><a name="TOC-Objective"></a>
        
      Objective
</h2><p>One of the goals for the  launch of Chromium is to support 40 UI languages; that is, the  UI needs to be localized for each language such that any UI text element (menus, titles, labels, etc.) is displayed in the target language. In order to make sure that Chromium can be easily localized to different languages (an effort known as <i>localizability</i>), the Chromium source code is structured such that localizable strings are stored in locale-specific DLLs. This way, the actual UI strings are loaded from the right DLL, depending on the target locale. There is one more localizability aspect which applies only to right-to-left (RTL) languages, such as Hebrew and Arabic. In such languages, translating the strings to the target language is not enough. In order to provide a perfect right-to-left look and feel to the browser, the entire UI needs to be mirrored.</p>
<p>This document starts by providing a brief overview of the UI mirroring technology in general and in particular the Windows support for UI mirroring. Then, the newly added ChromeViews mirroring infrastructure is described. Using this new infrastructure, the Chromium UI elements can be easily mirrored for RTL locales. Finally, and most importantly, the document provides a set of guidelines for writing Chromium UI elements that don't break when mirrored in RTL UIs.</p>
<h2><a name="TOC-Windows-UI-mirroring-architecture"></a>Windows UI mirroring architecture </h2>
<h3><a name="TOC-An-example"></a>An example </h3>
<p>The Windows operating system itself has been localized for a large set of languages, including right-to-left languages like Hebrew. Thus, users of the Hebrew version of Windows are presented with a mirrored version of the English OS UI. Before we examine the mirroring Windows API available to application developers, it will be helpful to compare the mirrored and the non-mirrored versions of a fundamental Windows UI component - Windows Explorer. Looking at the manner in which the Windows OS mirrors its core UI elements will shed some light on the ChromeViews Mirroring Infrastructure design. The following diagram shows the English version of Windows Explorer we are all familiar with:</p>
<div style="display:block;text-align:left"><a href="ui-mirroring-infrastructure/explorer_window_en_us.jpg%3Fattredirects=0" imageanchor="1"><img border="0" src="../../_/rsrc/1220197834541/developers/design-documents/ui-mirroring-infrastructure/explorer_window_en_us.jpg" /></a></div>
<p>The first thing to note about the English version is that left alignment is used for all the text elements. Also, there are two groups of highlighted UI elements (the red group and the black group) that behave differently when displayed in a mirrored UI. The elements in both groups contain an image (a bitmap or an icon). All the elements in the red group (elements 1, 2 and 3) contain direction sensitive images; that is, the images in these elements must be flipped horizontally when displayed in mirrored UIs. Not flipping direction sensitive graphics can cause various UI problems. For example, not flipping the resize bitmap (item 3) will cause the UI to appear incorrectly - a Southeast-oriented resize bar will appear in the Southwest corner of the window. Not flipping the back button (item 1) will result in a confusing user experience - the button will say 'Back' but the arrow will point to a direction indicating going 'Forward'. All the elements in the black group (elements A, B and C) do not contain direction sensitive images. Thus, the images in these elements must look the same in mirrored and non-mirrored UIs. Generally, legal trademarks, logos, favicons, etc. are not direction sensitive and flipping them horizontally in mirrored UIs does not make sense. Following is the Hebrew (and therefore mirrored) version of Windows Explorer:</p>
<div style="display:block;text-align:left"><a href="ui-mirroring-infrastructure/explorer_window_he.jpg%3Fattredirects=0" imageanchor="1"><img border="0" src="../../_/rsrc/1220197834922/developers/design-documents/ui-mirroring-infrastructure/explorer_window_he.jpg" /></a></div>
<p>The first thing to note about the Hebrew version is that right alignment is used for all the text elements (English and Hebrew). Also, all the UI text (menus, buttons, status bar info, etc.) is translated to Hebrew. All the UI elements and sub-elements are mirrored recursively. For example, the position of the folder tree view is mirrored (it is on the right-hand side of the window and not the left-hand side). The elements in the tree view (the plus signs, the directory icons, etc.) also appear in their mirrored position within the tree view. Note how even though the position of all the highlighted elements is mirrored, the elements in the black group look exactly the same as they did in the English version while the elements in the red group are flipped horizontally.</p>
<h3><a name="TOC-How-does-Windows-do-it-"></a>How does Windows do it? </h3>
<p>The Windows API provides a set of useful techniques for dealing with RTL UI localization. The goal of the Windows UI mirroring API is to allow GUI developers to write UI code without having to worry about mirroring the UI for right-to-left locales. The UI is created using well known Windows GUI constructs (HWNDs, Device Contexts, Dialog Boxes, etc.) and then an RTL layout property can be applied to individual elements in order to mirror their UI. For example, the property WS_EX_LAYOUTRTL can be applied to an HWND in order to mirror the UI of the underlying window. When an RTL layout is applied to a GUI element, the element's coordinate system is transformed in the following manner:</p>
<div style="display:block;text-align:left"><a href="ui-mirroring-infrastructure/ws_layout_rtl.jpg%3Fattredirects=0" imageanchor="1"><img border="0" src="../../_/rsrc/1220197836357/developers/design-documents/ui-mirroring-infrastructure/ws_layout_rtl.jpg" /></a></div>
<p>When using an RTL layout, the right-most horizontal coordinate value is 0 (instead of the leftmost) and the coordinate values increase (instead of decrease) when moving from right to left on the X axis. Using this transformation, a UI element the application positions in the top left corner will be positioned on the top right corner when the UI is mirrored. The concept of coordinate transformation is extremely powerful since it doesn't require the GUI application's logic to change in order to support mirroring. In reality, however, more often than not mirroring a GUI application involves much more than just setting a few flags. There are a few bad programming practices that cause the GUI application to appear incorrectly when mirrored. For the most part these have to do with incorrect conversions between screen and window coordinates. To learn more about the Windows mirroring API and about how to avoid programming techniques that don't work well in mirrored UIs, see the following <a href="http://msdn2.microsoft.com/en-us/goglobal/bb688119.aspx">MSDN article</a>.</p>
<h2><a name="TOC-ChromeViews-mirroring-infrastructure"></a>ChromeViews mirroring infrastructure </h2>
<p>Chromium has a portable, object oriented UI framework (aka <i>ChromeViews</i>) that allows developers to write Chromium UI elements. In order to allow the Chromium UI to be mirrored easily, a mirroring infrastructure needed to be added to the <i>ChromeViews</i> framework. The inherent Windows support could not be used by itself to mirror the Chromium UI for a few different reasons:</p>
<ul>
<li>In order to render the Chromium UI elements inside a Windows HWND (such as the window created by XPFrame), the entire Chromium UI is rendered into a DIB and then the DIB is being <i>BitBlt</i>ed into the underlying HWND's device context (or HDC). Setting the WS_EX_LAYOUTRTL property of the top level Chromium HWND means that any text drawn into the DIB (using Windows' DrawText API) will need to be drawn such that each and every glyph is mirrored (so that flipping the DIB into the mirrored HDC will display the correct text). The problem with this method is that it will break ClearType because ClearType text rendering is direction dependant (which subpixels the ClearType algorithm sets depends on where the subpixels are relative to the drawn glyphs); in other words, flipping a bitmap containing ClearType is guaranteed to break the cripsness of the text.
	</li>
<br />
<li><i>ChromeViews</i> is a portable framework and therefore it does not make much sense to use a platform-specific solution for mirroring in code that needs to remain portable.</li>
<br />
<li>The Windows mirroring applies to the HWND hierarchy of windows and controls. <i>ChromeViews</i> has its own concept of UI elements hierarchy and it is not possible to use the Windows API for mirroring and still have the flexibility of controlling mirroring in a <i>View</i> subclass granularity; in other words, not every <i>View</i> subclass is associated with a Windows HWND handle and it is therefore not possible to control the setting of each and every Chromium UI element by only using HWND mirroring. As we'll see later on, the Chromium mirroring infrastructure does use Windows native mirroring for the Chromium native UI controls.</li>
</ul>
<h3><a name="TOC-ChromeViews::View-mirroring-support"></a>ChromeViews::View mirroring support </h3>
<p>The Chromium mirroring infrastructure and API resides mostly in the <i>ChromeViews::View</i> class since it is the base class for the majority of the Chromium browser UI elements. Before describing the interface, it is important to note that whenever we refer to the concept of 'locale' or 'current locale' we refer to the Chromium UI language. The locale concept entails more than just the UI language, but for the purpose of explaining the mirroring infrastructure, it is OK to ignore the other locale aspects or the logic Chromium uses in order to set the default locale.</p>
<p>Just like the Windows mirroring API, the corresponding Chromium API is designed in a way that frees individual GUI developers from the burden of programmatically mirroring UI elements and sub elements. However, the API has certain limitations and in some cases more mirroring-related code needs to be written for specific Chromium UI elements. Chromium <i>View</i> subclasses that follow a certain set of conventions (described in <b>How to write RTL-ready Chromium UI</b>,  below), are going to work well in mirrored UIs and won't need to have additional code for handling right-to-left layout issues. For a complete documentation of the mirroring API, refer to the comments in <span style="font-family:courier new,monospace">view.h</span>. Here is a brief description of the new mirroring functions:</p>
<ul>
<li><b>GetBounds(), GetX()</b> overloaded versions were added that take a parameter indicating whether to apply the mirroring coordinate transformation to the X coordinate of the <i>View</i>. Most <i>View</i> subclasses don't need to use these new methods and should continue using the version of these two functions that don't take the new transformation parameter.</li>
<li><b>UILayoutIsRightToLeft()</b> determines whether the layout for the <i>View</i> is right-to-left. The <i>View</i>'s layout is RTL if the locale's language is a right-to-left language AND the RTL layout is not disabled for the <i>View</i>.</li>
<li><b>FlipCanvasOnPaintForRTLUI()</b> determines whether the <i>ChromeCanvas</i> used by the <i>View</i> to draw graphics (when the <i>View::Paint()</i> is invoked) should be transformed such that bitmaps are automatically flipped horizontally. This function returns true if the UI layout for the <i>View</i> is RTL AND if canvas flipping has been enabled for the <i>View</i> using<i>EnableCanvasFlippingForRTLUI</i> (see later).</li>
<li><b>EnableUIMirroringForRTLLanguages()</b> allows RTL UI layout to be enabled/disabled for the <i>View</i>. This is useful if a specific <i>View</i> subclass instance needs to use an LTR layout regardless of the locale.</li>
<li><b>EnableCanvasFlippingForRTLUI()</b> allows RTL canvas flipping to be enabled/disabled for the <i>View</i>. Using this method, it is easy to control whether or not the graphics drawn by the <i>View</i> is going to be flipped horizontally when the locale is RTL. Generally, canvas flipping is enabled for <i>Views</i> representing direction sensitive UI elements and it is disabled for direction insensitive<i>Views</i>.</li>
<li><b>MirroredX()</b> returns the mirrored X coordinate for the <i>View</i>. There is generally no need for subclasses to use this method.</li>
<li><b>MirroredLeftPointForRect()</b> returns the mirrored X coordinate of a given region relative to the <i>View</i>'s bounds. This method is used only when the <i>View</i> is drawing different UI elements on the canvas and thus needs to 'manually' mirror the position of each such element if the UI layout is RTL.</li>
<li><b>MirroredXCoordinateInsideView()</b> allows mirroring a given X coordinate inside the <i>View</i> bounds. Generally, this functionality is needed only for handling drag/drop operations, to make sure that the drop position is aligned with the display position of the <i>Views</i> in question.</li>
<li><b>GetViewForPoint(), ConvertPointForView(), etc.</b> the various point-to-view methods have been modified to use the mirrored position of the <i>View</i> so that things like mouse events use the mirrored point of the <i>View</i> inside the parent.</li>
</ul>
<p><b>NOTE: unlike Windows, the mirroring infrastructure in Chromium does not rely on coordinate transformations. Regardless of the locale, mouse events are always relative to the top left corner of the View.</b></p>
<p>The best way to demonstrate how the API works is to look at a hypothetical <i>View</i> subclass named Foo that contains three child <i>View</i>s. Here is the code snippet from the header file:</p>
<pre style="color:rgb(0,96,0);white-space:pre-wrap">class BitmapView : public ChromeViews::View {<br /><br />  ...<br /><br /> public:<br />  BitmapView() {<br />    // By default, we want to flip the canvas so that the bitmap is flipped<br />    // when the UI layout is right-to-left.<br />    EnableCanvasFlippingForRTLUI(true);<br />  }<br /><br />  virtual void Paint(ChromeCanvas* canvas) {<br />    canvas-&gt;DrawBitmapInt(bitmap_, 0, 0);<br />  }<br /><br /> private:<br /><br />  // The bitmap we draw on the canvas.<br />  SkBitmap bitmap_;<br /><br />  ...<br />}<br /><br />class Foo : public ChromeViews::View {<br /><br /> public:<br /><br />  // Layout the three child bitmap Views diagonally from top left to bottom<br />  // right.<br />  virtual void Layout() {<br />    ...<br />  }<br /><br /> private:<br /><br />  BitmapView* bitmap_one_;<br />  BitmapView* bitmap_two_;<br />  BitmapView* bitmap_three_;<br /><br />  ...<br /><br />}<br />
</pre>
<p>The <i>Foo</i> class contains three child <i>View</i>s that are laid out diagonally from top left to bottom right. Each child is an instance of the <i>BitmapView</i> subclass which represents a single bitmap. The following diagram visualizes the impact of different API calls on the manner in which <i>Foo</i> is rendered. Note that in the example, children one, two, and three contain a bitmap with the corresponding number.</p>
<div style="display:block;text-align:left"><a href="ui-mirroring-infrastructure/mirroring_api.jpg%3Fattredirects=0" imageanchor="1"><img border="0" src="../../_/rsrc/1220197835664/developers/design-documents/ui-mirroring-infrastructure/mirroring_api.jpg" /></a></div>
<p>It is important to emphasize that even though the mirroring API contains quite a few elements, <i>View</i> subclasses don't need to explicitly use the API in the majority of the cases. As an example, consider <i>BrowserToolbarView</i>, which is a <i>View</i> subclass with several child <i>Views</i>. Here is a snippet from <span style="font-family:courier new,monospace">toolbar_view.h</span> with the definition of the different Toolbar controls:</p>
<pre style="color:rgb(0,96,0);white-space:pre-wrap">class BrowserToolbarView : public ChromeViews::View,<br />                           public Menu::BaseControllerDelegate,<br />                           public ChromeViews::ViewMenuDelegate,<br />                           public ChromeViews::DragController,<br />                           public LocationBarView::Delegate {<br />  ...<br /><br />  // Controls<br />  ChromeViews::Button* back_;<br />  ChromeViews::Button* forward_;<br />  ChromeViews::Button* reload_;<br />  ChromeViews::ToggleButton* star_;<br />  LocationBarView* location_bar_;<br />  GoButton* go_;<br />  ChromeViews::MenuButton* page_menu_;<br />  ChromeViews::MenuButton* app_menu_;<br /><br />  ...<br />}<br />
</pre>
<p>All the toolbar's UI sub elements are child <i>View</i>s and the toolbar class does not render any UI elements itself. Instead, it delegates painting to its sub elements (we'll explain later why this is the preferred way to structure a <i>View</i> subclass). Here is a snippet from the code in <i>BrowserToolbarView::Layout()</i>:</p>
<pre style="color:rgb(0,96,0);white-space:pre-wrap">void BrowserToolbarView::Layout() {<br /><br />  ...<br /><br />  back_-&gt;GetPreferredSize(&amp;sz);<br />  back_-&gt;SetBounds(kControlIndent,<br />                   kControlVertOffset,<br />                   sz.cx,<br />                   sz.cy);<br /><br />  forward_-&gt;GetPreferredSize(&amp;sz);<br />  forward_-&gt;SetBounds(back_-&gt;GetX() + back_-&gt;GetWidth(),<br />                      kControlVertOffset,<br />                      sz.cx,<br />                      sz.cy);<br /><br />  ...<br /><br />}<br /></pre>
<p>The toolbar lays out its child elements using the normal <i>View</i> positioning API (GetX(), GetBounds(), etc.) and does not have to special case the layout for RTL locales. Finally, here is what the toolbar looks like in RTL and LTR locales:</p>
<div style="display:block;text-align:left"><a href="ui-mirroring-infrastructure/chrome_toolbar.jpg%3Fattredirects=0" imageanchor="1"><img border="0" src="../../_/rsrc/1220197834369/developers/design-documents/ui-mirroring-infrastructure/chrome_toolbar.jpg" /></a></div>
<p>The toolbar's code didn't need to change at all in order to appear correctly in an RTL UI. The toolbar is an example of a <i>View</i> subclass for which UI mirroring is taken care off automatically by the new framework. This is unfortunately not the case for all the Chromium UI elements.</p>
<h3><a name="TOC-Chromium-support-for-native-mirroring"></a>Chromium support for native mirroring </h3>
<p>Most of the Chromium mirroring infrastructure resides in <i>ChromeViews</i>. However, since Chromium also uses Windows native UI controls, the mirroring infrastructure includes interfaces that allow mirroring these controls easily. Here is a brief description of the interface:</p>
<ul>
<li><b>NativeControl::GetAdditionalExStyle()</b> when <i>NativeControl</i> subclasses invoke <i>::CreateWindowEx</i> in order to create the underlying Windows control, they must bitwise-or the value returned from this function with the control's extended style. This way, if mirroring is turned on for the control, then WS_EX_LAYOUTRTL will be passed when creating the control.</li>
<li><b>MenuHostWindow::Delegate::IsRightToLeftUILayout()</b> this virtual method lets the menu delegate control the directionality of the menu. By default, the direction is derived from the locale's direction so generally subclasses don't need to override this method.</li>
</ul>
<h2><a name="TOC-How-to-write-RTL-ready-Chromium-UI"></a>How to write RTL-ready Chromium UI </h2>
<p>The mirroring infrastructure described in this document is designed to be transparent to GUI developers. However, this is true only if the UI elements adhere to a certain set of conventions. Not following these rules when writing a UI element generally means that mirroring-specific code will need to be added to the element so that it is displayed correctly in right-to-left locales. This section describes the rules together with examples that demonstrate why not following these rules is problematic. Even though it is discouraged to put mirroring-specific code in a UI element (it is better to just follow the rules), this section shows how to handle mirroring manually in UI components. This is useful for UI component that, for whatever reason, can not be written in a manner that allows the mirroring infrastructure to display the component correctly in RTL locales.</p>
<p><b>Rule #1: represent UI sub elements as child <i>View</i>s</b></p>
<p>The Chromium toolbar example presented earlier is an example of a Chromium <i>View</i> subclass that contains several child <i>View</i>s as its sub elements. The toolbar lays out the sub elements, but it does not do any rendering. Instead, rendering is done by the individual sub elements. In other words, for the toolbar, the 'leaf' elements in the UI tree are the only elements that draw graphics on the canvas during <i>View::Paint()</i>. This method plays well with the mirroring infrastructure since the coordinate transformation can be easily applied to the bounds of the child elements. One of the Chromium UI components that does not adhere to this rule is the <i>Tab</i> (see chrome/browser/tabs/tab.h). The <i>Tab</i> contains three UI sub elements. A 'close' button, a title and a favicon. The button is represented as a <i>ChromeView::Button</i> child <i>View</i>. The title and the favicon are both drawn directly on the canvas by the <i>Tab</i> class during <i>View::Paint()</i>. While the tabs look correctly on left-to-right locales, they don't on RTL locales:</p>
<div style="display:block;text-align:left"><a href="ui-mirroring-infrastructure/tabs_layout_bug.jpg%3Fattredirects=0" imageanchor="1"><img border="0" src="../../_/rsrc/1220197836223/developers/design-documents/ui-mirroring-infrastructure/tabs_layout_bug.jpg" /></a></div>
<p>As the image shows, the button is positioned correctly on the left-hand side of the tab because during <i>Tab::Layout()</i>, it is positioned on the right-hand side (which becomes left when applying the coordinate transformation). The title and the favicon, on the other hand, are not positioned in the same manner since they are not child views. During <i>Tab::Paint()</i>, they are still drawn on the left-hand side, instead of the right-hand side. Readers of this (already long and boring) document are probably thinking the following right now: "This can probably be solved if <i>View::EnableCanvasFlippingForRTLUI(true);</i> is invoked in <i>Tab</i>'s constructor so that the canvas is transformed.". Well, think again:</p>
<div style="display:block;text-align:left"><a href="ui-mirroring-infrastructure/tabs_flipping_bug.jpg%3Fattredirects=0" imageanchor="1"><img border="0" src="../../_/rsrc/1220197836070/developers/design-documents/ui-mirroring-infrastructure/tabs_flipping_bug.jpg" /></a></div>
<p>Flipping the canvas makes sense only for 'leaf' <i>View</i>s that draw graphics on their entire area. When drawing different elements on the canvas, it is not possible to use the mirroring infrastructure in order to control the appearance of each element. The best way to fix the problem is to represent the title and the favicon as child views. If that's not possible, the position of these elements needs to be mirrored manually:</p>
<pre style="color:rgb(0,96,0);white-space:pre-wrap">favicon_bounds_.set_x(MirroredLeftPointForRect(favicon_bounds_));<br />title_bounds_.set_x(MirroredLeftPointForRect(title_bounds_));<br /></pre>
<p>With this change, the tabs are displayed properly:</p>
<div style="display:block;text-align:left"><a href="ui-mirroring-infrastructure/tabs_fixed.jpg%3Fattredirects=0" imageanchor="1"><img border="0" src="../../_/rsrc/1220197835880/developers/design-documents/ui-mirroring-infrastructure/tabs_fixed.jpg" /></a></div>
<p><b>Rule #2: don't make assumptions such as top-left is always northwest</b>.</p>
<p>When your <i>View</i> subclass is being mirrored, its coordinate system is transformed and therefore if you are processing a mouse event for the point (0,0), the actual mouse position is the Northeast corner of your control. Thus, you should not write your GUI code assuming a left-to-right coordinate system. If the logic of your code depends on the actual position of the mouse event, then you should use the mirroring API in order to find out whether or not the coordinate system is transformed. See <span style="font-family:courier new,monospace">chrome\views\custom_frame_window.cc</span> for an example.</p>
<p><b>More rules will be added later on as I continue analyzing the cause of the most common Chromium mirroring bugs. For now, try to adhere to the initial rules.</b>.</p>
<h2><a name="TOC-How-to-test-a-mirrored-Chromium-UI-element"></a>How to test a mirrored Chromium UI element </h2>
<p>If you write a new Chromium UI element or modify an existing element, it is highly important that you make sure the element is mirrored correctly in right-to-left locales. In order to do that, you can either change the UI language of Chromium via the <b>Options</b> dialog, or you can run Chromium from the command line such that the Hebrew UI is used:</p></div></div></div></div></div></div><blockquote style="margin:0 0 0 40px;border:none;padding:0px"><div><div><div><div><div><div><p>Windows: <span style="color:rgb(0,96,0);white-space:pre-wrap;font-size:10pt;background-color:transparent"><font face="courier new, monospace">chrome.exe --lang=he</font></span></p></div></div></div></div></div></div><div><div><div><div><div><div><p>Mac/Linux: Confirm the <b>he_IL</b> locale is installed on the system by running `locale -a` to list.  Then: <span style="color:rgb(0,96,0);font-size:13.3333330154419px;white-space:pre-wrap;background-color:transparent"><font face="courier new, monospace">LANG=he_IL.UTF-8 LANGUAGE=he_IL chrome</font></span></p></div></div></div></div></div></div></blockquote><div dir="ltr"><div dir="ltr"><div dir="ltr"><div dir="ltr"><div dir="ltr"><div dir="ltr">
<p><span style="font-size:10pt;background-color:transparent">Once you do that, you can look at your control and make sure it doesn't have layout bugs. Note that your machine probably doesn't include the files required for displaying right-to-left languages and therefore all the Hebrew strings will be rendered from left to right which will make them unreadable. It will also make certain Unicode control characters to appear as little squares surrounding the text. This does not impact the layout of the Chromium UI elements so it shouldn't prevent you from making sure your UI element is properly laid out. If you want the Hebrew strings to appear correctly and you want the annoying squares to go away, you can easily install the required Windows right-to-left language files by going to </span><b style="font-size:10pt;background-color:transparent">Control Panel &gt; Regional and Language Options</b><span style="font-size:10pt;background-color:transparent">, selecting the </span><b style="font-size:10pt;background-color:transparent">Languages</b><span style="font-size:10pt;background-color:transparent"> tab, and selecting the option to </span><b style="font-size:10pt;background-color:transparent">Install files for complex script and right-to-left languages (including Thai)</b><span style="font-size:10pt;background-color:transparent">. Note that installing the right-to-left files requires a restart.</span></p>
<p>I am still trying to figure out if there is a way to write a UI test that makes sure UI mirroring is not broken so that people can make sure they don't break anything before a check-in. Suggestions are welcome!</p>
</div>
</div></div></div></div></div></div></td></tr></tbody></table>
</div> 
</div> 
<div id="sites-canvas-bottom-panel">
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_page-subpages"> </div>
<div id="sites-attachments-container">
</div>
<a xmlns="http://www.w3.org/1999/xhtml" name="page-comments"></a>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_page-comments"><div class="sites-comment-docos-wrapper"><div class="sites-comment-docos"><div class="sites-comment-docos-background"></div><div class="sites-comment-docos-header"><div class="sites-comment-docos-header-title">Comments</div></div><div id="sites-comment-docos-pane" class="sites-comment-docos-pane"></div></div></div></div>
</div>
</div> 
</td> 
</tr>
</table> 
</div> 
</div> 
<div id="sites-chrome-footer-wrapper">
<div id="sites-chrome-footer-wrapper-inside">
<div id="sites-chrome-footer">
</div>
</div>
</div>
</div> 
</div> 
<div id="sites-chrome-adminfooter-container">
<div xmlns="http://www.w3.org/1999/xhtml" class="sites-adminfooter" role="navigation"><p><a class="sites-system-link" href="https://www.google.com/a/UniversalLogin?service=jotspot&amp;continue=https://sites.google.com/a/chromium.org/dev/developers/design-documents/ui-mirroring-infrastructure">Sign in</a><span aria-hidden="true">|</span><a class="sites-system-link" href="../../system/app/pages/recentChanges.html">Recent Site Activity</a><span aria-hidden="true">|</span><a class="sites-system-link" href="../../system/app/pages/reportAbuse.html" target="_blank">Report Abuse</a><span aria-hidden="true">|</span><a class="sites-system-link" href="javascript:;" onclick="window.open(webspace.printUrl)">Print Page</a><span aria-hidden="true">|</span><span class="sites-system-link">Powered By</span> <b class="powered-by"><a href="http://sites.google.com">Google Sites</a></b></p></div>
</div>
</div> 
</div> 
<div id="sites-chrome-onebar-footer">
</div>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    window.jstiming.load.tick('sjl');
  </script>
<script xmlns="http://www.w3.org/1999/xhtml" src="https://ssl.gstatic.com/sites/p/56e332/system/js/jot_min_view__en.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    window.jstiming.load.tick('jl');
  </script>
<script xmlns="http://www.w3.org/1999/xhtml">
      
          sites.core.Analytics.createTracker();
          sites.core.Analytics.trackPageview();
        
    </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
                    sites.Searchbox.initialize(
                        'sites-searchbox-search-button',
                        {"object":[]}['object'],
                        'search-site',
                        {"label":"Configure search options...","url":"/system/app/pages/admin/settings"});
                  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
      gsites.HoverPopupMenu.createSiteDropdownMenus('sites-header-nav-dropdown', false);
    </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
            JOT_setupNav("7648876402527094", "Navigation", false);
            JOT_addListener('titleChange', 'JOT_NAVIGATION_titleChange', 'COMP_7648876402527094');
          </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
            JOT_setupNav("14720868319272995", "Quick links", false);
            JOT_addListener('titleChange', 'JOT_NAVIGATION_titleChange', 'COMP_14720868319272995');
          </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
            JOT_setupNav("19690813310444355", "Other sites", false);
            JOT_addListener('titleChange', 'JOT_NAVIGATION_titleChange', 'COMP_19690813310444355');
          </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
              new sites.CommentPane('//docs.google.com/comments/d/AAHRpnXukca4jaDOG9SuQz_G8t7Hlp2I9FtoSku0aJdg5JTm9MtRpVa3-6HLwffaCKbeRrvHVwuuZHp9PAjpa7QfAU_C9VXfOE2aMre_ytppt1mo99Zy7jcJGiWkXd-EaRTSBL-qEAHpQ/api/js?anon=true',
                  false, false);
            </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
  setTimeout(function() {
    var fingerprint = gsites.date.TimeZone.getFingerprint([]);
    gsites.Xhr.send('https://www.chromium.org/_/tz', null, null, 'GET', null, null, { afjstz: fingerprint });
  }, 500);
</script>
<script xmlns="http://www.w3.org/1999/xhtml">
                    window.onload = function() {
                      if (false) {
                        JOT_setMobilePreview();
                      }
                      var loadTimer = window.jstiming.load;
                      loadTimer.tick("ol");
                      loadTimer["name"] = "load," + webspace.page.type + ",user_page";
                      window.jstiming.report(loadTimer, {}, 'https://gg.google.com/csi');
                    }
                  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
        JOT_insertAnalyticsCode(false,
            false);
      </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    var maestroRunner = new gsites.pages.view.SitesMaestroRunner(
        webspace, "en");
    maestroRunner.initListeners();
    maestroRunner.installEditRender();
  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
  //<![CDATA[
    // Decorate any fastUI buttons on the page with a class of 'goog-button'.
    if (webspace.user.hasWriteAccess) {
      JOT_decorateButtons();
    }

    // Fires delayed events.
    (function() {
      JOT_fullyLoaded = true;
      var delayedEvents = JOT_delayedEvents;
      for (var x = 0; x < delayedEvents.length; x++) {
        var event = delayedEvents[x];
        JOT_postEvent(event.eventName, event.eventSrc, event.payload);
      }
      JOT_delayedEvents = null;
      JOT_postEvent('pageLoaded');
    })();
  //]]>
</script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    JOT_postEvent('decorateGvizCharts');
  </script>
<script type="text/javascript">
          JOT_setupPostRenderingManager();
        </script>
<script type="text/javascript">
          JOT_postEvent('renderPlus', null, 'sites-chrome-main');
        </script>
<div id="server-timer-div" style="display:none"> </div>
<script type="text/javascript">
          window.jstiming.load.tick('render');
          JOT_postEvent('usercontentrendered', this);
        </script>
</body>
</html>
