<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/WebPage">
<head>
<meta http-equiv="X-UA-Compatible" content="chrome=1" />
<script type="text/javascript">/* Copyright 2008 Google. */ (function() { var e="wtsrt_",g="tbsd_",h="tbnd_",k="start",l="_wtsrt",m="_tbnd",n="CSI/";(function(){function f(a){this.t={};this.tick=function(a,c,b){this.t[a]=[void 0!=b?b:(new Date).getTime(),c];if(void 0==b)try{window.console.timeStamp(n+a)}catch(d){}};this.tick(k,null,a)}var a;window.performance&&(a=window.performance.timing);var p=a?new f(a.responseStart):new f;window.jstiming={Timer:f,load:p};if(a){var c=a.navigationStart,d=a.responseStart;0<c&&d>=c&&(window.jstiming.srt=d-c)}if(a){var b=window.jstiming.load;0<c&&d>=c&&(b.tick(l,void 0,c),b.tick(e,l,d),b.tick(g,e))}try{a=null,
window.chrome&&window.chrome.csi&&(a=Math.floor(window.chrome.csi().pageT),b&&0<c&&(b.tick(m,void 0,window.chrome.csi().startE),b.tick(h,m,c))),null==a&&window.gtbExternal&&(a=window.gtbExternal.pageT()),null==a&&window.external&&(a=window.external.pageT,b&&0<c&&(b.tick(m,void 0,window.external.startE),b.tick(h,m,c))),a&&(window.jstiming.pt=a)}catch(q){}})(); })()
</script>
<link rel="shortcut icon" href="/_/rsrc/1354323194313/favicon.ico" type="image/x-icon" />
<link rel="apple-touch-icon" href="https://ssl.gstatic.com/sites/p/56e332/system/app/images/apple-touch-icon.png" type="image/png" />
<script type="text/javascript">/* Copyright 2008 Google. */ (function() { var d="",g="__duration__",h="function";function k(c){return document.getElementById(c)}window.byId=k;function l(c){return c.replace(/^\s+|\s+$/g,d)}window.trim=l;var m=[],n=0;window.JOT_addListener=function(c,a,b){var e=new String(n++);c={eventName:c,handler:a,compId:b,key:e};m.push(c);return e};window.JOT_removeListenerByKey=function(c){for(var a=0;a<m.length;a++)if(m[a].key==c){m.splice(a,1);break}};
window.JOT_removeAllListenersForName=function(c){for(var a=0;a<m.length;a++)m[a].eventName==c&&m.splice(a,1)};window.JOT_postEvent=function(c,a,b){var e={eventName:c,eventSrc:a||{},payload:b||{}};if(window.JOT_fullyLoaded)for(a=m.length,b=0;b<a&&b<m.length;b++){var f=m[b];f&&f.eventName==c&&(e.listenerCompId=f.compId||d,(f=typeof f.handler==h?f.handler:window[f.handler])&&f(e))}else window.JOT_delayedEvents.push({eventName:c,eventSrc:a,payload:b})};window.JOT_delayedEvents=[];
window.JOT_fullyLoaded=!1;window.JOT_formatRelativeToNow=function(c,a){var b=((new Date).getTime()-c)/6E4;if(1440<=b||0>b)return null;var e=0;60<=b&&(b/=60,e=2);2<=b&&e++;return a?window.JOT_siteRelTimeStrs[e].replace(g,Math.floor(b)):window.JOT_userRelTimeStrs[e].replace(g,Math.floor(b))}; })()
</script>
<script>

  

  var breadcrumbs = [{"path":"/developers","deleted":false,"title":"For Developers","dir":"ltr"},{"path":"/developers/design-documents","deleted":false,"title":"Design Documents","dir":"ltr"},{"path":"/developers/design-documents/per-page-suborigins","deleted":false,"title":"Per-page Suborigins","dir":"ltr"}];
  var JOT_clearDotPath = 'https://ssl.gstatic.com/sites/p/56e332/system/app/images/cleardot.gif';

  
  var JOT_userRelTimeStrs = ["a minute ago","__duration__ minutes ago","an hour ago","__duration__ hours ago"];

  
  

  

  var webspace = {"enableAnalytics":true,"pageSharingId":"jotspot_page","enableUniversalAnalytics":false,"sharingPolicy":"OPENED_WITH_INDICATOR","siteTitle":"The Chromium Projects","isStartPageEnabled":true,"adsensePublisherId":null,"features":{"languageSelectDefaultTextSetToDefault":true,"validateClientGvizDataSourceUrls":true,"moreMobileStyleImprovements":true,"newInsertMenuIcons":true,"accessibleSortingButtons":true,"domainAnalyticsInGAOnly":true,"noCaptcha":true,"fileCabinetScreenReaderFix":true,"updatedTosAndPrivacyLinks":null,"pageDrafts":false,"mobileOrientationFix":true,"plusBadge":false,"pdfEmbedSupport":false,"jsClickFix":true},"isPublic":true,"isConsumer":false,"serverFlags":{"cajaBaseUrl":"//www.gstatic.com/caja","cajaDebugMode":false},"onepickBaseUrl":"https://docs.google.com","domainAnalyticsAccountId":"","plusPageId":"","signInUrl":"https://www.google.com/a/SelectSession?continue\u003dhttps://sites.google.com/a/chromium.org/dev/developers/design-documents/per-page-suborigins\u0026service\u003djotspot","analyticsAccountId":"UA-5484340-1","scottyUrl":"/_/upload","homePath":"/","siteNoticeUrlEnabled":null,"plusPageUrl":"","adsensePromoClickedOrSiteIneligible":true,"csiReportUri":"https://gg.google.com/csi","sharingId":"jotspot","termsUrl":"//www.google.com/intl/en/policies/terms/","gvizVersion":1,"editorResources":{"sitelayout":["https://ssl.gstatic.com/sites/p/56e332/system/app/css/sitelayouteditor.css"],"text":["https://ssl.gstatic.com/sites/p/56e332/system/js/codemirror.js","https://ssl.gstatic.com/sites/p/56e332/system/app/css/codemirror_css.css","https://ssl.gstatic.com/sites/p/56e332/system/js/trog_edit__en.js","https://ssl.gstatic.com/sites/p/56e332/system/app/css/trogedit.css","/_/rsrc/1441580320000/system/app/css/editor.css","https://ssl.gstatic.com/sites/p/56e332/system/app/css/codeeditor.css","/_/rsrc/1441580320000/system/app/css/camelot/editor-jfk-wlb.css"]},"sharingUrlPrefix":"/_/sharing","isAdsenseEnabled":true,"domain":"chromium.org","baseUri":"","name":"dev","siteTemplateId":false,"siteNoticeRevision":null,"siteNoticeUrlAddress":null,"siteNoticeMessage":null,"page":{"isRtlLocale":false,"canDeleteWebspace":null,"isPageDraft":null,"parentPath":"/developers/design-documents","parentWuid":"wuid:gx:359ef223e0fb14ac","siteLocale":"en","timeZone":"America/Los_Angeles","type":"text","title":"Per-page Suborigins","locale":"en","wuid":"wuid:gx:559e530a85550369","revision":4,"path":"/developers/design-documents/per-page-suborigins","isSiteRtlLocale":false,"pageInheritsPermissions":null,"name":"per-page-suborigins","canChangePath":true,"state":"","properties":{},"bidiEnabled":false,"currentTemplate":{"path":"/system/app/pagetemplates/text","title":"Web Page"}},"canPublishScriptToAnyone":true,"user":{"keyboardShortcuts":true,"sessionIndex":"","guest_":true,"displayNameOrEmail":"guest","userName":"guest","uid":"","renderMobile":false,"domain":"","namespace":"","hasWriteAccess":false,"namespaceUser":false,"primaryEmail":"guest","hasAdminAccess":false},"gadgets":{"baseUri":"/system/app/pages/gadgets"}};
  webspace.page.breadcrumbs = breadcrumbs;

  
  var JOT_siteRelTimeStrs = ["a minute ago","__duration__ minutes ago","an hour ago","__duration__ hours ago"];

</script>
<script type="text/javascript">
                window.jstiming.load.tick('scl');
              </script>
<meta name="title" content="Per-page Suborigins - The Chromium Projects" />
<meta itemprop="name" content="Per-page Suborigins - The Chromium Projects" />
<meta property="og:title" content="Per-page Suborigins - The Chromium Projects" />
<meta name="description" content="Home of the Chromium Open Source Project" />
<meta itemprop="description" content="Home of the Chromium Open Source Project" />
<meta id="meta-tag-description" property="og:description" content="Home of the Chromium Open Source Project" />
<style type="text/css">
</style>
<link rel="stylesheet" type="text/css" href="https://ssl.gstatic.com/sites/p/56e332/system/app/themes/beigeandblue/standard-css-beigeandblue-ltr-ltr.css" />
<link rel="stylesheet" type="text/css" href="/_/rsrc/1441580320000/system/app/css/overlay.css?cb=beigeandblueundefineda100%25%25150goog-ws-leftthemedefaultstandard" />
<link rel="stylesheet" type="text/css" href="/_/rsrc/1441580320000/system/app/css/camelot/allthemes-view.css" />
<!--[if IE]>
          <link rel="stylesheet" type="text/css" href="/system/app/css/camelot/allthemes%2die.css" />
        <![endif]-->
<title>Per-page Suborigins - The Chromium Projects</title>
<meta itemprop="image" content="/_/rsrc/1438879449147/config/customLogo.gif?revision=3" />
<meta property="og:image" content="/_/rsrc/1438879449147/config/customLogo.gif?revision=3" />
<script type="text/javascript">
                window.jstiming.load.tick('cl');
              </script>
</head>
<body xmlns="http://www.google.com/ns/jotspot" id="body" class=" en            ">
<div id="sites-page-toolbar" class="sites-header-divider">
<div xmlns="http://www.w3.org/1999/xhtml" id="sites-status" class="sites-status" style="display:none;"><div id="sites-notice" class="sites-notice" role="status" aria-live="assertive"> </div></div>
</div>
<div id="sites-chrome-everything-scrollbar">
<div id="sites-chrome-everything" class="">
<div id="sites-chrome-page-wrapper" style="direction: ltr">
<div id="sites-chrome-page-wrapper-inside">
<div xmlns="http://www.w3.org/1999/xhtml" id="sites-chrome-header-wrapper" style="height:auto;">
<table id="sites-chrome-header" class="sites-layout-hbox" cellspacing="0" style="height:auto;">
<tr class="sites-header-primary-row" id="sites-chrome-userheader">
<td id="sites-header-title" class="" role="banner"><div class="sites-header-cell-buffer-wrapper"><a href="https://www.chromium.org/" id="sites-chrome-userheader-logo"><img id="logo-img-id" src="/_/rsrc/1438879449147/config/customLogo.gif?revision=3" alt="The Chromium Projects" class="sites-logo  " /></a><h2><a href="https://www.chromium.org/" dir="ltr" id="sites-chrome-userheader-title">The Chromium Projects</a></h2></div></td><td class="sites-layout-searchbox  "><div class="sites-header-cell-buffer-wrapper"><form id="sites-searchbox-form" action="/system/app/pages/search" role="search"><input type="hidden" id="sites-searchbox-scope" name="scope" value="search-site" /><input type="text" id="jot-ui-searchInput" name="q" size="20" value="" aria-label="Search this site" /><div id="sites-searchbox-button-set" class="goog-inline-block"><div role="button" id="sites-searchbox-search-button" class="goog-inline-block jfk-button jfk-button-standard" tabindex="0">Search this site</div></div></form></div></td>
</tr>
<tr class="sites-header-secondary-row" id="sites-chrome-horizontal-nav">
<td colspan="2" id="sites-chrome-header-horizontal-nav-container" role="navigation">
</td>
</tr>
</table>
</div>
<div id="sites-chrome-main-wrapper">
<div id="sites-chrome-main-wrapper-inside">
<table id="sites-chrome-main" class="sites-layout-hbox" cellspacing="0" cellpadding="{scmCellpadding}" border="0">
<tr>
<td id="sites-chrome-sidebar-left" class="sites-layout-sidebar-left initial" style="width:150px">
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_7648876402527094" class="sites-embed" role="navigation"><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotId="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="/chromium-projects" jotId="wuid:gx:10ae433dadbbab13" class="sites-navigation-link">Home</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="/Home" jotId="wuid:gx:43582b9d2029d3af" class="sites-navigation-link">Chromium</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="/chromium-os" jotId="wuid:gx:83df2ab1f8880ba" class="sites-navigation-link">Chromium OS</a></div></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_14720868319272995" class="sites-embed" role="navigation"><h4 class="sites-embed-title">Quick links</h4><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotId="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="http://www.chromium.org/for-testers/bug-reporting-guidelines" class="sites-navigation-link">Report bugs</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="http://www.chromium.org/developers/discussion-groups" class="sites-navigation-link">Discuss</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="/system/app/pages/sitemap/hierarchy" jotId="wuid:gx:4b58a9a350ad12f" class="sites-navigation-link">网站地图</a></div></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_19690813310444355" class="sites-embed" role="navigation"><h4 class="sites-embed-title">Other sites</h4><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotId="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="http://blog.chromium.org/" class="sites-navigation-link">Chromium Blog</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="http://code.google.com/chrome/extensions/" class="sites-navigation-link">Google Chrome Extensions</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="https://developers.google.com/chrome/chrome-frame/" class="sites-navigation-link">Google Chrome Frame</a></div></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_19695218559354544" class="sites-embed" role="complementary"><h4 class="sites-embed-title"></h4><div class="sites-embed-content sites-embed-content-sidebar-textbox"><div dir="ltr"><span style="font-size:x-small">Except as otherwise </span><a href="http://developers.google.com/site-policies.html#restrictions"><span style="font-size:x-small">noted</span></a><span style="font-size:x-small">, the content of this page is licensed under a </span><a href="http://creativecommons.org/licenses/by/2.5/"><span style="font-size:x-small">Creative Commons Attribution 2.5 license</span></a><span style="font-size:x-small">, and examples are licensed under the </span><a href="http://src.chromium.org/viewvc/chrome/trunk/src/LICENSE" target="_blank"><span style="font-size:x-small">BSD License</span></a><span style="font-size:x-small">.<br /></span></div></div></div>
</td>
<td id="sites-canvas-wrapper">
<div id="sites-canvas" role="main">
<div id="goog-ws-editor-toolbar-container"> </div>
<div xmlns="http://www.w3.org/1999/xhtml" id="title-crumbs" style="">
<A href="/developers" dir="ltr">For Developers</A>‎ &gt; ‎<A href="/developers/design-documents" dir="ltr">Design Documents</A>‎ &gt; ‎
  </div>
<h3 xmlns="http://www.w3.org/1999/xhtml" id="sites-page-title-header" style="" align="left">
<span id="sites-page-title" dir="ltr" tabindex="-1" style="outline: none">Per-page Suborigins</span>
</h3>
<div id="sites-canvas-main" class="sites-canvas-main">
<div id="sites-canvas-main-content">
<table xmlns="http://www.w3.org/1999/xhtml" cellspacing="0" class="sites-layout-name-one-column sites-layout-hbox"><tbody><tr><td class="sites-layout-tile sites-tile-name-content-1"><div dir="ltr"><span><h1 dir="ltr" style="line-height:1.15;margin-top:24pt;margin-bottom:6pt"><a name="TOC-Objective"></a><span style="font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"><div style="color:rgb(74,134,232);font-size:24px"><div class="sites-embed-align-right-wrapping-on"><div class="sites-embed-border-off sites-embed" style="width:250px;"><div class="sites-embed-content sites-embed-type-toc"><div class="goog-toc sites-embed-toc-maxdepth-6"><p>Contents</p><ol class="goog-toc"><li class="goog-toc"><a href="#TOC-Objective"><strong>1 </strong>Objective</a></li><li class="goog-toc"><a href="#TOC-Background"><strong>2 </strong>Background</a></li><li class="goog-toc"><a href="#TOC-Overview"><strong>3 </strong>Overview</a></li><li class="goog-toc"><a href="#TOC-Detailed-Design"><strong>4 </strong>Detailed Design</a><ol class="goog-toc"><li class="goog-toc"><a href="#TOC-Definition-of-Suborigins"><strong>4.1 </strong>Definition of Suborigins</a></li><li class="goog-toc"><a href="#TOC-Checking-Origins-and-Suborigins"><strong>4.2 </strong>Checking Origins and Suborigins</a></li><li class="goog-toc"><a href="#TOC-Concerns"><strong>4.3 </strong>Concerns</a></li></ol></li><li class="goog-toc"><a href="#TOC-Security-Considerations"><strong>5 </strong>Security Considerations</a></li><li class="goog-toc"><a href="#TOC-Future-Work-and-Extensions"><strong>6 </strong>Future Work and Extensions</a></li></ol></div></div></div></div></div><font size="4">Objective</font></span></h1><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><font size="2"><span style="font-family:Arial;vertical-align:baseline;white-space:pre-wrap">Our objective is to provide a new mechanism for allowing sites to easily separate their content into separate, flexible synthetic origins while serving content from a single physical origin. Furthermore, the synthetic origins should be predictable and convey the full physical origin so that compartmentalized content can easily use current browser technologies, such as </span><span style="font-family:Courier New;vertical-align:baseline;white-space:pre-wrap">postMessage</span><span style="font-family:Arial;vertical-align:baseline;white-space:pre-wrap">, to interact with each other.</span></font></p><h1 dir="ltr" style="line-height:1.15;margin-top:24pt;margin-bottom:6pt"><a name="TOC-Background"></a><span style="font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"><font size="4">Background</font></span></h1><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><font size="2"><span style="font-family:Arial;vertical-align:baseline;white-space:pre-wrap">This document is based on (and much text lifted from) an original proposal written by Michal Zalewski</span></font></p><font size="2"><br /></font><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><font size="2"><span style="font-family:Arial;vertical-align:baseline;white-space:pre-wrap">Currently, web applications are almost always compartmentalized by using separate host names to establish separate web origins. This is useful for helping to prevent XSS and other cross-origin attacks, but has many unintended consequences. For example, it causes latency due to additional DNS lookups, removes the ability to use single-origin features (such as the </span><span style="font-family:Courier New;vertical-align:baseline;white-space:pre-wrap">history.pushState</span><span style="font-family:Arial;vertical-align:baseline;white-space:pre-wrap"> API), and creates cryptic host name changes in the user experience. Perhaps most importantly, it results in an extremely inflexible architecture that, once rolled out, can’t be easily and transparently changed later on.</span></font></p><font size="2"><br /></font><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-family:Arial;vertical-align:baseline;white-space:pre-wrap"><font size="2">There are several mechanisms for reducing the attack surface for XSS without creating separate host-name based origins, but each pose their own problems. Per-page Suborigins is an attempt to fill some of those gaps. Two of the most notable mechanisms are Sandboxed Frames and Content Security Policy (CSP). Both are powerful but have shortcomings and there are many external developers building legacy applications that find they cannot use those tools.</font></span></p><font size="2"><br /></font><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><font size="2"><span style="font-family:Arial;vertical-align:baseline;white-space:pre-wrap">Sandboxed frames can be used to completely separate untrusted content, but they pose a large problem for </span><span style="font-family:Arial;font-style:italic;vertical-align:baseline;white-space:pre-wrap">containing</span><span style="font-family:Arial;vertical-align:baseline;white-space:pre-wrap"> trusted but potentially buggy code because it is very difficult, by design, for them to communicate with other frames. The synthetic origins assigned in a sandboxed frame are random and unpredictable, making the use of </span><span style="font-family:Courier New;vertical-align:baseline;white-space:pre-wrap">postMessage</span><span style="font-family:Arial;vertical-align:baseline;white-space:pre-wrap"> and CORS difficult.</span></font></p><font size="2"><br /></font><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-family:Arial;vertical-align:baseline;white-space:pre-wrap"><font size="2">Content Security Policy is also promising but is generally incompatible with current website design. Many notable companies found it impractical to retrofit most of their applications with it. On top of this, until all applications hosted within a single origin are simultaneously put behind CSP, the mechanism offers limited incremental benefits, which is especially problematic for companies with large portfolios of disparate products all under the same domain.</font></span></p><h1 dir="ltr" style="line-height:1.15;margin-top:24pt;margin-bottom:6pt"><a name="TOC-Overview"></a><span style="font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"><font size="4">Overview</font></span></h1><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><font size="2"><span style="font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">We want to create a new browser primitive to provide isolation within a single origin between disparate components. Often, there are many web applications that share a single real origin. One example of this is </span><span style="font-family:Courier New;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">www.google.com</span><span style="font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">, which many functionally separate applications (in the hundreds) share for reasons related to branding, DNS latency, and seamless interoperability, despite being very different properties. The consequence of this is that one compromised web application from an XSS at the </span><span style="font-family:Courier New;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">www.google.com</span><span style="font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> origin means that all properties at</span><span style="font-family:Courier New;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> www.google.com</span><span style="font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> are compromised. Many other popular web destinations such as Facebook, Twitter, Dropbox, etc. face similar issues.</span></font></p><font size="2"><br /></font><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><font size="2"><span style="font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">This is an accident of the Same Origin Policy (SOP) in the sense that the SOP assumes everything at a given real origin is part of the same application. A Per-page Suborigin primitive would allow developers to apply the SOP at a finer grained granularity and specify that different applications within the same real origin should, in fact, be treated as different origins under the SOP. The primitive should fill a space between Sandboxed Frames and CSP by allowing consumers to separate trusted components into separated origins while still allowing efficient cross-origin communication via </span><span style="font-family:Courier New;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">postMessage</span><span style="font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> and CORS, but also without significant retrofitting limitations to legacy applications.</span></font></p><font size="2"><br /></font><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"><font size="2">Per-page Suborigins would provide a way for applications at the same origin to request to be placed in separate, synthetic suborigins. These suborigins would be in a predictable namespace, so utilizing postMessage and CORS would be possible just as normal. However, it would also provide the strong isolation properties of regular SOP protection; despite being in the same real origin, code from different suborigins would not be able to access the DOM of a different suborigin.</font></span></p><font size="2"><br /></font><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"><font size="2">Furthermore, Per-page Suborigins could actually help with a rollout of CSP. As noted above, when many different properties are hosted on the same domain, if only some have CSP applied, many of the benefits are lost because an XSS on one of the non-CSP enabled pages poses an immediate threat to CSP-enabled content. With Per-page Suborigins, by compartmentalizing different applications within the same domain, an exploit of one application that is not CSP enabled would not necessarily compromise an application in a different Per-page Suborigin, thus increasing the value of gradually deploying CSP for high-value components.</font></span></p><font size="2"><br /></font><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"><font size="2">We see effectively three different use cases for Per-page Suborigins:<br /></font></span></p><ol style="margin-top:0pt;margin-bottom:0pt"><li dir="ltr" style="list-style-type:decimal;font-family:Arial;background-color:transparent;vertical-align:baseline"><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="background-color:transparent;vertical-align:baseline;white-space:pre-wrap"><font size="2">Separating distinct applications that happen to be served from the same domain, but do not need to extensively interact with other content. Examples include marketing campaigns, simple search UIs, and so on. This use requires very little engineering effort and faces very few constraints; the applications may use XMLHttpRequest and postMessage to communicate with their host domain as required.<br /></font></span></p></li><li dir="ltr" style="list-style-type:decimal;font-family:Arial;background-color:transparent;vertical-align:baseline"><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="background-color:transparent;vertical-align:baseline;white-space:pre-wrap"><font size="2">Allowing for modularity within a larger web application by splitting the functional components into different suborigins. For example, Gmail might put the contacts widget, settings tab, and HTML message views in separate Per-page Suborigins. Such deployments may require relatively modest refactorings to switch to postMessage and CORS where direct DOM access and same-origin XMLHttpRequest are currently used, but we believe doing so is considerably easier than retrofitting CSP onto arbitrary code bases and can be done very incrementally.<br /></font></span></p></li><li dir="ltr" style="list-style-type:decimal;font-family:Arial;background-color:transparent;vertical-align:baseline"><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="background-color:transparent;vertical-align:baseline;white-space:pre-wrap"><font size="2">Similar to (2), applications with many users can split information relating to different users into their own suborigin. For example, Twitter might put each user profile into a unique suborigin so that an XSS within one profile cannot be used to immediately infect other users or read their personal messages stored within the account.</font></span></p></li></ol><h1 dir="ltr" style="line-height:1.15;margin-top:24pt;margin-bottom:6pt"><a name="TOC-Detailed-Design"></a><span style="font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"><font size="4">Detailed Design</font></span></h1><h2 dir="ltr" style="line-height:1.15;margin-top:18pt;margin-bottom:4pt"><a name="TOC-Definition-of-Suborigins"></a><span style="font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"><font size="3">Definition of Suborigins</font></span></h2><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><font size="2"><span style="font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Suborigins will be a synthetic origin, similar to the already implemented synthetic suborigins for HTML5 sandboxed frames. However, suborigins will have the important property of being predictable, well-defined, and hierarchical, allowing </span><span style="font-family:Courier New;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">postMessage</span><span style="font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> and CORS communication between sandboxed content.</span></font></p><font size="2"><br /></font><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"><font size="2">A suborigin may be specified by a HTTP header such as:</font></span></p><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt;margin-left:36pt"><span style="font-family:Courier New;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"><font size="2">Suborigin: &lt;name&gt;</font></span></p><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><font size="2"><span style="font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">where </span><span style="font-family:Courier New;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">&lt;name&gt;</span><span style="font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> is defined by the server or developer and should be predictable.</span></font></p><font size="2"><br /></font><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><font size="2"><span style="font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">We will treat suborigins as a separate field from origins that must be checked whenever the SOP is being enforced. Thus, the above suborigin will result in the following SOP origin for the frame of:</span></font></p><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt;margin-left:36pt"><span style="font-family:Courier New;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"><font size="2">origin:<span style="white-space:pre"> </span>&lt;protocol&gt;://&lt;host&gt;:&lt;port&gt;</font></span></p><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt;margin-left:36pt"><span style="font-family:Courier New;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"><font size="2">suborigin:<span style="white-space:pre"> </span>&lt;name&gt;</font></span></p><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><font size="2"><span style="font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">where </span><span style="font-family:Courier New;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">&lt;protocol&gt;</span><span style="font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">, </span><span style="font-family:Courier New;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">&lt;host&gt;</span><span style="font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">, and </span><span style="font-family:Courier New;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">&lt;port&gt;</span><span style="font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> remain as they always have, and </span><span style="font-family:Courier New;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">&lt;name&gt;</span><span style="font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> is a name defined by the server of alpha-numeric characters only. In the case that no suborigin is specified, the value of </span><span style="font-family:Courier New;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">suborigin</span><span style="font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> should be treated as the empty string.</span></font></p><font size="2"><br /></font><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"><font size="2">A potentially preferable option would be to implement this as a CSP directive. For example:</font></span></p><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><font size="2"><span style="font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"><span style="white-space:pre"> </span></span><span style="font-family:Courier New;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Content-Security-Policy: suborigin &lt;name&gt;;</span></font></p><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"><font size="2">which would result in the same full origin as above.</font></span></p><font size="2"><br /></font><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"><font size="2">An important point to note here is that, because of security considerations, there is no way to “surrender” or “escape” a suborigin. That is, once assigned a suborigin, a page cannot return within that instance to the real origin; the ability to do so would completely defeat the sandboxing purpose of the mechanism.</font></span></p><font size="2"><br /></font><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"><font size="2">We have considered alternative approaches to encoding suborigins but concluded that including it in the header is the best approach. For example, one alternative would be to encode the suborigin as part of the host or protocol. Two ways you might do this are:</font></span></p><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><font size="2"><span style="font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"><span style="white-space:pre"> </span></span><span style="font-family:Courier New;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">origin: &lt;protocol&gt;+&lt;name&gt;://&lt;host&gt;:&lt;port&gt;</span></font></p><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><font size="2"><span style="font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">or<span style="white-space:pre"> </span></span><span style="font-family:Courier New;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">origin: &lt;protocol&gt;://&lt;name&gt;@&lt;host&gt;:&lt;port&gt;</span></font></p><font size="2"><br /></font><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"><font size="2">These have the advantage that they (a) encode the suborigin as part of the current origin, thus no new suborigin field is required, and (b) current enforcement mechanisms would require relatively few changes since it would effectively be encoding the suborigin as part of either the protocol or host, and the current SOP already enforces these components.</font></span></p><font size="2"><br /></font><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><font size="2"><span style="font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">However, suborigins are not intended to be user understandable or interactive, and encoding suborigins in the scheme/host/port would risk users interacting with them, such as in the URL bar or having them accidentally displayed. Additionally, suborigins, as we will discuss, cannot be used in a variety of contexts that origins are valid, such as resource identifiers in </span><span style="font-family:Courier New;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">&lt;iframe&gt;</span><span style="font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> or </span><span style="font-family:Courier New;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">&lt;img&gt;</span><span style="font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> tags because we require that the server be the authority on what entities are place in suborigins. Thus, we create suborigins as a unique field alongside the origin field.</span></font></p><font size="2"><br /></font><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><font size="2"><span style="font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Permissions that are normally associated with origins should </span><span style="font-family:Arial;background-color:transparent;font-weight:bold;vertical-align:baseline;white-space:pre-wrap">not</span><span style="font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> be applied to Suborigins. For example, geolocation permissions and fullscreen permissions should not be propagated to execution contexts in a new Suborigin. Moreover, there should be no way for Suborigins to obtain such permissions. We apply these restrictions because there should be no way for users to see or interact with Suborigins, and any special permissions might require user confirmation that would require knowledge about the implementation level details of suborigins.</span></font></p><font size="2"><br /></font><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><font size="2"><span style="font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Cross-origin and cross-suborigin communication via </span><span style="font-family:Courier New;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">postMessage</span><span style="font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> is one of the most important features of per-page suborigins. Per-page suborigins with </span><span style="font-family:Courier New;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">postMessage</span><span style="font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> is a mostly straightforward extension of the current implementation. The main concern is on the receiving end of a </span><span style="font-family:Courier New;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">message</span><span style="font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> listener since we need both backwards compatibility and do not want to let legacy implementations accidentally accept messages from incorrect origins. Thus, the receiving </span><span style="font-family:Courier New;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">event</span><span style="font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> object will have </span><span style="font-family:Courier New;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">event.origin</span><span style="font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> set to </span><span style="font-family:Courier New;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">null</span><span style="font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> so that legacy applications will not confuse a message from the </span><span style="font-family:Courier New;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">foo</span><span style="font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> suborigin at </span><span style="font-family:Courier New;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">bar.com</span><span style="font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> for a message from the top level suborigin at </span><span style="font-family:Courier New;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">bar.com</span><span style="font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">. Instead, we propose a new property on the event object, </span><span style="font-family:Courier New;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">event.finerorigin</span><span style="font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">, that will contain two properties, </span><span style="font-family:Courier New;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">origin</span><span style="font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> and </span><span style="font-family:Courier New;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">suborigin</span><span style="font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">, containing the host and suborigin values respectively.</span></font></p><font size="2"><br /></font><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><font size="2"><span style="font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">In the case of pages with a non-empty string </span><span style="font-family:Courier New;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">suborigin</span><span style="font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> fields, all XMLHttpRequest requests to any URL should be treated as cross-origin, thus triggering CORS logic. This contains a similar concern to the </span><span style="font-family:Courier New;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">postMessage</span><span style="font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> issue outlined above. In order to prevent legacy applications from accidentally accepting CORS requests from suborigins, CORS headers originating from a suborigin execution context must specify a </span><span style="font-family:Courier New;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Suborigin: &lt;name&gt;</span><span style="font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> header and a </span><span style="font-family:Courier New;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Finer-Origin: &lt;origin&gt;</span><span style="font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> header, while explicitly </span><span style="font-family:Arial;background-color:transparent;font-weight:bold;vertical-align:baseline;white-space:pre-wrap">not</span><span style="font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> setting an </span><span style="font-family:Courier New;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Origin</span><span style="font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> header. Similarly, responses should be checked for matching new </span><span style="font-family:Courier New;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Access-Control-Allow-Finer-Origin</span><span style="font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> and </span><span style="font-family:Courier New;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Access-Control-Allow-Finer-Suborigin</span><span style="font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> headers, while </span><span style="font-family:Courier New;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Access-Control-Allow-Origin</span><span style="font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> headers should be ignored.</span></font></p><font size="2"><br /></font><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><font size="2"><span style="font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Execution contexts with a Suborigin should be tagged with a flag </span><span style="font-family:Courier New;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">is_suborigin</span><span style="font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> that is inherited by all child contexts that normally inherit the origin of the creator. The SOP should apply as it currently does, using the suborigin in addition to the traditional origin for making policy decisions. Thus, containment should nearly be “for free,” that is it should work using the current SOP mechanisms with an additional check for the Suborigin of an execution context.</span></font></p><font size="2"><br /></font><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"><font size="2">However, in order to compartmentalize, there may be things that may require limited access. As mentioned before, various permissions, such as geolocation, must be disallowed in Suborigins. Additional restrictions also apply.</font></span></p><font size="2"><br /></font><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><font size="2"><span style="font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Notably, a suborigin frame may not access </span><span style="font-family:Courier New;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">document.cookie</span><span style="font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">. While cookies will still be sent with HTTP requests based on the real origin, to simplify compartmentalization and security, suborigin contexts will not be able to access the cookie object, similar to sandboxed contexts. This will prevent information leak and limit the damage a compromised frame can do. If information from a cookie is needed, it will need to communicate with a non-suborigin frame via </span><span style="font-family:Courier New;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">postMessage</span><span style="font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> or another cross-origin mode of communication.</span></font></p><font size="2"><br /></font><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><font size="2"><span style="font-family:Arial;vertical-align:baseline;white-space:pre-wrap">Additionally, plugins pose a problem because they</span><span style="font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> use questionable methods to determine the origin of the embedding page, and may bestow some privileges associated with this origin to the plugin-executed code. In light of this, </span><span style="font-family:Courier New;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">&lt;embed&gt;</span><span style="font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">, </span><span style="font-family:Courier New;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">&lt;object&gt;</span><span style="font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">, or </span><span style="font-family:Courier New;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">&lt;applet&gt;</span><span style="font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> content within documents where </span><span style="font-family:Courier New;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">is_suborign</span><span style="font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> is set will not be allowed. As opposed to sandboxed frames, however, </span><span style="font-family:Courier New;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">is_suborign</span><span style="font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> will </span><span style="font-family:Arial;background-color:transparent;text-decoration:underline;vertical-align:baseline;white-space:pre-wrap">not</span><span style="font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> unconditionally propagate to all subframes - and therefore, many forms of rich ads or Flash videos placed on sandboxed pages should continue to work as-is or with only minimal tweaks.</span></font></p><br /><h2 dir="ltr" style="line-height:1.15;margin-top:18pt;margin-bottom:4pt"><a name="TOC-Checking-Origins-and-Suborigins"></a><span style="font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"><font size="3">Checking Origins and Suborigins</font></span></h2><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><font size="2"><span style="font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">As mentioned before, the SOP will now be applied to the new composite orign, that includes both an </span><span style="font-family:Courier New;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">origin</span><span style="font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> and </span><span style="font-family:Courier New;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">suborigin</span><span style="font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> field. SOP checks should remain functionally the same, however they should now include an additional check of the </span><span style="font-family:Courier New;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">suborigin</span><span style="font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> field for lexical case-insensitive equality.</span></font></p><h2 dir="ltr" style="line-height:1.15;margin-top:18pt;margin-bottom:4pt"><a name="TOC-Concerns"></a><span style="font-family:Arial;color:rgb(102,102,102);background-color:transparent;vertical-align:baseline;white-space:pre-wrap"><font size="2">Concerns</font></span></h2><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"><font size="2">There are many potential unintended consequences of establishing finer- or coarser-grained origins, and there is a long history of security issues and surprising corner cases caused by many of the previously proposed mechanisms (including sandboxed frames and CSP). </font></span></p><font size="2"><br /></font><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"><font size="2">Nevertheless, we think that this proposal avoids most of the pitfalls evident in previous efforts - in large part because it does not try to enforce any new, complex security rules for the sandboxed content, and does not routinely expose the new boundaries to the user.</font></span></p><font size="2"><br /></font><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"><font size="2">One concern, however, is with phishing attacks. As mentioned earlier, suborigins are purposefully create as a new field, rather than being fit into the current scheme/host/port scheme. This is because we don’t want users to see these implementation details. However, this has the consequence that phishing attacks are possible by suborigin content where content pretends to be from another suborigin. However, this is already the case with CSP.</font></span></p><h1 dir="ltr" style="line-height:1.15;margin-top:24pt;margin-bottom:6pt"><a name="TOC-Security-Considerations"></a><span style="font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"><font size="4">Security Considerations</font></span></h1><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"><font size="2">When implementing the feature, care should be taken to provide several relatively straightforward guarantees:</font></span></p><font size="2"><br /></font><ul style="margin-top:0pt;margin-bottom:0pt"><li dir="ltr" style="list-style-type:disc;font-family:Arial;background-color:transparent;vertical-align:baseline"><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><font size="2"><span style="background-color:transparent;vertical-align:baseline;white-space:pre-wrap">The origin needs to be correctly communicated and matched by the </span><span style="font-family:Courier New;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">postMessage</span><span style="background-color:transparent;font-style:italic;vertical-align:baseline;white-space:pre-wrap"> </span><span style="background-color:transparent;vertical-align:baseline;white-space:pre-wrap">API and in the </span><span style="font-family:Courier New;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Origin</span><span style="background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> header in CORS requests (this should require no code changes, but should be confirmed by the implementor). All </span><span style="font-family:Courier New;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">XMLHttpRequest</span><span style="background-color:transparent;font-style:italic;vertical-align:baseline;white-space:pre-wrap"> </span><span style="background-color:transparent;vertical-align:baseline;white-space:pre-wrap">initiated from an isolated origin would be treated as CORS.<br /></span></font></p></li><li dir="ltr" style="list-style-type:disc;font-family:Arial;background-color:transparent;vertical-align:baseline"><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><font size="2"><span style="background-color:transparent;vertical-align:baseline;white-space:pre-wrap">The </span><span style="font-family:Courier New;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">document.cookie</span><span style="background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> API must be inaccessible from contexts marked as </span><span style="font-family:Courier New;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">is_suborigin</span><span style="background-color:transparent;vertical-align:baseline;white-space:pre-wrap">, similar to how sandboxed contexts are currently treated.<br /></span></font></p></li><li dir="ltr" style="list-style-type:disc;font-family:Arial;background-color:transparent;vertical-align:baseline"><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="background-color:transparent;vertical-align:baseline;white-space:pre-wrap"><font size="2">Password manager and the “content permissions” (geolocation, full-screen access, microphone &amp; webcam APIs) generally should be disallowed in Suborigin execution contexts. This is generally because of UI considerations and the desire to not display anything about Suborigins to users.</font></span></p></li></ul><h1 dir="ltr" style="line-height:1.15;margin-top:24pt;margin-bottom:6pt"><a name="TOC-Future-Work-and-Extensions"></a><span style="font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"><font size="4">Future Work and Extensions</font></span></h1><font size="2"><span style="font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Allow some limited access to </span><span style="font-family:Courier New;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">document.cookie</span><span style="font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">. Although we suggest using </span><span style="font-family:Courier New;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">postMessage</span><span style="font-family:Arial;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> for transmitting and cookie related information to a suborigin, it might be useful to allow some limited access to cookies. One future approach might be to create suborigin-specific sections of cookies that only the named suborigin can access.</span></font></span></div></td></tr></tbody></table>
</div> 
</div> 
<div id="sites-canvas-bottom-panel">
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_page-subpages"> </div>
<div id="sites-attachments-container">
</div>
<a xmlns="http://www.w3.org/1999/xhtml" name="page-comments"></a>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_page-comments"><div class="sites-comment-docos-wrapper"><div class="sites-comment-docos"><div class="sites-comment-docos-background"></div><div class="sites-comment-docos-header"><div class="sites-comment-docos-header-title">Comments</div></div><div id="sites-comment-docos-pane" class="sites-comment-docos-pane"></div></div></div></div>
</div>
</div> 
</td> 
</tr>
</table> 
</div> 
</div> 
<div id="sites-chrome-footer-wrapper">
<div id="sites-chrome-footer-wrapper-inside">
<div id="sites-chrome-footer">
</div>
</div>
</div>
</div> 
</div> 
<div id="sites-chrome-adminfooter-container">
<div xmlns="http://www.w3.org/1999/xhtml" class="sites-adminfooter" role="navigation"><p><a class="sites-system-link" href="https://www.google.com/a/UniversalLogin?service=jotspot&amp;continue=https://sites.google.com/a/chromium.org/dev/developers/design-documents/per-page-suborigins">Sign in</a><span aria-hidden="true">|</span><a class="sites-system-link" href="/system/app/pages/recentChanges">Recent Site Activity</a><span aria-hidden="true">|</span><a class="sites-system-link" href="/system/app/pages/reportAbuse" target="_blank">Report Abuse</a><span aria-hidden="true">|</span><a class="sites-system-link" href="javascript:;" onclick="window.open(webspace.printUrl)">Print Page</a><span aria-hidden="true">|</span><span class="sites-system-link">Powered By</span> <b class="powered-by"><a href="http://sites.google.com">Google Sites</a></b></p></div>
</div>
</div> 
</div> 
<div id="sites-chrome-onebar-footer">
</div>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    window.jstiming.load.tick('sjl');
  </script>
<script xmlns="http://www.w3.org/1999/xhtml" src="https://ssl.gstatic.com/sites/p/56e332/system/js/jot_min_view__en.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    window.jstiming.load.tick('jl');
  </script>
<script xmlns="http://www.w3.org/1999/xhtml">
      
          sites.core.Analytics.createTracker();
          sites.core.Analytics.trackPageview();
        
    </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
                    sites.Searchbox.initialize(
                        'sites-searchbox-search-button',
                        {"object":[]}['object'],
                        'search-site',
                        {"label":"Configure search options...","url":"/system/app/pages/admin/settings"});
                  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
      gsites.HoverPopupMenu.createSiteDropdownMenus('sites-header-nav-dropdown', false);
    </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
            JOT_setupNav("7648876402527094", "Navigation", false);
            JOT_addListener('titleChange', 'JOT_NAVIGATION_titleChange', 'COMP_7648876402527094');
          </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
            JOT_setupNav("14720868319272995", "Quick links", false);
            JOT_addListener('titleChange', 'JOT_NAVIGATION_titleChange', 'COMP_14720868319272995');
          </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
            JOT_setupNav("19690813310444355", "Other sites", false);
            JOT_addListener('titleChange', 'JOT_NAVIGATION_titleChange', 'COMP_19690813310444355');
          </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
              new sites.CommentPane('//docs.google.com/comments/d/AAHRpnXvrAwjAfmld0ObrebBiGRq9gzEl6_vmoX2gL5KUFiwia0_6udEZgWRbrVkgdZipwix6uiqn9N56o1-BKi-GcCrZKTmMk59c27NxIH6psyx4fV1MQuFOI04fpTO-NKF2v1JLtUXn/api/js?anon=true',
                  false, false);
            </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
  setTimeout(function() {
    var fingerprint = gsites.date.TimeZone.getFingerprint([]);
    gsites.Xhr.send('https://www.chromium.org/_/tz', null, null, 'GET', null, null, { afjstz: fingerprint });
  }, 500);
</script>
<script xmlns="http://www.w3.org/1999/xhtml">
                    window.onload = function() {
                      if (false) {
                        JOT_setMobilePreview();
                      }
                      var loadTimer = window.jstiming.load;
                      loadTimer.tick("ol");
                      loadTimer["name"] = "load," + webspace.page.type + ",user_page";
                      window.jstiming.report(loadTimer, {}, 'https://gg.google.com/csi');
                    }
                  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
        JOT_insertAnalyticsCode(false,
            false);
      </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    var maestroRunner = new gsites.pages.view.SitesMaestroRunner(
        webspace, "en");
    maestroRunner.initListeners();
    maestroRunner.installEditRender();
  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
  //<![CDATA[
    // Decorate any fastUI buttons on the page with a class of 'goog-button'.
    if (webspace.user.hasWriteAccess) {
      JOT_decorateButtons();
    }

    // Fires delayed events.
    (function() {
      JOT_fullyLoaded = true;
      var delayedEvents = JOT_delayedEvents;
      for (var x = 0; x < delayedEvents.length; x++) {
        var event = delayedEvents[x];
        JOT_postEvent(event.eventName, event.eventSrc, event.payload);
      }
      JOT_delayedEvents = null;
      JOT_postEvent('pageLoaded');
    })();
  //]]>
</script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    JOT_postEvent('decorateGvizCharts');
  </script>
<script type="text/javascript">
          JOT_setupPostRenderingManager();
        </script>
<script type="text/javascript">
          JOT_postEvent('renderPlus', null, 'sites-chrome-main');
        </script>
<div id="server-timer-div" style="display:none"> </div>
<script type="text/javascript">
          window.jstiming.load.tick('render');
          JOT_postEvent('usercontentrendered', this);
        </script>
</body>
</html>
