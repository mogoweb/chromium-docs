<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/WebPage">
<head>
<meta http-equiv="X-UA-Compatible" content="chrome=1" />
<script type="text/javascript">/* Copyright 2008 Google. */ (function() { var e="wtsrt_",g="tbsd_",h="tbnd_",k="start",l="_wtsrt",m="_tbnd",n="CSI/";(function(){function f(a){this.t={};this.tick=function(a,c,b){this.t[a]=[void 0!=b?b:(new Date).getTime(),c];if(void 0==b)try{window.console.timeStamp(n+a)}catch(d){}};this.tick(k,null,a)}var a;window.performance&&(a=window.performance.timing);var p=a?new f(a.responseStart):new f;window.jstiming={Timer:f,load:p};if(a){var c=a.navigationStart,d=a.responseStart;0<c&&d>=c&&(window.jstiming.srt=d-c)}if(a){var b=window.jstiming.load;0<c&&d>=c&&(b.tick(l,void 0,c),b.tick(e,l,d),b.tick(g,e))}try{a=null,
window.chrome&&window.chrome.csi&&(a=Math.floor(window.chrome.csi().pageT),b&&0<c&&(b.tick(m,void 0,window.chrome.csi().startE),b.tick(h,m,c))),null==a&&window.gtbExternal&&(a=window.gtbExternal.pageT()),null==a&&window.external&&(a=window.external.pageT,b&&0<c&&(b.tick(m,void 0,window.external.startE),b.tick(h,m,c))),a&&(window.jstiming.pt=a)}catch(q){}})(); })()
</script>
<link rel="shortcut icon" href="../../_/rsrc/1354323194313/favicon.ico" type="image/x-icon" />
<link rel="apple-touch-icon" href="https://ssl.gstatic.com/sites/p/56e332/system/app/images/apple-touch-icon.png" type="image/png" />
<script type="text/javascript">/* Copyright 2008 Google. */ (function() { var d="",g="__duration__",h="function";function k(c){return document.getElementById(c)}window.byId=k;function l(c){return c.replace(/^\s+|\s+$/g,d)}window.trim=l;var m=[],n=0;window.JOT_addListener=function(c,a,b){var e=new String(n++);c={eventName:c,handler:a,compId:b,key:e};m.push(c);return e};window.JOT_removeListenerByKey=function(c){for(var a=0;a<m.length;a++)if(m[a].key==c){m.splice(a,1);break}};
window.JOT_removeAllListenersForName=function(c){for(var a=0;a<m.length;a++)m[a].eventName==c&&m.splice(a,1)};window.JOT_postEvent=function(c,a,b){var e={eventName:c,eventSrc:a||{},payload:b||{}};if(window.JOT_fullyLoaded)for(a=m.length,b=0;b<a&&b<m.length;b++){var f=m[b];f&&f.eventName==c&&(e.listenerCompId=f.compId||d,(f=typeof f.handler==h?f.handler:window[f.handler])&&f(e))}else window.JOT_delayedEvents.push({eventName:c,eventSrc:a,payload:b})};window.JOT_delayedEvents=[];
window.JOT_fullyLoaded=!1;window.JOT_formatRelativeToNow=function(c,a){var b=((new Date).getTime()-c)/6E4;if(1440<=b||0>b)return null;var e=0;60<=b&&(b/=60,e=2);2<=b&&e++;return a?window.JOT_siteRelTimeStrs[e].replace(g,Math.floor(b)):window.JOT_userRelTimeStrs[e].replace(g,Math.floor(b))}; })()
</script>
<script>

  

  var breadcrumbs = [{"path":"/developers","deleted":false,"title":"For Developers","dir":"ltr"},{"path":"/developers/design-documents","deleted":false,"title":"Design Documents","dir":"ltr"},{"path":"/developers/design-documents/system-dictionary-pop-up-architecture","deleted":false,"title":"System Dictionary Pop-Up Architecture","dir":"ltr"}];
  var JOT_clearDotPath = 'https://ssl.gstatic.com/sites/p/56e332/system/app/images/cleardot.gif';

  
  var JOT_userRelTimeStrs = ["a minute ago","__duration__ minutes ago","an hour ago","__duration__ hours ago"];

  
  

  

  var webspace = {"enableAnalytics":true,"pageSharingId":"jotspot_page","enableUniversalAnalytics":false,"sharingPolicy":"OPENED_WITH_INDICATOR","siteTitle":"The Chromium Projects","isStartPageEnabled":true,"adsensePublisherId":null,"features":{"languageSelectDefaultTextSetToDefault":true,"validateClientGvizDataSourceUrls":true,"moreMobileStyleImprovements":true,"newInsertMenuIcons":true,"accessibleSortingButtons":true,"domainAnalyticsInGAOnly":true,"noCaptcha":true,"fileCabinetScreenReaderFix":true,"updatedTosAndPrivacyLinks":null,"pageDrafts":false,"mobileOrientationFix":true,"plusBadge":false,"pdfEmbedSupport":false,"jsClickFix":true},"isPublic":true,"isConsumer":false,"serverFlags":{"cajaBaseUrl":"//www.gstatic.com/caja","cajaDebugMode":false},"onepickBaseUrl":"https://docs.google.com","domainAnalyticsAccountId":"","plusPageId":"","signInUrl":"https://www.google.com/a/SelectSession?continue\u003dhttps://sites.google.com/a/chromium.org/dev/developers/design-documents/system-dictionary-pop-up-architecture\u0026service\u003djotspot","analyticsAccountId":"UA-5484340-1","scottyUrl":"/_/upload","homePath":"/","siteNoticeUrlEnabled":null,"plusPageUrl":"","adsensePromoClickedOrSiteIneligible":true,"csiReportUri":"https://gg.google.com/csi","sharingId":"jotspot","termsUrl":"//www.google.com/intl/en/policies/terms/","gvizVersion":1,"editorResources":{"sitelayout":["https://ssl.gstatic.com/sites/p/56e332/system/app/css/sitelayouteditor.css"],"text":["https://ssl.gstatic.com/sites/p/56e332/system/js/codemirror.js","https://ssl.gstatic.com/sites/p/56e332/system/app/css/codemirror_css.css","https://ssl.gstatic.com/sites/p/56e332/system/js/trog_edit__en.js","https://ssl.gstatic.com/sites/p/56e332/system/app/css/trogedit.css","/_/rsrc/1441580320000/system/app/css/editor.css","https://ssl.gstatic.com/sites/p/56e332/system/app/css/codeeditor.css","/_/rsrc/1441580320000/system/app/css/camelot/editor-jfk-wlb.css"]},"sharingUrlPrefix":"/_/sharing","isAdsenseEnabled":true,"domain":"chromium.org","baseUri":"","name":"dev","siteTemplateId":false,"siteNoticeRevision":null,"siteNoticeUrlAddress":null,"siteNoticeMessage":null,"page":{"isRtlLocale":false,"canDeleteWebspace":null,"isPageDraft":null,"parentPath":"/developers/design-documents","parentWuid":"wuid:gx:359ef223e0fb14ac","siteLocale":"en","timeZone":"America/Los_Angeles","type":"text","title":"System Dictionary Pop-Up Architecture","locale":"en","wuid":"wuid:gx:7bab0ba75275a26d","revision":6,"path":"/developers/design-documents/system-dictionary-pop-up-architecture","isSiteRtlLocale":false,"pageInheritsPermissions":null,"name":"system-dictionary-pop-up-architecture","canChangePath":true,"state":"","properties":{},"bidiEnabled":false,"currentTemplate":{"path":"/system/app/pagetemplates/text","title":"Web Page"}},"canPublishScriptToAnyone":true,"user":{"keyboardShortcuts":true,"sessionIndex":"","guest_":true,"displayNameOrEmail":"guest","userName":"guest","uid":"","renderMobile":false,"domain":"","namespace":"","hasWriteAccess":false,"namespaceUser":false,"primaryEmail":"guest","hasAdminAccess":false},"gadgets":{"baseUri":"/system/app/pages/gadgets"}};
  webspace.page.breadcrumbs = breadcrumbs;

  
  var JOT_siteRelTimeStrs = ["a minute ago","__duration__ minutes ago","an hour ago","__duration__ hours ago"];

</script>
<script type="text/javascript">
                window.jstiming.load.tick('scl');
              </script>
<meta name="title" content="System Dictionary Pop-Up Architecture - The Chromium Projects" />
<meta itemprop="name" content="System Dictionary Pop-Up Architecture - The Chromium Projects" />
<meta property="og:title" content="System Dictionary Pop-Up Architecture - The Chromium Projects" />
<meta name="description" content="Home of the Chromium Open Source Project" />
<meta itemprop="description" content="Home of the Chromium Open Source Project" />
<meta id="meta-tag-description" property="og:description" content="Home of the Chromium Open Source Project" />
<style type="text/css">
</style>
<link rel="stylesheet" type="text/css" href="https://ssl.gstatic.com/sites/p/56e332/system/app/themes/beigeandblue/standard-css-beigeandblue-ltr-ltr.css" />
<link rel="stylesheet" type="text/css" href="../../_/rsrc/1441580320000/system/app/css/overlay.css%3Fcb=beigeandblueundefineda100%2525%2525150goog-ws-leftthemedefaultstandard.css" />
<link rel="stylesheet" type="text/css" href="../../_/rsrc/1441580320000/system/app/css/camelot/allthemes-view.css" />
<!--[if IE]>
          <link rel="stylesheet" type="text/css" href="/system/app/css/camelot/allthemes%2die.css" />
        <![endif]-->
<title>System Dictionary Pop-Up Architecture - The Chromium Projects</title>
<meta itemprop="image" content="/_/rsrc/1438879449147/config/customLogo.gif?revision=3" />
<meta property="og:image" content="/_/rsrc/1438879449147/config/customLogo.gif?revision=3" />
<script type="text/javascript">
                window.jstiming.load.tick('cl');
              </script>
</head>
<body xmlns="http://www.google.com/ns/jotspot" id="body" class=" en            ">
<div id="sites-page-toolbar" class="sites-header-divider">
<div xmlns="http://www.w3.org/1999/xhtml" id="sites-status" class="sites-status" style="display:none;"><div id="sites-notice" class="sites-notice" role="status" aria-live="assertive"> </div></div>
</div>
<div id="sites-chrome-everything-scrollbar">
<div id="sites-chrome-everything" class="">
<div id="sites-chrome-page-wrapper" style="direction: ltr">
<div id="sites-chrome-page-wrapper-inside">
<div xmlns="http://www.w3.org/1999/xhtml" id="sites-chrome-header-wrapper" style="height:auto;">
<table id="sites-chrome-header" class="sites-layout-hbox" cellspacing="0" style="height:auto;">
<tr class="sites-header-primary-row" id="sites-chrome-userheader">
<td id="sites-header-title" class="" role="banner"><div class="sites-header-cell-buffer-wrapper"><a href="../../index.html" id="sites-chrome-userheader-logo"><img id="logo-img-id" src="../../_/rsrc/1438879449147/config/customLogo.gif%3Frevision=3" alt="The Chromium Projects" class="sites-logo  " /></a><h2><a href="../../index.html" dir="ltr" id="sites-chrome-userheader-title">The Chromium Projects</a></h2></div></td><td class="sites-layout-searchbox  "><div class="sites-header-cell-buffer-wrapper"><form id="sites-searchbox-form" action="https://www.chromium.org/system/app/pages/search" role="search"><input type="hidden" id="sites-searchbox-scope" name="scope" value="search-site" /><input type="text" id="jot-ui-searchInput" name="q" size="20" value="" aria-label="Search this site" /><div id="sites-searchbox-button-set" class="goog-inline-block"><div role="button" id="sites-searchbox-search-button" class="goog-inline-block jfk-button jfk-button-standard" tabindex="0">Search this site</div></div></form></div></td>
</tr>
<tr class="sites-header-secondary-row" id="sites-chrome-horizontal-nav">
<td colspan="2" id="sites-chrome-header-horizontal-nav-container" role="navigation">
</td>
</tr>
</table>
</div>
<div id="sites-chrome-main-wrapper">
<div id="sites-chrome-main-wrapper-inside">
<table id="sites-chrome-main" class="sites-layout-hbox" cellspacing="0" cellpadding="{scmCellpadding}" border="0">
<tr>
<td id="sites-chrome-sidebar-left" class="sites-layout-sidebar-left initial" style="width:150px">
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_7648876402527094" class="sites-embed" role="navigation"><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotId="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="../../chromium-projects.html" jotId="wuid:gx:10ae433dadbbab13" class="sites-navigation-link">Home</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="../../Home.1.html" jotId="wuid:gx:43582b9d2029d3af" class="sites-navigation-link">Chromium</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="../../chromium-os.1.html" jotId="wuid:gx:83df2ab1f8880ba" class="sites-navigation-link">Chromium OS</a></div></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_14720868319272995" class="sites-embed" role="navigation"><h4 class="sites-embed-title">Quick links</h4><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotId="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="../../for-testers/bug-reporting-guidelines.html" class="sites-navigation-link">Report bugs</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="../discussion-groups.html" class="sites-navigation-link">Discuss</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="../../system/app/pages/sitemap/hierarchy.html" jotId="wuid:gx:4b58a9a350ad12f" class="sites-navigation-link">网站地图</a></div></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_19690813310444355" class="sites-embed" role="navigation"><h4 class="sites-embed-title">Other sites</h4><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotId="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="http://blog.chromium.org/" class="sites-navigation-link">Chromium Blog</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="http://code.google.com/chrome/extensions/" class="sites-navigation-link">Google Chrome Extensions</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="https://developers.google.com/chrome/chrome-frame/" class="sites-navigation-link">Google Chrome Frame</a></div></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_19695218559354544" class="sites-embed" role="complementary"><h4 class="sites-embed-title"></h4><div class="sites-embed-content sites-embed-content-sidebar-textbox"><div dir="ltr"><span style="font-size:x-small">Except as otherwise </span><a href="http://developers.google.com/site-policies.html#restrictions"><span style="font-size:x-small">noted</span></a><span style="font-size:x-small">, the content of this page is licensed under a </span><a href="http://creativecommons.org/licenses/by/2.5/"><span style="font-size:x-small">Creative Commons Attribution 2.5 license</span></a><span style="font-size:x-small">, and examples are licensed under the </span><a href="http://src.chromium.org/viewvc/chrome/trunk/src/LICENSE" target="_blank"><span style="font-size:x-small">BSD License</span></a><span style="font-size:x-small">.<br /></span></div></div></div>
</td>
<td id="sites-canvas-wrapper">
<div id="sites-canvas" role="main">
<div id="goog-ws-editor-toolbar-container"> </div>
<div xmlns="http://www.w3.org/1999/xhtml" id="title-crumbs" style="">
<A href="../../developers.1.html" dir="ltr">For Developers</A>‎ &gt; ‎<A href="../design-documents.1.html" dir="ltr">Design Documents</A>‎ &gt; ‎
  </div>
<h3 xmlns="http://www.w3.org/1999/xhtml" id="sites-page-title-header" style="" align="left">
<span id="sites-page-title" dir="ltr" tabindex="-1" style="outline: none">System Dictionary Pop-Up Architecture</span>
</h3>
<div id="sites-canvas-main" class="sites-canvas-main">
<div id="sites-canvas-main-content">
<table xmlns="http://www.w3.org/1999/xhtml" cellspacing="0" class="sites-layout-name-one-column sites-layout-hbox"><tbody><tr><td class="sites-layout-tile sites-tile-name-content-1"><div dir="ltr"><div>The Mac OS X system function "Lookup in Dictionary" pops open a hover panel that shows the dictionary definition of the word at which  the mouse cursor points. This functionality is provided by the system but is difficult to make work with Chromium's multi-process architecture. The underlying implementation uses <font face="'courier new', monospace">-[NSTextInput characterIndexAtPoint:]</font> to return the index of the character in the text stream where the mouse is pointing. Our current accessibility work provides the text content of the webpage over IPC to the browser process. Unfortunately, the mapping of points to characters is a prohibitively large data set and cannot be moved over IPC. Since the underlying implementation of the dictionary function relies on a synchronous accessibility API, the problem is further complicated.</div><div><br /></div><div>One possible implementation is to send a synchronous IPC message from the browser process to the renderer. This would have to have a very short timeout because this synchronous message will block the UI thread, which could lead to a janky experience. But, the browser process, as a general rule, does not send synchronous messages to the renderer; only the vice versa is allowed. In order to perform this, then, the browser's IPC channel would need to be made synchronous as well as asynchronous. However, doing so would make it easier for people to add other synchronous IPC View messages, which should be avoided at all costs.</div><div><br /></div><div>Another option, rather than making the main IPC channel synchronous, would be to add another channel between the browser and renderer. This shares the same drawbacks as the first implementation, but at least would separate out the single synchronous View message into its own member, which could be documented with verboten warnings. But it also has an additional drawback of requiring another IPC channel, which would consume another file descriptor per renderer process. Considering file descriptor exhaustion could already be an issue due to Chrome's architecture, this is not desirable for the implementation of a single feature.</div><div><br /></div><div>The third option is to communicate to the renderer with asynchronous messages and use thread synchronization techniques to make the communication behave synchronously. To do this, we use a condition variable and a Singleton member.</div><div><br /></div><div>A fourth option is to completely bypass how the system implements this using Accessibility of NSText and instead call the 10.6+ API to show the popup manually. The API in question is: <font face="'courier new', monospace">-[NSView showDefinitionForAttributedString:range:options:baselineOriginProvider:]</font><font face="arial, sans-serif"> with </font><font face="'courier new', monospace">NSDefinitionPresentationTypeKey=NSDefinitionPresentationTypeOverlay</font><font face="arial, sans-serif"> in </font><font face="'courier new', monospace">options</font><font face="arial, sans-serif">. This works well on 10.6, but it means that the browser process would need to simulate the cmd-ctrl-d-then-keep-cmd-ctrl-down-and-drag-mouse-around logic, which is unfortunate. On the plus side, this would be completely async.</font></div><h2><a name="TOC-Dictionary-Pop-Up-Internals"></a><font face="arial, sans-serif">Dictionary Pop-Up Internals</font></h2><div></div><div>This section will detail how Mac OS X brings up the dictionary pop-up. This examination was done on Mac OS X 10.6.5.</div><div><br /></div><div>All typical Cocoa apps get the dictionary pop-up behavior for free because NSTextField and NSTextView conform to NSTextInput (or NSTextInputClient). These protocols define the three methods used to implement the dictionary functionality:</div><div>
<ol><li><font face="'courier new', monospace">- (<span>NSAttributedString</span>*)attributedSubstringFromRange:(<span>NSRange</span>)</font><span style="font-family:courier new,monospace">theRange</span></li><li><font face="'courier new', monospace">- (<span>NSUInteger</span>)characterIndexForPoint:(<span>NSPoint</span>)thePoint</font></li><li><font face="'courier new', monospace">- (<span>NSRect</span>)firstRectForCharacterRange:(<span>NSRange</span>)theRange</font></li></ol><p><span>
</span></p></div><div>The system calls these methods in that order, with this rough pattern:</div><div><ol><li><font face="'courier new', monospace">-attributedStringForRange:</font>{0, 10}</li><li><font face="'courier new', monospace">-characterIndexForPoint:</font>{mouseX, mouseY} → returns index <b>C</b> </li><li><font face="'courier new', monospace">-attributedStringForRange:</font>{<b>C</b>, 50} → returns string <b>S</b></li><li><font face="'courier new', monospace">-firstRectForCharacterRange:</font>{<b>C</b> ± 50, <b>S*</b>.length}</li></ol><div>It's unclear why each dictionary popup request always starts with (1), but it's likely some sort of warmup test. The rest is fairly forward: it receives the index of the character in the text stream over which the mouse points. From there, it gets the attributed string at that point and the 50 characters after it. The string it returns is attributed because the highlighted word effect is done by drawing the attributed string with the gray background over the word that is being looked up. Finally, it gets the drawing rectangle for the word so it knows where to position the popup. The range it passes is determined by the Dictionary framework, which breaks up the 50 character string and finds the individual word or phrase that is being looked up.</div></div><div><br /></div><div>In Chromium, our native view that lives in the browser process conforms to the NSTextInput protocol but the text stream and web contents live in a separate process. This means that the access to the necessary data has to be brought across the process boundary. Unfortunately, the API assumes that everything is within the same process (a safe assumption for almost all Cocoa applications), so it is synchronous. To work within that constraint, we use the third option outlined above: send asynchronous ViewMsg messages to the renderer and then wait on a condition variable. Each of the 3 NSTextInput methods listed above follow this pattern in render_widget_host_view_mac.mm, using the example pseudocode below.</div><div><br /></div><div><hr /></div><h3><a name="TOC-Sample-Code:"></a>Sample Code:</h3><h4><a name="TOC-chrome-browser-cocoa-lookup_in_dictionary.h:"></a>//chrome/browser/cocoa/lookup_in_dictionary.h:</h4><div><font face="'courier new', monospace">#include "base/singleton.h"</font></div><div><font face="'courier new', monospace"><br /></font></div><div><font face="'courier new', monospace">class LookupInDictionary {</font></div><div><font face="'courier new', monospace"> public:</font></div><div><font face="'courier new', monospace">  // Locks the internal condition for use before the asynchronous message is sent to the renderer</font></div><div><font face="'courier new', monospace">  // to lookup the character index at a given point.</font></div><div><font face="'courier new', monospace">  void BeforeRequest() {</font></div><div><font face="'courier new', monospace">    lock_.Acquire();</font></div><div><font face="'courier new', monospace">    character_index_ = NSNotFound;</font></div><div><font face="'courier new', monospace">  }</font></div><div><font face="'courier new', monospace"><br /></font></div><div><font face="'courier new', monospace">  // Blocks the calling thread with a short timeout after the async message has been sent to the</font></div><div><font face="'courier new', monospace">  // renderer to lookup the character index of a given mouse point. This will return NSNotFound</font></div><div><font face="'courier new', monospace">  // if the timeout expires or if no character at the given point was found, otherwise it will return</font></div><div><font face="'courier new', monospace">  // the character index.</font></div><div><font face="'courier new', monospace">  NSUInteger WaitForCharacterIndex() {</font></div><div><font face="'courier new', monospace">    condition_.TimedWait(1.5 seconds);</font></div><div><font face="'courier new', monospace">    return character_index_;</font></div><div><font face="'courier new', monospace">  }</font></div><div><font face="'courier new', monospace"><br /></font></div><div><font face="'courier new', monospace">  // Called at the end of the critical section. This will release the lock and condition.</font></div><div><font face="'courier new', monospace">  void AfterRequest() {</font></div><div><font face="'courier new', monospace">    lock_.Release();</font></div><div><font face="'courier new', monospace">  }</font></div><div><font face="'courier new', monospace"><br /></font></div><div><font face="'courier new', monospace">  // Sets the character index for the last point message. This is called from the IO thread upon</font></div><div><font face="'courier new', monospace">  // receipt of the reply message. This will signal the condition to wake the sleeping UI thread if it</font></div><div><font face="'courier new', monospace">  // has not yet timed out.</font></div><div><font face="'courier new', monospace">  void SetCharacterIndexAndSignal(NSUInteger index) {</font></div><div><font face="'courier new', monospace">    lock_.Acquire();</font></div><div><font face="'courier new', monospace">    character_index_ = index;</font></div><div><font face="'courier new', monospace">    lock_.Release();</font></div><div><font face="'courier new', monospace">    condition_.Signal();</font></div><div><font face="'courier new', monospace">  }</font></div><div><font face="'courier new', monospace"><br /></font></div><div><font face="'courier new', monospace"> private:</font></div><div><font face="'courier new', monospace">  friend struct DefaultSingletonTraits;</font></div><div><font face="'courier new', monospace">  LookupInDictionary() </font></div><div><font face="'courier new', monospace">      : character_index_(NSNotFound),</font></div><div><font face="'courier new', monospace">        lock_(),</font></div><div><font face="'courier new', monospace">        condition_(&amp;lock_) {</font></div><div><font face="'courier new', monospace">  }</font></div><div><font face="'courier new', monospace"><br /></font></div><div><font face="'courier new', monospace">  NSUInteger character_index_;</font></div><div><font face="'courier new', monospace"><br /></font></div><div><font face="'courier new', monospace">  Lock lock_;</font></div><div><font face="'courier new', monospace">  ConditionVariable condition_;</font></div><div><font face="'courier new', monospace">};</font></div><div><br /></div><div><hr /></div><div><span style="font-weight:bold">render_widget_host_mac.mm</span></div><div><br /></div><div><font face="'courier new', monospace">- (NSUInteger)characterIndexAtPoint:(NSPoint)thePoint {</font></div><div><font face="'courier new', monospace">  gfx::Point point(thePoint.x, thePoint.y);</font></div><div><font face="'courier new', monospace">  LookupInDictionary* service = Singleton&lt;LookupInDictionary&gt;::get();</font></div><div><font face="'courier new', monospace"><br /></font></div><div><font face="'courier new', monospace">  service-&gt;BeforeRequest();</font></div><div><font face="'courier new', monospace">  Send(new ViewMsg_CharacterIndexAtPoint(routing_id(), point));</font></div><div><font face="'courier new', monospace">  NSUInteger index = service-&gt;WaitForCharacterIndex();</font></div><div><font face="'courier new', monospace">  service-&gt;AfterRequest();</font></div><div><font face="'courier new', monospace"><br /></font></div><div><font face="'courier new', monospace">  return index;</font></div><div><font face="'courier new', monospace">}</font></div><div><br /></div><div><hr /></div><div><span style="font-weight:bold">resource_message_filter.cc</span></div><div><br /></div><div><font face="'courier new', monospace">void ResourceMessageFilter::OnCharacterIndexAtPoint(uint index) {</font></div><div><font face="'courier new', monospace">  LookupInDictionary* service = Singleton&lt;LookupInDictionary&gt;::get();</font></div><div><font face="'courier new', monospace">  service-&gt;SetCharacterIndexAndSignal(index);</font></div><div><font face="'courier new', monospace">}</font></div></div></td></tr></tbody></table>
</div> 
</div> 
<div id="sites-canvas-bottom-panel">
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_page-subpages"> </div>
<div id="sites-attachments-container">
</div>
<a xmlns="http://www.w3.org/1999/xhtml" name="page-comments"></a>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_page-comments"><div class="sites-comment-docos-wrapper"><div class="sites-comment-docos"><div class="sites-comment-docos-background"></div><div class="sites-comment-docos-header"><div class="sites-comment-docos-header-title">Comments</div></div><div id="sites-comment-docos-pane" class="sites-comment-docos-pane"></div></div></div></div>
</div>
</div> 
</td> 
</tr>
</table> 
</div> 
</div> 
<div id="sites-chrome-footer-wrapper">
<div id="sites-chrome-footer-wrapper-inside">
<div id="sites-chrome-footer">
</div>
</div>
</div>
</div> 
</div> 
<div id="sites-chrome-adminfooter-container">
<div xmlns="http://www.w3.org/1999/xhtml" class="sites-adminfooter" role="navigation"><p><a class="sites-system-link" href="https://www.google.com/a/UniversalLogin?service=jotspot&amp;continue=https://sites.google.com/a/chromium.org/dev/developers/design-documents/system-dictionary-pop-up-architecture">Sign in</a><span aria-hidden="true">|</span><a class="sites-system-link" href="../../system/app/pages/recentChanges.html">Recent Site Activity</a><span aria-hidden="true">|</span><a class="sites-system-link" href="../../system/app/pages/reportAbuse.html" target="_blank">Report Abuse</a><span aria-hidden="true">|</span><a class="sites-system-link" href="javascript:;" onclick="window.open(webspace.printUrl)">Print Page</a><span aria-hidden="true">|</span><span class="sites-system-link">Powered By</span> <b class="powered-by"><a href="http://sites.google.com">Google Sites</a></b></p></div>
</div>
</div> 
</div> 
<div id="sites-chrome-onebar-footer">
</div>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    window.jstiming.load.tick('sjl');
  </script>
<script xmlns="http://www.w3.org/1999/xhtml" src="https://ssl.gstatic.com/sites/p/56e332/system/js/jot_min_view__en.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    window.jstiming.load.tick('jl');
  </script>
<script xmlns="http://www.w3.org/1999/xhtml">
      
          sites.core.Analytics.createTracker();
          sites.core.Analytics.trackPageview();
        
    </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
                    sites.Searchbox.initialize(
                        'sites-searchbox-search-button',
                        {"object":[]}['object'],
                        'search-site',
                        {"label":"Configure search options...","url":"/system/app/pages/admin/settings"});
                  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
      gsites.HoverPopupMenu.createSiteDropdownMenus('sites-header-nav-dropdown', false);
    </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
            JOT_setupNav("7648876402527094", "Navigation", false);
            JOT_addListener('titleChange', 'JOT_NAVIGATION_titleChange', 'COMP_7648876402527094');
          </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
            JOT_setupNav("14720868319272995", "Quick links", false);
            JOT_addListener('titleChange', 'JOT_NAVIGATION_titleChange', 'COMP_14720868319272995');
          </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
            JOT_setupNav("19690813310444355", "Other sites", false);
            JOT_addListener('titleChange', 'JOT_NAVIGATION_titleChange', 'COMP_19690813310444355');
          </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
              new sites.CommentPane('//docs.google.com/comments/d/AAHRpnXvrAwjAfmld0ObrebBiGRq97CaULrSDRj2P5vcbXiXdhpKg562A5EQeCghCjILjVttdA1ksZ1Gyd7EYtrTNOW18e88S4ddOmiOnsVE-jQbWvTS6QcR2uwaeVyF5vyDl_SKU8BSq/api/js?anon=true',
                  false, false);
            </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
  setTimeout(function() {
    var fingerprint = gsites.date.TimeZone.getFingerprint([]);
    gsites.Xhr.send('https://www.chromium.org/_/tz', null, null, 'GET', null, null, { afjstz: fingerprint });
  }, 500);
</script>
<script xmlns="http://www.w3.org/1999/xhtml">
                    window.onload = function() {
                      if (false) {
                        JOT_setMobilePreview();
                      }
                      var loadTimer = window.jstiming.load;
                      loadTimer.tick("ol");
                      loadTimer["name"] = "load," + webspace.page.type + ",user_page";
                      window.jstiming.report(loadTimer, {}, 'https://gg.google.com/csi');
                    }
                  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
        JOT_insertAnalyticsCode(false,
            false);
      </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    var maestroRunner = new gsites.pages.view.SitesMaestroRunner(
        webspace, "en");
    maestroRunner.initListeners();
    maestroRunner.installEditRender();
  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
  //<![CDATA[
    // Decorate any fastUI buttons on the page with a class of 'goog-button'.
    if (webspace.user.hasWriteAccess) {
      JOT_decorateButtons();
    }

    // Fires delayed events.
    (function() {
      JOT_fullyLoaded = true;
      var delayedEvents = JOT_delayedEvents;
      for (var x = 0; x < delayedEvents.length; x++) {
        var event = delayedEvents[x];
        JOT_postEvent(event.eventName, event.eventSrc, event.payload);
      }
      JOT_delayedEvents = null;
      JOT_postEvent('pageLoaded');
    })();
  //]]>
</script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    JOT_postEvent('decorateGvizCharts');
  </script>
<script type="text/javascript">
          JOT_setupPostRenderingManager();
        </script>
<script type="text/javascript">
          JOT_postEvent('renderPlus', null, 'sites-chrome-main');
        </script>
<div id="server-timer-div" style="display:none"> </div>
<script type="text/javascript">
          window.jstiming.load.tick('render');
          JOT_postEvent('usercontentrendered', this);
        </script>
</body>
</html>
