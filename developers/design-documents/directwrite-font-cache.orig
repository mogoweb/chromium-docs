<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/WebPage">
<head>
<meta http-equiv="X-UA-Compatible" content="chrome=1" />
<script type="text/javascript">/* Copyright 2008 Google. */ (function() { var e="wtsrt_",g="tbsd_",h="tbnd_",k="start",l="_wtsrt",m="_tbnd",n="CSI/";(function(){function f(a){this.t={};this.tick=function(a,c,b){this.t[a]=[void 0!=b?b:(new Date).getTime(),c];if(void 0==b)try{window.console.timeStamp(n+a)}catch(d){}};this.tick(k,null,a)}var a;window.performance&&(a=window.performance.timing);var p=a?new f(a.responseStart):new f;window.jstiming={Timer:f,load:p};if(a){var c=a.navigationStart,d=a.responseStart;0<c&&d>=c&&(window.jstiming.srt=d-c)}if(a){var b=window.jstiming.load;0<c&&d>=c&&(b.tick(l,void 0,c),b.tick(e,l,d),b.tick(g,e))}try{a=null,
window.chrome&&window.chrome.csi&&(a=Math.floor(window.chrome.csi().pageT),b&&0<c&&(b.tick(m,void 0,window.chrome.csi().startE),b.tick(h,m,c))),null==a&&window.gtbExternal&&(a=window.gtbExternal.pageT()),null==a&&window.external&&(a=window.external.pageT,b&&0<c&&(b.tick(m,void 0,window.external.startE),b.tick(h,m,c))),a&&(window.jstiming.pt=a)}catch(q){}})(); })()
</script>
<link rel="shortcut icon" href="/_/rsrc/1354323194313/favicon.ico" type="image/x-icon" />
<link rel="apple-touch-icon" href="https://ssl.gstatic.com/sites/p/56e332/system/app/images/apple-touch-icon.png" type="image/png" />
<script type="text/javascript">/* Copyright 2008 Google. */ (function() { var d="",g="__duration__",h="function";function k(c){return document.getElementById(c)}window.byId=k;function l(c){return c.replace(/^\s+|\s+$/g,d)}window.trim=l;var m=[],n=0;window.JOT_addListener=function(c,a,b){var e=new String(n++);c={eventName:c,handler:a,compId:b,key:e};m.push(c);return e};window.JOT_removeListenerByKey=function(c){for(var a=0;a<m.length;a++)if(m[a].key==c){m.splice(a,1);break}};
window.JOT_removeAllListenersForName=function(c){for(var a=0;a<m.length;a++)m[a].eventName==c&&m.splice(a,1)};window.JOT_postEvent=function(c,a,b){var e={eventName:c,eventSrc:a||{},payload:b||{}};if(window.JOT_fullyLoaded)for(a=m.length,b=0;b<a&&b<m.length;b++){var f=m[b];f&&f.eventName==c&&(e.listenerCompId=f.compId||d,(f=typeof f.handler==h?f.handler:window[f.handler])&&f(e))}else window.JOT_delayedEvents.push({eventName:c,eventSrc:a,payload:b})};window.JOT_delayedEvents=[];
window.JOT_fullyLoaded=!1;window.JOT_formatRelativeToNow=function(c,a){var b=((new Date).getTime()-c)/6E4;if(1440<=b||0>b)return null;var e=0;60<=b&&(b/=60,e=2);2<=b&&e++;return a?window.JOT_siteRelTimeStrs[e].replace(g,Math.floor(b)):window.JOT_userRelTimeStrs[e].replace(g,Math.floor(b))}; })()
</script>
<script>

  

  var breadcrumbs = [{"path":"/developers","deleted":false,"title":"For Developers","dir":"ltr"},{"path":"/developers/design-documents","deleted":false,"title":"Design Documents","dir":"ltr"},{"path":"/developers/design-documents/directwrite-font-cache","deleted":false,"title":"DirectWrite Font Cache","dir":"ltr"}];
  var JOT_clearDotPath = 'https://ssl.gstatic.com/sites/p/56e332/system/app/images/cleardot.gif';

  
  var JOT_userRelTimeStrs = ["a minute ago","__duration__ minutes ago","an hour ago","__duration__ hours ago"];

  
  

  

  var webspace = {"enableAnalytics":true,"pageSharingId":"jotspot_page","enableUniversalAnalytics":false,"sharingPolicy":"OPENED_WITH_INDICATOR","siteTitle":"The Chromium Projects","isStartPageEnabled":true,"adsensePublisherId":null,"features":{"languageSelectDefaultTextSetToDefault":true,"validateClientGvizDataSourceUrls":true,"moreMobileStyleImprovements":true,"newInsertMenuIcons":true,"accessibleSortingButtons":true,"domainAnalyticsInGAOnly":true,"noCaptcha":true,"fileCabinetScreenReaderFix":true,"updatedTosAndPrivacyLinks":null,"pageDrafts":false,"mobileOrientationFix":true,"plusBadge":false,"pdfEmbedSupport":false,"jsClickFix":true},"isPublic":true,"isConsumer":false,"serverFlags":{"cajaBaseUrl":"//www.gstatic.com/caja","cajaDebugMode":false},"onepickBaseUrl":"https://docs.google.com","domainAnalyticsAccountId":"","plusPageId":"","signInUrl":"https://www.google.com/a/SelectSession?continue\u003dhttps://sites.google.com/a/chromium.org/dev/developers/design-documents/directwrite-font-cache\u0026service\u003djotspot","analyticsAccountId":"UA-5484340-1","scottyUrl":"/_/upload","homePath":"/","siteNoticeUrlEnabled":null,"plusPageUrl":"","adsensePromoClickedOrSiteIneligible":true,"csiReportUri":"https://gg.google.com/csi","sharingId":"jotspot","termsUrl":"//www.google.com/intl/en/policies/terms/","gvizVersion":1,"editorResources":{"sitelayout":["https://ssl.gstatic.com/sites/p/56e332/system/app/css/sitelayouteditor.css"],"text":["https://ssl.gstatic.com/sites/p/56e332/system/js/codemirror.js","https://ssl.gstatic.com/sites/p/56e332/system/app/css/codemirror_css.css","https://ssl.gstatic.com/sites/p/56e332/system/js/trog_edit__en.js","https://ssl.gstatic.com/sites/p/56e332/system/app/css/trogedit.css","/_/rsrc/1441580320000/system/app/css/editor.css","https://ssl.gstatic.com/sites/p/56e332/system/app/css/codeeditor.css","/_/rsrc/1441580320000/system/app/css/camelot/editor-jfk-wlb.css"]},"sharingUrlPrefix":"/_/sharing","isAdsenseEnabled":true,"domain":"chromium.org","baseUri":"","name":"dev","siteTemplateId":false,"siteNoticeRevision":null,"siteNoticeUrlAddress":null,"siteNoticeMessage":null,"page":{"isRtlLocale":false,"canDeleteWebspace":null,"isPageDraft":null,"parentPath":"/developers/design-documents","parentWuid":"wuid:gx:359ef223e0fb14ac","siteLocale":"en","timeZone":"America/Los_Angeles","type":"text","title":"DirectWrite Font Cache","locale":"en","wuid":"wuid:gx:4af1eef1fa413788","revision":4,"path":"/developers/design-documents/directwrite-font-cache","isSiteRtlLocale":false,"pageInheritsPermissions":null,"name":"directwrite-font-cache","canChangePath":true,"state":"","properties":{},"bidiEnabled":false,"currentTemplate":{"path":"/system/app/pagetemplates/text","title":"Web Page"}},"canPublishScriptToAnyone":true,"user":{"keyboardShortcuts":true,"sessionIndex":"","guest_":true,"displayNameOrEmail":"guest","userName":"guest","uid":"","renderMobile":false,"domain":"","namespace":"","hasWriteAccess":false,"namespaceUser":false,"primaryEmail":"guest","hasAdminAccess":false},"gadgets":{"baseUri":"/system/app/pages/gadgets"}};
  webspace.page.breadcrumbs = breadcrumbs;

  
  var JOT_siteRelTimeStrs = ["a minute ago","__duration__ minutes ago","an hour ago","__duration__ hours ago"];

</script>
<script type="text/javascript">
                window.jstiming.load.tick('scl');
              </script>
<meta name="title" content="DirectWrite Font Cache - The Chromium Projects" />
<meta itemprop="name" content="DirectWrite Font Cache - The Chromium Projects" />
<meta property="og:title" content="DirectWrite Font Cache - The Chromium Projects" />
<meta name="description" content="Home of the Chromium Open Source Project" />
<meta itemprop="description" content="Home of the Chromium Open Source Project" />
<meta id="meta-tag-description" property="og:description" content="Home of the Chromium Open Source Project" />
<style type="text/css">
</style>
<link rel="stylesheet" type="text/css" href="https://ssl.gstatic.com/sites/p/56e332/system/app/themes/beigeandblue/standard-css-beigeandblue-ltr-ltr.css" />
<link rel="stylesheet" type="text/css" href="/_/rsrc/1441580320000/system/app/css/overlay.css?cb=beigeandblueundefineda100%25%25150goog-ws-leftthemedefaultstandard" />
<link rel="stylesheet" type="text/css" href="/_/rsrc/1441580320000/system/app/css/camelot/allthemes-view.css" />
<!--[if IE]>
          <link rel="stylesheet" type="text/css" href="/system/app/css/camelot/allthemes%2die.css" />
        <![endif]-->
<title>DirectWrite Font Cache - The Chromium Projects</title>
<meta itemprop="image" content="https://docs.google.com/a/google.com/drawings/d/sr3ilNMP6rJv-ADbjZC1BFQ/image?w=624&amp;h=263&amp;rev=1&amp;ac=1" />
<meta property="og:image" content="https://docs.google.com/a/google.com/drawings/d/sr3ilNMP6rJv-ADbjZC1BFQ/image?w=624&amp;h=263&amp;rev=1&amp;ac=1" />
<script type="text/javascript">
                window.jstiming.load.tick('cl');
              </script>
</head>
<body xmlns="http://www.google.com/ns/jotspot" id="body" class=" en            ">
<div id="sites-page-toolbar" class="sites-header-divider">
<div xmlns="http://www.w3.org/1999/xhtml" id="sites-status" class="sites-status" style="display:none;"><div id="sites-notice" class="sites-notice" role="status" aria-live="assertive"> </div></div>
</div>
<div id="sites-chrome-everything-scrollbar">
<div id="sites-chrome-everything" class="">
<div id="sites-chrome-page-wrapper" style="direction: ltr">
<div id="sites-chrome-page-wrapper-inside">
<div xmlns="http://www.w3.org/1999/xhtml" id="sites-chrome-header-wrapper" style="height:auto;">
<table id="sites-chrome-header" class="sites-layout-hbox" cellspacing="0" style="height:auto;">
<tr class="sites-header-primary-row" id="sites-chrome-userheader">
<td id="sites-header-title" class="" role="banner"><div class="sites-header-cell-buffer-wrapper"><a href="https://www.chromium.org/" id="sites-chrome-userheader-logo"><img id="logo-img-id" src="/_/rsrc/1438879449147/config/customLogo.gif?revision=3" alt="The Chromium Projects" class="sites-logo  " /></a><h2><a href="https://www.chromium.org/" dir="ltr" id="sites-chrome-userheader-title">The Chromium Projects</a></h2></div></td><td class="sites-layout-searchbox  "><div class="sites-header-cell-buffer-wrapper"><form id="sites-searchbox-form" action="/system/app/pages/search" role="search"><input type="hidden" id="sites-searchbox-scope" name="scope" value="search-site" /><input type="text" id="jot-ui-searchInput" name="q" size="20" value="" aria-label="Search this site" /><div id="sites-searchbox-button-set" class="goog-inline-block"><div role="button" id="sites-searchbox-search-button" class="goog-inline-block jfk-button jfk-button-standard" tabindex="0">Search this site</div></div></form></div></td>
</tr>
<tr class="sites-header-secondary-row" id="sites-chrome-horizontal-nav">
<td colspan="2" id="sites-chrome-header-horizontal-nav-container" role="navigation">
</td>
</tr>
</table>
</div>
<div id="sites-chrome-main-wrapper">
<div id="sites-chrome-main-wrapper-inside">
<table id="sites-chrome-main" class="sites-layout-hbox" cellspacing="0" cellpadding="{scmCellpadding}" border="0">
<tr>
<td id="sites-chrome-sidebar-left" class="sites-layout-sidebar-left initial" style="width:150px">
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_7648876402527094" class="sites-embed" role="navigation"><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotId="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="/chromium-projects" jotId="wuid:gx:10ae433dadbbab13" class="sites-navigation-link">Home</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="/Home" jotId="wuid:gx:43582b9d2029d3af" class="sites-navigation-link">Chromium</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="/chromium-os" jotId="wuid:gx:83df2ab1f8880ba" class="sites-navigation-link">Chromium OS</a></div></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_14720868319272995" class="sites-embed" role="navigation"><h4 class="sites-embed-title">Quick links</h4><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotId="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="http://www.chromium.org/for-testers/bug-reporting-guidelines" class="sites-navigation-link">Report bugs</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="http://www.chromium.org/developers/discussion-groups" class="sites-navigation-link">Discuss</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="/system/app/pages/sitemap/hierarchy" jotId="wuid:gx:4b58a9a350ad12f" class="sites-navigation-link">网站地图</a></div></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_19690813310444355" class="sites-embed" role="navigation"><h4 class="sites-embed-title">Other sites</h4><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotId="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="http://blog.chromium.org/" class="sites-navigation-link">Chromium Blog</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="http://code.google.com/chrome/extensions/" class="sites-navigation-link">Google Chrome Extensions</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="https://developers.google.com/chrome/chrome-frame/" class="sites-navigation-link">Google Chrome Frame</a></div></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_19695218559354544" class="sites-embed" role="complementary"><h4 class="sites-embed-title"></h4><div class="sites-embed-content sites-embed-content-sidebar-textbox"><div dir="ltr"><span style="font-size:x-small">Except as otherwise </span><a href="http://developers.google.com/site-policies.html#restrictions"><span style="font-size:x-small">noted</span></a><span style="font-size:x-small">, the content of this page is licensed under a </span><a href="http://creativecommons.org/licenses/by/2.5/"><span style="font-size:x-small">Creative Commons Attribution 2.5 license</span></a><span style="font-size:x-small">, and examples are licensed under the </span><a href="http://src.chromium.org/viewvc/chrome/trunk/src/LICENSE" target="_blank"><span style="font-size:x-small">BSD License</span></a><span style="font-size:x-small">.<br /></span></div></div></div>
</td>
<td id="sites-canvas-wrapper">
<div id="sites-canvas" role="main">
<div id="goog-ws-editor-toolbar-container"> </div>
<div xmlns="http://www.w3.org/1999/xhtml" id="title-crumbs" style="">
<A href="/developers" dir="ltr">For Developers</A>‎ &gt; ‎<A href="/developers/design-documents" dir="ltr">Design Documents</A>‎ &gt; ‎
  </div>
<h3 xmlns="http://www.w3.org/1999/xhtml" id="sites-page-title-header" style="" align="left">
<span id="sites-page-title" dir="ltr" tabindex="-1" style="outline: none">DirectWrite Font Cache</span>
</h3>
<div id="sites-canvas-main" class="sites-canvas-main">
<div id="sites-canvas-main-content">
<table xmlns="http://www.w3.org/1999/xhtml" cellspacing="0" class="sites-layout-name-one-column sites-layout-hbox"><tbody><tr><td class="sites-layout-tile sites-tile-name-content-1"><div dir="ltr"><span>
<h1 dir="ltr" style="line-height:1.15;margin-top:10pt;margin-bottom:0pt"><a name="TOC-Abstract:"></a><span style="font-family:Verdana;font-size:17px;white-space:pre-wrap;line-height:1.15;background-color:transparent">Abstract:</span></h1>
<p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Verdana;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">With Chrome version 38 DirectWrite has been enabled by default on Windows Chrome. With Chrome’s secure sandbox architecture DirectWrite poses a basic but significant problem. DirectWrite relies on Font Cache Service for system installed fonts. It communicates with Font Cache service over Windows mostly undocumented and traditional IPC mechanism of ALPC (Asynchronous Local Procedure Call.). Due to severe sandbox restrictions DirectWrite is not able to communicate to Font Cache service from Chrome Renderer process. This causes main hurdle for implementation and usage of DirectWrite from Renderer process. DirectWrite allows loading of Custom Fonts separately from System Fonts. We used this concept to enable DirectWrite in current release by loading system font files as custom fonts. Though this mechanism currently works, it definitely adds to load time for renderer (Latency range of 40th percentile less than ~226ms and 90th percentile ~3000ms). To solve this load latency issue we are implementing Font Cache in the Browser process, which will be shared by all renderers. The Font Cache will be scoped only for loading all font families and such properties during initial DirectWrite font enumeration process. Individual font file for Glyphs will still be directly loaded from disk.</span></p>
<br />
<h2 dir="ltr" style="line-height:1.15;margin-top:10pt;margin-bottom:0pt"><a name="TOC-."></a><span style="font-size:17px;font-family:Verdana;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">.</span></h2>
<h2 dir="ltr" style="line-height:1.15;margin-top:10pt;margin-bottom:0pt"><a name="TOC-Implementation:"></a><span style="font-size:17px;font-family:Verdana;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">Implementation:</span></h2>
<br />
<p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Verdana;vertical-align:baseline;white-space:pre-wrap;background-color:transparent"><img height="263px;" src="https://docs.google.com/a/google.com/drawings/d/sr3ilNMP6rJv-ADbjZC1BFQ/image?w=624&amp;h=263&amp;rev=1&amp;ac=1" style="border:none" width="624px;" /></span></p>
<br />
<p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Verdana;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">Inside content/renderer most of the code which deals with all DirectWrite custom font collection details is in file </span><a href="https://code.google.com/p/chromium/codesearch#chromium/src/content/renderer/renderer_font_platform_win.cc" style="text-decoration:none"><span style="font-size:15px;font-family:Verdana;color:rgb(17,85,204);text-decoration:underline;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">renderer_font_platform_win.cc/.h</span></a><span style="font-size:15px;font-family:Verdana;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">. The code is comprised mainly of the following classes that DirectWrite requires for loading custom font collection.</span></p>
<br />
<p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Verdana;font-style:italic;vertical-align:baseline;white-space:pre-wrap">FontCollectionLoader: (implementing IDWriteFontCollectionLoader)</span></p>
<br />
<p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Verdana;vertical-align:baseline;white-space:pre-wrap">Function of interest in this class is CreateEnumeratorFromKey, which returns a font file enumerator to the caller.</span></p>
<br />
<p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Verdana;font-style:italic;vertical-align:baseline;white-space:pre-wrap">FontFileEnumerator: (implementing IDWriteFontFileLoader)</span></p>
<br />
<p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Verdana;vertical-align:baseline;white-space:pre-wrap">This class provides one way enumerator using two function MoveNext and GetCurrentFile. MoveNext lets you move cursor to next file in the list where as GetCurrentFile gets you file at the cursor. We create a reference to font file at cursor using our custom font file loader and return that reference to caller.</span></p>
<br />
<p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Verdana;font-style:italic;vertical-align:baseline;white-space:pre-wrap">FontFileLoader: (implementing IDWriteFontFileLoader)</span></p>
<br />
<p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Verdana;vertical-align:baseline;white-space:pre-wrap">As name suggests this class is responsible for loading actual font file whether it is from disk, resources or somewhere else. This class returns a new instance of FontFileStream for the file.</span></p>
<br />
<br />
<br />
<p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Verdana;font-style:italic;vertical-align:baseline;white-space:pre-wrap">FontFileStream: (implementing IDWriteFontFileStream)</span></p>
<br />
<p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Verdana;vertical-align:baseline;white-space:pre-wrap">This class actually lets call read bytes and fragments of Font File. DirectWrite during initial phase of building collection seem to use methods provided by this class to read various data table entries, which include information such as Font Families contained in this file. Main function implemented here is ReadFileFragment(), which returns binary data starting a specified offset and of specified size.</span></p>
<br />
<br />
<p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Verdana;vertical-align:baseline;white-space:pre-wrap">The journey for all this class maze starts from a call to function IDWriteFactory::CreateCustomFontCollection(). We supply our own custom FontCollectionLoader as parameter to this function so that DirectWrite ends up calling us for loading of the actual collection. </span></p>
<br />
<p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Verdana;vertical-align:baseline;white-space:pre-wrap">[ Before calling CreateCustomFontCollection we load list of system installed fonts from registry (</span><span style="font-size:15px;font-family:Verdana;color:rgb(0,136,0);vertical-align:baseline;white-space:pre-wrap">HKEY_LOCAL_MACHINE\Software\Microsoft\Windows NT\CurrentVersion\Fonts.)</span><span style="font-size:15px;font-family:Verdana;vertical-align:baseline;white-space:pre-wrap">. This list is in the form of key value pair, where usually key is the name of the main font family contained in the file e.g. Arial (TrueType) and value is the path to file which contains that family. e.g. arial.ttf. When full path is not specified system uses standard font location such as \windows\fonts. In our current implementation we ignore all font files which have absolute path specified. We are doing this in order to avoid any clashes with our sandbox policy. e.g. if path for a file is c:\program files\xyz\arial.ttf, we cannot load this file from renderer as this particular path is sandbox whitelist. We have added Windows standard font location such as \windows\fonts into our sandbox policy to load font files from there. ]</span></p>
<br />
<p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Verdana;vertical-align:baseline;white-space:pre-wrap">DirectWrite then invokes function to create an enumerator to load all font files through our FontCollectionLoader. We expose instance to our custom enumerator for loading these files (FontFileEnumerator). Then DirectWrite enumerates and creates instance of each font file using MoveNext and GetCurrentFile functions.  Seemingly DirectWrite goes through entire font file collection for generating a copy of local cache in some undocumented data structure. Through FontFileEnumerator and FontFileLoader when we return instance to FontFileStream to represent single font file in our collection, DirectWrite calls ReadFileFragment multiple times to get required data to fill internal data structures. After entire enumeration is done, DirectWrite then will satisfy some of the queries such as how many font families are available etc, from internal data structures for actual Glyphs it again creates instance of our FontFileStream using the key that we provided during enumeration time.</span></p>
<br />
<p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Verdana;vertical-align:baseline;white-space:pre-wrap">Given above flow we can clearly see that DirectWrite is dealing with Font Collection in two phases, one phase is to load and enumerate entire collection to read all font files for properties and store them in internal data structure, the other phase is to actually read glyphs and data from specific font file. Our theory is that the font file collection enumeration is the key part contributing to initial latency and we are trying to minimize that using our font cache. One problem with loading all font files that are installed on the system is that they are large in numbers. From UMA numbers 55th percentile files to be loaded are ~340. Which means every new renderer instance will go through loading of those many files. Given our understanding of how antivirus and antimalware programs work, we think that these programs sometime add checks for each file load operation, which adds to the latency.</span></p>
<br />
<p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Verdana;vertical-align:baseline;white-space:pre-wrap">As mentioned above we want to provide cache implementation only for phase 1 Font File enumeration of DirectWrite. In our experiments we observed that when calling ReadFileFragment for the same file such as arial.ttf in various runs, DirectWrite actually asks for same offset and chunk sizes. If we cache these offsets and chunk sizes into single file during this enumeration phase then we may avoid loading of all these font files at least during the startup. In second phase we are little less worried as the it is very unlikely that any webpage or application in renderer ends up loading all font files simultaneously. In our experiments we saw maximum of upto 3-4 font files loaded in phase 2.</span></p>
<br />
<p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Verdana;vertical-align:baseline;white-space:pre-wrap">For Cache implementation we plan to go through DirectWrite font file enumeration noting down all offsets and chunk sizes along with actual chunk bytes in Cache File. We run this process either through Chrome Browser or Chrome utility process. In our experiment we found that for some files like simunb.ttf, DirectWrite ends up asking for entire file after first few chunks. To avoid caching whole file simsunb.ttf (~16MB.) We will check on percentage of total file to be cached against preset limit such as 70% (</span><a href="#histogram" style="text-decoration:none"><span style="font-size:15px;font-family:Verdana;color:rgb(17,85,204);text-decoration:underline;vertical-align:baseline;white-space:pre-wrap">Histogram of total fonts with respective cache sizes</span></a><span style="font-size:15px;font-family:Verdana;vertical-align:baseline;white-space:pre-wrap">) and only allow caching chunks if criteria satisfies. During actual enumeration inside renderer we will always supply alternative path (That is of direct loading from disk) for any font file that is asked by DirectWrite during enumeration which is not present in our cache.</span></p>
<br />
<p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Verdana;vertical-align:baseline;white-space:pre-wrap">We will store this cache file under user profile folder. We will have to provide mechanism to check for consistency of the file using either checksum or write completed mark. Once cache file is created browser process will open this file during initialization and map into a shared memory section accessible in read only form to all renderers. Renderer will first try to open the section for font cache during enumeration process. If unable to find the section renderers will fall back to old font file loading path.</span></p>
<br />
<br />
<p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:17px;font-family:Verdana;font-weight:bold;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">Caching merged segments:</span></p>
<p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Verdana;vertical-align:baseline;white-space:pre-wrap">As briefly mentioned above, through ReadFileFragment function of FontFileStream, DirectWrite reads various data segments inside font file. In our experiments these segments overlap each other. Sometimes DirectWrite keeps querying several subset of a segment which it read in some previous call. In our caching strategy we wait for all these segments to be read and keep track of these offsets and length pairs as DirectWrite reads font file. For an example look at sample log of following segments that it read for arial.ttf font file in our trials.</span></p>
<br />
<div dir="ltr" style="margin-left:0pt">
<table style="border:none;border-collapse:collapse">
<colgroup>
<col width="39" />
<col width="146" />
<col width="463" /></colgroup>
<tbody>
<tr style="height:0px">
<td style="border:1px solid rgb(0,0,0);padding:7px">
<p dir="ltr" style="line-height:1;margin-top:0pt;margin-bottom:0pt"><span style="font-size:12px;font-family:Verdana;vertical-align:baseline;white-space:pre-wrap">No.</span></p>
</td>
<td style="border:1px solid rgb(0,0,0);padding:7px">
<p dir="ltr" style="line-height:1;margin-top:0pt;margin-bottom:0pt"><span style="font-size:12px;font-family:Verdana;vertical-align:baseline;white-space:pre-wrap">Starting Offset</span></p>
</td>
<td style="border:1px solid rgb(0,0,0);padding:7px">
<p dir="ltr" style="line-height:1;margin-top:0pt;margin-bottom:0pt"><span style="font-size:12px;font-family:Verdana;vertical-align:baseline;white-space:pre-wrap">Data Chunk Length</span></p>
</td>
</tr>
<tr style="height:0px">
<td style="border:1px solid rgb(0,0,0);padding:7px">
<p dir="ltr" style="line-height:1;margin-top:0pt;margin-bottom:0pt"><span style="font-size:12px;font-family:Verdana;vertical-align:baseline;white-space:pre-wrap">1</span></p>
</td>
<td style="border:1px solid rgb(0,0,0);padding:7px">
<p dir="ltr" style="line-height:1;margin-top:0pt;margin-bottom:0pt"><span style="font-size:12px;font-family:Verdana;vertical-align:baseline;white-space:pre-wrap">0</span></p>
</td>
<td style="border:1px solid rgb(0,0,0);padding:7px">
<p dir="ltr" style="line-height:1;margin-top:0pt;margin-bottom:0pt"><span style="font-size:12px;font-family:Verdana;vertical-align:baseline;white-space:pre-wrap">117</span></p>
</td>
</tr>
<tr style="height:0px">
<td style="border:1px solid rgb(0,0,0);padding:7px">
<p dir="ltr" style="line-height:1;margin-top:0pt;margin-bottom:0pt"><span style="font-size:12px;font-family:Verdana;vertical-align:baseline;white-space:pre-wrap">2</span></p>
</td>
<td style="border:1px solid rgb(0,0,0);padding:7px">
<p dir="ltr" style="line-height:1;margin-top:0pt;margin-bottom:0pt"><span style="font-size:12px;font-family:Verdana;vertical-align:baseline;white-space:pre-wrap">0</span></p>
</td>
<td style="border:1px solid rgb(0,0,0);padding:7px">
<p dir="ltr" style="line-height:1;margin-top:0pt;margin-bottom:0pt"><span style="font-size:12px;font-family:Verdana;vertical-align:baseline;white-space:pre-wrap">7</span></p>
</td>
</tr>
<tr style="height:0px">
<td style="border:1px solid rgb(0,0,0);padding:7px">
<p dir="ltr" style="line-height:1;margin-top:0pt;margin-bottom:0pt"><span style="font-size:12px;font-family:Verdana;vertical-align:baseline;white-space:pre-wrap">3</span></p>
</td>
<td style="border:1px solid rgb(0,0,0);padding:7px">
<p dir="ltr" style="line-height:1;margin-top:0pt;margin-bottom:0pt"><span style="font-size:12px;font-family:Verdana;vertical-align:baseline;white-space:pre-wrap">0</span></p>
</td>
<td style="border:1px solid rgb(0,0,0);padding:7px">
<p dir="ltr" style="line-height:1;margin-top:0pt;margin-bottom:0pt"><span style="font-size:12px;font-family:Verdana;vertical-align:baseline;white-space:pre-wrap">16</span></p>
</td>
</tr>
<tr style="height:0px">
<td style="border:1px solid rgb(0,0,0);padding:7px">
<p dir="ltr" style="line-height:1;margin-top:0pt;margin-bottom:0pt"><span style="font-size:12px;font-family:Verdana;vertical-align:baseline;white-space:pre-wrap">4</span></p>
</td>
<td style="border:1px solid rgb(0,0,0);padding:7px">
<p dir="ltr" style="line-height:1;margin-top:0pt;margin-bottom:0pt"><span style="font-size:12px;font-family:Verdana;vertical-align:baseline;white-space:pre-wrap">0</span></p>
</td>
<td style="border:1px solid rgb(0,0,0);padding:7px">
<p dir="ltr" style="line-height:1;margin-top:0pt;margin-bottom:0pt"><span style="font-size:12px;font-family:Verdana;vertical-align:baseline;white-space:pre-wrap">12</span></p>
</td>
</tr>
<tr style="height:0px">
<td style="border:1px solid rgb(0,0,0);padding:7px">
<p dir="ltr" style="line-height:1;margin-top:0pt;margin-bottom:0pt"><span style="font-size:12px;font-family:Verdana;vertical-align:baseline;white-space:pre-wrap">5</span></p>
</td>
<td style="border:1px solid rgb(0,0,0);padding:7px">
<p dir="ltr" style="line-height:1;margin-top:0pt;margin-bottom:0pt"><span style="font-size:12px;font-family:Verdana;vertical-align:baseline;white-space:pre-wrap">12</span></p>
</td>
<td style="border:1px solid rgb(0,0,0);padding:7px">
<p dir="ltr" style="line-height:1;margin-top:0pt;margin-bottom:0pt"><span style="font-size:12px;font-family:Verdana;vertical-align:baseline;white-space:pre-wrap">368</span></p>
</td>
</tr>
<tr style="height:0px">
<td style="border:1px solid rgb(0,0,0);padding:7px">
<p dir="ltr" style="line-height:1;margin-top:0pt;margin-bottom:0pt"><span style="font-size:12px;font-family:Verdana;vertical-align:baseline;white-space:pre-wrap">6</span></p>
</td>
<td style="border:1px solid rgb(0,0,0);padding:7px">
<p dir="ltr" style="line-height:1;margin-top:0pt;margin-bottom:0pt"><span style="font-size:12px;font-family:Verdana;vertical-align:baseline;white-space:pre-wrap">504</span></p>
</td>
<td style="border:1px solid rgb(0,0,0);padding:7px">
<p dir="ltr" style="line-height:1;margin-top:0pt;margin-bottom:0pt"><span style="font-size:12px;font-family:Verdana;vertical-align:baseline;white-space:pre-wrap">96</span></p>
</td>
</tr>
<tr style="height:0px">
<td style="border:1px solid rgb(0,0,0);padding:7px">
<p dir="ltr" style="line-height:1;margin-top:0pt;margin-bottom:0pt"><span style="font-size:12px;font-family:Verdana;vertical-align:baseline;white-space:pre-wrap">7</span></p>
</td>
<td style="border:1px solid rgb(0,0,0);padding:7px">
<p dir="ltr" style="line-height:1;margin-top:0pt;margin-bottom:0pt"><span style="font-size:12px;font-family:Verdana;vertical-align:baseline;white-space:pre-wrap">380</span></p>
</td>
<td style="border:1px solid rgb(0,0,0);padding:7px">
<p dir="ltr" style="line-height:1;margin-top:0pt;margin-bottom:0pt"><span style="font-size:12px;font-family:Verdana;vertical-align:baseline;white-space:pre-wrap">54</span></p>
</td>
</tr>
</tbody>
</table>
</div>
<p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Verdana;vertical-align:baseline;white-space:pre-wrap">Figure 1: Shows how segments overlap in actual reading of Arial.ttf font file.</span></p>
<br />
<p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Verdana;vertical-align:baseline;white-space:pre-wrap">During closing of this font file, we fold/merge all these chunks of segments so to create unified caching segments. As could be seen in Figure 1, there are several segments that start from offset 0 and are of various sizes, also there are some segments which extended already encountered segment because of overlap. In Figure 1, segments numbers 2 to 4 are all complete subsets of segments number 1. In this particular case we fold all these subsets into single to be cached segment of (offset: 0, length: 117). Segment number 5 is an overlapping segment which starts within (0, 117) but extends beyond it. In this case we extend our to be cached segment of (0, 117) to be (0, 368). If you next look at segment number 7, then we also need to combine this segment into our first to be cached segment of (0, 368) as it is immediate next segment. In conclusion we cache our first segment as (0, 442) which is representative of segment numbers 1 to 5 and 7. We will store segment number 6 separately in our cache. With this logic our folded/merged cached segments become:</span></p>
<br />
<br />
<div dir="ltr" style="margin-left:0pt">
<table style="border:none;border-collapse:collapse">
<colgroup>
<col width="37" />
<col width="140" />
<col width="445" /></colgroup>
<tbody>
<tr style="height:0px">
<td style="border:1px solid rgb(0,0,0);padding:7px">
<p dir="ltr" style="line-height:1;margin-top:0pt;margin-bottom:0pt"><span style="font-size:12px;font-family:Verdana;vertical-align:baseline;white-space:pre-wrap">No.</span></p>
</td>
<td style="border:1px solid rgb(0,0,0);padding:7px">
<p dir="ltr" style="line-height:1;margin-top:0pt;margin-bottom:0pt"><span style="font-size:12px;font-family:Verdana;vertical-align:baseline;white-space:pre-wrap">Starting Offset</span></p>
</td>
<td style="border:1px solid rgb(0,0,0);padding:7px">
<p dir="ltr" style="line-height:1;margin-top:0pt;margin-bottom:0pt"><span style="font-size:12px;font-family:Verdana;vertical-align:baseline;white-space:pre-wrap">Data Chunk Length</span></p>
</td>
</tr>
<tr style="height:0px">
<td style="border:1px solid rgb(0,0,0);padding:7px">
<p dir="ltr" style="line-height:1;margin-top:0pt;margin-bottom:0pt"><span style="font-size:12px;font-family:Verdana;vertical-align:baseline;white-space:pre-wrap">1</span></p>
</td>
<td style="border:1px solid rgb(0,0,0);padding:7px">
<p dir="ltr" style="line-height:1;margin-top:0pt;margin-bottom:0pt"><span style="font-size:12px;font-family:Verdana;vertical-align:baseline;white-space:pre-wrap">0</span></p>
</td>
<td style="border:1px solid rgb(0,0,0);padding:7px">
<p dir="ltr" style="line-height:1;margin-top:0pt;margin-bottom:0pt"><span style="font-size:12px;font-family:Verdana;vertical-align:baseline;white-space:pre-wrap">442</span></p>
</td>
</tr>
<tr style="height:0px">
<td style="border:1px solid rgb(0,0,0);padding:7px">
<p dir="ltr" style="line-height:1;margin-top:0pt;margin-bottom:0pt"><span style="font-size:12px;font-family:Verdana;vertical-align:baseline;white-space:pre-wrap">2</span></p>
</td>
<td style="border:1px solid rgb(0,0,0);padding:7px">
<p dir="ltr" style="line-height:1;margin-top:0pt;margin-bottom:0pt"><span style="font-size:12px;font-family:Verdana;vertical-align:baseline;white-space:pre-wrap">504</span></p>
</td>
<td style="border:1px solid rgb(0,0,0);padding:7px">
<p dir="ltr" style="line-height:1;margin-top:0pt;margin-bottom:0pt"><span style="font-size:12px;font-family:Verdana;vertical-align:baseline;white-space:pre-wrap">96</span></p>
</td>
</tr>
</tbody>
</table>
</div>
<p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Verdana;vertical-align:baseline;white-space:pre-wrap">Figure 2: Shows how the segments get folded/merged while caching.</span></p>
<br />
<p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Verdana;vertical-align:baseline;white-space:pre-wrap">During read phase we check if requested segment lies within boundaries of cached segments and provide data for request from cache.</span></p>
<br />
<h2 dir="ltr" style="line-height:1.15;margin-top:10pt;margin-bottom:0pt"><a name="TOC-Font-Cache-File-Format:"></a><span style="font-size:17px;font-family:Verdana;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">Font Cache File Format:</span></h2>
<p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:13px;font-family:Verdana;font-weight:bold;font-style:italic;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">CacheFileHeader:</span></p>
<p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Verdana;font-style:italic;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">Declaration:</span></p>
<p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Verdana;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">struct CacheFileHeader {</span></p>
<p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Verdana;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">   UINT32 file_signature;</span></p>
<p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Verdana;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">   UINT32 magic_completion_signature;</span></p>
<p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Verdana;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">   UINT32 version;</span></p>
<p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Verdana;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">   UINT32 undefined[5];</span></p>
<p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Verdana;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">};</span></p>
<p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Verdana;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">Details:</span></p>
<p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:12px;font-family:Verdana;font-weight:bold;font-style:italic;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">file_signature</span><span style="font-size:15px;font-family:Verdana;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">: Contains values identifying this file type. Current value is 0x4D4F5243, which denote ascii letters ‘CROM’.</span></p>
<p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:12px;font-family:Verdana;font-weight:bold;font-style:italic;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">magic_completion_signature</span><span style="font-size:15px;font-family:Verdana;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">: Contains specific value which indicate that file has been fully written. This is to minimally ensure consistency of the file. Current value is 0x454E4F44, which denote ascii letter ‘DONE’</span></p>
<p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:12px;font-family:Verdana;font-weight:bold;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">version:</span><span style="font-size:15px;font-family:Verdana;vertical-align:baseline;white-space:pre-wrap;background-color:transparent"> Contains version of file format.</span></p>
<p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:12px;font-family:Verdana;font-weight:bold;font-style:italic;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">undefined</span><span style="font-size:15px;font-family:Verdana;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">: Some extra space to accommodate for future addition of fields into this file.</span></p>
<br />
<p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:13px;font-family:Verdana;font-weight:bold;font-style:italic;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">CacheFileEntry:</span></p>
<p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Verdana;font-style:italic;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">Declaration:</span></p>
<p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Verdana;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">struct CacheFileEntry {</span></p>
<p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Verdana;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">  UINT64 file_size;</span></p>
<p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Verdana;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">  DWORD entry_count;</span></p>
<p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Verdana;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">  wchar_t file_name[kMaxFontFileNameLength];</span></p>
<p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Verdana;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">};</span></p>
<p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Verdana;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">Details:</span></p>
<p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Verdana;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">CacheFileEntry is entry per font file. e.g. arial.ttf and arialb.ttf will have two separate entries.</span></p>
<p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Verdana;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">We will have fixed space for font file name. This could be problematic for font file names which exceed our limit and are a letter or two off at the end. We will have to ignore such entry from adding to font cache for now.</span></p>
<p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:12px;font-family:Verdana;font-weight:bold;font-style:italic;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">file_size:</span><span style="font-size:15px;font-family:Verdana;vertical-align:baseline;white-space:pre-wrap;background-color:transparent"> File size here refers to original file size for which this font file entry exists. e.g. size of arial.ttf. This size is required when DirectWrite calls GetFileSize function of FontFileStream class.</span></p>
<p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:12px;font-family:Verdana;font-weight:bold;font-style:italic;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">entry_count:</span><span style="font-size:15px;font-family:Verdana;vertical-align:baseline;white-space:pre-wrap;background-color:transparent"> It contains total number of CacheFileOffsetEntry records following this CacheFileEntry record.</span></p>
<p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:12px;font-family:Verdana;font-weight:bold;font-style:italic;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">file_name:</span><span style="font-size:15px;font-family:Verdana;vertical-align:baseline;white-space:pre-wrap;background-color:transparent"> Name of the original .ttf/.ttc file.</span></p>
<br />
<p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:13px;font-family:Verdana;font-weight:bold;font-style:italic;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">CacheFileOffsetEntry:</span></p>
<p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Verdana;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">struct CacheFileOffsetEntry {</span></p>
<p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Verdana;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">  UINT64 start_offset;</span></p>
<p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Verdana;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">  UINT64 length;</span></p>
<p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Verdana;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">  /* BYTE blob[];  // Place holder for the blob that follows. */</span></p>
<p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Verdana;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">};</span></p>
<p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Verdana;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">Details:</span><span style="font-size:15px;font-family:Verdana;vertical-align:baseline;white-space:pre-wrap;background-color:transparent"><br />
</span><span style="font-size:15px;font-family:Verdana;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">Array of CacheFileOffsetEntry records follow single CacheFileEntry record. Size of this array is specified in entry_count_ field of CacheFileEntry.</span></p>
<p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:12px;font-family:Verdana;font-weight:bold;font-style:italic;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">start_offset:</span><span style="font-size:15px;font-family:Verdana;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">  Contains starting offset within original file that was asked by DirectWrite during enumeration in call to ReadFileFragment.</span></p>
<p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:12px;font-family:Verdana;font-weight:bold;font-style:italic;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">length:</span><span style="font-size:15px;font-family:Verdana;vertical-align:baseline;white-space:pre-wrap;background-color:transparent"> This contains value from fragmet_size parameter of ReadFileFragment, which as passed by DirectWrite during initial enumeration.</span></p>
<p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:12px;font-family:Verdana;font-weight:bold;font-style:italic;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">BYTE blob[]:</span><span style="font-size:15px;font-family:Verdana;vertical-align:baseline;white-space:pre-wrap;background-color:transparent"> This is just a place holder. What follows each CacheFileOffsetEntry record is actual blob of data that was returned to DirectWrite during initial enumeration. This blob should be copy of exact contents of original file such as arial.ttf or times.ttf.</span></p>
<br />
<p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Verdana;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">** Our assumption here is that no font file has duplicate record in our cache.</span></p>
<p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Verdana;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">** Another assumption is that if for some reason we find font file cache invalid, we just recreate it instead of repairing it.</span></p>
<br />
<h2 dir="ltr" style="line-height:1.15;margin-top:10pt;margin-bottom:0pt"><a name="TOC-Font-Cache-File-Layout:"></a><span style="font-size:17px;font-family:Verdana;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">Font Cache File Layout:</span></h2>
<br />
<div dir="ltr" style="margin-left:0pt">
<table style="border:none;border-collapse:collapse;width:624px">
<colgroup>
<col width="*" /></colgroup>
<tbody>
<tr style="height:64px">
<td style="border:1px solid rgb(0,0,0);padding:7px">
<p dir="ltr" style="line-height:1;margin-top:0pt;margin-bottom:0pt"><span style="font-size:13px;font-family:Verdana;font-weight:bold;font-style:italic;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">CacheFileHeader</span></p>
<div dir="ltr" style="margin-left:0pt">
<table style="border:none;border-collapse:collapse;width:100%">
<colgroup>
<col width="*" />
<col width="*" />
<col width="*" />
<col width="*" /></colgroup>
<tbody>
<tr style="height:0px">
<td style="border:1px solid rgb(0,0,0);padding:7px">
<p dir="ltr" style="line-height:1;margin-top:0pt;margin-bottom:0pt"><span style="font-size:13px;font-family:Verdana;font-weight:bold;font-style:italic;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">file_signature</span></p>
</td>
<td style="border:1px solid rgb(0,0,0);padding:7px">
<p dir="ltr" style="line-height:1;margin-top:0pt;margin-bottom:0pt"><span style="font-size:13px;font-family:Verdana;font-weight:bold;font-style:italic;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">magic_signature</span></p>
</td>
<td style="border:1px solid rgb(0,0,0);padding:7px">
<p dir="ltr" style="line-height:1;margin-top:0pt;margin-bottom:0pt"><span style="font-size:13px;font-family:Verdana;font-weight:bold;font-style:italic;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">version</span></p>
</td>
<td style="border:1px solid rgb(0,0,0);padding:7px">
<p dir="ltr" style="line-height:1;margin-top:0pt;margin-bottom:0pt"><span style="font-size:13px;font-family:Verdana;font-weight:bold;font-style:italic;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">undefined</span></p>
</td>
</tr>
</tbody>
</table>
</div>
<br />
</td>
</tr>
<tr style="height:0px">
<td style="border:1px solid rgb(0,0,0);padding:7px">
<p dir="ltr" style="line-height:1;margin-top:0pt;margin-bottom:0pt"><span style="font-size:13px;font-family:Verdana;font-weight:bold;font-style:italic;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">CacheFileEntry</span></p>
<div dir="ltr" style="margin-left:0pt">
<table style="border:none;border-collapse:collapse;width:100%">
<colgroup>
<col width="*" />
<col width="*" />
<col width="*" /></colgroup>
<tbody>
<tr style="height:0px">
<td style="border:1px solid rgb(0,0,0);padding:7px">
<p dir="ltr" style="line-height:1;margin-top:0pt;margin-bottom:0pt"><span style="font-size:13px;font-family:Verdana;font-weight:bold;font-style:italic;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">file_size</span></p>
</td>
<td style="border:1px solid rgb(0,0,0);padding:7px">
<p dir="ltr" style="line-height:1;margin-top:0pt;margin-bottom:0pt"><span style="font-size:13px;font-family:Verdana;font-weight:bold;font-style:italic;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">entry_count</span></p>
</td>
<td style="border:1px solid rgb(0,0,0);padding:7px">
<p dir="ltr" style="line-height:1;margin-top:0pt;margin-bottom:0pt"><span style="font-size:13px;font-family:Verdana;font-weight:bold;font-style:italic;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">file_name</span></p>
</td>
</tr>
</tbody>
</table>
</div>
<br />
</td>
</tr>
<tr style="height:0px">
<td style="border:1px solid rgb(0,0,0);padding:7px">
<p dir="ltr" style="line-height:1;margin-top:0pt;margin-bottom:0pt"><span style="font-size:12px;font-family:Verdana;font-weight:bold;font-style:italic;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">CacheFileOffsetEntry</span></p>
<div dir="ltr" style="margin-left:0pt">
<table style="border:none;border-collapse:collapse">
<colgroup>
<col width="85" />
<col width="82" />
<col width="442" /></colgroup>
<tbody>
<tr style="height:0px">
<td style="border:1px solid rgb(0,0,0);padding:7px">
<p dir="ltr" style="line-height:1;margin-top:0pt;margin-bottom:0pt"><span style="font-size:12px;font-family:Verdana;font-weight:bold;font-style:italic;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">start</span></p>
</td>
<td style="border:1px solid rgb(0,0,0);padding:7px">
<p dir="ltr" style="line-height:1;margin-top:0pt;margin-bottom:0pt"><span style="font-size:12px;font-family:Verdana;font-weight:bold;font-style:italic;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">length</span></p>
</td>
<td style="border:1px solid rgb(0,0,0);padding:7px">
<p dir="ltr" style="line-height:1;margin-top:0pt;margin-bottom:0pt"><span style="font-size:12px;font-family:Verdana;font-weight:bold;font-style:italic;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">Actual Cached Data Segment</span></p>
</td>
</tr>
</tbody>
</table>
</div>
<br />
</td>
</tr>
<tr style="height:0px">
<td style="border:1px solid rgb(0,0,0);padding:7px">
<p dir="ltr" style="line-height:1;margin-top:0pt;margin-bottom:0pt"><span style="font-size:12px;font-family:Verdana;font-weight:bold;font-style:italic;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">CacheFileOffsetEntry</span></p>
<div dir="ltr" style="margin-left:0pt">
<table style="border:none;border-collapse:collapse">
<colgroup>
<col width="85" />
<col width="82" />
<col width="442" /></colgroup>
<tbody>
<tr style="height:0px">
<td style="border:1px solid rgb(0,0,0);padding:7px">
<p dir="ltr" style="line-height:1;margin-top:0pt;margin-bottom:0pt"><span style="font-size:12px;font-family:Verdana;font-weight:bold;font-style:italic;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">start</span></p>
</td>
<td style="border:1px solid rgb(0,0,0);padding:7px">
<p dir="ltr" style="line-height:1;margin-top:0pt;margin-bottom:0pt"><span style="font-size:12px;font-family:Verdana;font-weight:bold;font-style:italic;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">length</span></p>
</td>
<td style="border:1px solid rgb(0,0,0);padding:7px">
<p dir="ltr" style="line-height:1;margin-top:0pt;margin-bottom:0pt"><span style="font-size:12px;font-family:Verdana;font-weight:bold;font-style:italic;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">Actual Cached Data Segment</span></p>
</td>
</tr>
</tbody>
</table>
</div>
<br />
</td>
</tr>
<tr style="height:0px">
<td style="border:1px solid rgb(0,0,0);padding:7px">
<p dir="ltr" style="line-height:1;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Verdana;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">...</span></p>
</td>
</tr>
<tr style="height:0px">
<td style="border:1px solid rgb(0,0,0);padding:7px">
<p dir="ltr" style="line-height:1;margin-top:0pt;margin-bottom:0pt"><span style="font-size:13px;font-family:Verdana;font-weight:bold;font-style:italic;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">CacheFileEntry</span></p>
<div dir="ltr" style="margin-left:0pt">
<table style="border:none;border-collapse:collapse;width:100%">
<colgroup>
<col width="*" />
<col width="*" />
<col width="*" /></colgroup>
<tbody>
<tr style="height:0px">
<td style="border:1px solid rgb(0,0,0);padding:7px">
<p dir="ltr" style="line-height:1;margin-top:0pt;margin-bottom:0pt"><span style="font-size:13px;font-family:Verdana;font-weight:bold;font-style:italic;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">file_size</span></p>
</td>
<td style="border:1px solid rgb(0,0,0);padding:7px">
<p dir="ltr" style="line-height:1;margin-top:0pt;margin-bottom:0pt"><span style="font-size:13px;font-family:Verdana;font-weight:bold;font-style:italic;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">entry_count</span></p>
</td>
<td style="border:1px solid rgb(0,0,0);padding:7px">
<p dir="ltr" style="line-height:1;margin-top:0pt;margin-bottom:0pt"><span style="font-size:13px;font-family:Verdana;font-weight:bold;font-style:italic;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">file_name</span></p>
</td>
</tr>
</tbody>
</table>
</div>
<br />
</td>
</tr>
<tr style="height:0px">
<td style="border:1px solid rgb(0,0,0);padding:7px">
<p dir="ltr" style="line-height:1;margin-top:0pt;margin-bottom:0pt"><span style="font-size:12px;font-family:Verdana;font-weight:bold;font-style:italic;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">CacheFileOffsetEntry</span></p>
<div dir="ltr" style="margin-left:0pt">
<table style="border:none;border-collapse:collapse">
<colgroup>
<col width="85" />
<col width="82" />
<col width="442" /></colgroup>
<tbody>
<tr style="height:0px">
<td style="border:1px solid rgb(0,0,0);padding:7px">
<p dir="ltr" style="line-height:1;margin-top:0pt;margin-bottom:0pt"><span style="font-size:12px;font-family:Verdana;font-weight:bold;font-style:italic;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">start</span></p>
</td>
<td style="border:1px solid rgb(0,0,0);padding:7px">
<p dir="ltr" style="line-height:1;margin-top:0pt;margin-bottom:0pt"><span style="font-size:12px;font-family:Verdana;font-weight:bold;font-style:italic;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">length</span></p>
</td>
<td style="border:1px solid rgb(0,0,0);padding:7px">
<p dir="ltr" style="line-height:1;margin-top:0pt;margin-bottom:0pt"><span style="font-size:12px;font-family:Verdana;font-weight:bold;font-style:italic;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">Actual Cached Data Segment</span></p>
</td>
</tr>
</tbody>
</table>
</div>
<br />
</td>
</tr>
<tr style="height:0px">
<td style="border:1px solid rgb(0,0,0);padding:7px">
<p dir="ltr" style="line-height:1;margin-top:0pt;margin-bottom:0pt"><span style="font-size:12px;font-family:Verdana;font-weight:bold;font-style:italic;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">CacheFileOffsetEntry</span></p>
<div dir="ltr" style="margin-left:0pt">
<table style="border:none;border-collapse:collapse">
<colgroup>
<col width="85" />
<col width="82" />
<col width="442" /></colgroup>
<tbody>
<tr style="height:0px">
<td style="border:1px solid rgb(0,0,0);padding:7px">
<p dir="ltr" style="line-height:1;margin-top:0pt;margin-bottom:0pt"><span style="font-size:12px;font-family:Verdana;font-weight:bold;font-style:italic;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">start</span></p>
</td>
<td style="border:1px solid rgb(0,0,0);padding:7px">
<p dir="ltr" style="line-height:1;margin-top:0pt;margin-bottom:0pt"><span style="font-size:12px;font-family:Verdana;font-weight:bold;font-style:italic;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">length</span></p>
</td>
<td style="border:1px solid rgb(0,0,0);padding:7px">
<p dir="ltr" style="line-height:1;margin-top:0pt;margin-bottom:0pt"><span style="font-size:12px;font-family:Verdana;font-weight:bold;font-style:italic;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">Actual Cached Data Segment</span></p>
</td>
</tr>
</tbody>
</table>
</div>
<br />
</td>
</tr>
<tr style="height:0px">
<td style="border:1px solid rgb(0,0,0);padding:7px">
<p dir="ltr" style="line-height:1;margin-top:0pt;margin-bottom:0pt"><span style="font-size:12px;font-family:Verdana;font-weight:bold;font-style:italic;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">CacheFileOffsetEntry</span></p>
<div dir="ltr" style="margin-left:0pt">
<table style="border:none;border-collapse:collapse">
<colgroup>
<col width="85" />
<col width="82" />
<col width="442" /></colgroup>
<tbody>
<tr style="height:0px">
<td style="border:1px solid rgb(0,0,0);padding:7px">
<p dir="ltr" style="line-height:1;margin-top:0pt;margin-bottom:0pt"><span style="font-size:12px;font-family:Verdana;font-weight:bold;font-style:italic;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">start</span></p>
</td>
<td style="border:1px solid rgb(0,0,0);padding:7px">
<p dir="ltr" style="line-height:1;margin-top:0pt;margin-bottom:0pt"><span style="font-size:12px;font-family:Verdana;font-weight:bold;font-style:italic;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">length</span></p>
</td>
<td style="border:1px solid rgb(0,0,0);padding:7px">
<p dir="ltr" style="line-height:1;margin-top:0pt;margin-bottom:0pt"><span style="font-size:12px;font-family:Verdana;font-weight:bold;font-style:italic;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">Actual Cached Data Segment</span></p>
</td>
</tr>
</tbody>
</table>
</div>
<br />
</td>
</tr>
<tr style="height:0px">
<td style="border:1px solid rgb(0,0,0);padding:7px">
<p dir="ltr" style="line-height:1;margin-top:0pt;margin-bottom:0pt"><span style="font-size:12px;font-family:Verdana;font-weight:bold;font-style:italic;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">...</span></p>
</td>
</tr>
</tbody>
</table>
</div>
<br />
<br />
<br />
<h2 dir="ltr" style="line-height:1.15;margin-top:10pt;margin-bottom:0pt"><a name="TOC-Font-In-memory-Cache:"></a><span style="font-size:17px;font-family:Trebuchet MS;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">Font In-memory Cache:</span></h2>
<br />
<p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Verdana;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">Internally cache is represented by a map of font file name to a list of data segments cached from that file. Here in the list we just store start, length and pointer inside original cache file, which is memory mapped.</span></p>
<br />
<p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Verdana;vertical-align:baseline;white-space:pre-wrap;background-color:transparent"><img height="214px;" src="https://docs.google.com/a/google.com/drawings/d/shy9MpsyCNfdhVX7zqgAefA/image?w=594&amp;h=214&amp;rev=1&amp;ac=1" style="border:none" width="594px;" /></span></p>
<br />
<h2 dir="ltr" style="line-height:1.15;margin-top:10pt;margin-bottom:0pt">
<a name="histogram"></a>
<span style="font-size:17px;font-family:Trebuchet MS;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">Histogram of total fonts with cached percentile.</span></h2>
<p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">Following histogram shows frequency of fonts on a typical Windows 8 system in reference to their respective cached size. Here we are referring to respective cache size as total number of bytes that need to be present in cache file compared to original font file.</span></p>
<p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent"><img alt="dwrite-font-caching-histogram.png" height="418px;" src="https://lh5.googleusercontent.com/pShkIUuF5tXWbeqv8F7fPdPNkE-FBdEK-8QQhLuUmX5wkS-tIlsKOMBflGL83n_ZHr3ji4rPZlwe3xczxk6_U4_duYOYfOHXvCojTGYP0hYXPwiRkOQ3yiGwybij8dRwfg" style="border:none" width="566px;" /></span></p>
<h2 dir="ltr" style="line-height:1.15;margin-top:10pt;margin-bottom:0pt"><a name="TOC-References:"></a><span style="font-size:17px;font-family:Trebuchet MS;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">References:</span></h2>
<p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Verdana;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">Microsoft DirectWrite API documentation.</span></p>
<p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/dd371554(v=vs.85).aspx" style="text-decoration:none"><span style="font-size:15px;font-family:Verdana;color:rgb(17,85,204);text-decoration:underline;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">http://msdn.microsoft.com/en-us/library/windows/desktop/dd371554(v=vs.85).aspx</span></a></p>
<br />
<p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Verdana;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">DirectWrite font system in comparison to GDI.</span></p>
<a href="http://blogs.msdn.com/b/text/archive/2009/04/15/introducing-the-directwrite-font-system.aspx" style="text-decoration:none"><span style="font-size:15px;font-family:Verdana;color:rgb(17,85,204);text-decoration:underline;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">http://blogs.msdn.com/b/text/archive/2009/04/15/introducing-the-directwrite-font-system.aspx</span></a></span></div></td></tr></tbody></table>
</div> 
</div> 
<div id="sites-canvas-bottom-panel">
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_page-subpages"> </div>
<div id="sites-attachments-container">
</div>
<a xmlns="http://www.w3.org/1999/xhtml" name="page-comments"></a>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_page-comments"><div class="sites-comment-docos-wrapper"><div class="sites-comment-docos"><div class="sites-comment-docos-background"></div><div class="sites-comment-docos-header"><div class="sites-comment-docos-header-title">Comments</div></div><div id="sites-comment-docos-pane" class="sites-comment-docos-pane"></div></div></div></div>
</div>
</div> 
</td> 
</tr>
</table> 
</div> 
</div> 
<div id="sites-chrome-footer-wrapper">
<div id="sites-chrome-footer-wrapper-inside">
<div id="sites-chrome-footer">
</div>
</div>
</div>
</div> 
</div> 
<div id="sites-chrome-adminfooter-container">
<div xmlns="http://www.w3.org/1999/xhtml" class="sites-adminfooter" role="navigation"><p><a class="sites-system-link" href="https://www.google.com/a/UniversalLogin?service=jotspot&amp;continue=https://sites.google.com/a/chromium.org/dev/developers/design-documents/directwrite-font-cache">Sign in</a><span aria-hidden="true">|</span><a class="sites-system-link" href="/system/app/pages/recentChanges">Recent Site Activity</a><span aria-hidden="true">|</span><a class="sites-system-link" href="/system/app/pages/reportAbuse" target="_blank">Report Abuse</a><span aria-hidden="true">|</span><a class="sites-system-link" href="javascript:;" onclick="window.open(webspace.printUrl)">Print Page</a><span aria-hidden="true">|</span><span class="sites-system-link">Powered By</span> <b class="powered-by"><a href="http://sites.google.com">Google Sites</a></b></p></div>
</div>
</div> 
</div> 
<div id="sites-chrome-onebar-footer">
</div>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    window.jstiming.load.tick('sjl');
  </script>
<script xmlns="http://www.w3.org/1999/xhtml" src="https://ssl.gstatic.com/sites/p/56e332/system/js/jot_min_view__en.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    window.jstiming.load.tick('jl');
  </script>
<script xmlns="http://www.w3.org/1999/xhtml">
      
          sites.core.Analytics.createTracker();
          sites.core.Analytics.trackPageview();
        
    </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
                    sites.Searchbox.initialize(
                        'sites-searchbox-search-button',
                        {"object":[]}['object'],
                        'search-site',
                        {"label":"Configure search options...","url":"/system/app/pages/admin/settings"});
                  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
      gsites.HoverPopupMenu.createSiteDropdownMenus('sites-header-nav-dropdown', false);
    </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
            JOT_setupNav("7648876402527094", "Navigation", false);
            JOT_addListener('titleChange', 'JOT_NAVIGATION_titleChange', 'COMP_7648876402527094');
          </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
            JOT_setupNav("14720868319272995", "Quick links", false);
            JOT_addListener('titleChange', 'JOT_NAVIGATION_titleChange', 'COMP_14720868319272995');
          </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
            JOT_setupNav("19690813310444355", "Other sites", false);
            JOT_addListener('titleChange', 'JOT_NAVIGATION_titleChange', 'COMP_19690813310444355');
          </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
              new sites.CommentPane('//docs.google.com/comments/d/AAHRpnXvrAwjAfmld0ObrebBiGRq9LYDEG5kQOhDyLuR8G0J8yJnYpZR9jdeTRCLsGE1MmzLTxUUfY3aLo7I7FkxvezrW5qJZJBJTVnt2EMm51T5wlGDlQMbS4HBwiuZJXoKT6tr0WO2I/api/js?anon=true',
                  false, false);
            </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
  setTimeout(function() {
    var fingerprint = gsites.date.TimeZone.getFingerprint([]);
    gsites.Xhr.send('https://www.chromium.org/_/tz', null, null, 'GET', null, null, { afjstz: fingerprint });
  }, 500);
</script>
<script xmlns="http://www.w3.org/1999/xhtml">
                    window.onload = function() {
                      if (false) {
                        JOT_setMobilePreview();
                      }
                      var loadTimer = window.jstiming.load;
                      loadTimer.tick("ol");
                      loadTimer["name"] = "load," + webspace.page.type + ",user_page";
                      window.jstiming.report(loadTimer, {}, 'https://gg.google.com/csi');
                    }
                  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
        JOT_insertAnalyticsCode(false,
            false);
      </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    var maestroRunner = new gsites.pages.view.SitesMaestroRunner(
        webspace, "en");
    maestroRunner.initListeners();
    maestroRunner.installEditRender();
  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
  //<![CDATA[
    // Decorate any fastUI buttons on the page with a class of 'goog-button'.
    if (webspace.user.hasWriteAccess) {
      JOT_decorateButtons();
    }

    // Fires delayed events.
    (function() {
      JOT_fullyLoaded = true;
      var delayedEvents = JOT_delayedEvents;
      for (var x = 0; x < delayedEvents.length; x++) {
        var event = delayedEvents[x];
        JOT_postEvent(event.eventName, event.eventSrc, event.payload);
      }
      JOT_delayedEvents = null;
      JOT_postEvent('pageLoaded');
    })();
  //]]>
</script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    JOT_postEvent('decorateGvizCharts');
  </script>
<script type="text/javascript">
          JOT_setupPostRenderingManager();
        </script>
<script type="text/javascript">
          JOT_postEvent('renderPlus', null, 'sites-chrome-main');
        </script>
<div id="server-timer-div" style="display:none"> </div>
<script type="text/javascript">
          window.jstiming.load.tick('render');
          JOT_postEvent('usercontentrendered', this);
        </script>
</body>
</html>
