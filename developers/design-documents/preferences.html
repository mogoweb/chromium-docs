<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/WebPage">
<head>
<meta http-equiv="X-UA-Compatible" content="chrome=1" />
<script type="text/javascript">/* Copyright 2008 Google. */ (function() { var e="wtsrt_",g="tbsd_",h="tbnd_",k="start",l="_wtsrt",m="_tbnd",n="CSI/";(function(){function f(a){this.t={};this.tick=function(a,c,b){this.t[a]=[void 0!=b?b:(new Date).getTime(),c];if(void 0==b)try{window.console.timeStamp(n+a)}catch(d){}};this.tick(k,null,a)}var a;window.performance&&(a=window.performance.timing);var p=a?new f(a.responseStart):new f;window.jstiming={Timer:f,load:p};if(a){var c=a.navigationStart,d=a.responseStart;0<c&&d>=c&&(window.jstiming.srt=d-c)}if(a){var b=window.jstiming.load;0<c&&d>=c&&(b.tick(l,void 0,c),b.tick(e,l,d),b.tick(g,e))}try{a=null,
window.chrome&&window.chrome.csi&&(a=Math.floor(window.chrome.csi().pageT),b&&0<c&&(b.tick(m,void 0,window.chrome.csi().startE),b.tick(h,m,c))),null==a&&window.gtbExternal&&(a=window.gtbExternal.pageT()),null==a&&window.external&&(a=window.external.pageT,b&&0<c&&(b.tick(m,void 0,window.external.startE),b.tick(h,m,c))),a&&(window.jstiming.pt=a)}catch(q){}})(); })()
</script>
<link rel="shortcut icon" href="../../_/rsrc/1354323194313/favicon.ico" type="image/x-icon" />
<link rel="apple-touch-icon" href="https://ssl.gstatic.com/sites/p/56e332/system/app/images/apple-touch-icon.png" type="image/png" />
<script type="text/javascript">/* Copyright 2008 Google. */ (function() { var d="",g="__duration__",h="function";function k(c){return document.getElementById(c)}window.byId=k;function l(c){return c.replace(/^\s+|\s+$/g,d)}window.trim=l;var m=[],n=0;window.JOT_addListener=function(c,a,b){var e=new String(n++);c={eventName:c,handler:a,compId:b,key:e};m.push(c);return e};window.JOT_removeListenerByKey=function(c){for(var a=0;a<m.length;a++)if(m[a].key==c){m.splice(a,1);break}};
window.JOT_removeAllListenersForName=function(c){for(var a=0;a<m.length;a++)m[a].eventName==c&&m.splice(a,1)};window.JOT_postEvent=function(c,a,b){var e={eventName:c,eventSrc:a||{},payload:b||{}};if(window.JOT_fullyLoaded)for(a=m.length,b=0;b<a&&b<m.length;b++){var f=m[b];f&&f.eventName==c&&(e.listenerCompId=f.compId||d,(f=typeof f.handler==h?f.handler:window[f.handler])&&f(e))}else window.JOT_delayedEvents.push({eventName:c,eventSrc:a,payload:b})};window.JOT_delayedEvents=[];
window.JOT_fullyLoaded=!1;window.JOT_formatRelativeToNow=function(c,a){var b=((new Date).getTime()-c)/6E4;if(1440<=b||0>b)return null;var e=0;60<=b&&(b/=60,e=2);2<=b&&e++;return a?window.JOT_siteRelTimeStrs[e].replace(g,Math.floor(b)):window.JOT_userRelTimeStrs[e].replace(g,Math.floor(b))}; })()
</script>
<script>

  

  var breadcrumbs = [{"path":"/developers","deleted":false,"title":"For Developers","dir":"ltr"},{"path":"/developers/design-documents","deleted":false,"title":"Design Documents","dir":"ltr"},{"path":"/developers/design-documents/preferences","deleted":false,"title":"Preferences","dir":"ltr"}];
  var JOT_clearDotPath = 'https://ssl.gstatic.com/sites/p/56e332/system/app/images/cleardot.gif';

  
  var JOT_userRelTimeStrs = ["a minute ago","__duration__ minutes ago","an hour ago","__duration__ hours ago"];

  
  

  

  var webspace = {"enableAnalytics":true,"pageSharingId":"jotspot_page","enableUniversalAnalytics":false,"sharingPolicy":"OPENED_WITH_INDICATOR","siteTitle":"The Chromium Projects","isStartPageEnabled":true,"adsensePublisherId":null,"features":{"languageSelectDefaultTextSetToDefault":true,"validateClientGvizDataSourceUrls":true,"moreMobileStyleImprovements":true,"newInsertMenuIcons":true,"accessibleSortingButtons":true,"domainAnalyticsInGAOnly":true,"noCaptcha":true,"fileCabinetScreenReaderFix":true,"updatedTosAndPrivacyLinks":null,"pageDrafts":false,"mobileOrientationFix":true,"plusBadge":false,"pdfEmbedSupport":false,"jsClickFix":true},"isPublic":true,"isConsumer":false,"serverFlags":{"cajaBaseUrl":"//www.gstatic.com/caja","cajaDebugMode":false},"onepickBaseUrl":"https://docs.google.com","domainAnalyticsAccountId":"","plusPageId":"","signInUrl":"https://www.google.com/a/SelectSession?continue\u003dhttps://sites.google.com/a/chromium.org/dev/developers/design-documents/preferences\u0026service\u003djotspot","analyticsAccountId":"UA-5484340-1","scottyUrl":"/_/upload","homePath":"/","siteNoticeUrlEnabled":null,"plusPageUrl":"","adsensePromoClickedOrSiteIneligible":true,"csiReportUri":"https://gg.google.com/csi","sharingId":"jotspot","termsUrl":"//www.google.com/intl/en/policies/terms/","gvizVersion":1,"editorResources":{"sitelayout":["https://ssl.gstatic.com/sites/p/56e332/system/app/css/sitelayouteditor.css"],"text":["https://ssl.gstatic.com/sites/p/56e332/system/js/codemirror.js","https://ssl.gstatic.com/sites/p/56e332/system/app/css/codemirror_css.css","https://ssl.gstatic.com/sites/p/56e332/system/js/trog_edit__en.js","https://ssl.gstatic.com/sites/p/56e332/system/app/css/trogedit.css","/_/rsrc/1441580320000/system/app/css/editor.css","https://ssl.gstatic.com/sites/p/56e332/system/app/css/codeeditor.css","/_/rsrc/1441580320000/system/app/css/camelot/editor-jfk-wlb.css"]},"sharingUrlPrefix":"/_/sharing","isAdsenseEnabled":true,"domain":"chromium.org","baseUri":"","name":"dev","siteTemplateId":false,"siteNoticeRevision":null,"siteNoticeUrlAddress":null,"siteNoticeMessage":null,"page":{"isRtlLocale":false,"canDeleteWebspace":null,"isPageDraft":null,"parentPath":"/developers/design-documents","parentWuid":"wuid:gx:359ef223e0fb14ac","siteLocale":"en","timeZone":"America/Los_Angeles","type":"text","title":"Preferences","locale":"en","wuid":"wuid:gx:79c5b9f9801484e6","revision":14,"path":"/developers/design-documents/preferences","isSiteRtlLocale":false,"pageInheritsPermissions":null,"name":"preferences","canChangePath":true,"state":"","properties":{},"bidiEnabled":false,"currentTemplate":{"path":"/system/app/pagetemplates/text","title":"Web Page"}},"canPublishScriptToAnyone":true,"user":{"keyboardShortcuts":true,"sessionIndex":"","guest_":true,"displayNameOrEmail":"guest","userName":"guest","uid":"","renderMobile":false,"domain":"","namespace":"","hasWriteAccess":false,"namespaceUser":false,"primaryEmail":"guest","hasAdminAccess":false},"gadgets":{"baseUri":"/system/app/pages/gadgets"}};
  webspace.page.breadcrumbs = breadcrumbs;

  
  var JOT_siteRelTimeStrs = ["a minute ago","__duration__ minutes ago","an hour ago","__duration__ hours ago"];

</script>
<script type="text/javascript">
                window.jstiming.load.tick('scl');
              </script>
<meta name="title" content="Preferences - The Chromium Projects" />
<meta itemprop="name" content="Preferences - The Chromium Projects" />
<meta property="og:title" content="Preferences - The Chromium Projects" />
<meta name="description" content="Home of the Chromium Open Source Project" />
<meta itemprop="description" content="Home of the Chromium Open Source Project" />
<meta id="meta-tag-description" property="og:description" content="Home of the Chromium Open Source Project" />
<style type="text/css">
</style>
<link rel="stylesheet" type="text/css" href="https://ssl.gstatic.com/sites/p/56e332/system/app/themes/beigeandblue/standard-css-beigeandblue-ltr-ltr.css" />
<link rel="stylesheet" type="text/css" href="../../_/rsrc/1441580320000/system/app/css/overlay.css%3Fcb=beigeandblueundefineda100%2525%2525150goog-ws-leftthemedefaultstandard.css" />
<link rel="stylesheet" type="text/css" href="../../_/rsrc/1441580320000/system/app/css/camelot/allthemes-view.css" />
<!--[if IE]>
          <link rel="stylesheet" type="text/css" href="/system/app/css/camelot/allthemes%2die.css" />
        <![endif]-->
<title>Preferences - The Chromium Projects</title>
<meta itemprop="image" content="https://lh4.googleusercontent.com/1uVGQHkigA9rUfiAyp9u9wpolF425l4wji6YNJne7Ct8RYb8blgyeTAPGbTjrDCCR9D9mCTsXLBzT8prDjeLvVf_n0XmBdXHF98npBjrVnXthNB5oMo5C6go0y1yGSUb" />
<meta property="og:image" content="https://lh4.googleusercontent.com/1uVGQHkigA9rUfiAyp9u9wpolF425l4wji6YNJne7Ct8RYb8blgyeTAPGbTjrDCCR9D9mCTsXLBzT8prDjeLvVf_n0XmBdXHF98npBjrVnXthNB5oMo5C6go0y1yGSUb" />
<script type="text/javascript">
                window.jstiming.load.tick('cl');
              </script>
</head>
<body xmlns="http://www.google.com/ns/jotspot" id="body" class=" en            ">
<div id="sites-page-toolbar" class="sites-header-divider">
<div xmlns="http://www.w3.org/1999/xhtml" id="sites-status" class="sites-status" style="display:none;"><div id="sites-notice" class="sites-notice" role="status" aria-live="assertive"> </div></div>
</div>
<div id="sites-chrome-everything-scrollbar">
<div id="sites-chrome-everything" class="">
<div id="sites-chrome-page-wrapper" style="direction: ltr">
<div id="sites-chrome-page-wrapper-inside">
<div xmlns="http://www.w3.org/1999/xhtml" id="sites-chrome-header-wrapper" style="height:auto;">
<table id="sites-chrome-header" class="sites-layout-hbox" cellspacing="0" style="height:auto;">
<tr class="sites-header-primary-row" id="sites-chrome-userheader">
<td id="sites-header-title" class="" role="banner"><div class="sites-header-cell-buffer-wrapper"><a href="../../index.html" id="sites-chrome-userheader-logo"><img id="logo-img-id" src="../../_/rsrc/1438879449147/config/customLogo.gif%3Frevision=3" alt="The Chromium Projects" class="sites-logo  " /></a><h2><a href="../../index.html" dir="ltr" id="sites-chrome-userheader-title">The Chromium Projects</a></h2></div></td><td class="sites-layout-searchbox  "><div class="sites-header-cell-buffer-wrapper"><form id="sites-searchbox-form" action="https://www.chromium.org/system/app/pages/search" role="search"><input type="hidden" id="sites-searchbox-scope" name="scope" value="search-site" /><input type="text" id="jot-ui-searchInput" name="q" size="20" value="" aria-label="Search this site" /><div id="sites-searchbox-button-set" class="goog-inline-block"><div role="button" id="sites-searchbox-search-button" class="goog-inline-block jfk-button jfk-button-standard" tabindex="0">Search this site</div></div></form></div></td>
</tr>
<tr class="sites-header-secondary-row" id="sites-chrome-horizontal-nav">
<td colspan="2" id="sites-chrome-header-horizontal-nav-container" role="navigation">
</td>
</tr>
</table>
</div>
<div id="sites-chrome-main-wrapper">
<div id="sites-chrome-main-wrapper-inside">
<table id="sites-chrome-main" class="sites-layout-hbox" cellspacing="0" cellpadding="{scmCellpadding}" border="0">
<tr>
<td id="sites-chrome-sidebar-left" class="sites-layout-sidebar-left initial" style="width:150px">
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_7648876402527094" class="sites-embed" role="navigation"><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotId="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="../../chromium-projects.html" jotId="wuid:gx:10ae433dadbbab13" class="sites-navigation-link">Home</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="../../Home.1.html" jotId="wuid:gx:43582b9d2029d3af" class="sites-navigation-link">Chromium</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="../../chromium-os.1.html" jotId="wuid:gx:83df2ab1f8880ba" class="sites-navigation-link">Chromium OS</a></div></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_14720868319272995" class="sites-embed" role="navigation"><h4 class="sites-embed-title">Quick links</h4><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotId="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="../../for-testers/bug-reporting-guidelines.html" class="sites-navigation-link">Report bugs</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="../discussion-groups.html" class="sites-navigation-link">Discuss</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="../../system/app/pages/sitemap/hierarchy.html" jotId="wuid:gx:4b58a9a350ad12f" class="sites-navigation-link">网站地图</a></div></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_19690813310444355" class="sites-embed" role="navigation"><h4 class="sites-embed-title">Other sites</h4><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotId="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="http://blog.chromium.org/" class="sites-navigation-link">Chromium Blog</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="http://code.google.com/chrome/extensions/" class="sites-navigation-link">Google Chrome Extensions</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="https://developers.google.com/chrome/chrome-frame/" class="sites-navigation-link">Google Chrome Frame</a></div></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_19695218559354544" class="sites-embed" role="complementary"><h4 class="sites-embed-title"></h4><div class="sites-embed-content sites-embed-content-sidebar-textbox"><div dir="ltr"><span style="font-size:x-small">Except as otherwise </span><a href="http://developers.google.com/site-policies.html#restrictions"><span style="font-size:x-small">noted</span></a><span style="font-size:x-small">, the content of this page is licensed under a </span><a href="http://creativecommons.org/licenses/by/2.5/"><span style="font-size:x-small">Creative Commons Attribution 2.5 license</span></a><span style="font-size:x-small">, and examples are licensed under the </span><a href="http://src.chromium.org/viewvc/chrome/trunk/src/LICENSE" target="_blank"><span style="font-size:x-small">BSD License</span></a><span style="font-size:x-small">.<br /></span></div></div></div>
</td>
<td id="sites-canvas-wrapper">
<div id="sites-canvas" role="main">
<div id="goog-ws-editor-toolbar-container"> </div>
<div xmlns="http://www.w3.org/1999/xhtml" id="title-crumbs" style="">
<A href="../../developers.1.html" dir="ltr">For Developers</A>‎ &gt; ‎<A href="../design-documents.1.html" dir="ltr">Design Documents</A>‎ &gt; ‎
  </div>
<h3 xmlns="http://www.w3.org/1999/xhtml" id="sites-page-title-header" style="" align="left">
<span id="sites-page-title" dir="ltr" tabindex="-1" style="outline: none">Preferences</span>
</h3>
<div id="sites-canvas-main" class="sites-canvas-main">
<div id="sites-canvas-main-content">
<table xmlns="http://www.w3.org/1999/xhtml" cellspacing="0" class="sites-layout-name-one-column sites-layout-hbox"><tbody><tr><td class="sites-layout-tile sites-tile-name-content-1"><div dir="ltr"><b>Abstract:</b> Preferences are used to store configuration parameters that can be modified at run-time rather than compile-time. This document describes the architecture of Chromium’s preferences system and explains how to use it in the context of extensions and policies.<div><br /></div><div><b>Authors:</b> battre, pamg</div><div><b>Last modification:</b> March 16, 2013 (updated code search links)<br /><div style="background-color:transparent;font-family:Times;font-size:medium"><span style="font-family:Arial;font-size:15px;white-space:pre-wrap"><br /></span></div><div style="background-color:transparent;font-family:Times;font-size:medium"><span style="font-family:Arial;font-size:15px;white-space:pre-wrap"><div class="sites-embed-align-left-wrapping-off"><div class="sites-embed-border-off sites-embed" style="width:250px;"><div class="sites-embed-content sites-embed-type-toc"><div class="goog-toc sites-embed-toc-maxdepth-6"><p>Contents</p><ol class="goog-toc"><li class="goog-toc"><a href="preferences.html#TOC-Introduction"><strong>1 </strong>Introduction</a></li><li class="goog-toc"><a href="preferences.html#TOC-Basics"><strong>2 </strong>Basics</a><ol class="goog-toc"><li class="goog-toc"><a href="preferences.html#TOC-Registering-preferences"><strong>2.1 </strong>Registering preferences</a></li><li class="goog-toc"><a href="preferences.html#TOC-Accessing-preference-values"><strong>2.2 </strong>Accessing preference values</a></li><li class="goog-toc"><a href="preferences.html#TOC-PrefStores-and-Precedences"><strong>2.3 </strong>PrefStores and Precedences</a></li><li class="goog-toc"><a href="preferences.html#TOC-Incognito-Profile"><strong>2.4 </strong>Incognito Profile</a></li></ol></li><li class="goog-toc"><a href="preferences.html#TOC-Class-Structure"><strong>3 </strong>Class Structure</a><ol class="goog-toc"><li class="goog-toc"><a href="preferences.html#TOC-Notification-Mechanisms"><strong>3.1 </strong>Notification Mechanisms</a></li></ol></li><li class="goog-toc"><a href="preferences.html#TOC-Extension-Controlled-Preferences"><strong>4 </strong>Extension Controlled Preferences</a><ol class="goog-toc"><li class="goog-toc"><a href="preferences.html#TOC-Exposing-preferences-to-extensions"><strong>4.1 </strong>Exposing preferences to extensions</a></li></ol></li><li class="goog-toc"><a href="preferences.html#TOC-Configuration-Policy"><strong>5 </strong>Configuration Policy</a></li><li class="goog-toc"><a href="preferences.html#TOC-Command-line-parameters"><strong>6 </strong>Command line parameters</a></li></ol></div></div></div></div><br /></span></div><h2><a name="TOC-Introduction"></a>Introduction</h2><div style="background-color:transparent">Preferences are a means to <b>store configuration options</b> in Chromium. Each <b>preference</b> is <b>identified by a key </b>(a string like “proxy.mode”) and points to a value that we call the <b>preference value</b>. These values can be represented by any data-type that is defined in “values.h”, i.e. booleans, integers, strings, lists, dictionaries, et cetera.<br /><br />Preferences can be <b>associated</b> with a <b>browser profile</b> or with <b>local state</b>. Local state contains everything that is not directly associated to a specific profile but rather represents values that are associated with the user account on the host computer (e.g. “Was the browser shut down correctly last time?”, “When was the ‘GPU black list’ downloaded the last time?”, etc.). Due to its nature, local state is never synced across machines.<br /><br />The <b>preference values that are effective at runtime can be set from various sources like default values, files of persisted settings, extensions</b> and <b>policies</b>.<br /><br />The <b>preference system is responsible for</b> and allows for<br /><ul><li>registering preferences with default values</li><li>setting and getting of preference values</li><ul><li>while performing basic type validation</li><li>while respecting precedences (priority) of preference value sources</li><li>while providing thread safety (allow access only on UI thread, provide some helpers for subscribing to preference values on other threads)</li></ul><li>notification of preference value changes</li></ul>These aspects are addressed in the following.<br /><h2><a name="TOC-Basics"></a>Basics</h2><h3><a name="TOC-Registering-preferences"></a>Registering preferences</h3><b>Each preference needs to be registered</b> before being used as in the following example:<br /><br /><div class="sites-codeblock sites-codesnippet-block"><code>PrefService* prefs = …;</code><br /><code>prefs-&gt;RegisterBooleanPref(prefs::kSavingBrowserHistoryDisabled, false, PrefService::UNSYNCABLE_PREF);</code></div></div><div style="background-color:transparent"><br />where <code>prefs::kSavingBrowserHistoryDisabled</code> is a string defined in <code>pref_names.{h,cc}</code>.<br /><br />Here we register a boolean preference with the <b>key</b> <code>“history.saving_disabled”</code> <b>and a default value</b> of <code>false</code>. The default value determines the type of value that can be stored under the key (in this case: boolean). Prefs associated with a profile may be labeled as sync-able and un-sync-able (see <a href="sync.1.html">sync</a>).<br /><br />Registering preferences is important to define their type and guarantee valid default values but also because only registered preference keys can be queried for their current value. Preferences are persisted to disk in the “Preferences” file as JSON with nested dictionaries. The “.” in the preference key is used as the nesting operator:</div><div style="background-color:transparent"><br /><div class="sites-codeblock sites-codesnippet-block"><code>{</code><br /><code>  “history”: {</code><br /><code>    “saving_disabled”: false</code><br /><code>  }</code><br /><code>}</code></div></div><div style="background-color:transparent"><br />This hierarchical namespace is not exposed within Chromium. You must not query <code>“history”</code> and expect a dictionary containing <code>“saving_disabled”</code>. Always access registered preferences by their full key.<br /><br />To register new preferences, add your <code>RegisterPrefs</code> call to <code>RegisterLocalState</code> or <code>RegisterUserPrefs</code> in <code>browser_prefs.cc</code>.</div><h3><a name="TOC-Accessing-preference-values"></a>Accessing preference values</h3><div>The <b>preferences system lives entirely on the UI thread</b>. In the following we assume that we want to access it from there.<br /><br />The preferences associated with the profile can be accessed using the <code>PrefService</code> provided by <code>Profile::GetPrefs()</code>. The <code>PrefService</code> responsible for local_state is accessible by calling <code>g_browser_process-&gt;local_state()</code>.<br /><br />The <b>PrefService provides getter and setter methods</b> like<br /> <code>bool GetBoolean(const char* path) const;</code><br /><code> void SetBoolean(const char* path, bool value);</code><br /><br />As we want to be sure that modifications trigger notifications (see below), <code>GetDictionary()</code> and <code>GetList()</code> return const-pointers. To modify the values, there are two choices:<br /><ol><li>Use <code>void PrefService::Set(const char* path, const Value&amp; value)</code> to set a new dictionary value.</li><li>Use a <code>ScopedUserPrefUpdate</code> (see <code>scoped_user_perf_update.h</code>) to modify a dictionary or list.<br />For <b>updating a dictionary</b>, the code would look as follows:<br /><code>DictionaryPrefUpdate update(pref_service, prefs::kPrefName);</code><br /><code>update-&gt;SetBoolean(“member_key”, true);</code><br /><code>update-&gt;Remove(“other_key”, NULL);<br /></code>At the time when “update” leaves its scope, a “value has changed” notification is automatically triggered.</li></ol><div>You <b>do not need to save modified preferences</b>. All set and update operations trigger a timer to write the modified preferences to disk. This reduces the number of incremental write operations. If you really need to be sure that the preferences are written to disk (during shutdown), use <code>PrefService::CommitPendingWrite()</code>.</div><div><br /></div>The <b>PrefChangeRegistrar</b> allows to subscribe to preference change events. A class that implements the <code>NotificationObserver</code> interface (<code>notification_observer.h</code>) can have a member variable<br /> <div class="sites-codeblock sites-codesnippet-block"><code>PrefChangeRegistrar registrar_;</code></div><br />In its constructor, the class would initialize the registrar as follows<br /> <div class="sites-codeblock sites-codesnippet-block"><code>registrar_.Init(pref_service);</code><br /><code>registrar_.Add(prefs::kPreference, this);</code><br /></div><div><br /></div>Any changes to <code>prefs::kPreference</code> would call the <code>Observe()</code> method of <code>this</code>.<br /><br />The <b>PrefMember</b> classes (<code>BooleanPrefMember</code>, <code>IntegerPrefMember</code>, …, see <code>pref_member.h</code>) are helper classes that stay in sync with preference values beyond the scope of the UI thread. This allows simple reading of preference values even outside the UI thread.</div><h3><a name="TOC-PrefStores-and-Precedences"></a>PrefStores and Precedences</h3><div>Chromium knows several locations where preferences can be stored:</div><div><br /></div><div><table border="1" bordercolor="#888" cellspacing="0" style="border-collapse:collapse;border-top-color:rgb(136,136,136);border-right-color:rgb(136,136,136);border-bottom-color:rgb(136,136,136);border-left-color:rgb(136,136,136);border-top-width:1px;border-right-width:1px;border-bottom-width:1px;border-left-width:1px"><tbody><tr><td style="width:171px;height:14px"><b> Store</b></td><td style="width:625px;height:14px"><b>Purpose </b></td></tr><tr><td style="width:171px;height:14px"><span style="border-collapse:separate">managed_platform_prefs</span> </td><td style="width:625px;height:14px"><span style="border-collapse:separate">contains all managed platform (non-cloud policy) preference values</span> </td></tr><tr><td style="width:171px;height:14px"><span style="border-collapse:separate">managed_cloud_prefs</span> </td><td style="width:625px;height:14px"><span style="border-collapse:separate">contains all managed cloud policy preference values</span> </td></tr><tr><td style="width:171px;height:14px"><span style="border-collapse:separate">extension_prefs</span> </td><td style="width:625px;height:14px"><span style="border-collapse:separate">contains preference values set by extensions</span> </td></tr><tr><td style="width:171px;height:14px"><span style="border-collapse:separate">command_line_prefs</span> </td><td style="width:625px;height:14px"><span style="border-collapse:separate">contains preference values set by command-line switches</span> </td></tr><tr><td style="width:171px;height:14px"><span style="border-collapse:separate">user_prefs</span> </td><td style="width:625px;height:14px"><span style="border-collapse:separate">contains all user-set preference values</span> </td></tr><tr><td style="width:171px;height:14px"><span style="border-collapse:separate">recommended_platform_prefs</span> </td><td style="width:625px;height:14px"><span style="border-collapse:separate">contains all recommended platform policy preference values</span> </td></tr><tr><td style="width:171px;height:14px"><span style="border-collapse:separate">recommended_cloud_prefs</span> </td><td style="width:625px;height:14px"><span style="border-collapse:separate">contains all recommended platform cloud preference values</span> </td></tr><tr><td style="width:171px;height:14px"><span style="border-collapse:separate">default_prefs</span> </td><td style="width:625px;height:14px"><span style="border-collapse:separate">contains all default preference values</span> </td></tr></tbody></table><br />Source: <a href="https://code.google.com/p/chromium/codesearch#chromium/src/base/prefs/pref_value_store.h&amp;q=file:pref_value_store.h%20%22decreasing%20order%20of%20precedence%22&amp;sq=package:chromium&amp;type=cs&amp;l=34" target="_blank">pref_value_store.h</a></div><br />The locations are <b>sorted in decreasing order of precedence</b> meaning that a higher preference store overrides preference values returned by a lower preference store. This is important because it means for example that an extension can override command-line configured preferences and that policies can overrule extension controlled preference values.<br /><br />The <code>default_prefs</code> <code>PrefStore</code> contains the values set by <code>PrefService::Register...Value</code> (see above).<br /><br />The four policy related <code>PrefStore</code>s are discussed in a chapter below.<br /><br />The <code>user_prefs</code> <code>PrefStore</code> represents a persisted pref store. It contains preference values configured by Chromium’s “Preferences” dialogs (and also preferences set by extensions stored under extension-specific preference keys “<code>extensions.settings.$extensionid.preferences</code>”).<br /><br />The <code>extension_prefs</code> <code>PrefStore</code> maintains an in-memory view of the currently effective preference values that are set by extensions. As multiple extensions can try to override the same preference, this PrefStore respects their relative preferences (more on this below). It provides a view over the “<code>extensions.settings.*.preferences</code>” paths in the <code>user_prefs</code>.<br /><br />The <code>command_line_prefs</code> represent preferences activated by command-line flags.<br /><h3><a name="TOC-Incognito-Profile"></a>Incognito Profile</h3><div>The incognito profile is designed to overlay the regular profile. Preferences defined in the regular profile are visible in the incognito profile unless they are overridden.<br /><br />The following table illustrates which <code>PrefStore</code>s are shared between the profiles and which are handled differently.<br /><br /><table border="1" bordercolor="#888" cellspacing="0" style="border-collapse:collapse;border-top-color:rgb(136,136,136);border-right-color:rgb(136,136,136);border-bottom-color:rgb(136,136,136);border-left-color:rgb(136,136,136);border-top-width:1px;border-right-width:1px;border-bottom-width:1px;border-left-width:1px"><tbody><tr><td style="width:171px;height:14px"><span style="border-collapse:separate"><b>Store in regular profile</b></span></td><td style="width:636px;height:14px"><span style="border-collapse:separate"><b>Incognito profile</b></span></td></tr><tr><td style="width:171px;height:14px"><span style="border-collapse:separate">managed_platform_prefs</span> </td><td style="width:636px;height:14px"><font color="#999999"><span style="border-collapse:separate">Same PrefStore as in regular profile</span></font></td></tr><tr><td style="width:171px;height:14px"><span style="border-collapse:separate">managed_cloud_prefs</span> </td><td style="width:636px;height:14px"><font color="#999999"><span style="border-collapse:separate">Same PrefStore as in regular profile</span></font></td></tr><tr><td style="width:171px;height:14px"><span style="border-collapse:separate">extension_prefs</span> </td><td style="width:636px;height:14px"><span style="border-collapse:separate">Special handling for different life-cycles (see below)</span></td></tr><tr><td style="width:171px;height:14px"><span style="border-collapse:separate">command_line_prefs</span> </td><td style="width:636px;height:14px"><font color="#999999"><span style="border-collapse:separate">Same PrefStore as in regular profile</span></font></td></tr><tr><td style="width:171px;height:14px"><span style="border-collapse:separate">user_prefs</span> </td><td style="width:636px;height:14px"><span style="border-collapse:separate">In-memory overlay that prevents persistence to disk</span></td></tr><tr><td style="width:171px;height:14px"><span style="border-collapse:separate">recommended_platform_prefs</span> </td><td style="width:636px;height:14px"><font color="#999999"><span style="border-collapse:separate">Same PrefStore as in regular profile</span></font></td></tr><tr><td style="width:171px;height:14px"><span style="border-collapse:separate">recommended_cloud_prefs</span> </td><td style="width:636px;height:14px"><font color="#999999"><span style="border-collapse:separate">Same PrefStore as in regular profile</span></font></td></tr><tr><td style="width:171px;height:14px"><span style="border-collapse:separate">default_prefs</span></td><td style="width:636px;height:14px"><font color="#999999"><span style="border-collapse:separate">Same PrefStore as in regular profile</span></font></td></tr></tbody></table><br />Extension controlled preferences can be defined for three different scopes:<br /><ul><li>regular (inherited by incognito profile, persisted to disk)</li><li>incognito_persistent (overrides regular, persisted to disk)</li><li>incognito_session_only (overrides regular and incognito_persistent, not persisted to disk, life-time limited to one incognito session)</li></ul></div><div>The in-memory overlay for user_prefs can be used to ensure that specific changes to the preferences do not get persisted in the regular user prefs.</div><div><br /></div><h2><a name="TOC-Class-Structure"></a>Class Structure</h2><div>The following figure illustrates the <code>PrefStores</code> (the figures use UML syntax: dashed lines with triangles represent inheritance; solid lines with arrows and filled diamonds represent composition; solid lines with arrows and empty diamonds represent aggregation):<img src="https://lh4.googleusercontent.com/1uVGQHkigA9rUfiAyp9u9wpolF425l4wji6YNJne7Ct8RYb8blgyeTAPGbTjrDCCR9D9mCTsXLBzT8prDjeLvVf_n0XmBdXHF98npBjrVnXthNB5oMo5C6go0y1yGSUb" /><br /><br /><code>PrefStore</code> is an interface that allows read access and subscription to changed values.<br /><br />The <code>PersistentPrefStore</code> interface extends this with setter methods as well as read and write operations to load and persist the preferences to disk. The <code>JsonPrefStore</code> implements this interface to store the “Preferences” file in the profile on disk. The <code>IncognitoUserPrefStore</code> provides means for an in-memory overlay. This allows storing incognito preferences that are not written to disk but forgotten when the last incognito window is closed.<br /><br />The <code>ConfigurationPolicyPrefStore</code>s handle policy driven preferences. They are discussed in a separate chapter.<br /><br />The <code>CommandLinePrefStore</code>, <code>DefaultPrefStore</code> and <code>ExtensionPrefStore</code> store the respective types of preference values. The <code>ExtensionPrefStore</code> is discussed in a separate chapter. These three PrefStores are based on the <code>ValueMapPrefStore</code> which provides an in-memory implementation of a <code>PrefStore</code> and relies on the <code>PrefValueMap</code> for this.<br /><br />The <code>PrefValueStore</code> is a facade around all <code>PrefStores</code> that enforces the precedence presented above. It maintains ownership of the respective <code>PrefStore</code>s and asks them one by one until the first <code>PrefStore</code> contains a specific key. <code>PrefValueStore</code> also answers questions about where a preference value comes from. For example, client code occasionally wants to know whether a preference is under control of the user, i.e., not forced by configuration management or extensions.<br /><br />The <code>PrefService</code> is the global interface to preferences. It supports registering default values, and simple access to currently effective preference values. At this abstraction layer, the <code>PrefValueStore</code> becomes an implementation detail of the <code>PrefService</code>:</div><div><img src="https://lh3.googleusercontent.com/-3xUJutScqdsTVmiR1QCi0nPow-L2sBZBk17oOU7iWpKdfFqAkoSEpclcQXYRrHK9H3xwe28rHhzRmMtnZeeWHcX1hhHsiYHwUHwQZA2D3iplxqMHl5XVkCCjTIjrCfV" /><br /><br />The <code>PrefService</code> serves three purposes:<br /><ul><li>Registering default values for preferences.</li><li>Retrieving the currently effective preference value.</li><li>Storing preference values in the persisted user_prefs.</li></ul>The <code>ExtensionPrefs</code> class manages preference values that extensions want to set. It persists values to disk using the <code>PrefService</code> and feeds values to the <code>ExtensionPrefStore</code> so that the <code>PrefValueStore</code> can consider extension controlled preferences for effective preference values. The latter happens indirectly. The <code>ExtensionPrefs</code> instance writes the preference values into the <code>ExtensionPrefValueMap</code> which knows about regular and incognito preferences. The <code>ExtensionPrefStore</code>, which is specific to either a regular profile or an incognito profile, subscribes to the <code>ExtensionPrefValueMap</code> and retrieves the respective regular or incognito preferences.</div><h3><a name="TOC-Notification-Mechanisms"></a><span style="font-size:16px;font-weight:bold">Notification Mechanisms</span></h3><div>The following figure indicates how preferences are set (blue arrows) and how change notifications are propagated to subscribers (red arrows).</div><div><br /><img src="https://lh3.googleusercontent.com/f40v5VbhUvCRk6R0zHSwQ1K9IrRJ2q860-gywMk-VfEbVRwXquL8y8ZnUKaGiHq5tyB4iVUVQgaSB5o1VNy8jDFc5dxgagHfZEqZApACk349KQNhwDfqgQMgbEJ-zgi6" style="display:block;margin-right:auto;text-align:left" /><br />The blue paths are triggered in three different ways:<br /><ul><li>Registering a default preference value: <code>PrefService</code> → <code>DefaultPrefStore</code></li><li>Setting user preference (user modifies a setting in Chromium): <code>PrefService</code> → <code>JsonPrefStore</code></li><li>Extension sets a preference: <code>ExtensionPrefs</code> → <code>ExtensionPrefValueMap</code> and for persistence beyond browser sessions: <code>ExtensionPrefs</code> → <code>PrefService</code> → <code>JsonPrefStore</code></li></ul>Helper classes like the <code>PrefChangeRegistrar</code> and <code>PrefMember</code> can be used to subscribe to changes as outlined above.</div><h2><a name="TOC-Extension-Controlled-Preferences"></a><span style="font-size:20px;font-weight:bold">Extension Controlled Preferences</span></h2><div>Some (selected) preferences can be controlled by extensions (such as the proxy settings). These preferences need to be made available to extensions explicitly as we do not want to allow extensions to configure all preferences.<br /><br />Some particularities of extension controlled preferences need to be addressed:<br /><ul><li>Two or more extensions might write different preference values for the same preference. E.g. two extensions might want to set the proxy configuration. In this case it is important to ensure that one extension overrides the preference values of the other extension and to guarantee a <b>deterministic precedence</b>. This means that each time somebody requests the current value of a preference, he gets the same reply. The precedence rule is defined as <b>“last extension installed wins”</b>. This precedence order needs to be maintained even between browser restarts where extensions are loaded asynchronously. This is realized by adding a path <code>extensions.settings.$EXTENSION_ID.install_time</code> to the Preferences file.</li><li>The <code>ExtensionPrefStore</code> needs to <b>provide values even before extensions are started</b>. Imagine that a proxy extension provides proxy configuration values that are essential for any kind of network communication. Other extensions would not be able to communicate until the proxy extension has been started. For this reason, the Preferences file is extended by <code>extensions.settings.$EXTENSION_ID.preferences</code>. At this point we store a dictionary, whose keys are un-expanded path names that identify the preferences. Maintaining these entries and updating the <code>ExtensionPrefStore</code> that represents the winning preferences of extensions is task of the <code>ExtensionPrefs</code> class.</li><li>We want to allow using <b>different preference values for incognito windows</b>. We support two different kinds of incognito preferences:</li><ul><li><b>persistent_incognito</b> preferences are persisted in the Preferences file as <code>extension.settings.$EXTENSION_ID.incognito_preferences</code>. Their life-time spans several browser sessions (i.e. browser restart) and can be used for settings about incognito windows that are NOT related to the specific browsing history of an incognito session. Otherwise we would defeat the purpose of the incognito mode (don’t store any browsing behavior related data).</li><li><b>session_only_incognito</b> preferences are not persisted. They can only be set once at least one incognito window has been opened and are cleared when the last incognito window is closed.</li></ul></ul><h3><a name="TOC-Exposing-preferences-to-extensions"></a>Exposing preferences to extensions</h3></div><div>In order to expose a preference to an extension, you need to follow these steps:<br /><br />Add a property of type ChromeSettings to your extension namespace in the respective file in <code>chrome/common/extensions/api</code>. This is an example from the proxy extension:<br /><div class="sites-codeblock sites-codesnippet-block"><code>"properties": {</code><br /><code>  "settings": { // “settings” is the name of the preference exposed to the extension</code><br /><code>    "$ref": "ChromeSetting",</code><br /><code>    "description": "Proxy settings to be used. The value of this setting is a ProxyConfig object.",</code><br /><code>    "value": [</code><br /><code>      "proxy", // this is an internal, unique key referred to as “preference key” below</code><br /><code>      {"$ref": "ProxyConfig"} // this is the schema to which preferences need to comply</code><br /><code>    ]</code><br /><code>  }</code><br /><code>}</code></div><br />Add an <code>PrefMappingEntry</code> to <code>kPrefMapping[]</code> in <code>extension_preference_api.cc</code>. You require three entries:<br /><ul><li>Name of the preference as exposed to the extension (referred to as “preference key” above)</li><li>Name of the preference as handled within the browser (a string literal in the prefs:: namespace)</li><li>Name of the permission required to modify the preference</li></ul>Optionally you can register a <code>PrefTransformer</code> to <code>PrefMapping::PrefMapping()</code> in <code>extension_preference_api.cc</code>. This allows for a transformation of how preferences are structured within the browser and in the extension. For example, the Proxy Settings API exposes preferences differently to extensions than they are stored internally.<br /><br />By following these steps, we guarantee that all preferences are made available in the same way. We provide <code>get()</code>, <code>set()</code>, and <code>clear()</code> functions as well as an <code>onChanged</code> event.</div><h2><a name="TOC-Configuration-Policy"></a>Configuration Policy</h2><div>Configuration policy, a.k.a. admin policy, uses preferences as the main way of exposing policy settings in the Chromium code. There are two levels policy can come in:</div><div><ul><li><b>Mandatory policy</b>: Settings that are forced upon the user by their administrator. These policy settings are injected through the <code>managed_platform</code> and <font face="'courier new', monospace"><code>managed_cloud</code></font> <code>ConfigurationPolicyPrefStore</code>s, which are the highest-precedence <code>PrefStore</code>s. Any user-visible configuration settings (e.g. in chrome://settings) should be disabled and merely show the preference value if a policy-configured preference value is present. To facilitate implementing this, there is <code>PrefService::Preference::IsManaged()</code> which will return <code>true</code> if there's a managed policy setting.</li><li><b>Recommended policy</b>: At the low-precedence side of the <code>PrefStore</code> stack, there are two more <code>ConfigurationPolicyPrefStore</code>s: <code>recommended_platform</code> and <code>recommended_cloud</code>. These contain policy-configured values that are not forced on the user, but merely defaults provided by the administrator, which the user can still override. From the perspective of the Chromium code, recommended policy shouldn't require special handling in most cases; the PrefService will just return the policy-configured default when appropriate.</li></ul></div><div>The <code>ConfigurationPolicyPrefStore</code> objects always keep the latest known policy configuration. Behind the scenes, the policy settings are read from the platform's native management APIs through the <code>ConfigurationPolicyProvider</code> abstraction, which monitors the platform's policy configuration an notifies <code>ConfigurationPolicyPrefStore</code> to reexamine policy configuration as provided by the <span style="color:rgb(0,96,0);font-family:monospace">ConfigurationPolicyProvider </span>on changes. <span style="color:rgb(0,96,0);font-family:monospace">ConfigurationPolicyProvider</span> will then map the new configuration to preferences and expose them to PrefValueStore, generating <code>PREF_CHANGED</code> notifications as appropriate.</div><div><br /></div><div>Covering the design of all <code>ConfigurationPolicyProvider</code> implementations is out of scope for this document, but here is a quick overview (see also <a href="http://dev.chromium.org/administrators">http://dev.chromium.org/administrators</a>):</div><div><ul><li>On Windows, <code>ConfigurationPolicyProviderWin</code> integrates with Windows Group Policy. Policy settings are read from the registry and Chromium watches for policy notifications to update policy settings when Group Policy changes.</li><li>Mac has a mechanism called "Managed Preferences" and policy-configured settings come as locked application preferences. They can be configured and distributed through the Workgroup Manager application and Apple's Directory Service.</li><li>For Linux, <code>ConfigDirPolicyProvider</code> reads policy settings from JSON files in <code>/etc</code>. The directories are monitored for changes so policy can be reloaded when files change.</li><li>On ChromeOS, there is code that can pull down policy settings from a device management service in the cloud.</li></ul></div><div><h2><a name="TOC-Command-line-parameters"></a>Command line parameters</h2></div><div>In order to map command line parameters to preference values, you can edit <code>command_line_pref_store.cc</code> and follow the examples therein. Note that it may be advantageous to copy command-line flags into the <code>CommandLinePrefStore</code>. This decouples our code from a static global <code>CommandLine</code> instance.</div></div></div></td></tr></tbody></table>
</div> 
</div> 
<div id="sites-canvas-bottom-panel">
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_page-subpages"> </div>
<div id="sites-attachments-container">
</div>
<a xmlns="http://www.w3.org/1999/xhtml" name="page-comments"></a>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_page-comments"><div class="sites-comment-docos-wrapper"><div class="sites-comment-docos"><div class="sites-comment-docos-background"></div><div class="sites-comment-docos-header"><div class="sites-comment-docos-header-title">Comments</div></div><div id="sites-comment-docos-pane" class="sites-comment-docos-pane"></div></div></div></div>
</div>
</div> 
</td> 
</tr>
</table> 
</div> 
</div> 
<div id="sites-chrome-footer-wrapper">
<div id="sites-chrome-footer-wrapper-inside">
<div id="sites-chrome-footer">
</div>
</div>
</div>
</div> 
</div> 
<div id="sites-chrome-adminfooter-container">
<div xmlns="http://www.w3.org/1999/xhtml" class="sites-adminfooter" role="navigation"><p><a class="sites-system-link" href="https://www.google.com/a/UniversalLogin?service=jotspot&amp;continue=https://sites.google.com/a/chromium.org/dev/developers/design-documents/preferences">Sign in</a><span aria-hidden="true">|</span><a class="sites-system-link" href="../../system/app/pages/recentChanges.html">Recent Site Activity</a><span aria-hidden="true">|</span><a class="sites-system-link" href="../../system/app/pages/reportAbuse.html" target="_blank">Report Abuse</a><span aria-hidden="true">|</span><a class="sites-system-link" href="javascript:;" onclick="window.open(webspace.printUrl)">Print Page</a><span aria-hidden="true">|</span><span class="sites-system-link">Powered By</span> <b class="powered-by"><a href="http://sites.google.com">Google Sites</a></b></p></div>
</div>
</div> 
</div> 
<div id="sites-chrome-onebar-footer">
</div>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    window.jstiming.load.tick('sjl');
  </script>
<script xmlns="http://www.w3.org/1999/xhtml" src="https://ssl.gstatic.com/sites/p/56e332/system/js/jot_min_view__en.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    window.jstiming.load.tick('jl');
  </script>
<script xmlns="http://www.w3.org/1999/xhtml">
      
          sites.core.Analytics.createTracker();
          sites.core.Analytics.trackPageview();
        
    </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
                    sites.Searchbox.initialize(
                        'sites-searchbox-search-button',
                        {"object":[]}['object'],
                        'search-site',
                        {"label":"Configure search options...","url":"/system/app/pages/admin/settings"});
                  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
      gsites.HoverPopupMenu.createSiteDropdownMenus('sites-header-nav-dropdown', false);
    </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
            JOT_setupNav("7648876402527094", "Navigation", false);
            JOT_addListener('titleChange', 'JOT_NAVIGATION_titleChange', 'COMP_7648876402527094');
          </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
            JOT_setupNav("14720868319272995", "Quick links", false);
            JOT_addListener('titleChange', 'JOT_NAVIGATION_titleChange', 'COMP_14720868319272995');
          </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
            JOT_setupNav("19690813310444355", "Other sites", false);
            JOT_addListener('titleChange', 'JOT_NAVIGATION_titleChange', 'COMP_19690813310444355');
          </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
              new sites.CommentPane('//docs.google.com/comments/d/AAHRpnXvrAwjAfmld0ObrebBiGRq99zqFg74qblTyJd8dcpRbGm2jwyRYN1We-Co-BxTYrEWBckFnjV5gxZJgQkf7JLTYgD4Mcd-kE6Pkc_F3FmWNa-nBdpwuCdUurN_W9Gl0CTqNNSsJ/api/js?anon=true',
                  false, false);
            </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
  setTimeout(function() {
    var fingerprint = gsites.date.TimeZone.getFingerprint([]);
    gsites.Xhr.send('https://www.chromium.org/_/tz', null, null, 'GET', null, null, { afjstz: fingerprint });
  }, 500);
</script>
<script xmlns="http://www.w3.org/1999/xhtml">
                    window.onload = function() {
                      if (false) {
                        JOT_setMobilePreview();
                      }
                      var loadTimer = window.jstiming.load;
                      loadTimer.tick("ol");
                      loadTimer["name"] = "load," + webspace.page.type + ",user_page";
                      window.jstiming.report(loadTimer, {}, 'https://gg.google.com/csi');
                    }
                  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
        JOT_insertAnalyticsCode(false,
            false);
      </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    var maestroRunner = new gsites.pages.view.SitesMaestroRunner(
        webspace, "en");
    maestroRunner.initListeners();
    maestroRunner.installEditRender();
  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
  //<![CDATA[
    // Decorate any fastUI buttons on the page with a class of 'goog-button'.
    if (webspace.user.hasWriteAccess) {
      JOT_decorateButtons();
    }

    // Fires delayed events.
    (function() {
      JOT_fullyLoaded = true;
      var delayedEvents = JOT_delayedEvents;
      for (var x = 0; x < delayedEvents.length; x++) {
        var event = delayedEvents[x];
        JOT_postEvent(event.eventName, event.eventSrc, event.payload);
      }
      JOT_delayedEvents = null;
      JOT_postEvent('pageLoaded');
    })();
  //]]>
</script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    JOT_postEvent('decorateGvizCharts');
  </script>
<script type="text/javascript">
          JOT_setupPostRenderingManager();
        </script>
<script type="text/javascript">
          JOT_postEvent('renderPlus', null, 'sites-chrome-main');
        </script>
<div id="server-timer-div" style="display:none"> </div>
<script type="text/javascript">
          window.jstiming.load.tick('render');
          JOT_postEvent('usercontentrendered', this);
        </script>
</body>
</html>
