<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/WebPage">
<head>
<meta http-equiv="X-UA-Compatible" content="chrome=1" />
<script type="text/javascript">/* Copyright 2008 Google. */ (function() { var e="wtsrt_",g="tbsd_",h="tbnd_",k="start",l="_wtsrt",m="_tbnd",n="CSI/";(function(){function f(a){this.t={};this.tick=function(a,c,b){this.t[a]=[void 0!=b?b:(new Date).getTime(),c];if(void 0==b)try{window.console.timeStamp(n+a)}catch(d){}};this.tick(k,null,a)}var a;window.performance&&(a=window.performance.timing);var p=a?new f(a.responseStart):new f;window.jstiming={Timer:f,load:p};if(a){var c=a.navigationStart,d=a.responseStart;0<c&&d>=c&&(window.jstiming.srt=d-c)}if(a){var b=window.jstiming.load;0<c&&d>=c&&(b.tick(l,void 0,c),b.tick(e,l,d),b.tick(g,e))}try{a=null,
window.chrome&&window.chrome.csi&&(a=Math.floor(window.chrome.csi().pageT),b&&0<c&&(b.tick(m,void 0,window.chrome.csi().startE),b.tick(h,m,c))),null==a&&window.gtbExternal&&(a=window.gtbExternal.pageT()),null==a&&window.external&&(a=window.external.pageT,b&&0<c&&(b.tick(m,void 0,window.external.startE),b.tick(h,m,c))),a&&(window.jstiming.pt=a)}catch(q){}})(); })()
</script>
<link rel="shortcut icon" href="/_/rsrc/1354323194313/favicon.ico" type="image/x-icon" />
<link rel="apple-touch-icon" href="https://ssl.gstatic.com/sites/p/56e332/system/app/images/apple-touch-icon.png" type="image/png" />
<script type="text/javascript">/* Copyright 2008 Google. */ (function() { var d="",g="__duration__",h="function";function k(c){return document.getElementById(c)}window.byId=k;function l(c){return c.replace(/^\s+|\s+$/g,d)}window.trim=l;var m=[],n=0;window.JOT_addListener=function(c,a,b){var e=new String(n++);c={eventName:c,handler:a,compId:b,key:e};m.push(c);return e};window.JOT_removeListenerByKey=function(c){for(var a=0;a<m.length;a++)if(m[a].key==c){m.splice(a,1);break}};
window.JOT_removeAllListenersForName=function(c){for(var a=0;a<m.length;a++)m[a].eventName==c&&m.splice(a,1)};window.JOT_postEvent=function(c,a,b){var e={eventName:c,eventSrc:a||{},payload:b||{}};if(window.JOT_fullyLoaded)for(a=m.length,b=0;b<a&&b<m.length;b++){var f=m[b];f&&f.eventName==c&&(e.listenerCompId=f.compId||d,(f=typeof f.handler==h?f.handler:window[f.handler])&&f(e))}else window.JOT_delayedEvents.push({eventName:c,eventSrc:a,payload:b})};window.JOT_delayedEvents=[];
window.JOT_fullyLoaded=!1;window.JOT_formatRelativeToNow=function(c,a){var b=((new Date).getTime()-c)/6E4;if(1440<=b||0>b)return null;var e=0;60<=b&&(b/=60,e=2);2<=b&&e++;return a?window.JOT_siteRelTimeStrs[e].replace(g,Math.floor(b)):window.JOT_userRelTimeStrs[e].replace(g,Math.floor(b))}; })()
</script>
<script>

  

  var breadcrumbs = [{"path":"/developers","deleted":false,"title":"For Developers","dir":"ltr"},{"path":"/developers/design-documents","deleted":false,"title":"Design Documents","dir":"ltr"},{"path":"/developers/design-documents/conventions-and-patterns-for-multi-platform-development","deleted":false,"title":"Conventions and patterns for multi-platform development","dir":"ltr"}];
  var JOT_clearDotPath = 'https://ssl.gstatic.com/sites/p/56e332/system/app/images/cleardot.gif';

  
  var JOT_userRelTimeStrs = ["a minute ago","__duration__ minutes ago","an hour ago","__duration__ hours ago"];

  
  

  

  var webspace = {"enableAnalytics":true,"pageSharingId":"jotspot_page","enableUniversalAnalytics":false,"sharingPolicy":"OPENED_WITH_INDICATOR","siteTitle":"The Chromium Projects","isStartPageEnabled":true,"adsensePublisherId":null,"features":{"languageSelectDefaultTextSetToDefault":true,"validateClientGvizDataSourceUrls":true,"moreMobileStyleImprovements":true,"newInsertMenuIcons":true,"accessibleSortingButtons":true,"domainAnalyticsInGAOnly":true,"noCaptcha":true,"fileCabinetScreenReaderFix":true,"updatedTosAndPrivacyLinks":null,"pageDrafts":false,"mobileOrientationFix":true,"plusBadge":false,"pdfEmbedSupport":false,"jsClickFix":true},"isPublic":true,"isConsumer":false,"serverFlags":{"cajaBaseUrl":"//www.gstatic.com/caja","cajaDebugMode":false},"onepickBaseUrl":"https://docs.google.com","domainAnalyticsAccountId":"","plusPageId":"","signInUrl":"https://www.google.com/a/SelectSession?continue\u003dhttps://sites.google.com/a/chromium.org/dev/developers/design-documents/conventions-and-patterns-for-multi-platform-development\u0026service\u003djotspot","analyticsAccountId":"UA-5484340-1","scottyUrl":"/_/upload","homePath":"/","siteNoticeUrlEnabled":null,"plusPageUrl":"","adsensePromoClickedOrSiteIneligible":true,"csiReportUri":"https://gg.google.com/csi","sharingId":"jotspot","termsUrl":"//www.google.com/intl/en/policies/terms/","gvizVersion":1,"editorResources":{"sitelayout":["https://ssl.gstatic.com/sites/p/56e332/system/app/css/sitelayouteditor.css"],"text":["https://ssl.gstatic.com/sites/p/56e332/system/js/codemirror.js","https://ssl.gstatic.com/sites/p/56e332/system/app/css/codemirror_css.css","https://ssl.gstatic.com/sites/p/56e332/system/js/trog_edit__en.js","https://ssl.gstatic.com/sites/p/56e332/system/app/css/trogedit.css","/_/rsrc/1441580320000/system/app/css/editor.css","https://ssl.gstatic.com/sites/p/56e332/system/app/css/codeeditor.css","/_/rsrc/1441580320000/system/app/css/camelot/editor-jfk-wlb.css"]},"sharingUrlPrefix":"/_/sharing","isAdsenseEnabled":true,"domain":"chromium.org","baseUri":"","name":"dev","siteTemplateId":false,"siteNoticeRevision":null,"siteNoticeUrlAddress":null,"siteNoticeMessage":null,"page":{"isRtlLocale":false,"canDeleteWebspace":null,"isPageDraft":null,"parentPath":"/developers/design-documents","parentWuid":"wuid:gx:359ef223e0fb14ac","siteLocale":"en","timeZone":"America/Los_Angeles","type":"text","title":"Conventions and patterns for multi-platform development","locale":"en","wuid":"wuid:gx:73c897186c3cde93","revision":18,"path":"/developers/design-documents/conventions-and-patterns-for-multi-platform-development","isSiteRtlLocale":false,"pageInheritsPermissions":null,"name":"conventions-and-patterns-for-multi-platform-development","canChangePath":true,"state":"","properties":{},"bidiEnabled":false,"currentTemplate":{"path":"/system/app/pagetemplates/text","title":"Web Page"}},"canPublishScriptToAnyone":true,"user":{"keyboardShortcuts":true,"sessionIndex":"","guest_":true,"displayNameOrEmail":"guest","userName":"guest","uid":"","renderMobile":false,"domain":"","namespace":"","hasWriteAccess":false,"namespaceUser":false,"primaryEmail":"guest","hasAdminAccess":false},"gadgets":{"baseUri":"/system/app/pages/gadgets"}};
  webspace.page.breadcrumbs = breadcrumbs;

  
  var JOT_siteRelTimeStrs = ["a minute ago","__duration__ minutes ago","an hour ago","__duration__ hours ago"];

</script>
<script type="text/javascript">
                window.jstiming.load.tick('scl');
              </script>
<meta name="title" content="Conventions and patterns for multi-platform development - The Chromium Projects" />
<meta itemprop="name" content="Conventions and patterns for multi-platform development - The Chromium Projects" />
<meta property="og:title" content="Conventions and patterns for multi-platform development - The Chromium Projects" />
<meta name="description" content="Home of the Chromium Open Source Project" />
<meta itemprop="description" content="Home of the Chromium Open Source Project" />
<meta id="meta-tag-description" property="og:description" content="Home of the Chromium Open Source Project" />
<style type="text/css">
</style>
<link rel="stylesheet" type="text/css" href="https://ssl.gstatic.com/sites/p/56e332/system/app/themes/beigeandblue/standard-css-beigeandblue-ltr-ltr.css" />
<link rel="stylesheet" type="text/css" href="/_/rsrc/1441580320000/system/app/css/overlay.css?cb=beigeandblueundefineda100%25%25150goog-ws-leftthemedefaultstandard" />
<link rel="stylesheet" type="text/css" href="/_/rsrc/1441580320000/system/app/css/camelot/allthemes-view.css" />
<!--[if IE]>
          <link rel="stylesheet" type="text/css" href="/system/app/css/camelot/allthemes%2die.css" />
        <![endif]-->
<title>Conventions and patterns for multi-platform development - The Chromium Projects</title>
<meta itemprop="image" content="/_/rsrc/1438879449147/config/customLogo.gif?revision=3" />
<meta property="og:image" content="/_/rsrc/1438879449147/config/customLogo.gif?revision=3" />
<script type="text/javascript">
                window.jstiming.load.tick('cl');
              </script>
</head>
<body xmlns="http://www.google.com/ns/jotspot" id="body" class=" en            ">
<div id="sites-page-toolbar" class="sites-header-divider">
<div xmlns="http://www.w3.org/1999/xhtml" id="sites-status" class="sites-status" style="display:none;"><div id="sites-notice" class="sites-notice" role="status" aria-live="assertive"> </div></div>
</div>
<div id="sites-chrome-everything-scrollbar">
<div id="sites-chrome-everything" class="">
<div id="sites-chrome-page-wrapper" style="direction: ltr">
<div id="sites-chrome-page-wrapper-inside">
<div xmlns="http://www.w3.org/1999/xhtml" id="sites-chrome-header-wrapper" style="height:auto;">
<table id="sites-chrome-header" class="sites-layout-hbox" cellspacing="0" style="height:auto;">
<tr class="sites-header-primary-row" id="sites-chrome-userheader">
<td id="sites-header-title" class="" role="banner"><div class="sites-header-cell-buffer-wrapper"><a href="https://www.chromium.org/" id="sites-chrome-userheader-logo"><img id="logo-img-id" src="/_/rsrc/1438879449147/config/customLogo.gif?revision=3" alt="The Chromium Projects" class="sites-logo  " /></a><h2><a href="https://www.chromium.org/" dir="ltr" id="sites-chrome-userheader-title">The Chromium Projects</a></h2></div></td><td class="sites-layout-searchbox  "><div class="sites-header-cell-buffer-wrapper"><form id="sites-searchbox-form" action="/system/app/pages/search" role="search"><input type="hidden" id="sites-searchbox-scope" name="scope" value="search-site" /><input type="text" id="jot-ui-searchInput" name="q" size="20" value="" aria-label="Search this site" /><div id="sites-searchbox-button-set" class="goog-inline-block"><div role="button" id="sites-searchbox-search-button" class="goog-inline-block jfk-button jfk-button-standard" tabindex="0">Search this site</div></div></form></div></td>
</tr>
<tr class="sites-header-secondary-row" id="sites-chrome-horizontal-nav">
<td colspan="2" id="sites-chrome-header-horizontal-nav-container" role="navigation">
</td>
</tr>
</table>
</div>
<div id="sites-chrome-main-wrapper">
<div id="sites-chrome-main-wrapper-inside">
<table id="sites-chrome-main" class="sites-layout-hbox" cellspacing="0" cellpadding="{scmCellpadding}" border="0">
<tr>
<td id="sites-chrome-sidebar-left" class="sites-layout-sidebar-left initial" style="width:150px">
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_7648876402527094" class="sites-embed" role="navigation"><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotId="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="/chromium-projects" jotId="wuid:gx:10ae433dadbbab13" class="sites-navigation-link">Home</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="/Home" jotId="wuid:gx:43582b9d2029d3af" class="sites-navigation-link">Chromium</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="/chromium-os" jotId="wuid:gx:83df2ab1f8880ba" class="sites-navigation-link">Chromium OS</a></div></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_14720868319272995" class="sites-embed" role="navigation"><h4 class="sites-embed-title">Quick links</h4><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotId="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="http://www.chromium.org/for-testers/bug-reporting-guidelines" class="sites-navigation-link">Report bugs</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="http://www.chromium.org/developers/discussion-groups" class="sites-navigation-link">Discuss</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="/system/app/pages/sitemap/hierarchy" jotId="wuid:gx:4b58a9a350ad12f" class="sites-navigation-link">网站地图</a></div></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_19690813310444355" class="sites-embed" role="navigation"><h4 class="sites-embed-title">Other sites</h4><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotId="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="http://blog.chromium.org/" class="sites-navigation-link">Chromium Blog</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="http://code.google.com/chrome/extensions/" class="sites-navigation-link">Google Chrome Extensions</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="https://developers.google.com/chrome/chrome-frame/" class="sites-navigation-link">Google Chrome Frame</a></div></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_19695218559354544" class="sites-embed" role="complementary"><h4 class="sites-embed-title"></h4><div class="sites-embed-content sites-embed-content-sidebar-textbox"><div dir="ltr"><span style="font-size:x-small">Except as otherwise </span><a href="http://developers.google.com/site-policies.html#restrictions"><span style="font-size:x-small">noted</span></a><span style="font-size:x-small">, the content of this page is licensed under a </span><a href="http://creativecommons.org/licenses/by/2.5/"><span style="font-size:x-small">Creative Commons Attribution 2.5 license</span></a><span style="font-size:x-small">, and examples are licensed under the </span><a href="http://src.chromium.org/viewvc/chrome/trunk/src/LICENSE" target="_blank"><span style="font-size:x-small">BSD License</span></a><span style="font-size:x-small">.<br /></span></div></div></div>
</td>
<td id="sites-canvas-wrapper">
<div id="sites-canvas" role="main">
<div id="goog-ws-editor-toolbar-container"> </div>
<div xmlns="http://www.w3.org/1999/xhtml" id="title-crumbs" style="">
<A href="/developers" dir="ltr">For Developers</A>‎ &gt; ‎<A href="/developers/design-documents" dir="ltr">Design Documents</A>‎ &gt; ‎
  </div>
<h3 xmlns="http://www.w3.org/1999/xhtml" id="sites-page-title-header" style="" align="left">
<span id="sites-page-title" dir="ltr" tabindex="-1" style="outline: none">Conventions and patterns for multi-platform development</span>
</h3>
<div id="sites-canvas-main" class="sites-canvas-main">
<div id="sites-canvas-main-content">
<table xmlns="http://www.w3.org/1999/xhtml" cellspacing="0" class="sites-layout-name-one-column sites-layout-hbox"><tbody><tr><td class="sites-layout-tile sites-tile-name-content-1"><div dir="ltr">
<div style="margin-top:0px;margin-bottom:0px">Chromium is a large and complex cross-platform product. We try to share as much code as possible between platforms, while implementing the UI and OS integration in the most appropriate way for each. While this gives a better user experience, it adds extra complexity to the code. This document describes the recommended practices for keeping such cross-platform code clean.</div>
<div style="margin-top:0px;margin-bottom:0px"><br />
</div>
<div style="margin-top:0px;margin-bottom:0px">We use a variety of different file naming suffixes to indicate when a file should be used:</div>
<p style="margin:0px"> </p>
<ul style="margin-top:0px;margin-bottom:0px"><li style="margin-top:0px;margin-bottom:0px">Mac files use the <font face="'courier new', monospace">_mac </font>suffix for lower-level files and Cocoa (Mac UI) files use the <font face="'courier new', monospace">_cocoa</font> suffix.</li><li style="margin-top:0px;margin-bottom:0px">iOS files use the <font face="courier new, monospace">_ios</font> suffix (although iOS also uses some specific <font face="courier new, monospace">_mac</font> files).</li>
<li style="margin-top:0px;margin-bottom:0px">Linux files use <font face="'courier new', monospace">_linux</font> suffix for lower-level files, <font face="'courier new', monospace">_gtk</font> for GTK-specific files, and <font face="'courier new', monospace">_x</font> for X Windows (with no GTK) specific files.</li>
<li style="margin-top:0px;margin-bottom:0px">Windows files use the <font face="'courier new', monospace">_win</font> suffix.</li>
<li style="margin-top:0px;margin-bottom:0px">Posix files shared between Mac, iOS, and Linux use the <font face="'courier new', monospace">_posix</font> suffix.</li>
<li style="margin-top:0px;margin-bottom:0px">Files for Chrome's "Views" UI (on Windows and experimental GTK) layout system use the <font face="'courier new', monospace">_views</font> suffix.</li></ul>
<div style="margin-top:0px;margin-bottom:0px"><br />
</div>
<div style="margin-top:0px;margin-bottom:0px">The separate front-ends of the browser are contained in their own directories:</div><div style="margin-top:0px;margin-bottom:0px"><br /></div>
<div style="margin-top:0px;margin-bottom:0px">
<ul style="margin-top:0px;margin-bottom:0px"><li style="margin-top:0px;margin-bottom:0px">Mac Cocoa: chrome/browser/ui/cocoa</li>
<li style="margin-top:0px;margin-bottom:0px">Linux GTK: chrome/browser/ui/gtk</li>
<li style="margin-top:0px;margin-bottom:0px">Windows Views (and the experimental GTK-views): chrome/browser/ui/views</li></ul><div><br /></div><div>The <a href="https://www.chromium.org/developers/coding-style">Coding Style</a> page lists some stylistic rules affecting platform-specific defines.</div></div><h3 style="font-size:12pt"><a name="TOC-How-to-separate-platform-specific-code"></a>How to separate platform-specific code</h3>
<h4 style="font-size:10pt"><a name="TOC-Small-platform-differences:-ifdefs"></a>Small platform differences: #ifdefs</h4>
<div style="margin-top:0px;margin-bottom:0px">When you have a class with many shared functions or data members, but a few differences, use <font face="'courier new', monospace">#ifdefs</font> around the platform-specific parts. If there are no significant differences, it's easier for everybody to keep everything in one place.</div>
<h4 style="font-size:10pt"><a name="TOC-Small-platform-differences-in-the-header-larger-ones-in-the-implementation:-split-the-implementation"></a>Small platform differences in the header, larger ones in the implementation: split the implementation</h4>
<div style="margin-top:0px;margin-bottom:0px">There may be cases where there are few header file differences, but significant implementation differences for parts of the implementation. For example, <font face="'courier new', monospace">base/waitable_event.h</font> defines a common API with a couple of platform differences.</div>
<div style="margin-top:0px;margin-bottom:0px"><br />
</div>
<div style="margin-top:0px;margin-bottom:0px">With significant implementation differences, the implementation files can be split. The prevents you from having to do a lot of <font face="'courier new', monospace">#ifdefs</font> for the includes necessary for each platform and also makes it easier to follow (three versions each of a set of functions in a file can get confusing). There can be different <font face="'courier new', monospace">.cc</font> files for each platform, as in <font face="'courier new', monospace">base/waitable_event_posix.cc</font> that implements posix-specific functions. If there were cross-platform functions in this class, they would be put in a file called <font face="'courier new', monospace">base/waitable_event.cc</font>.</div>
<h4 style="font-size:10pt"><a name="TOC-Complete-platform-implementations-and-callers:-separate-implementations"></a>Complete platform implementations and callers: separate implementations</h4>
<div style="margin-top:0px;margin-bottom:0px">When virtually none of the implementation is shared, implement the class separately for each platform in separate files.</div>
<div style="margin-top:0px;margin-bottom:0px"><br />
</div>
<div style="margin-top:0px;margin-bottom:0px">If all implementations are in a cross-platform directory such as base, they should be named with the platform name, such as <font face="'courier new', monospace">FooBarWin</font> in <font face="'courier new', monospace">base/foo_bar_win.h.</font> This case will generally be rare since files in these cross-platform files are normally designed to be used by cross-platform code, and separate header files makes this impossible. In some places we've defined a commonly named class in different files, so <font face="'courier new', monospace">PlatformDevice</font> is defined in <font face="'courier new', monospace">skia/ext/platform_device_win.h</font>, <font face="'courier new', monospace">skia/ext/platform_device_linux.h</font>, and <font face="'courier new', monospace">skia/ext/platform_device_mac.h</font>. This is OK if you really need to refer to this class in cross-platform code. But generally, cases like this will fall into the following rule.</div>
<div style="margin-top:0px;margin-bottom:0px"><br />
</div>
<div style="margin-top:0px;margin-bottom:0px">If the implementations live in platform-specific directories such as <font face="'courier new', monospace">chrome/browser/ui/cocoa</font> or <font face="'courier new', monospace">chrome/browser/ui/views</font>, there is no chance that the class will be used by cross-platform code. In this case, the classes and filenames should omit the platform name since it would be redundant. So you would have FooBar implemented in <font face="'courier new', monospace">chrome/browser/ui/cocoa/foo_bar.h</font>.</div><div style="margin-top:0px;margin-bottom:0px"><br /></div><div style="margin-top:0px;margin-bottom:0px">Don't create different classes with different names for each platform and typedef it to a shared name. We used to have this for <font face="'courier new', monospace">PlatformCanvas</font>, where it was a typedef of <font face="'courier new', monospace">PlatformCanvasMac</font>, <font face="'courier new', monospace">PlatformCanvasLinux</font>, or <font face="'courier new', monospace">PlatformCanvasWin </font>depending on the platform. This makes it impossible to forward-declare the class, which is an important tool for reducing dependencies.</div>
<h3 style="font-size:12pt"><a name="TOC-When-to-use-virtual-interfaces"></a>When to use virtual interfaces</h3>
<div style="margin-top:0px;margin-bottom:0px">In general, virtual interfaces and factories should not be used for the sole purpose of separating platform differences. Instead, it should be be used to separate interfaces from implementations to make the code better designed. This comes up mostly when implementing the view as separate from the model, as in <font face="'courier new', monospace">TabContentsView</font> or <font face="'courier new', monospace">RenderWidgetHostView</font>. In these cases, it's desirable for the model not to depend on implementation details of the view. In many cases, there will only be one implementation of the view for each platform, but gives cleaner separation and more flexibility in the future.</div>
<div style="margin-top:0px;margin-bottom:0px"><br />
</div>
<div style="margin-top:0px;margin-bottom:0px">In some places like <font face="'courier new', monospace">TabContentsView</font>, the virtual interface has non-virtual functions that do things shared between platforms. Avoid this. If the code is always the same regardless of the view, it probably shouldn't be in the view in the first place.</div>
<h3 style="font-size:12pt"><a name="TOC-Implementing-platform-specific-UI"></a>Implementing platform-specific UI</h3>
<div style="margin-top:0px;margin-bottom:0px">In general, construct platform specific user interface elements from other platform-specific user interface elements. For instance, the views-specific class <font face="'courier new', monospace">BrowserView</font> is responsible for constructing many of the browser dialog boxes. The alternative is to wrap the UI element in a platform-independent interface and construct it from a model via a factory. This is significantly less desirable as it confuses ownership: in most cases of construction by factory, the UI element returned ends up being owned by the model that created it. However in many cases the UI element is most easily managed by the UI framework to which it belongs. For example, a <font face="'courier new', monospace">views::View</font> is owned by its view hierarchy and is automatically deleted when its containing window is destroyed. If you have a dialog box <font face="'courier new', monospace">views::View</font> that implements a platform independent interface that is then owned by another object, the views::View instance now needs to explicitly tell its view hierarchy not to try and manage its lifetime.</div>
<div style="margin-top:0px;margin-bottom:0px"><br />
</div>
<div style="margin-top:0px;margin-bottom:0px">e.g. prefer this:</div>
<div style="margin-top:0px;margin-bottom:0px"><br />
</div>
<blockquote style="margin:0pt 0pt 0pt 40px;border:medium none;padding:0px"><span style="font-family:Courier New,Verdana,sans-serif">// browser.cc:</span><br /><br /><span style="font-family:Courier New,Verdana,sans-serif">Browser::ExecuteCommand(..) {</span><br /><span style="font-family:Courier New,Verdana,sans-serif">  ...</span><br /><span style="font-family:Courier New,Verdana,sans-serif">  case IDC_COMMAND_EDIT_FOO:</span><br /><span style="font-family:Courier New,Verdana,sans-serif">    window()-&gt;ShowFooDialog();</span><br /><span style="font-family:Courier New,Verdana,sans-serif">    break;</span><br /><span style="font-family:Courier New,Verdana,sans-serif">  ...</span><br /><span style="font-family:Courier New,Verdana,sans-serif">}</span><br /><br /><span style="font-family:Courier New,Verdana,sans-serif">// browser_window.h:</span><br /><br /><span style="font-family:Courier New,Verdana,sans-serif">class BrowserWindow {</span><br /><span style="font-family:Courier New,Verdana,sans-serif">...</span><br /><span style="font-family:Courier New,Verdana,sans-serif">  virtual void ShowFooDialog() = 0;</span><br /><span style="font-family:Courier New,Verdana,sans-serif">...</span><br /><span style="font-family:Courier New,Verdana,sans-serif">};</span><br /><br /><span style="font-family:Courier New,Verdana,sans-serif">// browser_view.cc:</span><br /><br /><span style="font-family:Courier New,Verdana,sans-serif">BrowserView::ShowFooDialog() {</span><br /><span style="font-family:Courier New,Verdana,sans-serif">  views::Widget::CreateWindow(new FooDialogView)-&gt;Show();</span><br /><span style="font-family:Courier New,Verdana,sans-serif">}</span><br /><br /><span style="font-family:Courier New,Verdana,sans-serif">// foo_dialog_view.cc:</span><br /><br /><span style="font-family:Courier New,Verdana,sans-serif">// FooDialogView and FooDialogController are automatically cleaned up when the window is closed.</span><br /><span style="font-family:Courier New,Verdana,sans-serif">class FooDialogView : public views::View {</span><br /><span style="font-family:Courier New,Verdana,sans-serif">  ...</span><br /><span style="font-family:Courier New,Verdana,sans-serif"> private:</span><br /><span style="font-family:Courier New,Verdana,sans-serif">  scoped_ptr&lt;FooDialogController&gt; controller_; // Cross-platform state/control logic</span><br /><span style="font-family:Courier New,Verdana,sans-serif">  ...</span><br /><span style="font-family:Courier New,Verdana,sans-serif">}</span></blockquote>
<div style="margin-top:0px;margin-bottom:0px"><br /></div>
<div style="margin-top:0px;margin-bottom:0px">to this:</div>
<div style="margin-top:0px;margin-bottom:0px"><br />
</div>
<blockquote style="margin:0pt 0pt 0pt 40px;border:medium none;padding:0px"><span style="font-family:Courier New,Verdana,sans-serif">// browser.cc:</span><br /><br /><span style="font-family:Courier New,Verdana,sans-serif">Browser::ExecuteCommand(..) {</span><br /><span style="font-family:Courier New,Verdana,sans-serif">  ...</span><br /><span style="font-family:Courier New,Verdana,sans-serif">  case IDC_COMMAND_EDIT_FOO: {</span><br /><span style="font-family:Courier New,Verdana,sans-serif">    FooDialogController::instance()-&gt;ShowUI();</span><br /><span style="font-family:Courier New,Verdana,sans-serif">    break;</span><br /><span style="font-family:Courier New,Verdana,sans-serif">  }</span><br /><span style="font-family:Courier New,Verdana,sans-serif">  ...</span><br /><span style="font-family:Courier New,Verdana,sans-serif">}</span><br /><br /><span style="font-family:Courier New,Verdana,sans-serif">// foo_dialog_controller.h:</span><br /><br /><span style="font-family:Courier New,Verdana,sans-serif">class FooDialog {</span><br /><span style="font-family:Courier New,Verdana,sans-serif"> public:</span><br /><span style="font-family:Courier New,Verdana,sans-serif">  static FooDialog* CreateFooDialog(FooDialogController* controller);</span><br /><span style="font-family:Courier New,Verdana,sans-serif">  virtual void Show() = 0;</span><br /><span style="font-family:Courier New,Verdana,sans-serif">  virtual void Bar() = 0;</span><br /><span style="font-family:Courier New,Verdana,sans-serif">};</span><br /><br /><span style="font-family:Courier New,Verdana,sans-serif">class FooDialogController {</span><br /><span style="font-family:Courier New,Verdana,sans-serif"> public:</span><br /><span style="font-family:Courier New,Verdana,sans-serif">  ...</span><br /><span style="font-family:Courier New,Verdana,sans-serif">  static FooDialogController* instance() {</span><br /><span style="font-family:Courier New,Verdana,sans-serif">    static FooDialogController* instance = NULL;</span><br /><span style="font-family:Courier New,Verdana,sans-serif">    if (!instance)</span><br /><span style="font-family:Courier New,Verdana,sans-serif">      instance = Singleton&lt;FooDialogController&gt;::get();</span><br /><span style="font-family:Courier New,Verdana,sans-serif">    return instance;</span><br /><span style="font-family:Courier New,Verdana,sans-serif">  }</span><br /><span style="font-family:Courier New,Verdana,sans-serif">  ...</span><br /><span style="font-family:Courier New,Verdana,sans-serif"> private:</span><br /><span style="font-family:Courier New,Verdana,sans-serif">  ...</span><br /><span style="font-family:Courier New,Verdana,sans-serif">  void ShowUI() {</span><br /><span style="font-family:Courier New,Verdana,sans-serif">    if (!dialog_.get())</span><br /><span style="font-family:Courier New,Verdana,sans-serif">      dialog_.reset(FooDialog::CreateFooDialog(this));</span><br /><span style="font-family:Courier New,Verdana,sans-serif">    dialog_-&gt;Show();</span><br /><span style="font-family:Courier New,Verdana,sans-serif">  }</span><br /><br /><span style="font-family:Courier New,Verdana,sans-serif">  // Why bother keeping FooDialog or even FooDialogController around?</span><br /><span style="font-family:Courier New,Verdana,sans-serif">  // Most dialogs are very seldom used.</span><br /><span style="font-family:Courier New,Verdana,sans-serif">  scoped_ptr&lt;FooDialog&gt; dialog_;</span><br /><span style="font-family:Courier New,Verdana,sans-serif">};</span><br /><br /><span style="font-family:Courier New,Verdana,sans-serif">// foo_dialog_win.cc:</span><br /><br /><span style="font-family:Courier New,Verdana,sans-serif">class FooDialogView : public views::View,</span><br /><span style="font-family:Courier New,Verdana,sans-serif">                      public FooDialogController {</span><br /><span style="font-family:Courier New,Verdana,sans-serif"> public:</span><br /><span style="font-family:Courier New,Verdana,sans-serif">  ...</span><br /><span style="font-family:Courier New,Verdana,sans-serif">  explicit FooDialogView(FooDialogController* controller) {</span><br /><span style="font-family:Courier New,Verdana,sans-serif">    set_parent_owned(false); // Now necessary due to scoped_ptr in FooDialogController.</span><br /><span style="font-family:Courier New,Verdana,sans-serif">  }</span><br />  ...<br /><span style="font-family:Courier New,Verdana,sans-serif">};</span><br /><br /><span style="font-family:Courier New,Verdana,sans-serif">FooDialog* FooDialog::CreateFooDialog(FooDialogController* controller) {</span><br /><span style="font-family:Courier New,Verdana,sans-serif">  return new FooDialogView(controller);</span><br /><span style="font-family:Courier New,Verdana,sans-serif">}</span></blockquote>
<br />
<div style="margin-top:0px;margin-bottom:0px">Sometimes this latter pattern is necessary, but these occasions are rare, and very well understood by the frontend team. When porting, consider converting cases of the latter model to the former model if the UI element is something simple like a dialog box.</div>
<div><br />
</div>
</div></td></tr></tbody></table>
</div> 
</div> 
<div id="sites-canvas-bottom-panel">
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_page-subpages"> </div>
<div id="sites-attachments-container">
</div>
<a xmlns="http://www.w3.org/1999/xhtml" name="page-comments"></a>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_page-comments"><div class="sites-comment-docos-wrapper"><div class="sites-comment-docos"><div class="sites-comment-docos-background"></div><div class="sites-comment-docos-header"><div class="sites-comment-docos-header-title">Comments</div></div><div id="sites-comment-docos-pane" class="sites-comment-docos-pane"></div></div></div></div>
</div>
</div> 
</td> 
</tr>
</table> 
</div> 
</div> 
<div id="sites-chrome-footer-wrapper">
<div id="sites-chrome-footer-wrapper-inside">
<div id="sites-chrome-footer">
</div>
</div>
</div>
</div> 
</div> 
<div id="sites-chrome-adminfooter-container">
<div xmlns="http://www.w3.org/1999/xhtml" class="sites-adminfooter" role="navigation"><p><a class="sites-system-link" href="https://www.google.com/a/UniversalLogin?service=jotspot&amp;continue=https://sites.google.com/a/chromium.org/dev/developers/design-documents/conventions-and-patterns-for-multi-platform-development">Sign in</a><span aria-hidden="true">|</span><a class="sites-system-link" href="/system/app/pages/recentChanges">Recent Site Activity</a><span aria-hidden="true">|</span><a class="sites-system-link" href="/system/app/pages/reportAbuse" target="_blank">Report Abuse</a><span aria-hidden="true">|</span><a class="sites-system-link" href="javascript:;" onclick="window.open(webspace.printUrl)">Print Page</a><span aria-hidden="true">|</span><span class="sites-system-link">Powered By</span> <b class="powered-by"><a href="http://sites.google.com">Google Sites</a></b></p></div>
</div>
</div> 
</div> 
<div id="sites-chrome-onebar-footer">
</div>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    window.jstiming.load.tick('sjl');
  </script>
<script xmlns="http://www.w3.org/1999/xhtml" src="https://ssl.gstatic.com/sites/p/56e332/system/js/jot_min_view__en.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    window.jstiming.load.tick('jl');
  </script>
<script xmlns="http://www.w3.org/1999/xhtml">
      
          sites.core.Analytics.createTracker();
          sites.core.Analytics.trackPageview();
        
    </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
                    sites.Searchbox.initialize(
                        'sites-searchbox-search-button',
                        {"object":[]}['object'],
                        'search-site',
                        {"label":"Configure search options...","url":"/system/app/pages/admin/settings"});
                  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
      gsites.HoverPopupMenu.createSiteDropdownMenus('sites-header-nav-dropdown', false);
    </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
            JOT_setupNav("7648876402527094", "Navigation", false);
            JOT_addListener('titleChange', 'JOT_NAVIGATION_titleChange', 'COMP_7648876402527094');
          </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
            JOT_setupNav("14720868319272995", "Quick links", false);
            JOT_addListener('titleChange', 'JOT_NAVIGATION_titleChange', 'COMP_14720868319272995');
          </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
            JOT_setupNav("19690813310444355", "Other sites", false);
            JOT_addListener('titleChange', 'JOT_NAVIGATION_titleChange', 'COMP_19690813310444355');
          </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
              new sites.CommentPane('//docs.google.com/comments/d/AAHRpnXvrAwjAfmld0ObrebBiGRq9dDS4x8GZei2YB0EmvXTq_fBJcuRABiJEi7M7oQTaUoLNVd64NaGepht06Y6ogxl6OTncw_3raeH4Qe-9II80kQGQiJDMhLvlCABA4AwRyLT2T5ja/api/js?anon=true',
                  false, false);
            </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
  setTimeout(function() {
    var fingerprint = gsites.date.TimeZone.getFingerprint([]);
    gsites.Xhr.send('https://www.chromium.org/_/tz', null, null, 'GET', null, null, { afjstz: fingerprint });
  }, 500);
</script>
<script xmlns="http://www.w3.org/1999/xhtml">
                    window.onload = function() {
                      if (false) {
                        JOT_setMobilePreview();
                      }
                      var loadTimer = window.jstiming.load;
                      loadTimer.tick("ol");
                      loadTimer["name"] = "load," + webspace.page.type + ",user_page";
                      window.jstiming.report(loadTimer, {}, 'https://gg.google.com/csi');
                    }
                  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
        JOT_insertAnalyticsCode(false,
            false);
      </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    var maestroRunner = new gsites.pages.view.SitesMaestroRunner(
        webspace, "en");
    maestroRunner.initListeners();
    maestroRunner.installEditRender();
  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
  //<![CDATA[
    // Decorate any fastUI buttons on the page with a class of 'goog-button'.
    if (webspace.user.hasWriteAccess) {
      JOT_decorateButtons();
    }

    // Fires delayed events.
    (function() {
      JOT_fullyLoaded = true;
      var delayedEvents = JOT_delayedEvents;
      for (var x = 0; x < delayedEvents.length; x++) {
        var event = delayedEvents[x];
        JOT_postEvent(event.eventName, event.eventSrc, event.payload);
      }
      JOT_delayedEvents = null;
      JOT_postEvent('pageLoaded');
    })();
  //]]>
</script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    JOT_postEvent('decorateGvizCharts');
  </script>
<script type="text/javascript">
          JOT_setupPostRenderingManager();
        </script>
<script type="text/javascript">
          JOT_postEvent('renderPlus', null, 'sites-chrome-main');
        </script>
<div id="server-timer-div" style="display:none"> </div>
<script type="text/javascript">
          window.jstiming.load.tick('render');
          JOT_postEvent('usercontentrendered', this);
        </script>
</body>
</html>
