<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/WebPage">
<head>
<meta http-equiv="X-UA-Compatible" content="chrome=1" />
<script type="text/javascript">/* Copyright 2008 Google. */ (function() { var e="wtsrt_",g="tbsd_",h="tbnd_",k="start",l="_wtsrt",m="_tbnd",n="CSI/";(function(){function f(a){this.t={};this.tick=function(a,c,b){this.t[a]=[void 0!=b?b:(new Date).getTime(),c];if(void 0==b)try{window.console.timeStamp(n+a)}catch(d){}};this.tick(k,null,a)}var a;window.performance&&(a=window.performance.timing);var p=a?new f(a.responseStart):new f;window.jstiming={Timer:f,load:p};if(a){var c=a.navigationStart,d=a.responseStart;0<c&&d>=c&&(window.jstiming.srt=d-c)}if(a){var b=window.jstiming.load;0<c&&d>=c&&(b.tick(l,void 0,c),b.tick(e,l,d),b.tick(g,e))}try{a=null,
window.chrome&&window.chrome.csi&&(a=Math.floor(window.chrome.csi().pageT),b&&0<c&&(b.tick(m,void 0,window.chrome.csi().startE),b.tick(h,m,c))),null==a&&window.gtbExternal&&(a=window.gtbExternal.pageT()),null==a&&window.external&&(a=window.external.pageT,b&&0<c&&(b.tick(m,void 0,window.external.startE),b.tick(h,m,c))),a&&(window.jstiming.pt=a)}catch(q){}})(); })()
</script>
<link rel="shortcut icon" href="/_/rsrc/1354323194313/favicon.ico" type="image/x-icon" />
<link rel="apple-touch-icon" href="http://www.gstatic.com/sites/p/56e332/system/app/images/apple-touch-icon.png" type="image/png" />
<script type="text/javascript">/* Copyright 2008 Google. */ (function() { var d="",g="__duration__",h="function";function k(c){return document.getElementById(c)}window.byId=k;function l(c){return c.replace(/^\s+|\s+$/g,d)}window.trim=l;var m=[],n=0;window.JOT_addListener=function(c,a,b){var e=new String(n++);c={eventName:c,handler:a,compId:b,key:e};m.push(c);return e};window.JOT_removeListenerByKey=function(c){for(var a=0;a<m.length;a++)if(m[a].key==c){m.splice(a,1);break}};
window.JOT_removeAllListenersForName=function(c){for(var a=0;a<m.length;a++)m[a].eventName==c&&m.splice(a,1)};window.JOT_postEvent=function(c,a,b){var e={eventName:c,eventSrc:a||{},payload:b||{}};if(window.JOT_fullyLoaded)for(a=m.length,b=0;b<a&&b<m.length;b++){var f=m[b];f&&f.eventName==c&&(e.listenerCompId=f.compId||d,(f=typeof f.handler==h?f.handler:window[f.handler])&&f(e))}else window.JOT_delayedEvents.push({eventName:c,eventSrc:a,payload:b})};window.JOT_delayedEvents=[];
window.JOT_fullyLoaded=!1;window.JOT_formatRelativeToNow=function(c,a){var b=((new Date).getTime()-c)/6E4;if(1440<=b||0>b)return null;var e=0;60<=b&&(b/=60,e=2);2<=b&&e++;return a?window.JOT_siteRelTimeStrs[e].replace(g,Math.floor(b)):window.JOT_userRelTimeStrs[e].replace(g,Math.floor(b))}; })()
</script>
<script>

  

  var breadcrumbs = [{"path":"/developers","deleted":false,"title":"For Developers","dir":"ltr"},{"path":"/developers/design-documents","deleted":false,"title":"Design Documents","dir":"ltr"},{"path":"/developers/design-documents/sync","deleted":false,"title":"Sync","dir":"ltr"},{"path":"/developers/design-documents/sync/syncable-service-api","deleted":false,"title":"Syncable Service API","dir":"ltr"}];
  var JOT_clearDotPath = 'http://www.gstatic.com/sites/p/56e332/system/app/images/cleardot.gif';

  
  var JOT_userRelTimeStrs = ["a minute ago","__duration__ minutes ago","an hour ago","__duration__ hours ago"];

  
  

  

  var webspace = {"enableAnalytics":true,"pageSharingId":"jotspot_page","enableUniversalAnalytics":false,"sharingPolicy":"OPENED_WITH_INDICATOR","siteTitle":"The Chromium Projects","isStartPageEnabled":true,"adsensePublisherId":null,"features":{"languageSelectDefaultTextSetToDefault":true,"validateClientGvizDataSourceUrls":true,"moreMobileStyleImprovements":true,"newInsertMenuIcons":true,"accessibleSortingButtons":true,"domainAnalyticsInGAOnly":true,"noCaptcha":true,"fileCabinetScreenReaderFix":true,"updatedTosAndPrivacyLinks":null,"pageDrafts":false,"mobileOrientationFix":true,"plusBadge":false,"pdfEmbedSupport":false,"jsClickFix":true},"isPublic":true,"isConsumer":false,"serverFlags":{"cajaBaseUrl":"//www.gstatic.com/caja","cajaDebugMode":false},"onepickBaseUrl":"https://docs.google.com","domainAnalyticsAccountId":"","plusPageId":"","signInUrl":"https://www.google.com/a/SelectSession?continue\u003dhttp://sites.google.com/a/chromium.org/dev/developers/design-documents/sync/syncable-service-api\u0026service\u003djotspot","analyticsAccountId":"UA-5484340-1","scottyUrl":"/_/upload","homePath":"/","siteNoticeUrlEnabled":null,"plusPageUrl":"","adsensePromoClickedOrSiteIneligible":true,"csiReportUri":"http://csi.gstatic.com/csi","sharingId":"jotspot","termsUrl":"//www.google.com/intl/en/policies/terms/","gvizVersion":1,"editorResources":{"sitelayout":["http://www.gstatic.com/sites/p/56e332/system/app/css/sitelayouteditor.css"],"text":["http://www.gstatic.com/sites/p/56e332/system/js/codemirror.js","http://www.gstatic.com/sites/p/56e332/system/app/css/codemirror_css.css","http://www.gstatic.com/sites/p/56e332/system/js/trog_edit__en.js","http://www.gstatic.com/sites/p/56e332/system/app/css/trogedit.css","/_/rsrc/1441580320000/system/app/css/editor.css","http://www.gstatic.com/sites/p/56e332/system/app/css/codeeditor.css","/_/rsrc/1441580320000/system/app/css/camelot/editor-jfk-wlb.css"]},"sharingUrlPrefix":"/_/sharing","isAdsenseEnabled":true,"domain":"chromium.org","baseUri":"","name":"dev","siteTemplateId":false,"siteNoticeRevision":null,"siteNoticeUrlAddress":null,"siteNoticeMessage":null,"page":{"isRtlLocale":false,"canDeleteWebspace":null,"isPageDraft":null,"parentPath":"/developers/design-documents/sync","parentWuid":"wuid:gx:6594e62131fa2821","siteLocale":"en","timeZone":"America/Los_Angeles","type":"text","title":"Syncable Service API","locale":"en","wuid":"wuid:gx:751d1081e998173f","revision":51,"path":"/developers/design-documents/sync/syncable-service-api","isSiteRtlLocale":false,"pageInheritsPermissions":null,"name":"syncable-service-api","canChangePath":true,"state":"","properties":{},"bidiEnabled":false,"currentTemplate":{"path":"/system/app/pagetemplates/text","title":"Web Page"}},"canPublishScriptToAnyone":true,"user":{"keyboardShortcuts":true,"sessionIndex":"","guest_":true,"displayNameOrEmail":"guest","userName":"guest","uid":"","renderMobile":false,"domain":"","namespace":"","hasWriteAccess":false,"namespaceUser":false,"primaryEmail":"guest","hasAdminAccess":false},"gadgets":{"baseUri":"/system/app/pages/gadgets"}};
  webspace.page.breadcrumbs = breadcrumbs;

  
  var JOT_siteRelTimeStrs = ["a minute ago","__duration__ minutes ago","an hour ago","__duration__ hours ago"];

</script>
<script type="text/javascript">
                window.jstiming.load.tick('scl');
              </script>
<meta name="title" content="Syncable Service API - The Chromium Projects" />
<meta itemprop="name" content="Syncable Service API - The Chromium Projects" />
<meta property="og:title" content="Syncable Service API - The Chromium Projects" />
<meta name="description" content="Home of the Chromium Open Source Project" />
<meta itemprop="description" content="Home of the Chromium Open Source Project" />
<meta id="meta-tag-description" property="og:description" content="Home of the Chromium Open Source Project" />
<style type="text/css">
</style>
<link rel="stylesheet" type="text/css" href="http://www.gstatic.com/sites/p/56e332/system/app/themes/beigeandblue/standard-css-beigeandblue-ltr-ltr.css" />
<link rel="stylesheet" type="text/css" href="/_/rsrc/1441580320000/system/app/css/overlay.css?cb=beigeandblueundefineda100%25%25150goog-ws-leftthemedefaultstandard" />
<link rel="stylesheet" type="text/css" href="/_/rsrc/1441580320000/system/app/css/camelot/allthemes-view.css" />
<!--[if IE]>
          <link rel="stylesheet" type="text/css" href="/system/app/css/camelot/allthemes%2die.css" />
        <![endif]-->
<title>Syncable Service API - The Chromium Projects</title>
<meta itemprop="image" content="/_/rsrc/1438879449147/config/customLogo.gif?revision=3" />
<meta property="og:image" content="/_/rsrc/1438879449147/config/customLogo.gif?revision=3" />
<script type="text/javascript">
                window.jstiming.load.tick('cl');
              </script>
</head>
<body xmlns="http://www.google.com/ns/jotspot" id="body" class=" en            ">
<div id="sites-page-toolbar" class="sites-header-divider">
<div xmlns="http://www.w3.org/1999/xhtml" id="sites-status" class="sites-status" style="display:none;"><div id="sites-notice" class="sites-notice" role="status" aria-live="assertive"> </div></div>
</div>
<div id="sites-chrome-everything-scrollbar">
<div id="sites-chrome-everything" class="">
<div id="sites-chrome-page-wrapper" style="direction: ltr">
<div id="sites-chrome-page-wrapper-inside">
<div xmlns="http://www.w3.org/1999/xhtml" id="sites-chrome-header-wrapper" style="height:auto;">
<table id="sites-chrome-header" class="sites-layout-hbox" cellspacing="0" style="height:auto;">
<tr class="sites-header-primary-row" id="sites-chrome-userheader">
<td id="sites-header-title" class="" role="banner"><div class="sites-header-cell-buffer-wrapper"><a href="http://www.chromium.org/" id="sites-chrome-userheader-logo"><img id="logo-img-id" src="/_/rsrc/1438879449147/config/customLogo.gif?revision=3" alt="The Chromium Projects" class="sites-logo  " /></a><h2><a href="http://www.chromium.org/" dir="ltr" id="sites-chrome-userheader-title">The Chromium Projects</a></h2></div></td><td class="sites-layout-searchbox  "><div class="sites-header-cell-buffer-wrapper"><form id="sites-searchbox-form" action="/system/app/pages/search" role="search"><input type="hidden" id="sites-searchbox-scope" name="scope" value="search-site" /><input type="text" id="jot-ui-searchInput" name="q" size="20" value="" aria-label="Search this site" /><div id="sites-searchbox-button-set" class="goog-inline-block"><div role="button" id="sites-searchbox-search-button" class="goog-inline-block jfk-button jfk-button-standard" tabindex="0">Search this site</div></div></form></div></td>
</tr>
<tr class="sites-header-secondary-row" id="sites-chrome-horizontal-nav">
<td colspan="2" id="sites-chrome-header-horizontal-nav-container" role="navigation">
</td>
</tr>
</table>
</div>
<div id="sites-chrome-main-wrapper">
<div id="sites-chrome-main-wrapper-inside">
<table id="sites-chrome-main" class="sites-layout-hbox" cellspacing="0" cellpadding="{scmCellpadding}" border="0">
<tr>
<td id="sites-chrome-sidebar-left" class="sites-layout-sidebar-left initial" style="width:150px">
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_7648876402527094" class="sites-embed" role="navigation"><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotId="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="/chromium-projects" jotId="wuid:gx:10ae433dadbbab13" class="sites-navigation-link">Home</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="/Home" jotId="wuid:gx:43582b9d2029d3af" class="sites-navigation-link">Chromium</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="/chromium-os" jotId="wuid:gx:83df2ab1f8880ba" class="sites-navigation-link">Chromium OS</a></div></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_14720868319272995" class="sites-embed" role="navigation"><h4 class="sites-embed-title">Quick links</h4><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotId="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="http://www.chromium.org/for-testers/bug-reporting-guidelines" class="sites-navigation-link">Report bugs</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="http://www.chromium.org/developers/discussion-groups" class="sites-navigation-link">Discuss</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="/system/app/pages/sitemap/hierarchy" jotId="wuid:gx:fe204a485666144" class="sites-navigation-link">Sitemap</a></div></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_19690813310444355" class="sites-embed" role="navigation"><h4 class="sites-embed-title">Other sites</h4><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotId="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="http://blog.chromium.org/" class="sites-navigation-link">Chromium Blog</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="http://code.google.com/chrome/extensions/" class="sites-navigation-link">Google Chrome Extensions</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="https://developers.google.com/chrome/chrome-frame/" class="sites-navigation-link">Google Chrome Frame</a></div></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_19695218559354544" class="sites-embed" role="complementary"><h4 class="sites-embed-title"></h4><div class="sites-embed-content sites-embed-content-sidebar-textbox"><div dir="ltr"><span style="font-size:x-small">Except as otherwise </span><a href="http://developers.google.com/site-policies.html#restrictions"><span style="font-size:x-small">noted</span></a><span style="font-size:x-small">, the content of this page is licensed under a </span><a href="http://creativecommons.org/licenses/by/2.5/"><span style="font-size:x-small">Creative Commons Attribution 2.5 license</span></a><span style="font-size:x-small">, and examples are licensed under the </span><a href="http://src.chromium.org/viewvc/chrome/trunk/src/LICENSE" target="_blank"><span style="font-size:x-small">BSD License</span></a><span style="font-size:x-small">.<br /></span></div></div></div>
</td>
<td id="sites-canvas-wrapper">
<div id="sites-canvas" role="main">
<div id="goog-ws-editor-toolbar-container"> </div>
<div xmlns="http://www.w3.org/1999/xhtml" id="title-crumbs" style="">
<A href="/developers" dir="ltr">For Developers</A>‎ &gt; ‎<A href="/developers/design-documents" dir="ltr">Design Documents</A>‎ &gt; ‎<A href="/developers/design-documents/sync" dir="ltr">Sync</A>‎ &gt; ‎
  </div>
<h3 xmlns="http://www.w3.org/1999/xhtml" id="sites-page-title-header" style="" align="left">
<span id="sites-page-title" dir="ltr" tabindex="-1" style="outline: none">Syncable Service API</span>
</h3>
<div id="sites-canvas-main" class="sites-canvas-main">
<div id="sites-canvas-main-content">
<table xmlns="http://www.w3.org/1999/xhtml" cellspacing="0" class="sites-layout-name-one-column sites-layout-hbox"><tbody><tr><td class="sites-layout-tile sites-tile-name-content-1"><div dir="ltr"><h3><a name="TOC-http:-go-syncapi-also-see-http:-go-syncapipreso-Googlers-only-but-a-PDF-of-the-presentation-is-attached-to-this-document-"></a><span style="font-weight:normal"><a href="http://go/syncapi" style="color:rgb(0,102,204);outline-style:none;outline-width:initial;outline-color:initial">http://go/syncapi</a> (also, see </span><span style="font-weight:normal"><a href="http://go/syncapipreso" style="color:rgb(0,102,204);outline-style:none;outline-width:initial;outline-color:initial">http://go/syncapipreso</a> [Googlers only, but a PDF of the presentation is attached to this document])</span></h3><h4><a name="TOC-Background"></a>Background</h4><div>As sync continues to expand to handle more data types, the need for an easier and more scalable way for Chrome services to interact with sync is becoming more apparent. This document proposes a new API with the following goals:</div><div><ul><li>A Chrome service should be able to use this API to sync its data without having to know the details of the sync code base and protocol.</li><li>This API should encourage new Chrome services to define its interactions with sync up front.</li><li>The "business logic" for syncing a service's data should live in the service itself.</li></ul><h4><a name="TOC-SyncableService-Interface-and-related-classes"></a>SyncableService Interface and related classes</h4></div><div>First, the message types that Chrome services will use to talk to sync (and vice versa):</div><div><br /></div><div></div><div class="sites-codeblock sites-codesnippet-block"><div><div style="color:rgb(0,0,0);font-family:Arial,Verdana,sans-serif"><span style="color:rgb(0,96,0);font-family:monospace">enum SyncType { BOOKMARKS, PREFERENCES, ... };</span></div></div><div><span style="color:rgb(0,96,0);font-family:monospace"><br /></span></div><div><div style="color:rgb(0,0,0);font-family:Arial,Verdana,sans-serif"><span style="color:rgb(0,96,0);font-family:monospace">class SyncData {</span></div><div style="color:rgb(0,0,0);font-family:Arial,Verdana,sans-serif"><span style="color:rgb(0,96,0);font-family:monospace"> public:</span></div><div style="color:rgb(0,0,0);font-family:Arial,Verdana,sans-serif"><span style="color:rgb(0,96,0);font-family:monospace">  SyncType sync_type();</span></div><div style="color:rgb(0,0,0);font-family:Arial,Verdana,sans-serif"><font color="#006000" face="monospace"><br /></font></div><div style="color:rgb(0,0,0);font-family:Arial,Verdana,sans-serif"><font color="#006000" face="monospace">  // The service-specific data is in a <a href="http://code.google.com/apis/protocolbuffers/docs/proto.html#extensions" style="color:rgb(0,102,204);outline-style:none;outline-width:initial;outline-color:initial">protobuf extension</a> of <a href="http://codesearch.google.com/codesearch/p#OAMlx_jo-ck/src/chrome/browser/sync/protocol/sync.proto&amp;exact_package=chromium" style="color:rgb(0,102,204);outline-style:none;outline-width:initial;outline-color:initial">EntitySpecifics</a></font></div><div style="color:rgb(0,0,0);font-family:Arial,Verdana,sans-serif"><font color="#006000" face="monospace">  // which corresponds to sync_type().</font></div><div style="color:rgb(0,0,0);font-family:Arial,Verdana,sans-serif"><span style="color:rgb(0,96,0);font-family:monospace">  <a href="http://codesearch.google.com/codesearch/p#OAMlx_jo-ck/src/chrome/browser/sync/protocol/sync.proto&amp;exact_package=chromium" style="color:rgb(0,102,204);outline-style:none;outline-width:initial;outline-color:initial">EntitySpecifics</a> specifics();</span></div><div style="color:rgb(0,0,0);font-family:Arial,Verdana,sans-serif"><span style="color:rgb(0,96,0);font-family:monospace">};</span></div></div><div><span style="color:rgb(0,96,0);font-family:monospace"><br /></span></div><div><span style="color:rgb(0,96,0);font-family:monospace">class SyncChange {</span></div><div><span style="color:rgb(0,96,0);font-family:monospace"> public:</span></div><div><span style="color:rgb(0,96,0);font-family:monospace">  enum ChangeType { ADD, UPDATE, DELETE };</span></div><div><font color="#006000" face="monospace"><br /></font></div><div><font color="#006000" face="monospace">  ChangeType change_type();</font></div><div><font color="#006000" face="monospace"><br /></font></div><div><font color="#006000" face="monospace"><div style="color:rgb(0,0,0);font-family:Arial,Verdana,sans-serif"><font color="#006000" face="monospace">  // If change_type is ADD or UPDATE, this contains the new data; </font><span style="color:rgb(0,96,0);font-family:monospace">if</span></div><div style="color:rgb(0,0,0);font-family:Arial,Verdana,sans-serif"><span style="color:rgb(0,96,0);font-family:monospace">  // change_type is DELETE, this contains the data </span><span style="color:rgb(0,96,0);font-family:monospace">right before deletion.</span></div></font></div><div><font color="#006000" face="monospace">  SyncData sync_data();</font></div><div><span style="color:rgb(0,96,0);font-family:monospace">};</span></div><div><code><br /></code></div><div><code>SyncData CreateSyncData(SyncType sync_type, <a href="http://codesearch.google.com/codesearch/p#OAMlx_jo-ck/src/chrome/browser/sync/protocol/sync.proto&amp;exact_package=chromium" style="color:rgb(0,102,204);outline-style:none;outline-width:initial;outline-color:initial">EntitySpecifics</a> specifics);</code></div><div><font color="#006000" face="monospace"><br /></font></div><div><font color="#006000" face="monospace">// |tag| should be a unique data-type specific ID that can be used to</font></div><div><font color="#006000" face="monospace">// prevent duplicate entries for the same object, e.g. for extensions,</font></div><div><font color="#006000" face="monospace">// it would be the extension ID.</font></div><div><code>SyncChange CreateSyncChange(SyncChange::ChangeType type, SyncType sync_type, <a href="http://codesearch.google.com/codesearch/p#OAMlx_jo-ck/src/chrome/browser/sync/protocol/sync.proto&amp;exact_package=chromium">EntitySpecifics</a> specifics, string tag);</code></div></div><div><br /></div><div>Both <code>SyncData</code> and <code>SyncChange</code> are immutable, thread-safe, and cheaply copyable/assignable.</div><div><br /></div><div>Then, the <code>SyncChangeProcessor</code> interface, which is implemented by sync classes (and also by local services<span style="line-height:15px;font-family:arial,sans-serif;font-size:small">—</span>see below):</div><div><div><br /></div><div><div><div class="sites-codeblock sites-codesnippet-block" style="background-color:rgb(239,239,239);border-top-width:1px;border-right-width:1px;border-bottom-width:1px;border-left-width:1px;border-top-style:solid;border-right-style:solid;border-bottom-style:solid;border-left-style:solid;border-top-color:rgb(211,211,211);border-right-color:rgb(211,211,211);border-bottom-color:rgb(211,211,211);border-left-color:rgb(211,211,211);display:block;padding-top:0.5em;padding-right:0px;padding-bottom:0.5em;padding-left:1em;line-height:13px"><div><span style="color:rgb(0,96,0);font-family:monospace">interface SyncChangeProcessor {</span></div><div><span style="color:rgb(0,96,0);font-family:monospace">  void ProcessSyncChanges(SyncType type, vector&lt;SyncChange&gt; changes);</span></div><div><code style="color:rgb(0,96,0)">};</code></div></div></div></div><div><br /></div><div><div>When <code>ProcessSyncChanges</code> is called on a sync class, it processes the given list of sync changes for the given type, which eventually gets propagated to the sync server and then to other clients.</div></div><div><br /></div><div>Finally, the <code style="color:rgb(0,96,0)">SyncableService</code> interface, which Chrome services should implement:</div><div><br /></div><div></div><div class="sites-codeblock sites-codesnippet-block" style="background-color:rgb(239,239,239);border-top-width:1px;border-right-width:1px;border-bottom-width:1px;border-left-width:1px;border-top-style:solid;border-right-style:solid;border-bottom-style:solid;border-left-style:solid;border-top-color:rgb(211,211,211);border-right-color:rgb(211,211,211);border-bottom-color:rgb(211,211,211);border-left-color:rgb(211,211,211);display:block;padding-top:0.5em;padding-right:0px;padding-bottom:0.5em;padding-left:1em;line-height:13px"><div><span style="color:rgb(0,96,0);font-family:monospace">interface SyncableService inherits SyncChangeProcessor {</span></div><div><span style="color:rgb(0,96,0);font-family:monospace">  // Inherited from SyncChangeProcessor.</span></div><div><span style="color:rgb(0,96,0);font-family:monospace"><span style="font-family:Arial,Verdana,sans-serif;color:rgb(0,0,0)"><div><span style="color:rgb(0,96,0);font-family:monospace"><span style="font-family:Arial,Verdana,sans-serif;color:rgb(0,0,0)"><div><span style="color:rgb(0,96,0);font-family:monospace">  void ProcessSyncChanges(SyncType type, vector&lt;SyncChange&gt; changes);</span></div><div><span style="color:rgb(0,96,0);font-family:monospace"><br /></span></div></span></span></div><div><span style="color:rgb(0,96,0);font-family:monospace">  vector&lt;SyncData&gt; GetAllSyncData(SyncType type);</span></div></span></span></div><div><code><div style="color:rgb(0,0,0);font-family:Arial,Verdana,sans-serif"><code style="color:rgb(0,96,0)"><br /></code></div><div style="color:rgb(0,0,0);font-family:Arial,Verdana,sans-serif"><code style="color:rgb(0,96,0)">  bool MergeDataAndStartSyncing(SyncType type, vector&lt;SyncData&gt; sync_data_to_merge, SyncChangeProcessor sync_change_processor);</code></div><div style="color:rgb(0,0,0);font-family:Arial,Verdana,sans-serif"><code style="color:rgb(0,96,0)"><br /></code></div><div style="color:rgb(0,0,0);font-family:Arial,Verdana,sans-serif"><code style="color:rgb(0,96,0)">  void StopSyncing(SyncType type);</code></div><div style="color:rgb(0,0,0);font-family:Arial,Verdana,sans-serif"><span style="color:rgb(0,96,0);font-family:monospace">};</span></div><div style="color:rgb(0,0,0);font-family:Arial,Verdana,sans-serif"><span style="color:rgb(0,96,0);font-family:monospace"><br /></span></div><div style="color:rgb(0,0,0);font-family:Arial,Verdana,sans-serif"><span style="color:rgb(0,96,0);font-family:monospace">interface <a href="http://codesearch.google.com/codesearch/p#OAMlx_jo-ck/src/chrome/browser/profiles/profile_keyed_service.h&amp;exact_package=chromium">ProfileKeyedService</a> inherits SyncableService {</span></div><div style="color:rgb(0,0,0);font-family:Arial,Verdana,sans-serif"><span style="color:rgb(0,96,0);font-family:monospace">  ...</span></div><div style="color:rgb(0,0,0);font-family:Arial,Verdana,sans-serif"><span style="color:rgb(0,96,0);font-family:monospace">};</span></div></code></div></div></div><div><br /></div><div>Some Chrome services map to multiple sync data types, hence the need for a <code>SyncType</code> parameter to all <code>SyncableService</code> methods (e.g., <code>ExtensionService</code> handles both extensions and apps, and <code>WebDataService</code> handles both autofill and autofill profiles).</div><div><br /></div><div>A <code>SyncableService</code> is also a <code>SyncChangeProcessor</code>.  When <code>ProcessSyncChanges</code> is called on a Chrome service, it must process the given list of sync changes for the given type (which came from other clients via the sync server).</div><div><br /></div><div>When <code style="color:rgb(0,96,0)">GetAllSyncData</code> is called, it must return a list of <code style="color:rgb(0,96,0)">SyncData</code>s which represents the currently known local data for the given type.  <code style="color:rgb(0,96,0)">GetAllSyncData</code> may be called at any time, even before syncing starts; it should always return an accurate representation of the local state, as it may be used for diagnostics and verification, e.g. sync may call <code style="color:rgb(0,96,0)">GetAllSyncData</code> after it calls <code style="color:rgb(0,96,0)">StartSync</code> and verify that the local state is equivalent to the remote state.</div><div><br /></div><div>When <code>MergeDataAndStartSyncing</code> is called on a Chrome service, it must do an "initial sync": it must merge <code>sync_data_to_merge</code> with its local data and/or push changes to <code>sync_change_processor</code> such that, after the function returns, the local sync state (i.e., the return value of <code>GetAllSyncData</code>) matches the state represented by <code>sync_data_to_merge</code> plus any changes pushed to <code>sync_change_processor</code>.  It should also store the given <code>sync_change_processor</code> reference and use it to send changes for <code>type</code> until <code>StopSyncing</code> is called for <code>type</code>.</div><div><br /></div><div>A Chrome service can assume that all <code>SyncableService</code> methods are called on the same thread, usually its "native" thread.</div><div><br /></div><div><code>SyncChange</code>s can be assumed to be processed atomically by sync, i.e. a Chrome service will never receive a "partial" <code>SyncChange.</code></div><div><b><br /></b></div><div><code>SyncableService</code> should be a super-interface of <code><a href="http://codesearch.google.com/codesearch/p#OAMlx_jo-ck/src/chrome/browser/profiles/profile_keyed_service.h&amp;exact_package=chromium">ProfileKeyedService</a></code>.  Most Chrome services should implement <code>SyncableService</code>, either directly or via <code>ProfileKeyedService</code>.</div><h4><a name="TOC-How-to-write-a-new-sync-aware-Chrome-service"></a>How to write a new sync-aware Chrome service</h4><div><ol><li><font color="#ff0000"><b>Important</b></font>: Loop in the sync team early!  Send an e-mail to chrome-sync-dev@google.com explaining what you want to sync.  We're happy to help.</li><li>You will need to add your type to the <code>SyncType</code> enum as well define a protobuf to use for your data and make it an <a href="http://code.google.com/apis/protocolbuffers/docs/proto.html#extensions">extension</a> of <a href="http://codesearch.google.com/codesearch/p#OAMlx_jo-ck/src/chrome/browser/sync/protocol/sync.proto&amp;exact_package=chromium">EntitySpecifics</a>.</li><li>Except for some special cases, you will probably need to make your service inherit from <code>ProfileKeyedService</code>.  Make sure your service has one thread (not necessarily the UI thread) that it can use to communicate with sync.</li><li>Write unit tests to:</li><ol><li>Make sure <code>GetAllSyncData</code> accurately reflects your service's state.</li><li>Make sure that <code>ProcessSyncChanges</code> handles <code>SyncChanges</code> intelligently (even erroneous ones).</li><li>Make sure that calling <code>MergeDataAndStartSyncing</code> on an instance of your service with another instance's sync state and a reference to that instance as a <code>SyncChangeProcessor</code> brings both instances to the same state.  In other words, the following should hold:<br /><br /><span style="color:rgb(0,96,0);font-family:monospace;line-height:13px"><div class="sites-codeblock sites-codesnippet-block"><code>SyncType my_sync_type = ...;<br />SyncableService my_service = ...;<br />SyncableService my_other_service = ...;<br />my_service.MergeDataAndStartSyncing(my_sync_type, my_other_service.GetAllSyncData(), my_other_service);<br />EXPECT_EQ(my_service.GetAllSyncData(), my_other_service.GetAllSyncData());</code></div></span><br /></li></ol><li>Write sync integration tests for your service.  See <a href="http://go/syncautomation">http://go/syncautomation</a> for details.</li></ol><h4><a name="TOC-Suggested-migration-for-existing-synced-Chrome-services"></a>Suggested migration for existing synced Chrome services</h4></div><div><ol><li>Make the service "consume" <code>SyncChange</code>s, i.e. implement <code>ProcessSyncChanges</code>.  This most likely involves moving some logic from the change processor to the service itself.</li><li>The change processor is most likely listening to notifications from the service and using the notification's details or querying the service directly to find out what changed.  Make the service "produce" <code>SyncChange</code>s: i.e., when the change processor receives a notification from the service, it should only have to query the service to get one or more <code>SyncChange</code>s to process.  This most likely involves moving the rest of the logic from the change processor to the service itself.</li><li>Make the service inherit from <code>SyncableService</code>; this most likely involves moving the logic from the model associator to <code>MergeDataAndStartSyncing</code>.  The model associator itself can stick around and just call <code>MergeDataAndStartSyncing<span style="font-family:Arial,Verdana,sans-serif;color:rgb(0,0,0)">/</span>StopSyncing</code> from <code>Associate</code>/<code>DisassociateModels</code>.</li></ol></div><h4><a name="TOC-Implementation-Notes"></a>Implementation Notes</h4><div>See the PDF attached for an overview of the Syncable Service API.</div><div><code><br /></code></div><div><code>SyncType</code> should just be <code>syncable::ModelType</code>.</div><div><br /></div><div>Internally, a <code>SyncData</code> will contain a <code>SyncEntity</code> protobuf.  Or rather, a thread-safe ref-counted pointer to an immutable one, so <code>SyncData</code>/<code>SyncChange</code> can be cheaply copyable and passable across threads.  <span style="background-color:rgb(255,255,0)">TODO</span>: We should try to make <code>sync_data.h</code>/<code>sync_change.h</code> not include our protobuf header files.</div><div><br /></div><div>Some special handling is needed for bookmarks; currently, it is the only data type which uses sync's support for hierarchies.  The most practical solution for this is probably to just add bookmark-specific accessors to <code>SyncChange</code> for id, <code>first_child_id</code>, and <code>successor_id</code>.</div><div><br /></div><div>Extensions and apps may need to use sync's support for ordering, i.e. it may also need to use <code>successor_id</code>.</div><div><br /></div><div>There will most likely be one instance per thread of <code>SyncChangeProcessor</code> which handles all the data types which live on that thread.</div><div><br /></div><div>An earlier API proposal by Nicolas Zea is <a href="https://docs.google.com/a/google.com/document/d/1-Ky4lhCTIN_9cTef2zZsIh3pBALQUPj-3Hh2BpPkX20/edit?hl=en">here</a> (available only to Googlers).</div><div><br /></div><div><a href="https://docs.google.com/Doc?docid=0Aa_pnb1d4_gnZDUzOWp4bV80ZDhjeng1ZzU&amp;hl=en">Life of a Sync Item Update</a> is useful for understanding how exactly sync works behind the scenes.</div><h4><a name="TOC-Future-plans"></a>Future plans</h4><div>Support may be added to enable <code>SyncableService</code>s to talk to <b>chrome://sync-internals</b>.  This will most likely involve passing some sort of Javascript bridge object in <code>MergeDataAndStartSyncing</code> that a <code>SyncableService</code> can use to raise events, and/or an additional method in <code>SyncableService</code> to enable it to respond to Javascript queries.</div></div></td></tr></tbody></table>
</div> 
</div> 
<div id="sites-canvas-bottom-panel">
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_page-subpages"> </div>
<div id="sites-attachments-container">
<div xmlns="http://www.w3.org/1999/xhtml" id="sites-attachments">
<div class="sites-attachments-row"><div class="sites-attachments-icon" style="left:0px;"><span aria-label="Attachments" title="Attachments"><div class="sites-translucent sites-symbol" aria-hidden="true">Č</div></span></div><div id="sites-attachments-update-div" class="sites-attachments-inner-div" style="display:none;"><span class="sites-attachments-update-icon"><img src="http://www.gstatic.com/sites/p/56e332/system/app/images/spinner.gif" /></span><div class="sites-attachments-update-text">Updating...</div></div></div><div class="sites-attachments-separator"></div>
<div id="attachment-wuid:gx:6355410e0555079d"><div class="sites-attachments-row"><div class="sites-attachments-icon sites-attachments-icon-accessible" style="left:5px"><span class="sites-symbol sites-color-adobe-pdf" aria-label="Adobe PDF" title="Adobe PDF">Ċ</span></div><div class="sites-attachments-inner-div"><div class="sites-attachments-name"><a href="http://docs.google.com/viewer?a=v&amp;pid=sites&amp;srcid=Y2hyb21pdW0ub3JnfGRldnxneDo2MzU1NDEwZTA1NTUwNzlk">SyncAPI.pdf</a> <div class="sites-translucent">(563k)</div></div><div class="sites-attachments-author">Nicolas Zea, <div class="sites-translucent">May 24, 2011, 3:22 PM</div></div></div><div class="sites-attachments-version sites-attachments-version-accessible"><a href="/system/app/pages/admin/revisions?wuid=wuid:gx:6355410e0555079d">v.1</a></div><div id="attachment-download-wuid:gx:6355410e0555079d" class="sites-attachments-icon sites-attachments-icon-accessible" style="right:0px"><a href="/developers/design-documents/sync/syncable-service-api/SyncAPI.pdf?attredirects=0&amp;d=1" aria-label="Download SyncAPI.pdf" title="Download" role="button"><span class="sites-symbol" aria-hidden="true">ď</span></a></div></div><div class="sites-attachments-separator"></div></div>
<div style="height: 10px"></div>
</div>
</div>
<a xmlns="http://www.w3.org/1999/xhtml" name="page-comments"></a>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_page-comments"><div class="sites-comment-docos-wrapper"><div class="sites-comment-docos"><div class="sites-comment-docos-background"></div><div class="sites-comment-docos-header"><div class="sites-comment-docos-header-title">Comments</div></div><div id="sites-comment-docos-pane" class="sites-comment-docos-pane"></div></div></div></div>
</div>
</div> 
</td> 
</tr>
</table> 
</div> 
</div> 
<div id="sites-chrome-footer-wrapper">
<div id="sites-chrome-footer-wrapper-inside">
<div id="sites-chrome-footer">
</div>
</div>
</div>
</div> 
</div> 
<div id="sites-chrome-adminfooter-container">
<div xmlns="http://www.w3.org/1999/xhtml" class="sites-adminfooter" role="navigation"><p><a class="sites-system-link" href="https://www.google.com/a/UniversalLogin?service=jotspot&amp;continue=http://sites.google.com/a/chromium.org/dev/developers/design-documents/sync/syncable-service-api">Sign in</a><span aria-hidden="true">|</span><a class="sites-system-link" href="/system/app/pages/recentChanges">Recent Site Activity</a><span aria-hidden="true">|</span><a class="sites-system-link" href="/system/app/pages/reportAbuse" target="_blank">Report Abuse</a><span aria-hidden="true">|</span><a class="sites-system-link" href="javascript:;" onclick="window.open(webspace.printUrl)">Print Page</a><span aria-hidden="true">|</span><span class="sites-system-link">Powered By</span> <b class="powered-by"><a href="http://sites.google.com">Google Sites</a></b></p></div>
</div>
</div> 
</div> 
<div id="sites-chrome-onebar-footer">
</div>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    window.jstiming.load.tick('sjl');
  </script>
<script xmlns="http://www.w3.org/1999/xhtml" src="http://www.gstatic.com/sites/p/56e332/system/js/jot_min_view__en.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    window.jstiming.load.tick('jl');
  </script>
<script xmlns="http://www.w3.org/1999/xhtml">
      
          sites.core.Analytics.createTracker();
          sites.core.Analytics.trackPageview();
        
    </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
                    sites.Searchbox.initialize(
                        'sites-searchbox-search-button',
                        {"object":[]}['object'],
                        'search-site',
                        {"label":"Configure search options...","url":"/system/app/pages/admin/settings"});
                  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
      gsites.HoverPopupMenu.createSiteDropdownMenus('sites-header-nav-dropdown', false);
    </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
            JOT_setupNav("7648876402527094", "Navigation", false);
            JOT_addListener('titleChange', 'JOT_NAVIGATION_titleChange', 'COMP_7648876402527094');
          </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
            JOT_setupNav("14720868319272995", "Quick links", false);
            JOT_addListener('titleChange', 'JOT_NAVIGATION_titleChange', 'COMP_14720868319272995');
          </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
            JOT_setupNav("19690813310444355", "Other sites", false);
            JOT_addListener('titleChange', 'JOT_NAVIGATION_titleChange', 'COMP_19690813310444355');
          </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
              new sites.CommentPane('//docs.google.com/comments/d/AAHRpnXvrAwjAfmld0ObrebBiGRq9k0Dav54dkxks37zrnMVg1jBiZDqDAUi1d_iJHFY6_qTewF5i-d_KxSCm7x3IH0KexI653nMfes4q7yT8loxX-o-__o4v6h3QODiZAlJ1lWbV3P9n/api/js?anon=true',
                  false, false);
            </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
  setTimeout(function() {
    var fingerprint = gsites.date.TimeZone.getFingerprint([]);
    gsites.Xhr.send('http://www.chromium.org/_/tz', null, null, 'GET', null, null, { afjstz: fingerprint });
  }, 500);
</script>
<script xmlns="http://www.w3.org/1999/xhtml">
                    window.onload = function() {
                      if (false) {
                        JOT_setMobilePreview();
                      }
                      var loadTimer = window.jstiming.load;
                      loadTimer.tick("ol");
                      loadTimer["name"] = "load," + webspace.page.type + ",user_page";
                      window.jstiming.report(loadTimer, {}, 'http://csi.gstatic.com/csi');
                    }
                  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
        JOT_insertAnalyticsCode(false,
            false);
      </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    var maestroRunner = new gsites.pages.view.SitesMaestroRunner(
        webspace, "en");
    maestroRunner.initListeners();
    maestroRunner.installEditRender();
  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
  //<![CDATA[
    // Decorate any fastUI buttons on the page with a class of 'goog-button'.
    if (webspace.user.hasWriteAccess) {
      JOT_decorateButtons();
    }

    // Fires delayed events.
    (function() {
      JOT_fullyLoaded = true;
      var delayedEvents = JOT_delayedEvents;
      for (var x = 0; x < delayedEvents.length; x++) {
        var event = delayedEvents[x];
        JOT_postEvent(event.eventName, event.eventSrc, event.payload);
      }
      JOT_delayedEvents = null;
      JOT_postEvent('pageLoaded');
    })();
  //]]>
</script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    JOT_postEvent('decorateGvizCharts');
  </script>
<script type="text/javascript">
          JOT_setupPostRenderingManager();
        </script>
<script type="text/javascript">
          JOT_postEvent('renderPlus', null, 'sites-chrome-main');
        </script>
<div id="server-timer-div" style="display:none"> </div>
<script type="text/javascript">
          window.jstiming.load.tick('render');
          JOT_postEvent('usercontentrendered', this);
        </script>
</body>
</html>
