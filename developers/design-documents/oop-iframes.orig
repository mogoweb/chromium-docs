<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/WebPage">
<head>
<meta http-equiv="X-UA-Compatible" content="chrome=1" />
<script type="text/javascript">/* Copyright 2008 Google. */ (function() { var e="wtsrt_",g="tbsd_",h="tbnd_",k="start",l="_wtsrt",m="_tbnd",n="CSI/";(function(){function f(a){this.t={};this.tick=function(a,c,b){this.t[a]=[void 0!=b?b:(new Date).getTime(),c];if(void 0==b)try{window.console.timeStamp(n+a)}catch(d){}};this.tick(k,null,a)}var a;window.performance&&(a=window.performance.timing);var p=a?new f(a.responseStart):new f;window.jstiming={Timer:f,load:p};if(a){var c=a.navigationStart,d=a.responseStart;0<c&&d>=c&&(window.jstiming.srt=d-c)}if(a){var b=window.jstiming.load;0<c&&d>=c&&(b.tick(l,void 0,c),b.tick(e,l,d),b.tick(g,e))}try{a=null,
window.chrome&&window.chrome.csi&&(a=Math.floor(window.chrome.csi().pageT),b&&0<c&&(b.tick(m,void 0,window.chrome.csi().startE),b.tick(h,m,c))),null==a&&window.gtbExternal&&(a=window.gtbExternal.pageT()),null==a&&window.external&&(a=window.external.pageT,b&&0<c&&(b.tick(m,void 0,window.external.startE),b.tick(h,m,c))),a&&(window.jstiming.pt=a)}catch(q){}})(); })()
</script>
<link rel="shortcut icon" href="/_/rsrc/1354323194313/favicon.ico" type="image/x-icon" />
<link rel="apple-touch-icon" href="http://www.gstatic.com/sites/p/56e332/system/app/images/apple-touch-icon.png" type="image/png" />
<script type="text/javascript">/* Copyright 2008 Google. */ (function() { var d="",g="__duration__",h="function";function k(c){return document.getElementById(c)}window.byId=k;function l(c){return c.replace(/^\s+|\s+$/g,d)}window.trim=l;var m=[],n=0;window.JOT_addListener=function(c,a,b){var e=new String(n++);c={eventName:c,handler:a,compId:b,key:e};m.push(c);return e};window.JOT_removeListenerByKey=function(c){for(var a=0;a<m.length;a++)if(m[a].key==c){m.splice(a,1);break}};
window.JOT_removeAllListenersForName=function(c){for(var a=0;a<m.length;a++)m[a].eventName==c&&m.splice(a,1)};window.JOT_postEvent=function(c,a,b){var e={eventName:c,eventSrc:a||{},payload:b||{}};if(window.JOT_fullyLoaded)for(a=m.length,b=0;b<a&&b<m.length;b++){var f=m[b];f&&f.eventName==c&&(e.listenerCompId=f.compId||d,(f=typeof f.handler==h?f.handler:window[f.handler])&&f(e))}else window.JOT_delayedEvents.push({eventName:c,eventSrc:a,payload:b})};window.JOT_delayedEvents=[];
window.JOT_fullyLoaded=!1;window.JOT_formatRelativeToNow=function(c,a){var b=((new Date).getTime()-c)/6E4;if(1440<=b||0>b)return null;var e=0;60<=b&&(b/=60,e=2);2<=b&&e++;return a?window.JOT_siteRelTimeStrs[e].replace(g,Math.floor(b)):window.JOT_userRelTimeStrs[e].replace(g,Math.floor(b))}; })()
</script>
<script>

  

  var breadcrumbs = [{"path":"/developers","deleted":false,"title":"For Developers","dir":"ltr"},{"path":"/developers/design-documents","deleted":false,"title":"Design Documents","dir":"ltr"},{"path":"/developers/design-documents/oop-iframes","deleted":false,"title":"Design Plans for Out-of-Process iframes","dir":"ltr"}];
  var JOT_clearDotPath = 'http://www.gstatic.com/sites/p/56e332/system/app/images/cleardot.gif';

  
  var JOT_userRelTimeStrs = ["a minute ago","__duration__ minutes ago","an hour ago","__duration__ hours ago"];

  
  

  

  var webspace = {"enableAnalytics":true,"pageSharingId":"jotspot_page","enableUniversalAnalytics":false,"sharingPolicy":"OPENED_WITH_INDICATOR","siteTitle":"The Chromium Projects","isStartPageEnabled":true,"adsensePublisherId":null,"features":{"languageSelectDefaultTextSetToDefault":true,"validateClientGvizDataSourceUrls":true,"moreMobileStyleImprovements":true,"newInsertMenuIcons":true,"accessibleSortingButtons":true,"domainAnalyticsInGAOnly":true,"noCaptcha":true,"fileCabinetScreenReaderFix":true,"updatedTosAndPrivacyLinks":null,"pageDrafts":false,"mobileOrientationFix":true,"plusBadge":false,"pdfEmbedSupport":false,"jsClickFix":true},"isPublic":true,"isConsumer":false,"serverFlags":{"cajaBaseUrl":"//www.gstatic.com/caja","cajaDebugMode":false},"onepickBaseUrl":"https://docs.google.com","domainAnalyticsAccountId":"","plusPageId":"","signInUrl":"https://www.google.com/a/SelectSession?continue\u003dhttp://sites.google.com/a/chromium.org/dev/developers/design-documents/oop-iframes\u0026service\u003djotspot","analyticsAccountId":"UA-5484340-1","scottyUrl":"/_/upload","homePath":"/","siteNoticeUrlEnabled":null,"plusPageUrl":"","adsensePromoClickedOrSiteIneligible":true,"csiReportUri":"http://csi.gstatic.com/csi","sharingId":"jotspot","termsUrl":"//www.google.com/intl/en/policies/terms/","gvizVersion":1,"editorResources":{"sitelayout":["http://www.gstatic.com/sites/p/56e332/system/app/css/sitelayouteditor.css"],"text":["http://www.gstatic.com/sites/p/56e332/system/js/codemirror.js","http://www.gstatic.com/sites/p/56e332/system/app/css/codemirror_css.css","http://www.gstatic.com/sites/p/56e332/system/js/trog_edit__en.js","http://www.gstatic.com/sites/p/56e332/system/app/css/trogedit.css","/_/rsrc/1441580320000/system/app/css/editor.css","http://www.gstatic.com/sites/p/56e332/system/app/css/codeeditor.css","/_/rsrc/1441580320000/system/app/css/camelot/editor-jfk-wlb.css"]},"sharingUrlPrefix":"/_/sharing","isAdsenseEnabled":true,"domain":"chromium.org","baseUri":"","name":"dev","siteTemplateId":false,"siteNoticeRevision":null,"siteNoticeUrlAddress":null,"siteNoticeMessage":null,"page":{"isRtlLocale":false,"canDeleteWebspace":null,"isPageDraft":null,"parentPath":"/developers/design-documents","parentWuid":"wuid:gx:359ef223e0fb14ac","siteLocale":"en","timeZone":"America/Los_Angeles","type":"text","title":"Design Plans for Out-of-Process iframes","locale":"en","wuid":"wuid:gx:2595d8142f0e6966","revision":23,"path":"/developers/design-documents/oop-iframes","isSiteRtlLocale":false,"pageInheritsPermissions":null,"name":"oop-iframes","canChangePath":true,"state":"","properties":{},"bidiEnabled":false,"currentTemplate":{"path":"/system/app/pagetemplates/text","title":"Web Page"}},"canPublishScriptToAnyone":true,"user":{"keyboardShortcuts":true,"sessionIndex":"","guest_":true,"displayNameOrEmail":"guest","userName":"guest","uid":"","renderMobile":false,"domain":"","namespace":"","hasWriteAccess":false,"namespaceUser":false,"primaryEmail":"guest","hasAdminAccess":false},"gadgets":{"baseUri":"/system/app/pages/gadgets"}};
  webspace.page.breadcrumbs = breadcrumbs;

  
  var JOT_siteRelTimeStrs = ["a minute ago","__duration__ minutes ago","an hour ago","__duration__ hours ago"];

</script>
<script type="text/javascript">
                window.jstiming.load.tick('scl');
              </script>
<meta name="title" content="Design Plans for Out-of-Process iframes - The Chromium Projects" />
<meta itemprop="name" content="Design Plans for Out-of-Process iframes - The Chromium Projects" />
<meta property="og:title" content="Design Plans for Out-of-Process iframes - The Chromium Projects" />
<meta name="description" content="Home of the Chromium Open Source Project" />
<meta itemprop="description" content="Home of the Chromium Open Source Project" />
<meta id="meta-tag-description" property="og:description" content="Home of the Chromium Open Source Project" />
<style type="text/css">
</style>
<link rel="stylesheet" type="text/css" href="http://www.gstatic.com/sites/p/56e332/system/app/themes/beigeandblue/standard-css-beigeandblue-ltr-ltr.css" />
<link rel="stylesheet" type="text/css" href="/_/rsrc/1441580320000/system/app/css/overlay.css?cb=beigeandblueundefineda100%25%25150goog-ws-leftthemedefaultstandard" />
<link rel="stylesheet" type="text/css" href="/_/rsrc/1441580320000/system/app/css/camelot/allthemes-view.css" />
<!--[if IE]>
          <link rel="stylesheet" type="text/css" href="/system/app/css/camelot/allthemes%2die.css" />
        <![endif]-->
<title>Design Plans for Out-of-Process iframes - The Chromium Projects</title>
<meta itemprop="image" content="http://www.chromium.org/_/rsrc/1366228626421/developers/design-documents/oop-iframes/Cross%20Process%20Tabs%20%28for%20posting%29.png?height=329&amp;width=400" />
<meta property="og:image" content="http://www.chromium.org/_/rsrc/1366228626421/developers/design-documents/oop-iframes/Cross%20Process%20Tabs%20%28for%20posting%29.png?height=329&amp;width=400" />
<script type="text/javascript">
                window.jstiming.load.tick('cl');
              </script>
</head>
<body xmlns="http://www.google.com/ns/jotspot" id="body" class=" en            ">
<div id="sites-page-toolbar" class="sites-header-divider">
<div xmlns="http://www.w3.org/1999/xhtml" id="sites-status" class="sites-status" style="display:none;"><div id="sites-notice" class="sites-notice" role="status" aria-live="assertive"> </div></div>
</div>
<div id="sites-chrome-everything-scrollbar">
<div id="sites-chrome-everything" class="">
<div id="sites-chrome-page-wrapper" style="direction: ltr">
<div id="sites-chrome-page-wrapper-inside">
<div xmlns="http://www.w3.org/1999/xhtml" id="sites-chrome-header-wrapper" style="height:auto;">
<table id="sites-chrome-header" class="sites-layout-hbox" cellspacing="0" style="height:auto;">
<tr class="sites-header-primary-row" id="sites-chrome-userheader">
<td id="sites-header-title" class="" role="banner"><div class="sites-header-cell-buffer-wrapper"><a href="http://www.chromium.org/" id="sites-chrome-userheader-logo"><img id="logo-img-id" src="/_/rsrc/1438879449147/config/customLogo.gif?revision=3" alt="The Chromium Projects" class="sites-logo  " /></a><h2><a href="http://www.chromium.org/" dir="ltr" id="sites-chrome-userheader-title">The Chromium Projects</a></h2></div></td><td class="sites-layout-searchbox  "><div class="sites-header-cell-buffer-wrapper"><form id="sites-searchbox-form" action="/system/app/pages/search" role="search"><input type="hidden" id="sites-searchbox-scope" name="scope" value="search-site" /><input type="text" id="jot-ui-searchInput" name="q" size="20" value="" aria-label="Search this site" /><div id="sites-searchbox-button-set" class="goog-inline-block"><div role="button" id="sites-searchbox-search-button" class="goog-inline-block jfk-button jfk-button-standard" tabindex="0">Search this site</div></div></form></div></td>
</tr>
<tr class="sites-header-secondary-row" id="sites-chrome-horizontal-nav">
<td colspan="2" id="sites-chrome-header-horizontal-nav-container" role="navigation">
</td>
</tr>
</table>
</div>
<div id="sites-chrome-main-wrapper">
<div id="sites-chrome-main-wrapper-inside">
<table id="sites-chrome-main" class="sites-layout-hbox" cellspacing="0" cellpadding="{scmCellpadding}" border="0">
<tr>
<td id="sites-chrome-sidebar-left" class="sites-layout-sidebar-left initial" style="width:150px">
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_7648876402527094" class="sites-embed" role="navigation"><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotId="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="/chromium-projects" jotId="wuid:gx:10ae433dadbbab13" class="sites-navigation-link">Home</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="/Home" jotId="wuid:gx:43582b9d2029d3af" class="sites-navigation-link">Chromium</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="/chromium-os" jotId="wuid:gx:83df2ab1f8880ba" class="sites-navigation-link">Chromium OS</a></div></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_14720868319272995" class="sites-embed" role="navigation"><h4 class="sites-embed-title">Quick links</h4><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotId="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="http://www.chromium.org/for-testers/bug-reporting-guidelines" class="sites-navigation-link">Report bugs</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="http://www.chromium.org/developers/discussion-groups" class="sites-navigation-link">Discuss</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="/system/app/pages/sitemap/hierarchy" jotId="wuid:gx:fe204a485666144" class="sites-navigation-link">Sitemap</a></div></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_19690813310444355" class="sites-embed" role="navigation"><h4 class="sites-embed-title">Other sites</h4><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotId="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="http://blog.chromium.org/" class="sites-navigation-link">Chromium Blog</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="http://code.google.com/chrome/extensions/" class="sites-navigation-link">Google Chrome Extensions</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="https://developers.google.com/chrome/chrome-frame/" class="sites-navigation-link">Google Chrome Frame</a></div></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_19695218559354544" class="sites-embed" role="complementary"><h4 class="sites-embed-title"></h4><div class="sites-embed-content sites-embed-content-sidebar-textbox"><div dir="ltr"><span style="font-size:x-small">Except as otherwise </span><a href="http://developers.google.com/site-policies.html#restrictions"><span style="font-size:x-small">noted</span></a><span style="font-size:x-small">, the content of this page is licensed under a </span><a href="http://creativecommons.org/licenses/by/2.5/"><span style="font-size:x-small">Creative Commons Attribution 2.5 license</span></a><span style="font-size:x-small">, and examples are licensed under the </span><a href="http://src.chromium.org/viewvc/chrome/trunk/src/LICENSE" target="_blank"><span style="font-size:x-small">BSD License</span></a><span style="font-size:x-small">.<br /></span></div></div></div>
</td>
<td id="sites-canvas-wrapper">
<div id="sites-canvas" role="main">
<div id="goog-ws-editor-toolbar-container"> </div>
<div xmlns="http://www.w3.org/1999/xhtml" id="title-crumbs" style="">
<A href="/developers" dir="ltr">For Developers</A>‎ &gt; ‎<A href="/developers/design-documents" dir="ltr">Design Documents</A>‎ &gt; ‎
  </div>
<h3 xmlns="http://www.w3.org/1999/xhtml" id="sites-page-title-header" style="" align="left">
<span id="sites-page-title" dir="ltr" tabindex="-1" style="outline: none">Design Plans for Out-of-Process iframes</span>
</h3>
<div id="sites-canvas-main" class="sites-canvas-main">
<div id="sites-canvas-main-content">
<table xmlns="http://www.w3.org/1999/xhtml" cellspacing="0" class="sites-layout-name-one-column sites-layout-hbox"><tbody><tr><td class="sites-layout-tile sites-tile-name-content-1"><div dir="ltr"><span style="font-size:10pt">This page provides high level information on our plans to support out-of-process iframes (OOPIF) in Chromium, as part of the </span><a href="http://www.chromium.org/developers/design-documents/site-isolation" style="font-size:10pt">Site Isolation project</a><span style="font-size:10pt">.  The work is tracked in issue <a href="https://crbug.com/99379">https://crbug.com/99379</a>.</span><br /><br />Many parts of Chromium's architecture will need to change to support rendering and interacting with a frame in a different process from its parent page.  Our intended changes include keeping track of frames in multiple processes, routing certain script calls between processes, supporting cross-process navigations in frames, rendering and compositing frames in multiple processes, and sending input events to the correct processes.<br /><div><br /></div><div><div><div class="sites-embed-align-left-wrapping-off"><div class="sites-embed-border-off sites-embed" style="width:250px;"><div class="sites-embed-content sites-embed-type-toc"><div class="goog-toc sites-embed-toc-maxdepth-6"><p>Contents</p><ol class="goog-toc"><li class="goog-toc"><a href="#TOC-Frame-Representation"><strong>1 </strong>Frame Representation</a><ol class="goog-toc"><li class="goog-toc"><a href="#TOC-Background"><strong>1.1 </strong>Background</a></li><li class="goog-toc"><a href="#TOC-Browser-Process"><strong>1.2 </strong>Browser Process</a></li><li class="goog-toc"><a href="#TOC-Renderer-Process"><strong>1.3 </strong>Renderer Process</a></li><li class="goog-toc"><a href="#TOC-Inside-Blink"><strong>1.4 </strong>Inside Blink</a></li></ol></li><li class="goog-toc"><a href="#TOC-Navigation"><strong>2 </strong>Navigation</a></li><li class="goog-toc"><a href="#TOC-Rendering"><strong>3 </strong>Rendering</a></li><li class="goog-toc"><a href="#TOC-Input-Events"><strong>4 </strong>Input Events</a></li><li class="goog-toc"><a href="#TOC-Development-Resources"><strong>5 </strong>Development Resources</a></li><li class="goog-toc"><a href="#TOC-Discussions-Questions"><strong>6 </strong>Discussions/Questions</a></li></ol></div></div></div></div></div><br /><h2><a name="TOC-Frame-Representation"></a>Frame Representation</h2>Much of Chromium's tab-level logic is moving to the frame level, since each frame may be rendered by different processes over its lifetime.<br /><div><h3><a name="TOC-Background"></a>Background</h3><div style="font-size:10pt"></div><div><div style="display:inline;margin:5px 10px;float:right"><a href="http://www.chromium.org/developers/design-documents/oop-iframes/Cross%20Process%20Tabs%20%28for%20posting%29.png?attredirects=0" imageanchor="1"><img border="0" height="329" src="http://www.chromium.org/_/rsrc/1366228626421/developers/design-documents/oop-iframes/Cross%20Process%20Tabs%20%28for%20posting%29.png?height=329&amp;width=400" width="400" /></a></div>In general, documents that have script references to each other need to either live in the same process (if they are same-site) or have a way to route messages to each other (if they are cross-site).  Chromium manages these relationships by putting all documents that can reference each other in the same BrowsingInstance, and by grouping all of a BrowsingInstance's documents into SiteInstances based on site (as described on the <a href="http://www.chromium.org/developers/design-documents/process-models">Process Models</a> page).  BrowsingInstances often contain only a single tab, but they can include multiple tabs when a page uses window.open or targeted links.  Note that BrowsingInstances are not related to the number of tabs in a window, since tabs created manually are in their own BrowsingInstance.</div><div><br /></div><div>To support cross-process interactions like postMessage, Chromium must keep a proxy version of the document's DOMWindow in each of the other processes of its BrowsingInstance, as a placeholder.  As shown in the diagram at right, this allows a document from site A to find a proxy DOMWindow in its own process for a tab that is currently active on site B.  The proxy DOMWindow can then forward the postMessage call to the browser and then to the correct document in the process for site B.</div></div><div><br />With out-of-process iframes, Chromium needs to keep track of proxy DOMWindows for subframes as well as main frames.<br /><h3><a name="TOC-Browser-Process"></a>Browser Process</h3><div>In the browser process, Chromium must keep track of the full frame tree for each tab.  WebContents will host a tree of FrameTreeNode objects, mirroring the frame tree of the current page.  Each FrameTreeNode will contain frame-specific information (e.g., the frame's name).  It will be responsible for cross-process navigations in the frame, and it will support routing messages from other processes to the active frame.</div><h3><a name="TOC-Renderer-Process"></a>Renderer Process</h3><div>In each renderer process, Chromium must keep track of proxy DOMWindows for each frame in the BrowsingInstance, allowing JavaScript code to find frames and send messages to them.  We aim to minimize the overhead for each of the proxy DOMWindows by not having a document or widget for them.</div><div><br /></div><div>We plan to pull the frame-specific logic out of the content module's RenderView and RenderViewHost classes, into new RenderFrame and RenderFrameHost classes.  These new classes will allocate their own routing ids, so IPC messages can be targeted to specific frames. We will have a full RenderFrame for every active frame, regardless of process, and we will have a corresponding, slimmed down RenderFrameProxy as a placeholder in the other processes of the BrowsingInstance.  These proxies are shown with dashed lines in the diagram below, which shows one BrowsingInstance with two tabs, containing two subframes each.</div></div><div><br /><div style="display:block;text-align:center;margin-right:auto;margin-left:auto"><a href="http://www.chromium.org/developers/design-documents/oop-iframes/Frame%20Trees%20%28for%20posting%29.png?attredirects=0" imageanchor="1"><img border="0" src="http://www.chromium.org/_/rsrc/1364927955953/developers/design-documents/oop-iframes/Frame%20Trees%20%28for%20posting%29.png" /></a></div><br /><br /><h3><a name="TOC-Inside-Blink"></a>Inside Blink</h3><span style="font-size:10pt"><div></div></span><div><span style="font-size:10pt;background-color:transparent"><div></div><div style="display:inline;float:right;margin:5px 10px"></div><div style="display:inline;margin:5px 10px;float:right"><a href="http://www.chromium.org/developers/design-documents/oop-iframes/Local%20vs%20Remote%20Frame%20diagram.png?attredirects=0" imageanchor="1"><img border="0" height="265" src="http://www.chromium.org/_/rsrc/1427221335765/developers/design-documents/oop-iframes/Local%20vs%20Remote%20Frame%20diagram.png?height=265&amp;width=320" width="320" /></a></div>There are now local frames where all the state is in process, and remote frames that are proxies to act on frames that are rendered in other processes. The original <font face="courier new, monospace">Frame</font><font face="arial, sans-serif"> </font>/ <font face="courier new, monospace">DOMWindow</font> classes have been renamed to <font face="courier new, monospace">LocalFrame</font> / <font face="courier new, monospace">LocalDOMWindow</font>. The corresponding classes for remote frames are named <font face="courier new, monospace">RemoteFrame</font> / <font face="courier new, monospace">RemoteDOMWindow</font>.  </span><span style="font-size:10pt;background-color:transparent">It is important to note that remote frames and remote DOM windows have very little state: in general, the only state maintained in the remote proxy objects is data needed to service synchronous operations. For example, a remote DOM window does <b>not</b> have a <font face="courier new, monospace">Document</font> object.</span></div><div><span style="font-size:10pt;background-color:transparent"><br /></span></div><div><span style="font-size:10pt;background-color:transparent">Both <font face="courier new, monospace">LocalFrame</font> and <font face="courier new, monospace">RemoteFrame</font> inherit from a new interface, Frame, which represents operations that are valid on both local and remote frames. It is possible to downcast from <font face="courier new, monospace">Frame</font> to <font face="courier new, monospace">LocalFrame</font>, but having to do this usually indicates that the code structure is suboptimal for OOPIF. </span><span style="font-size:13.3333330154419px;background-color:transparent">In the blink API layer (Source/web), there are also corresponding <font face="courier new, monospace">WebLocalFrame</font> / <font face="courier new, monospace">WebRemoteFrame</font> / <font face="courier new, monospace">WebFrame</font> classes. <font face="courier new, monospace">content::RenderFrame</font> is responsible for managing a <font face="courier new, monospace">WebLocalFrame</font>, while <font face="courier new, monospace">content::RemoteFrameProxy</font> is responsible for managing a <font face="courier new, monospace">WebRemoteFrame</font>. </span></div><div><span style="font-size:13.3333330154419px;background-color:transparent"><br /></span></div><div><span style="font-size:13.3333330154419px;background-color:transparent">In addition, Blink has the ability to swap any frame in the frame tree between the local and remote versions. Generally, the process of swapping frames should not be observable, but it's worth mentioning, because it will allow the current <font face="courier new, monospace">content::RenderView</font> swap out logic to be removed. The current swap out implementation is tricky to understand, and prone to bugs: code incorrectly assumed that a <font face="courier new, monospace">content::RenderViewHost</font> would never change, it required IPC filtering to make sure a swapped out page didn't try to do something funny, etc.</span></div><div><br /></div><div>Finally, the <a href="https://developer.chrome.com/apps/tags/webview"><font face="courier new, monospace">&lt;webview&gt;</font></a> implementation is being migrated to work on top of this new infrastructure. For the most part, Blink code will be able to treat a <font face="courier new, monospace">&lt;webview&gt;</font> similar to an <font face="courier new, monospace">&lt;iframe&gt;</font> However, there is one important difference: the parent frame of the root frame in an <font face="courier new, monospace">&lt;iframe&gt;</font> is the document that contains the <font face="courier new, monospace">&lt;iframe&gt;</font> element. The root frame of a <font face="courier new, monospace">&lt;webview&gt;</font> has <b>no</b> parent and is itself a main frame.  It will likely live in a separate frame tree.</div><div><br /></div><div style="font-size:13.3333330154419px">These changes have several major implications for Blink:</div><div><ul><li><font face="courier new, monospace">Page</font>'s main frame may be local <b>or</b> remote. There are a number of places that assume that main frame will always be local: for example, the current drag and drop implementation always uses the main frame's event handler to perform hit-testing. This will need to change.</li><li>As a generalization of the previous point, <b>any</b> given frame in the frame tree may be remote. Thus, code like the web page serializer, which currently depends on iterating through all the frames in one process to generate the saved web page, will need to be rewritten.</li><li>Layout / rendering was formerly coordinated by the main frame. This (and other code like this) needs to change to use a new concept<span style="font-size:10pt;background-color:transparent">: the </span><i style="font-size:10pt;background-color:transparent">local frame root</i><span style="font-size:10pt;background-color:transparent">. The local frame root for a given <font face="courier new, monospace">LocalFrame</font> A is the highest level <font face="courier new, monospace">LocalFrame</font> that is a part of a contiguous <font face="courier new, monospace">LocalFrame</font> subtree that includes frame A. In code form:<br /><font face="courier new, monospace">    LocalFrame* localRootFor(LocalFrame* frame) {<br /></font><span style="font-size:10pt;background-color:transparent"><font face="courier new, monospace">        LocalFrame* local_root = frame;<br />        while (local_root &amp;&amp; local_root-&gt;parent()-&gt;isLocalFrame())<br />            local_root = toLocalFrame(local_root-&gt;parent());<br /></font></span></span><span style="font-family:courier new,monospace;font-size:10pt;background-color:transparent">        return local_root;<br /></span><span style="font-size:10pt;background-color:transparent"><font face="courier new, monospace">    }<br /></font></span><span style="font-size:10pt;background-color:transparent">These contiguous </span><font face="courier new, monospace" style="font-size:10pt;background-color:transparent">LocalFrame</font><span style="font-size:10pt;background-color:transparent"> subtrees are important in Blink because they synchronously get layout, paint, event routing, etc.</span></li></ul></div><div><span style="font-size:13.3333330154419px;background-color:transparent">Some further information on the refactoring goals can be found in the </span><a href="http://www.chromium.org/developers/design-documents/oop-iframes/framehandle" style="font-size:13.3333330154419px;background-color:transparent">FrameHandle design doc</a><span style="font-size:10pt;background-color:transparent">, however that is largely obsolete.</span></div><div><br /></div><div>Note: We are attempting to minimize the memory requirements of these swapped out RemoteFrames and RemoteDOMWindows, because there will be many more than in Chromium today.  Today, the space required is O(tabs * processes) within a BrowsingInstance, and most BrowsingInstances only contain 1 or 2 tabs.  This new model would require O(frames * processes) space.  This could be much higher, because the number of frames can be much larger than the number of tabs, and because the number of processes will increase based on cross-site frames.  Fortunately, RemoteFrames require far less memory than LocalFrames, and not all cross-site iframes will require separate processes.</div><div><span style="font-family:arial,sans-serif;font-size:small"><br /></span></div><h2><a name="TOC-Navigation"></a>Navigation</h2>Chromium will add support for cross-process navigations within subframes. Rather than letting the renderer process intercept the navigation and decide if the browser process should handle it, all navigations will be intercepted in the browser process's network stack. If the navigation crosses a site boundary that requires isolation (according to our Site Isolation policy), the browser process will be able to swap the frame's renderer process. This can be done because the browser process knows the full frame tree, as described above. Implementing this requires adapting TransferNavigationResourceThrottle into CrossSiteResourceHandler and making sufficient information available on the IO thread to make process swap decisions.  This work was tracked in issue <a href="https://crbug.com/238331">https://crbug.com/238331</a>.</div><div><br />A tab's session history also becomes more complicated when subframes may be rendered by different processes.  Currently, Blink takes care of tracking the frame tree in each HistoryItem in the renderer process, and the browser process just tracks each back/forward entry using NavigationEntry.  We will remove the frame tracking logic from Blink's HistoryController and keep track of each frame's navigations in the browser process directly.<br /><br />We will also change the representation of a tab's session history to more closely match the HTML5 spec.  Rather than cloning the frame tree for each HistoryItem, we will keep track of each frame's session history separately in the browser process, and we will use a separate "joint session history" list for back and forward navigations.  Each entry in this list will have a tree of pointers to each frame's corresponding session history item.  We expect this to require changes to the session restore logic as well.</div><div><br /></div><div>All details of navigation refactoring are described in a <a href="https://docs.google.com/document/d/1Z-24Xmb5A00eMSfaBB5MQLTrp9LQ5hm3GKMfpFi44fQ/edit">design document</a>.</div><div><h2><a name="TOC-1"></a><div><font size="2"><span style="font-weight:normal"><br /></span></font></div></h2></div><div><h2><a name="TOC-Rendering"></a>Rendering</h2><span style="font-size:10pt">To render an iframe in a different process than its parent frame, the browser process will pass information back and forth between the renderer processes and help the GPU process composite the images together in the correct sizes and locations.  We expect to use the <a href="http://www.chromium.org/developers/design-documents/chromium-graphics/surfaces">Surfaces</a> implementation to maintain a set of textures from multiple renderer processes, compositing them into a single output image.</span><br /><br />The design for rendering is encapsulated in a <a href="http://www.chromium.org/developers/design-documents/oop-iframes/oop-iframes-rendering">separate document</a>.<br /><br /><h2><a name="TOC-Input-Events"></a>Input Events</h2><span style="font-size:10pt">We are continuing to investigate the changes required to support hit testing and delivering input events to the correct iframe process without having to ask multiple renderer processes.  As with rendering, we expect to use the <a href="http://www.chromium.org/developers/design-documents/chromium-graphics/surfaces">Surfaces</a> implementation to do hit testing in the browser process to deliver input events directly to the intended frame's renderer process.  We also need to manage focus in the browser process to send keyboard events directly to the renderer process of the focused frame.</span></div><div><br /></div></div><div><br /></div><div><h2><a name="TOC-Development-Resources"></a><b>Development Resources</b></h2><div style="font-size:13.3333330154419px"><ul><li><a href="https://docs.google.com/document/d/1Iqe_CzFVA6hyxe7h2bUKusxsjB6frXfdAYLerM3JjPo/edit?usp=sharing">Feature Update FAQ for Out-of-Process iframes</a></li><li><a href="https://docs.google.com/document/d/1dCR2aEoBJj_Yqcs6GuM7lUPr0gag77L5OSgDa8bebsI/edit?usp=sharing">Features to Update for Out-of-Process iframes</a></li></ul></div></div><div><h3><a name="TOC-2"></a><br /></h3><h2><a name="TOC-Discussions-Questions"></a>Discussions/Questions</h2><div>The mailing list for technical discussions on Site Isolations and Out-of-Process iframes is <a href="mailto:site-isolation-dev@chromium.org" style="color:rgb(17,85,204);font-family:arial,sans-serif;line-height:21px" target="_blank">site-isolation-dev@chromium.org</a>.</div></div></div></td></tr></tbody></table>
</div> 
</div> 
<div id="sites-canvas-bottom-panel">
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_page-subpages" class="sites-canvas-bottom-panel-wrapper" style="">
<div class="sites-subpages">
            Subpages <span id="subpages-total-number">(2):</span>
<span>
<a href="/developers/design-documents/oop-iframes/framehandle" dir="ltr">FrameHandle</a>
</span>
<span>
<a href="/developers/design-documents/oop-iframes/oop-iframes-rendering" dir="ltr">Rendering and compositing out of process iframes</a>
</span>
</div>
</div>
<div id="sites-attachments-container">
</div>
<a xmlns="http://www.w3.org/1999/xhtml" name="page-comments"></a>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_page-comments"><div class="sites-comment-docos-wrapper"><div class="sites-comment-docos"><div class="sites-comment-docos-background"></div><div class="sites-comment-docos-header"><div class="sites-comment-docos-header-title">Comments</div></div><div id="sites-comment-docos-pane" class="sites-comment-docos-pane"></div></div></div></div>
</div>
</div> 
</td> 
</tr>
</table> 
</div> 
</div> 
<div id="sites-chrome-footer-wrapper">
<div id="sites-chrome-footer-wrapper-inside">
<div id="sites-chrome-footer">
</div>
</div>
</div>
</div> 
</div> 
<div id="sites-chrome-adminfooter-container">
<div xmlns="http://www.w3.org/1999/xhtml" class="sites-adminfooter" role="navigation"><p><a class="sites-system-link" href="https://www.google.com/a/UniversalLogin?service=jotspot&amp;continue=http://sites.google.com/a/chromium.org/dev/developers/design-documents/oop-iframes">Sign in</a><span aria-hidden="true">|</span><a class="sites-system-link" href="/system/app/pages/recentChanges">Recent Site Activity</a><span aria-hidden="true">|</span><a class="sites-system-link" href="/system/app/pages/reportAbuse" target="_blank">Report Abuse</a><span aria-hidden="true">|</span><a class="sites-system-link" href="javascript:;" onclick="window.open(webspace.printUrl)">Print Page</a><span aria-hidden="true">|</span><span class="sites-system-link">Powered By</span> <b class="powered-by"><a href="http://sites.google.com">Google Sites</a></b></p></div>
</div>
</div> 
</div> 
<div id="sites-chrome-onebar-footer">
</div>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    window.jstiming.load.tick('sjl');
  </script>
<script xmlns="http://www.w3.org/1999/xhtml" src="http://www.gstatic.com/sites/p/56e332/system/js/jot_min_view__en.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    window.jstiming.load.tick('jl');
  </script>
<script xmlns="http://www.w3.org/1999/xhtml">
      
          sites.core.Analytics.createTracker();
          sites.core.Analytics.trackPageview();
        
    </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
                    sites.Searchbox.initialize(
                        'sites-searchbox-search-button',
                        {"object":[]}['object'],
                        'search-site',
                        {"label":"Configure search options...","url":"/system/app/pages/admin/settings"});
                  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
      gsites.HoverPopupMenu.createSiteDropdownMenus('sites-header-nav-dropdown', false);
    </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
            JOT_setupNav("7648876402527094", "Navigation", false);
            JOT_addListener('titleChange', 'JOT_NAVIGATION_titleChange', 'COMP_7648876402527094');
          </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
            JOT_setupNav("14720868319272995", "Quick links", false);
            JOT_addListener('titleChange', 'JOT_NAVIGATION_titleChange', 'COMP_14720868319272995');
          </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
            JOT_setupNav("19690813310444355", "Other sites", false);
            JOT_addListener('titleChange', 'JOT_NAVIGATION_titleChange', 'COMP_19690813310444355');
          </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
              new sites.CommentPane('//docs.google.com/comments/d/AAHRpnXvrAwjAfmld0ObrebBiGRq9SUD29YfEp5-JcI3mlypJhyPlU8u6Xi2awrwBVnk-y0HVehWFzW8dD_VDDbm464LYbwrxra0Jfl3kk9pZxbH3ysWPPBpTNazmB3VbNzObHgu9FhWy/api/js?anon=true',
                  false, false);
            </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
  setTimeout(function() {
    var fingerprint = gsites.date.TimeZone.getFingerprint([]);
    gsites.Xhr.send('http://www.chromium.org/_/tz', null, null, 'GET', null, null, { afjstz: fingerprint });
  }, 500);
</script>
<script xmlns="http://www.w3.org/1999/xhtml">
                    window.onload = function() {
                      if (false) {
                        JOT_setMobilePreview();
                      }
                      var loadTimer = window.jstiming.load;
                      loadTimer.tick("ol");
                      loadTimer["name"] = "load," + webspace.page.type + ",user_page";
                      window.jstiming.report(loadTimer, {}, 'http://csi.gstatic.com/csi');
                    }
                  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
        JOT_insertAnalyticsCode(false,
            false);
      </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    var maestroRunner = new gsites.pages.view.SitesMaestroRunner(
        webspace, "en");
    maestroRunner.initListeners();
    maestroRunner.installEditRender();
  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
  //<![CDATA[
    // Decorate any fastUI buttons on the page with a class of 'goog-button'.
    if (webspace.user.hasWriteAccess) {
      JOT_decorateButtons();
    }

    // Fires delayed events.
    (function() {
      JOT_fullyLoaded = true;
      var delayedEvents = JOT_delayedEvents;
      for (var x = 0; x < delayedEvents.length; x++) {
        var event = delayedEvents[x];
        JOT_postEvent(event.eventName, event.eventSrc, event.payload);
      }
      JOT_delayedEvents = null;
      JOT_postEvent('pageLoaded');
    })();
  //]]>
</script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    JOT_postEvent('decorateGvizCharts');
  </script>
<script type="text/javascript">
          JOT_setupPostRenderingManager();
        </script>
<script type="text/javascript">
          JOT_postEvent('renderPlus', null, 'sites-chrome-main');
        </script>
<div id="server-timer-div" style="display:none"> </div>
<script type="text/javascript">
          window.jstiming.load.tick('render');
          JOT_postEvent('usercontentrendered', this);
        </script>
</body>
</html>
