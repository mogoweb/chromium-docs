<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/WebPage">
<head>
<meta http-equiv="X-UA-Compatible" content="chrome=1" />
<script type="text/javascript">/* Copyright 2008 Google. */ (function() { var e="wtsrt_",g="tbsd_",h="tbnd_",k="start",l="_wtsrt",m="_tbnd",n="CSI/";(function(){function f(a){this.t={};this.tick=function(a,c,b){this.t[a]=[void 0!=b?b:(new Date).getTime(),c];if(void 0==b)try{window.console.timeStamp(n+a)}catch(d){}};this.tick(k,null,a)}var a;window.performance&&(a=window.performance.timing);var p=a?new f(a.responseStart):new f;window.jstiming={Timer:f,load:p};if(a){var c=a.navigationStart,d=a.responseStart;0<c&&d>=c&&(window.jstiming.srt=d-c)}if(a){var b=window.jstiming.load;0<c&&d>=c&&(b.tick(l,void 0,c),b.tick(e,l,d),b.tick(g,e))}try{a=null,
window.chrome&&window.chrome.csi&&(a=Math.floor(window.chrome.csi().pageT),b&&0<c&&(b.tick(m,void 0,window.chrome.csi().startE),b.tick(h,m,c))),null==a&&window.gtbExternal&&(a=window.gtbExternal.pageT()),null==a&&window.external&&(a=window.external.pageT,b&&0<c&&(b.tick(m,void 0,window.external.startE),b.tick(h,m,c))),a&&(window.jstiming.pt=a)}catch(q){}})(); })()
</script>
<link rel="shortcut icon" href="../../_/rsrc/1354323194313/favicon.ico" type="image/x-icon" />
<link rel="apple-touch-icon" href="https://ssl.gstatic.com/sites/p/56e332/system/app/images/apple-touch-icon.png" type="image/png" />
<script type="text/javascript">/* Copyright 2008 Google. */ (function() { var d="",g="__duration__",h="function";function k(c){return document.getElementById(c)}window.byId=k;function l(c){return c.replace(/^\s+|\s+$/g,d)}window.trim=l;var m=[],n=0;window.JOT_addListener=function(c,a,b){var e=new String(n++);c={eventName:c,handler:a,compId:b,key:e};m.push(c);return e};window.JOT_removeListenerByKey=function(c){for(var a=0;a<m.length;a++)if(m[a].key==c){m.splice(a,1);break}};
window.JOT_removeAllListenersForName=function(c){for(var a=0;a<m.length;a++)m[a].eventName==c&&m.splice(a,1)};window.JOT_postEvent=function(c,a,b){var e={eventName:c,eventSrc:a||{},payload:b||{}};if(window.JOT_fullyLoaded)for(a=m.length,b=0;b<a&&b<m.length;b++){var f=m[b];f&&f.eventName==c&&(e.listenerCompId=f.compId||d,(f=typeof f.handler==h?f.handler:window[f.handler])&&f(e))}else window.JOT_delayedEvents.push({eventName:c,eventSrc:a,payload:b})};window.JOT_delayedEvents=[];
window.JOT_fullyLoaded=!1;window.JOT_formatRelativeToNow=function(c,a){var b=((new Date).getTime()-c)/6E4;if(1440<=b||0>b)return null;var e=0;60<=b&&(b/=60,e=2);2<=b&&e++;return a?window.JOT_siteRelTimeStrs[e].replace(g,Math.floor(b)):window.JOT_userRelTimeStrs[e].replace(g,Math.floor(b))}; })()
</script>
<script>

  

  var breadcrumbs = [{"path":"/developers","deleted":false,"title":"For Developers","dir":"ltr"},{"path":"/developers/design-documents","deleted":false,"title":"Design Documents","dir":"ltr"},{"path":"/developers/design-documents/os-x-password-manager-keychain-integration","deleted":false,"title":"OS X Password Manager/Keychain Integration","dir":"ltr"}];
  var JOT_clearDotPath = 'https://ssl.gstatic.com/sites/p/56e332/system/app/images/cleardot.gif';

  
  var JOT_userRelTimeStrs = ["a minute ago","__duration__ minutes ago","an hour ago","__duration__ hours ago"];

  
  

  

  var webspace = {"enableAnalytics":true,"pageSharingId":"jotspot_page","enableUniversalAnalytics":false,"sharingPolicy":"OPENED_WITH_INDICATOR","siteTitle":"The Chromium Projects","isStartPageEnabled":true,"adsensePublisherId":null,"features":{"languageSelectDefaultTextSetToDefault":true,"validateClientGvizDataSourceUrls":true,"moreMobileStyleImprovements":true,"newInsertMenuIcons":true,"accessibleSortingButtons":true,"domainAnalyticsInGAOnly":true,"noCaptcha":true,"fileCabinetScreenReaderFix":true,"updatedTosAndPrivacyLinks":null,"pageDrafts":false,"mobileOrientationFix":true,"plusBadge":false,"pdfEmbedSupport":false,"jsClickFix":true},"isPublic":true,"isConsumer":false,"serverFlags":{"cajaBaseUrl":"//www.gstatic.com/caja","cajaDebugMode":false},"onepickBaseUrl":"https://docs.google.com","domainAnalyticsAccountId":"","plusPageId":"","signInUrl":"https://www.google.com/a/SelectSession?continue\u003dhttps://sites.google.com/a/chromium.org/dev/developers/design-documents/os-x-password-manager-keychain-integration\u0026service\u003djotspot","analyticsAccountId":"UA-5484340-1","scottyUrl":"/_/upload","homePath":"/","siteNoticeUrlEnabled":null,"plusPageUrl":"","adsensePromoClickedOrSiteIneligible":true,"csiReportUri":"https://gg.google.com/csi","sharingId":"jotspot","termsUrl":"//www.google.com/intl/en/policies/terms/","gvizVersion":1,"editorResources":{"sitelayout":["https://ssl.gstatic.com/sites/p/56e332/system/app/css/sitelayouteditor.css"],"text":["https://ssl.gstatic.com/sites/p/56e332/system/js/codemirror.js","https://ssl.gstatic.com/sites/p/56e332/system/app/css/codemirror_css.css","https://ssl.gstatic.com/sites/p/56e332/system/js/trog_edit__en.js","https://ssl.gstatic.com/sites/p/56e332/system/app/css/trogedit.css","/_/rsrc/1441580320000/system/app/css/editor.css","https://ssl.gstatic.com/sites/p/56e332/system/app/css/codeeditor.css","/_/rsrc/1441580320000/system/app/css/camelot/editor-jfk-wlb.css"]},"sharingUrlPrefix":"/_/sharing","isAdsenseEnabled":true,"domain":"chromium.org","baseUri":"","name":"dev","siteTemplateId":false,"siteNoticeRevision":null,"siteNoticeUrlAddress":null,"siteNoticeMessage":null,"page":{"isRtlLocale":false,"canDeleteWebspace":null,"isPageDraft":null,"parentPath":"/developers/design-documents","parentWuid":"wuid:gx:359ef223e0fb14ac","siteLocale":"en","timeZone":"America/Los_Angeles","type":"text","title":"OS X Password Manager/Keychain Integration","locale":"en","wuid":"wuid:gx:74390b0c8f8e64c1","revision":2,"path":"/developers/design-documents/os-x-password-manager-keychain-integration","isSiteRtlLocale":false,"pageInheritsPermissions":null,"name":"os-x-password-manager-keychain-integration","canChangePath":true,"state":"","properties":{},"bidiEnabled":false,"currentTemplate":{"path":"/system/app/pagetemplates/text","title":"Web Page"}},"canPublishScriptToAnyone":true,"user":{"keyboardShortcuts":true,"sessionIndex":"","guest_":true,"displayNameOrEmail":"guest","userName":"guest","uid":"","renderMobile":false,"domain":"","namespace":"","hasWriteAccess":false,"namespaceUser":false,"primaryEmail":"guest","hasAdminAccess":false},"gadgets":{"baseUri":"/system/app/pages/gadgets"}};
  webspace.page.breadcrumbs = breadcrumbs;

  
  var JOT_siteRelTimeStrs = ["a minute ago","__duration__ minutes ago","an hour ago","__duration__ hours ago"];

</script>
<script type="text/javascript">
                window.jstiming.load.tick('scl');
              </script>
<meta name="title" content="OS X Password Manager/Keychain Integration - The Chromium Projects" />
<meta itemprop="name" content="OS X Password Manager/Keychain Integration - The Chromium Projects" />
<meta property="og:title" content="OS X Password Manager/Keychain Integration - The Chromium Projects" />
<meta name="description" content="Home of the Chromium Open Source Project" />
<meta itemprop="description" content="Home of the Chromium Open Source Project" />
<meta id="meta-tag-description" property="og:description" content="Home of the Chromium Open Source Project" />
<style type="text/css">
</style>
<link rel="stylesheet" type="text/css" href="https://ssl.gstatic.com/sites/p/56e332/system/app/themes/beigeandblue/standard-css-beigeandblue-ltr-ltr.css" />
<link rel="stylesheet" type="text/css" href="../../_/rsrc/1441580320000/system/app/css/overlay.css%3Fcb=beigeandblueundefineda100%2525%2525150goog-ws-leftthemedefaultstandard.css" />
<link rel="stylesheet" type="text/css" href="../../_/rsrc/1441580320000/system/app/css/camelot/allthemes-view.css" />
<!--[if IE]>
          <link rel="stylesheet" type="text/css" href="/system/app/css/camelot/allthemes%2die.css" />
        <![endif]-->
<title>OS X Password Manager/Keychain Integration - The Chromium Projects</title>
<meta itemprop="image" content="/_/rsrc/1438879449147/config/customLogo.gif?revision=3" />
<meta property="og:image" content="/_/rsrc/1438879449147/config/customLogo.gif?revision=3" />
<script type="text/javascript">
                window.jstiming.load.tick('cl');
              </script>
</head>
<body xmlns="http://www.google.com/ns/jotspot" id="body" class=" en            ">
<div id="sites-page-toolbar" class="sites-header-divider">
<div xmlns="http://www.w3.org/1999/xhtml" id="sites-status" class="sites-status" style="display:none;"><div id="sites-notice" class="sites-notice" role="status" aria-live="assertive"> </div></div>
</div>
<div id="sites-chrome-everything-scrollbar">
<div id="sites-chrome-everything" class="">
<div id="sites-chrome-page-wrapper" style="direction: ltr">
<div id="sites-chrome-page-wrapper-inside">
<div xmlns="http://www.w3.org/1999/xhtml" id="sites-chrome-header-wrapper" style="height:auto;">
<table id="sites-chrome-header" class="sites-layout-hbox" cellspacing="0" style="height:auto;">
<tr class="sites-header-primary-row" id="sites-chrome-userheader">
<td id="sites-header-title" class="" role="banner"><div class="sites-header-cell-buffer-wrapper"><a href="../../index.html" id="sites-chrome-userheader-logo"><img id="logo-img-id" src="../../_/rsrc/1438879449147/config/customLogo.gif%3Frevision=3" alt="The Chromium Projects" class="sites-logo  " /></a><h2><a href="../../index.html" dir="ltr" id="sites-chrome-userheader-title">The Chromium Projects</a></h2></div></td><td class="sites-layout-searchbox  "><div class="sites-header-cell-buffer-wrapper"><form id="sites-searchbox-form" action="https://www.chromium.org/system/app/pages/search" role="search"><input type="hidden" id="sites-searchbox-scope" name="scope" value="search-site" /><input type="text" id="jot-ui-searchInput" name="q" size="20" value="" aria-label="Search this site" /><div id="sites-searchbox-button-set" class="goog-inline-block"><div role="button" id="sites-searchbox-search-button" class="goog-inline-block jfk-button jfk-button-standard" tabindex="0">Search this site</div></div></form></div></td>
</tr>
<tr class="sites-header-secondary-row" id="sites-chrome-horizontal-nav">
<td colspan="2" id="sites-chrome-header-horizontal-nav-container" role="navigation">
</td>
</tr>
</table>
</div>
<div id="sites-chrome-main-wrapper">
<div id="sites-chrome-main-wrapper-inside">
<table id="sites-chrome-main" class="sites-layout-hbox" cellspacing="0" cellpadding="{scmCellpadding}" border="0">
<tr>
<td id="sites-chrome-sidebar-left" class="sites-layout-sidebar-left initial" style="width:150px">
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_7648876402527094" class="sites-embed" role="navigation"><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotId="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="../../chromium-projects.html" jotId="wuid:gx:10ae433dadbbab13" class="sites-navigation-link">Home</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="../../Home.1.html" jotId="wuid:gx:43582b9d2029d3af" class="sites-navigation-link">Chromium</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="../../chromium-os.1.html" jotId="wuid:gx:83df2ab1f8880ba" class="sites-navigation-link">Chromium OS</a></div></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_14720868319272995" class="sites-embed" role="navigation"><h4 class="sites-embed-title">Quick links</h4><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotId="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="../../for-testers/bug-reporting-guidelines.html" class="sites-navigation-link">Report bugs</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="../discussion-groups.html" class="sites-navigation-link">Discuss</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="../../system/app/pages/sitemap/hierarchy.html" jotId="wuid:gx:4b58a9a350ad12f" class="sites-navigation-link">网站地图</a></div></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_19690813310444355" class="sites-embed" role="navigation"><h4 class="sites-embed-title">Other sites</h4><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotId="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="http://blog.chromium.org/" class="sites-navigation-link">Chromium Blog</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="http://code.google.com/chrome/extensions/" class="sites-navigation-link">Google Chrome Extensions</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="https://developers.google.com/chrome/chrome-frame/" class="sites-navigation-link">Google Chrome Frame</a></div></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_19695218559354544" class="sites-embed" role="complementary"><h4 class="sites-embed-title"></h4><div class="sites-embed-content sites-embed-content-sidebar-textbox"><div dir="ltr"><span style="font-size:x-small">Except as otherwise </span><a href="http://developers.google.com/site-policies.html#restrictions"><span style="font-size:x-small">noted</span></a><span style="font-size:x-small">, the content of this page is licensed under a </span><a href="http://creativecommons.org/licenses/by/2.5/"><span style="font-size:x-small">Creative Commons Attribution 2.5 license</span></a><span style="font-size:x-small">, and examples are licensed under the </span><a href="http://src.chromium.org/viewvc/chrome/trunk/src/LICENSE" target="_blank"><span style="font-size:x-small">BSD License</span></a><span style="font-size:x-small">.<br /></span></div></div></div>
</td>
<td id="sites-canvas-wrapper">
<div id="sites-canvas" role="main">
<div id="goog-ws-editor-toolbar-container"> </div>
<div xmlns="http://www.w3.org/1999/xhtml" id="title-crumbs" style="">
<A href="../../developers.1.html" dir="ltr">For Developers</A>‎ &gt; ‎<A href="../design-documents.1.html" dir="ltr">Design Documents</A>‎ &gt; ‎
  </div>
<h3 xmlns="http://www.w3.org/1999/xhtml" id="sites-page-title-header" style="" align="left">
<span id="sites-page-title" dir="ltr" tabindex="-1" style="outline: none">OS X Password Manager/Keychain Integration</span>
</h3>
<div id="sites-canvas-main" class="sites-canvas-main">
<div id="sites-canvas-main-content">
<table xmlns="http://www.w3.org/1999/xhtml" cellspacing="0" class="sites-layout-name-one-column sites-layout-hbox"><tbody><tr><td class="sites-layout-tile sites-tile-name-content-1"><div dir="ltr"><span style="font-family:Verdana,sans-serif"><h3 style="font-size:12pt;text-align:left"><a name="TOC-Background"></a>Background</h3><div style="margin-top:0px;margin-bottom:0px">The Mac Keychain provides a shared, secure storage implementation that includes API specifically for storing various types of web passwords (web forms, HTTP auth, etc.). The platform expectation is that we should store our passwords there, providing interoperability with other browsers (with the exception of Firefox), rather than simply using it a private secure-storage mechanism.</div><h3 style="font-size:12pt"><a name="TOC-Storage"></a>Storage</h3><div style="margin-top:0px;margin-bottom:0px">Because the Keychain schema is limited, and is not extensible, we cannot use it as the sole storage mechanism—most notably we would lose the "action" field, without which we have dramatically different user experience for security reasons. This means we need our own (non-secure) storage for extra information. Because Keychain entries don't have a stable, unique identifier, and don't have a field we can use for adding an identifier for our own record, they must be paired by matching across multiple fields.</div><div style="margin-top:0px;margin-bottom:0px"><br /></div><div style="margin-top:0px;margin-bottom:0px">The fields that will be stored in each location, in PasswordForm terminology:</div><blockquote style="padding-top:10px;padding-right:10px;padding-bottom:10px;padding-left:10px;border-top-style:none;border-right-style:none;border-bottom-style:none;border-left-style:none;border-width:initial;border-color:initial;margin-top:0px;margin-right:0px;margin-bottom:0px;margin-left:40px;border-width:initial;border-color:initial"><b>Keychain</b></blockquote><div style="margin-top:0px;margin-bottom:0px"><ul style="margin-top:0px;margin-bottom:0px"><ul style="margin-top:0px;margin-bottom:0px"><li style="margin-top:0px;margin-bottom:0px">scheme </li></ul><ul style="margin-top:0px;margin-bottom:0px"><ul style="margin-top:0px;margin-bottom:0px"><li style="margin-top:0px;margin-bottom:0px">kSecAuthenticationTypeItemAttr (direct equivalents exist for each of the SCHEME_* types)</li></ul></ul><ul style="margin-top:0px;margin-bottom:0px"><li style="margin-top:0px;margin-bottom:0px">signon_realm</li></ul><ul style="margin-top:0px;margin-bottom:0px"><ul style="margin-top:0px;margin-bottom:0px"><li style="margin-top:0px;margin-bottom:0px">for SCHEME_HTML: kSecProtocolItemAttr + kSecServerItemAttr + kSecPortItemAttr</li><li style="margin-top:0px;margin-bottom:0px">for SCHEME_BASIC and SCHEME_DIGEST: as above, with the addition of kSecSecurityDomain</li><li style="margin-top:0px;margin-bottom:0px">for proxies: TBD (format is "proxy-host/auth-realm"; need to see what other browsers store, and how "origin" is handled on the Chromium side)</li></ul><li style="margin-top:0px;margin-bottom:0px">origin</li><ul style="margin-top:0px;margin-bottom:0px"><li style="margin-top:0px;margin-bottom:0px">signon_realm components + kSecPathItemAttr</li></ul><li style="margin-top:0px;margin-bottom:0px">username_value</li><ul style="margin-top:0px;margin-bottom:0px"><li style="margin-top:0px;margin-bottom:0px">kSecAccountItemAttr</li></ul><li style="margin-top:0px;margin-bottom:0px">password_value</li><ul style="margin-top:0px;margin-bottom:0px"><li style="margin-top:0px;margin-bottom:0px">Keychain data</li></ul><li style="margin-top:0px;margin-bottom:0px">date_created</li><ul style="margin-top:0px;margin-bottom:0px"><li style="margin-top:0px;margin-bottom:0px">kSecCreationDateItemAttr</li></ul></ul></ul></div><div style="margin-top:0px;margin-bottom:0px"><br /></div><blockquote style="padding-top:10px;padding-right:10px;padding-bottom:10px;padding-left:10px;border-top-style:none;border-right-style:none;border-bottom-style:none;border-left-style:none;border-width:initial;border-color:initial;margin-top:0px;margin-right:0px;margin-bottom:0px;margin-left:40px;border-width:initial;border-color:initial"><b>Internal Database</b> (using LoginDatabase)<br /></blockquote><blockquote style="padding-top:10px;padding-right:10px;padding-bottom:10px;padding-left:10px;border-top-style:none;border-right-style:none;border-bottom-style:none;border-left-style:none;border-width:initial;border-color:initial;margin-top:0px;margin-right:0px;margin-bottom:0px;margin-left:40px;border-width:initial;border-color:initial"><ul style="margin-top:0px;margin-bottom:0px"><li style="margin-top:0px;margin-bottom:0px">scheme</li><li style="margin-top:0px;margin-bottom:0px">signon_realm</li><li style="margin-top:0px;margin-bottom:0px">origin</li><li style="margin-top:0px;margin-bottom:0px">username_value</li><ul style="margin-top:0px;margin-bottom:0px"><li style="margin-top:0px;margin-bottom:0px">The above is duplicate information necessary to match our entries with Keychain entries. They should be sufficient to map uniquely to a Keychain entry, given Keychain's non-duplication enforcement.</li></ul><li style="margin-top:0px;margin-bottom:0px">action</li><ul style="margin-top:0px;margin-bottom:0px"><li style="margin-top:0px;margin-bottom:0px">This is the most important aspect of our metadata, since the UE changes if we don't have it (see discussion below).</li></ul><li style="margin-top:0px;margin-bottom:0px">submit_element</li><li style="margin-top:0px;margin-bottom:0px">username_element</li><li style="margin-top:0px;margin-bottom:0px">password_element</li><ul style="margin-top:0px;margin-bottom:0px"><li style="margin-top:0px;margin-bottom:0px">Used only for minor scoring changes.</li></ul><li style="margin-top:0px;margin-bottom:0px">ssl_valid</li><ul style="margin-top:0px;margin-bottom:0px"><li style="margin-top:0px;margin-bottom:0px">This gives us an extra security indicator for passwords we store; for passwords stored by other browsers we must infer it from kSecProtocolItemAttr, similar to how imported passwords are handled on other platforms.</li></ul><li style="margin-top:0px;margin-bottom:0px">preferred</li><li style="margin-top:0px;margin-bottom:0px">blacklisted_by_user</li><li style="margin-top:0px;margin-bottom:0px">date_created</li><ul style="margin-top:0px;margin-bottom:0px"><li style="margin-top:0px;margin-bottom:0px">Primarily for blacklisted_by_user here, which has no corresponding keychain entry</li></ul></ul></blockquote><div style="margin-top:0px;margin-bottom:0px">Note: In the PasswordStore implementations for other platforms, the PasswordStore doesn't need to understand anything about the format of signon_realm, so it can be free-form, which is not the case here. However, if we ever need to add a new format that cannot be expressed in Keychain terms, we can fall back to storing more metadata ourselves and using a generic application Keychain item for the password.</div><h3 style="font-size:12pt"><a name="TOC-Saving-Updating-Retrieving-and-Deleting"></a>Saving, Updating, Retrieving, and Deleting</h3><div style="margin-top:0px;margin-bottom:0px"><b>Saving</b> is relatively straightforward, except for a wrinkle with collisions:</div><div style="margin-top:0px;margin-bottom:0px"><ol style="margin-top:0px;margin-bottom:0px"><li style="margin-top:0px;margin-bottom:0px">Store the keychain entry</li><ul style="margin-top:0px;margin-bottom:0px"><li style="margin-top:0px;margin-bottom:0px">If this fails as a "duplicate item", attempt to set the password (since the other primary information must already match). If that succeeds—which is not guaranteed, since the user may deny us access to modify the item—count storage as a success.</li></ul><li style="margin-top:0px;margin-bottom:0px">If (1) succeeds, store our metadata.</li></ol><div style="margin-top:0px;margin-bottom:0px"><br /></div>This means that it is possible for us to have multiple entries in our database (different only by the *_element fields) mapping to the same keychain entry.<br /><br /></div><div style="margin-top:0px;margin-bottom:0px"><b>Updating</b> is essentially the same:</div><div style="margin-top:0px;margin-bottom:0px"><ol style="margin-top:0px;margin-bottom:0px"><li style="margin-top:0px;margin-bottom:0px">Store/update the Keychain, exactly as with Saving</li><li style="margin-top:0px;margin-bottom:0px">If we successfully create or update a Keychain item, update our metadata (or if we had no metadata, store some).</li></ol></div><div style="margin-top:0px;margin-bottom:0px"><br /></div><div style="margin-top:0px;margin-bottom:0px"><b>Retrieving (single)</b> is trickier:</div><div style="margin-top:0px;margin-bottom:0px"><ol style="margin-top:0px;margin-bottom:0px"><li style="margin-top:0px;margin-bottom:0px">Find all the matching entries in our database, and convert them to PasswordForms.</li><li style="margin-top:0px;margin-bottom:0px">Find all the matching Keychain entries, and convert them to PassswordForms.</li><li style="margin-top:0px;margin-bottom:0px">Walk the database PasswordForm list, and for each item:</li><ul style="margin-top:0px;margin-bottom:0px"><li style="margin-top:0px;margin-bottom:0px">If it's a blacklist item, add it to the merged list; otherwise</li></ul><ul style="margin-top:0px;margin-bottom:0px"><li style="margin-top:0px;margin-bottom:0px">try to find a matching entry from the Keychain list. If there is a match, merge the keychain PasswordForm into the database PasswordForm, then move the combined entry to the return list (and remember the keychain entry as having been used).</li></ul><li style="margin-top:0px;margin-bottom:0px">Move everything left in the original keychain list that's not a blacklist item into the return list.</li><ul style="margin-top:0px;margin-bottom:0px"><li style="margin-top:0px;margin-bottom:0px">These will be treated like imported passwords in the UI due to the lack of an action field.</li></ul><li style="margin-top:0px;margin-bottom:0px">Delete the database entry for anything left in the database list; if it's still there the user has deleted the keychain item outside of Chromium and it is now useless.</li></ol><br /></div><div style="margin-top:0px;margin-bottom:0px"><b>Retrieving (batch)</b> differs from single retrieval in handling of Keychain entries (see Design Choices):</div><div style="margin-top:0px;margin-bottom:0px"><ol style="margin-top:0px;margin-bottom:0px"><li style="margin-top:0px;margin-bottom:0px">Find all entries in our database, and convert them to PasswordForms.</li><li style="margin-top:0px;margin-bottom:0px">For each entry, find and merge in the corresponding Keychain entry.</li><ul style="margin-top:0px;margin-bottom:0px"><li style="margin-top:0px;margin-bottom:0px">If there isn't one, delete the database entry, since it is now useless.</li></ul></ol></div><div style="margin-top:0px;margin-bottom:0px"><br /></div><div style="margin-top:0px;margin-bottom:0px"><b>Deleting (single)</b> is slightly tricky due to potential sharing of an item by multiple database entries:</div><div style="margin-top:0px;margin-bottom:0px"><ol style="margin-top:0px;margin-bottom:0px"><li style="margin-top:0px;margin-bottom:0px">Delete the database entry that we are trying to delete.</li><li style="margin-top:0px;margin-bottom:0px">Find the Keychain item corresponding to the entry to delete.</li><li style="margin-top:0px;margin-bottom:0px">If we created the Keychain item (see Design Choices below):</li><ol style="margin-top:0px;margin-bottom:0px"><li style="margin-top:0px;margin-bottom:0px">Find all remaining database items that would use that Keychain item.</li><li style="margin-top:0px;margin-bottom:0px">If there aren't any, delete the Keychain item.</li></ol></ol><br /></div><div style="margin-top:0px;margin-bottom:0px"><b>Deleting (batch)</b> works much the same way (and is subject to some limitations; see Design Choices below):</div><div style="margin-top:0px;margin-bottom:0px"><ol style="margin-top:0px;margin-bottom:0px"><li style="margin-top:0px;margin-bottom:0px">Delete everything in our metadata database from the given time range.</li><li style="margin-top:0px;margin-bottom:0px">Find everything that's left in the database.</li><li style="margin-top:0px;margin-bottom:0px">Find everything in the Keychain created by Chromium.</li><li style="margin-top:0px;margin-bottom:0px">Merge the lists from those two steps, and delete any Keychain entries that aren't used.</li></ol></div><h3 style="font-size:12pt"><a name="TOC-Issues-Limitations"></a>Issues/Limitations</h3><ul style="margin-top:0px;margin-bottom:0px"><li style="margin-top:0px;margin-bottom:0px">Translation to PasswordForm format requires accessing the password, which will cause UI (from the OS) if the password was saved by another application or the Keychain is locked. This will be most noticeable for users visiting a site that we find a Keychain password for but no metadata of our own, because without an "action" we won't auto-fill without user interaction. Users will likely be confused/annoyed by being prompted for access to a password that doesn't immediately appear to be used.</li><ul style="margin-top:0px;margin-bottom:0px"><li style="margin-top:0px;margin-bottom:0px">Some Camino users complained about this general issue, causing a change to load passwords lazily. That would be possible in Chromium, but would require making PasswordForm a class, incorporating at least some platform-specific knowledge.</li></ul><li style="margin-top:0px;margin-bottom:0px">Keychain enforces more uniqueness than Chromium does. Specifically, we cannot store two password entries that differ only by *_element fields or by action.</li><ul style="margin-top:0px;margin-bottom:0px"><li style="margin-top:0px;margin-bottom:0px">This does not seem likely to be a significant concern; in testing of Windows behavior getting into this state appeared to require "tricking" Chromium by first storing the new entry with a different username, then changing that username.</li></ul><li style="margin-top:0px;margin-bottom:0px">Unlike the other platoforms' password storage, we can encounter errors in normal usage (experience with Camino tells us that unexpected keychain problems will occur for some number of users). There is currently no error reporting, so failures will be largely silent, although there is console logging.</li></ul><h3 style="font-size:12pt"><a name="TOC-Design-Choices"></a>Design Choices</h3><ul style="margin-top:0px;margin-bottom:0px"><li style="margin-top:0px;margin-bottom:0px">Deleting all passwords won't actually prevent Chromium from having stored passwords that it may access. Complete batch-deletion will leave Chromium in the same state that it started in: having access to passwords it did not create, but not trusting them for auto-fill.</li><ul style="margin-top:0px;margin-bottom:0px"><li style="margin-top:0px;margin-bottom:0px">This is the more conservative of the two options, and matches Camino's behavior; Safari, on the other hand, deletes all items it understands whether it created them or not (which runs a high risk of unexpected data loss by users who don't realize that there is a shared storage system for passwords).</li></ul><li style="margin-top:0px;margin-bottom:0px">Deleting individual password entries created by another browser will revert us to the untrusted state for that password, but will not delete it from the keychain.</li><ul style="margin-top:0px;margin-bottom:0px"><li style="margin-top:0px;margin-bottom:0px">This is primarily to be consistent with batch delete, although the the same argument also applies here to a lesser extent.</li></ul><li style="margin-top:0px;margin-bottom:0px">Passwords from the Keychain that we don't yet trust will not be listed in the Preferences UI (batch retrieval).</li><ul style="margin-top:0px;margin-bottom:0px"><li style="margin-top:0px;margin-bottom:0px">This is a consequence of the decisions about deletion; it would be extremely confusing to show entries that didn't go away when deleted. We'll need to watch for how much confusion there is about Chromium filling passwords (once they are typed) when they don't show up in the Preferences.</li></ul><li style="margin-top:0px;margin-bottom:0px">We do not attempt to share blacklist entries with other browsers. We don't store our blacklist entries in the keychain, or honor those stored by other browsers.</li><ul style="margin-top:0px;margin-bottom:0px"><li style="margin-top:0px;margin-bottom:0px">It's not entirely clear that if a user tells Safari never to remember a password for a given site that they should be unable to store a password there in Chromium. (Camino does not currently use or honor blacklist entries in the Keychain.) We also run the risk of confusing other browsers that don't make use of path information for Keychain entries, so that a blacklist for an individual form on a site in Chromium could block password storage for the entire site in other browsers.</li></ul></ul></span></div></td></tr></tbody></table>
</div> 
</div> 
<div id="sites-canvas-bottom-panel">
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_page-subpages"> </div>
<div id="sites-attachments-container">
</div>
<a xmlns="http://www.w3.org/1999/xhtml" name="page-comments"></a>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_page-comments"><div class="sites-comment-docos-wrapper"><div class="sites-comment-docos"><div class="sites-comment-docos-background"></div><div class="sites-comment-docos-header"><div class="sites-comment-docos-header-title">Comments</div></div><div id="sites-comment-docos-pane" class="sites-comment-docos-pane"></div></div></div></div>
</div>
</div> 
</td> 
</tr>
</table> 
</div> 
</div> 
<div id="sites-chrome-footer-wrapper">
<div id="sites-chrome-footer-wrapper-inside">
<div id="sites-chrome-footer">
</div>
</div>
</div>
</div> 
</div> 
<div id="sites-chrome-adminfooter-container">
<div xmlns="http://www.w3.org/1999/xhtml" class="sites-adminfooter" role="navigation"><p><a class="sites-system-link" href="https://www.google.com/a/UniversalLogin?service=jotspot&amp;continue=https://sites.google.com/a/chromium.org/dev/developers/design-documents/os-x-password-manager-keychain-integration">Sign in</a><span aria-hidden="true">|</span><a class="sites-system-link" href="../../system/app/pages/recentChanges.html">Recent Site Activity</a><span aria-hidden="true">|</span><a class="sites-system-link" href="../../system/app/pages/reportAbuse.html" target="_blank">Report Abuse</a><span aria-hidden="true">|</span><a class="sites-system-link" href="javascript:;" onclick="window.open(webspace.printUrl)">Print Page</a><span aria-hidden="true">|</span><span class="sites-system-link">Powered By</span> <b class="powered-by"><a href="http://sites.google.com">Google Sites</a></b></p></div>
</div>
</div> 
</div> 
<div id="sites-chrome-onebar-footer">
</div>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    window.jstiming.load.tick('sjl');
  </script>
<script xmlns="http://www.w3.org/1999/xhtml" src="https://ssl.gstatic.com/sites/p/56e332/system/js/jot_min_view__en.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    window.jstiming.load.tick('jl');
  </script>
<script xmlns="http://www.w3.org/1999/xhtml">
      
          sites.core.Analytics.createTracker();
          sites.core.Analytics.trackPageview();
        
    </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
                    sites.Searchbox.initialize(
                        'sites-searchbox-search-button',
                        {"object":[]}['object'],
                        'search-site',
                        {"label":"Configure search options...","url":"/system/app/pages/admin/settings"});
                  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
      gsites.HoverPopupMenu.createSiteDropdownMenus('sites-header-nav-dropdown', false);
    </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
            JOT_setupNav("7648876402527094", "Navigation", false);
            JOT_addListener('titleChange', 'JOT_NAVIGATION_titleChange', 'COMP_7648876402527094');
          </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
            JOT_setupNav("14720868319272995", "Quick links", false);
            JOT_addListener('titleChange', 'JOT_NAVIGATION_titleChange', 'COMP_14720868319272995');
          </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
            JOT_setupNav("19690813310444355", "Other sites", false);
            JOT_addListener('titleChange', 'JOT_NAVIGATION_titleChange', 'COMP_19690813310444355');
          </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
              new sites.CommentPane('//docs.google.com/comments/d/AAHRpnXvrAwjAfmld0ObrebBiGRq98lwx9o9cMxK1ubF9Am267RSs8jwXRpFluvOXSHnDUx9PS40sC-ZGM1iXcwQfCvjpWAei7BWUGJgL8ETGLaCNun6AuyGI_886gqSWXSKuA3ZArXSa/api/js?anon=true',
                  false, false);
            </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
  setTimeout(function() {
    var fingerprint = gsites.date.TimeZone.getFingerprint([]);
    gsites.Xhr.send('https://www.chromium.org/_/tz', null, null, 'GET', null, null, { afjstz: fingerprint });
  }, 500);
</script>
<script xmlns="http://www.w3.org/1999/xhtml">
                    window.onload = function() {
                      if (false) {
                        JOT_setMobilePreview();
                      }
                      var loadTimer = window.jstiming.load;
                      loadTimer.tick("ol");
                      loadTimer["name"] = "load," + webspace.page.type + ",user_page";
                      window.jstiming.report(loadTimer, {}, 'https://gg.google.com/csi');
                    }
                  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
        JOT_insertAnalyticsCode(false,
            false);
      </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    var maestroRunner = new gsites.pages.view.SitesMaestroRunner(
        webspace, "en");
    maestroRunner.initListeners();
    maestroRunner.installEditRender();
  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
  //<![CDATA[
    // Decorate any fastUI buttons on the page with a class of 'goog-button'.
    if (webspace.user.hasWriteAccess) {
      JOT_decorateButtons();
    }

    // Fires delayed events.
    (function() {
      JOT_fullyLoaded = true;
      var delayedEvents = JOT_delayedEvents;
      for (var x = 0; x < delayedEvents.length; x++) {
        var event = delayedEvents[x];
        JOT_postEvent(event.eventName, event.eventSrc, event.payload);
      }
      JOT_delayedEvents = null;
      JOT_postEvent('pageLoaded');
    })();
  //]]>
</script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    JOT_postEvent('decorateGvizCharts');
  </script>
<script type="text/javascript">
          JOT_setupPostRenderingManager();
        </script>
<script type="text/javascript">
          JOT_postEvent('renderPlus', null, 'sites-chrome-main');
        </script>
<div id="server-timer-div" style="display:none"> </div>
<script type="text/javascript">
          window.jstiming.load.tick('render');
          JOT_postEvent('usercontentrendered', this);
        </script>
</body>
</html>
