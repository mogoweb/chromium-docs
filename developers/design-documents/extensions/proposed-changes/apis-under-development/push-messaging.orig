<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/WebPage">
<head>
<meta http-equiv="X-UA-Compatible" content="chrome=1" />
<script type="text/javascript">/* Copyright 2008 Google. */ (function() { var e="wtsrt_",g="tbsd_",h="tbnd_",k="start",l="_wtsrt",m="_tbnd",n="CSI/";(function(){function f(a){this.t={};this.tick=function(a,c,b){this.t[a]=[void 0!=b?b:(new Date).getTime(),c];if(void 0==b)try{window.console.timeStamp(n+a)}catch(d){}};this.tick(k,null,a)}var a;window.performance&&(a=window.performance.timing);var p=a?new f(a.responseStart):new f;window.jstiming={Timer:f,load:p};if(a){var c=a.navigationStart,d=a.responseStart;0<c&&d>=c&&(window.jstiming.srt=d-c)}if(a){var b=window.jstiming.load;0<c&&d>=c&&(b.tick(l,void 0,c),b.tick(e,l,d),b.tick(g,e))}try{a=null,
window.chrome&&window.chrome.csi&&(a=Math.floor(window.chrome.csi().pageT),b&&0<c&&(b.tick(m,void 0,window.chrome.csi().startE),b.tick(h,m,c))),null==a&&window.gtbExternal&&(a=window.gtbExternal.pageT()),null==a&&window.external&&(a=window.external.pageT,b&&0<c&&(b.tick(m,void 0,window.external.startE),b.tick(h,m,c))),a&&(window.jstiming.pt=a)}catch(q){}})(); })()
</script>
<link rel="shortcut icon" href="/_/rsrc/1354323194313/favicon.ico" type="image/x-icon" />
<link rel="apple-touch-icon" href="https://ssl.gstatic.com/sites/p/56e332/system/app/images/apple-touch-icon.png" type="image/png" />
<script type="text/javascript">/* Copyright 2008 Google. */ (function() { var d="",g="__duration__",h="function";function k(c){return document.getElementById(c)}window.byId=k;function l(c){return c.replace(/^\s+|\s+$/g,d)}window.trim=l;var m=[],n=0;window.JOT_addListener=function(c,a,b){var e=new String(n++);c={eventName:c,handler:a,compId:b,key:e};m.push(c);return e};window.JOT_removeListenerByKey=function(c){for(var a=0;a<m.length;a++)if(m[a].key==c){m.splice(a,1);break}};
window.JOT_removeAllListenersForName=function(c){for(var a=0;a<m.length;a++)m[a].eventName==c&&m.splice(a,1)};window.JOT_postEvent=function(c,a,b){var e={eventName:c,eventSrc:a||{},payload:b||{}};if(window.JOT_fullyLoaded)for(a=m.length,b=0;b<a&&b<m.length;b++){var f=m[b];f&&f.eventName==c&&(e.listenerCompId=f.compId||d,(f=typeof f.handler==h?f.handler:window[f.handler])&&f(e))}else window.JOT_delayedEvents.push({eventName:c,eventSrc:a,payload:b})};window.JOT_delayedEvents=[];
window.JOT_fullyLoaded=!1;window.JOT_formatRelativeToNow=function(c,a){var b=((new Date).getTime()-c)/6E4;if(1440<=b||0>b)return null;var e=0;60<=b&&(b/=60,e=2);2<=b&&e++;return a?window.JOT_siteRelTimeStrs[e].replace(g,Math.floor(b)):window.JOT_userRelTimeStrs[e].replace(g,Math.floor(b))}; })()
</script>
<script>

  

  var breadcrumbs = [{"path":"/developers","deleted":false,"title":"For Developers","dir":"ltr"},{"path":"/developers/design-documents","deleted":false,"title":"Design Documents","dir":"ltr"},{"path":"/developers/design-documents/extensions","deleted":false,"title":"Extensions","dir":"ltr"},{"path":"/developers/design-documents/extensions/proposed-changes","deleted":false,"title":"Proposed \u0026 Proposing New Changes","dir":"ltr"},{"path":"/developers/design-documents/extensions/proposed-changes/apis-under-development","deleted":false,"title":"API Proposals (New APIs Start Here)","dir":"ltr"},{"path":"/developers/design-documents/extensions/proposed-changes/apis-under-development/push-messaging","deleted":false,"title":"Push Messaging","dir":"ltr"}];
  var JOT_clearDotPath = 'https://ssl.gstatic.com/sites/p/56e332/system/app/images/cleardot.gif';

  
  var JOT_userRelTimeStrs = ["a minute ago","__duration__ minutes ago","an hour ago","__duration__ hours ago"];

  
  

  

  var webspace = {"enableAnalytics":true,"pageSharingId":"jotspot_page","enableUniversalAnalytics":false,"sharingPolicy":"OPENED_WITH_INDICATOR","siteTitle":"The Chromium Projects","isStartPageEnabled":true,"adsensePublisherId":null,"features":{"languageSelectDefaultTextSetToDefault":true,"validateClientGvizDataSourceUrls":true,"moreMobileStyleImprovements":true,"newInsertMenuIcons":true,"accessibleSortingButtons":true,"domainAnalyticsInGAOnly":true,"noCaptcha":true,"fileCabinetScreenReaderFix":true,"updatedTosAndPrivacyLinks":null,"pageDrafts":false,"mobileOrientationFix":true,"plusBadge":false,"pdfEmbedSupport":false,"jsClickFix":true},"isPublic":true,"isConsumer":false,"serverFlags":{"cajaBaseUrl":"//www.gstatic.com/caja","cajaDebugMode":false},"onepickBaseUrl":"https://docs.google.com","domainAnalyticsAccountId":"","plusPageId":"","signInUrl":"https://www.google.com/a/SelectSession?continue\u003dhttps://sites.google.com/a/chromium.org/dev/developers/design-documents/extensions/proposed-changes/apis-under-development/push-messaging\u0026service\u003djotspot","analyticsAccountId":"UA-5484340-1","scottyUrl":"/_/upload","homePath":"/","siteNoticeUrlEnabled":null,"plusPageUrl":"","adsensePromoClickedOrSiteIneligible":true,"csiReportUri":"https://gg.google.com/csi","sharingId":"jotspot","termsUrl":"//www.google.com/intl/en/policies/terms/","gvizVersion":1,"editorResources":{"sitelayout":["https://ssl.gstatic.com/sites/p/56e332/system/app/css/sitelayouteditor.css"],"text":["https://ssl.gstatic.com/sites/p/56e332/system/js/codemirror.js","https://ssl.gstatic.com/sites/p/56e332/system/app/css/codemirror_css.css","https://ssl.gstatic.com/sites/p/56e332/system/js/trog_edit__en.js","https://ssl.gstatic.com/sites/p/56e332/system/app/css/trogedit.css","/_/rsrc/1441580320000/system/app/css/editor.css","https://ssl.gstatic.com/sites/p/56e332/system/app/css/codeeditor.css","/_/rsrc/1441580320000/system/app/css/camelot/editor-jfk-wlb.css"]},"sharingUrlPrefix":"/_/sharing","isAdsenseEnabled":true,"domain":"chromium.org","baseUri":"","name":"dev","siteTemplateId":false,"siteNoticeRevision":null,"siteNoticeUrlAddress":null,"siteNoticeMessage":null,"page":{"isRtlLocale":false,"canDeleteWebspace":null,"isPageDraft":null,"parentPath":"/developers/design-documents/extensions/proposed-changes/apis-under-development","parentWuid":"wuid:gx:4a1283b73b239cf","siteLocale":"en","timeZone":"America/Los_Angeles","type":"text","title":"Push Messaging","locale":"en","wuid":"wuid:gx:55faf2e465703d84","revision":10,"path":"/developers/design-documents/extensions/proposed-changes/apis-under-development/push-messaging","isSiteRtlLocale":false,"pageInheritsPermissions":null,"name":"push-messaging","canChangePath":true,"state":"","properties":{},"bidiEnabled":false,"currentTemplate":{"path":"/config/pagetemplates/extension-api-proposal-template","title":"API Proposal Template"}},"canPublishScriptToAnyone":true,"user":{"keyboardShortcuts":true,"sessionIndex":"","guest_":true,"displayNameOrEmail":"guest","userName":"guest","uid":"","renderMobile":false,"domain":"","namespace":"","hasWriteAccess":false,"namespaceUser":false,"primaryEmail":"guest","hasAdminAccess":false},"gadgets":{"baseUri":"/system/app/pages/gadgets"}};
  webspace.page.breadcrumbs = breadcrumbs;

  
  var JOT_siteRelTimeStrs = ["a minute ago","__duration__ minutes ago","an hour ago","__duration__ hours ago"];

</script>
<script type="text/javascript">
                window.jstiming.load.tick('scl');
              </script>
<meta name="title" content="Push Messaging - The Chromium Projects" />
<meta itemprop="name" content="Push Messaging - The Chromium Projects" />
<meta property="og:title" content="Push Messaging - The Chromium Projects" />
<meta name="description" content="Home of the Chromium Open Source Project" />
<meta itemprop="description" content="Home of the Chromium Open Source Project" />
<meta id="meta-tag-description" property="og:description" content="Home of the Chromium Open Source Project" />
<style type="text/css">
</style>
<link rel="stylesheet" type="text/css" href="https://ssl.gstatic.com/sites/p/56e332/system/app/themes/beigeandblue/standard-css-beigeandblue-ltr-ltr.css" />
<link rel="stylesheet" type="text/css" href="/_/rsrc/1441580320000/system/app/css/overlay.css?cb=beigeandblueundefineda100%25%25150goog-ws-leftthemedefaultstandard" />
<link rel="stylesheet" type="text/css" href="/_/rsrc/1441580320000/system/app/css/camelot/allthemes-view.css" />
<!--[if IE]>
          <link rel="stylesheet" type="text/css" href="/system/app/css/camelot/allthemes%2die.css" />
        <![endif]-->
<title>Push Messaging - The Chromium Projects</title>
<meta itemprop="image" content="/_/rsrc/1438879449147/config/customLogo.gif?revision=3" />
<meta property="og:image" content="/_/rsrc/1438879449147/config/customLogo.gif?revision=3" />
<script type="text/javascript">
                window.jstiming.load.tick('cl');
              </script>
</head>
<body xmlns="http://www.google.com/ns/jotspot" id="body" class=" en            ">
<div id="sites-page-toolbar" class="sites-header-divider">
<div xmlns="http://www.w3.org/1999/xhtml" id="sites-status" class="sites-status" style="display:none;"><div id="sites-notice" class="sites-notice" role="status" aria-live="assertive"> </div></div>
</div>
<div id="sites-chrome-everything-scrollbar">
<div id="sites-chrome-everything" class="">
<div id="sites-chrome-page-wrapper" style="direction: ltr">
<div id="sites-chrome-page-wrapper-inside">
<div xmlns="http://www.w3.org/1999/xhtml" id="sites-chrome-header-wrapper" style="height:auto;">
<table id="sites-chrome-header" class="sites-layout-hbox" cellspacing="0" style="height:auto;">
<tr class="sites-header-primary-row" id="sites-chrome-userheader">
<td id="sites-header-title" class="" role="banner"><div class="sites-header-cell-buffer-wrapper"><a href="https://www.chromium.org/" id="sites-chrome-userheader-logo"><img id="logo-img-id" src="/_/rsrc/1438879449147/config/customLogo.gif?revision=3" alt="The Chromium Projects" class="sites-logo  " /></a><h2><a href="https://www.chromium.org/" dir="ltr" id="sites-chrome-userheader-title">The Chromium Projects</a></h2></div></td><td class="sites-layout-searchbox  "><div class="sites-header-cell-buffer-wrapper"><form id="sites-searchbox-form" action="/system/app/pages/search" role="search"><input type="hidden" id="sites-searchbox-scope" name="scope" value="search-site" /><input type="text" id="jot-ui-searchInput" name="q" size="20" value="" aria-label="Search this site" /><div id="sites-searchbox-button-set" class="goog-inline-block"><div role="button" id="sites-searchbox-search-button" class="goog-inline-block jfk-button jfk-button-standard" tabindex="0">Search this site</div></div></form></div></td>
</tr>
<tr class="sites-header-secondary-row" id="sites-chrome-horizontal-nav">
<td colspan="2" id="sites-chrome-header-horizontal-nav-container" role="navigation">
</td>
</tr>
</table>
</div>
<div id="sites-chrome-main-wrapper">
<div id="sites-chrome-main-wrapper-inside">
<table id="sites-chrome-main" class="sites-layout-hbox" cellspacing="0" cellpadding="{scmCellpadding}" border="0">
<tr>
<td id="sites-chrome-sidebar-left" class="sites-layout-sidebar-left initial" style="width:150px">
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_7648876402527094" class="sites-embed" role="navigation"><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotId="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="/chromium-projects" jotId="wuid:gx:10ae433dadbbab13" class="sites-navigation-link">Home</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="/Home" jotId="wuid:gx:43582b9d2029d3af" class="sites-navigation-link">Chromium</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="/chromium-os" jotId="wuid:gx:83df2ab1f8880ba" class="sites-navigation-link">Chromium OS</a></div></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_14720868319272995" class="sites-embed" role="navigation"><h4 class="sites-embed-title">Quick links</h4><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotId="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="http://www.chromium.org/for-testers/bug-reporting-guidelines" class="sites-navigation-link">Report bugs</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="http://www.chromium.org/developers/discussion-groups" class="sites-navigation-link">Discuss</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="/system/app/pages/sitemap/hierarchy" jotId="wuid:gx:4b58a9a350ad12f" class="sites-navigation-link">网站地图</a></div></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_19690813310444355" class="sites-embed" role="navigation"><h4 class="sites-embed-title">Other sites</h4><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotId="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="http://blog.chromium.org/" class="sites-navigation-link">Chromium Blog</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="http://code.google.com/chrome/extensions/" class="sites-navigation-link">Google Chrome Extensions</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="https://developers.google.com/chrome/chrome-frame/" class="sites-navigation-link">Google Chrome Frame</a></div></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_19695218559354544" class="sites-embed" role="complementary"><h4 class="sites-embed-title"></h4><div class="sites-embed-content sites-embed-content-sidebar-textbox"><div dir="ltr"><span style="font-size:x-small">Except as otherwise </span><a href="http://developers.google.com/site-policies.html#restrictions"><span style="font-size:x-small">noted</span></a><span style="font-size:x-small">, the content of this page is licensed under a </span><a href="http://creativecommons.org/licenses/by/2.5/"><span style="font-size:x-small">Creative Commons Attribution 2.5 license</span></a><span style="font-size:x-small">, and examples are licensed under the </span><a href="http://src.chromium.org/viewvc/chrome/trunk/src/LICENSE" target="_blank"><span style="font-size:x-small">BSD License</span></a><span style="font-size:x-small">.<br /></span></div></div></div>
</td>
<td id="sites-canvas-wrapper">
<div id="sites-canvas" role="main">
<div id="goog-ws-editor-toolbar-container"> </div>
<div xmlns="http://www.w3.org/1999/xhtml" id="title-crumbs" style="">
<A href="/developers" dir="ltr">For Developers</A>‎ &gt; ‎<A href="/developers/design-documents" dir="ltr">Design Documents</A>‎ &gt; ‎<A href="/developers/design-documents/extensions" dir="ltr">Extensions</A>‎ &gt; ‎<A href="/developers/design-documents/extensions/proposed-changes" dir="ltr">Proposed &amp; Proposing New Changes</A>‎ &gt; ‎<A href="/developers/design-documents/extensions/proposed-changes/apis-under-development" dir="ltr">API Proposals (New APIs Start Here)</A>‎ &gt; ‎
  </div>
<h3 xmlns="http://www.w3.org/1999/xhtml" id="sites-page-title-header" style="" align="left">
<span id="sites-page-title" dir="ltr" tabindex="-1" style="outline: none">Push Messaging</span>
</h3>
<div id="sites-canvas-main" class="sites-canvas-main">
<div id="sites-canvas-main-content">
<table xmlns="http://www.w3.org/1999/xhtml" cellspacing="0" class="sites-layout-name-one-column sites-layout-hbox"><tbody><tr><td class="sites-layout-tile sites-tile-name-content-1"><div dir="ltr"><div style="margin-top:0px;margin-bottom:0px"><div style="margin-top:0px;margin-bottom:0px"><font face="arial, sans-serif"><b><span style="font-weight:normal;vertical-align:baseline;white-space:pre-wrap">You’re about to propose a new extension API, what a marvelous road you have ahead of you.  Before you venture forth, though, we’d like to get a sense for your new API and offer you some guidance on your way.  Fill out this proposal and post it und</span></b>er <a href="https://www.chromium.org/developers/design-documents/extensions/proposed-changes/apis-under-development">For Developers‎ &gt; ‎Design Documents‎ &gt; ‎Extensions‎ &gt; ‎Proposed &amp; Proposing New Changes‎ &gt; ‎API Proposals</a><b><span style="font-weight:normal;vertical-align:baseline;white-space:pre-wrap"> in the list of proposed APIs, then include a link in your Extension Review request in </span><a href="http://go/extensionsreview" rel="nofollow"><span style="color:rgb(0,0,153);font-weight:normal;vertical-align:baseline;white-space:pre-wrap">go/extensionsreview</span></a><span style="font-weight:normal;vertical-align:baseline;white-space:pre-wrap">.  </span></b></font></div><div style="margin-top:0px;margin-bottom:0px"><font face="arial, sans-serif"><br /></font><div style="background-color:transparent"><font face="arial, sans-serif"><span style="font-weight:bold;vertical-align:baseline;white-space:pre-wrap">Proposal Date</span><br /><span style="white-space:pre-wrap">2012/07/31</span><br /><br /><span style="font-weight:bold;vertical-align:baseline;white-space:pre-wrap">Who is the primary contact for this API?</span><br /><span style="white-space:pre-wrap">dimich@</span></font></div><div style="background-color:transparent"><font face="arial, sans-serif"><span style="white-space:pre-wrap"><br /></span><span style="font-weight:bold;vertical-align:baseline;white-space:pre-wrap">Who will be responsible for this API? (Team please, not an individual)</span><br /></font><p dir="ltr" style="margin-right:12pt;margin-top:0pt;margin-bottom:0pt"><font face="arial, sans-serif">dcheng@, dimich@, petewil@</font></p><p dir="ltr" style="font-weight:bold;margin-right:12pt;margin-top:0pt;margin-bottom:0pt"><font face="arial, sans-serif"><br /></font></p><font face="arial, sans-serif"><span style="font-weight:bold;vertical-align:baseline;white-space:pre-wrap">Overview</span><br /><span style="font-weight:normal;vertical-align:baseline;white-space:pre-wrap">Web apps have the inherent limitation that they're not able to do much when they aren't running. Today, extensions/apps use persistent background pages to do interesting work even if they're not in the foreground; for example, they can use it to poll the server for new emails and download them to a local store when they're received. From a performance/efficiency standpoint, this is less than desirable since it requires a mostly idle background page to just hang around waiting for work. W<span style="white-space:normal">ith new Chrome packaged apps and extension APIs that allow background pages to be unloaded</span> on idle, this will no longer be possible. As a result, we believe it'd be useful to offer an API that would allow a remote server to wake up a web app that's not currently running to do useful work. We plan on implementing this API on top of the cache invalidation service that Chrome is already using for Sync.</span><br /><br /><span style="font-weight:bold;vertical-align:baseline;white-space:pre-wrap">Use cases</span><br /><span style="font-weight:normal;vertical-align:baseline;white-space:pre-wrap">Gmail/Google Docs: instead of polling the server for updates, they could subscribe to push messages for their service. When there's actually an update, then they can use the event to wake up their background page and update their local store.</span><br />Google Talk: a push message would be triggered for the start of a new chat; this would allow Google Talk to spawn a new chat window even when it's currently unloaded.<br /><br /><span style="font-weight:bold;vertical-align:baseline;white-space:pre-wrap">Do you know anyone else, internal or external, that is also interested in this API?</span><span style="font-weight:normal;vertical-align:baseline;white-space:pre-wrap"> </span><br /><span style="white-space:pre-wrap">Google Talk is the most interested client, though it could be useful for Gmail and Google Docs as well.</span><br /><br /><span style="font-weight:bold;vertical-align:baseline;white-space:pre-wrap">Could this API be part of the web platform?</span><br />It would be difficult to standardize this in the web platform because it depends on many other server-side components such as:</font></div><div style="background-color:transparent"><ul><li><span style="background-color:transparent"><font face="arial, sans-serif">Authentication</font></span></li><li><span style="background-color:transparent"><font face="arial, sans-serif">The invalidation mechanism used</font></span></li><li><span style="background-color:transparent"><font face="arial, sans-serif">The features supported</font></span></li></ul></div><div style="background-color:transparent"><font face="arial, sans-serif"><span style="font-weight:bold;vertical-align:baseline;white-space:pre-wrap">Do you expect this API to be fairly stable?  How might it be extended or changed in the future?</span><br /><span style="font-weight:normal;vertical-align:baseline;white-space:pre-wrap">We expose only a small subset of the cache invalidation service that Chrome uses internally. </span></font><span style="white-space:pre-wrap;font-family:arial,sans-serif;background-color:transparent">The main limitation today is that we have a list of hardcoded subchannels that we register on behalf of extensions; in the future, it's possible that we'd allow extensions to specify their own subchannel names. We'd likely have to keep the hardcoded subchannels around forever though, to avoid breaking extensions that use those subchannels.</span></div><div style="background-color:transparent"><span style="white-space:pre-wrap"><i><font face="arial, sans-serif"><br /></font></i></span></div><div style="background-color:transparent"><font face="arial, sans-serif"><b><font><span style="font-size:small;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">If multiple extensions used this API at the same time, could they conflict with each others? If so, how do you propose to mitigate this problem?</span></font></b><span style="white-space:pre-wrap"><i><br /></i></span>They cannot conflict with each other, since we do not allow extensions to specify any part of the object IDs registered on their behalf.<br /><br /><span style="font-weight:bold;vertical-align:baseline;white-space:pre-wrap">List every UI surface belonging to or potentially affected by your API:</span><br /><span style="vertical-align:baseline;white-space:pre-wrap">No UI elements are involved.</span><br /><br /><b><font><span style="font-size:small;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Actions taken with extension APIs should be obviously attributable to an extension. Will users be able to tell when this new API is being used? How?</span></font></b></font></div><div style="background-color:transparent"><font face="arial, sans-serif">Invalidations may trigger actions that result in UI elements being surfaced. Since we add no new UI elements ourselves, and existing ones should be obviously attributable, the existing UI should be sufficient.</font></div><div style="background-color:transparent"><font face="arial, sans-serif"><br /><span style="font-weight:bold;vertical-align:baseline;white-space:pre-wrap">How could this API be abused?</span><br />See below.<br /><br /><span style="font-weight:bold;vertical-align:baseline;white-space:pre-wrap">Imagine you’re Dr. Evil Extension Writer, list the three worst evil deeds you could commit with your API (if you’ve got good ones, feel free to add more):</span><br /><span style="font-weight:normal;vertical-align:baseline;white-space:pre-wrap">1) The server could trigger a lot of invalidations. Presumably this would eventually cause the app to get throttled on the server though...</span><br /><span style="font-weight:normal;vertical-align:baseline;white-space:pre-wrap">2) An extension could claim it will manually acknowledge an invalidation and never acknowledge it, allowing it to be woken up regularly.</span><br /><span style="font-weight:normal;vertical-align:baseline;white-space:pre-wrap">3) An app writer could always add the pushMessaging to his permissions list, whether or not he used it, causing the extension API to always register object IDs for that extension even though they are not used.</span><br /><b><br /></b><font size="2"><span style="font-weight:bold;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">What security UI or other mitigations do you propose to limit evilness made possible by this new API?</span><br /><span style="white-space:pre-wrap">To prevent extensions from being able to snoop on invalidations for other users/extensions, we do not allow the extensions to actually specify their own object IDs--we generate object IDs for an extension based on the signed-in user + the extension ID + the subchannel.</span></font></font></div><div style="background-color:transparent"><font face="arial, sans-serif"><font size="2"><span style="white-space:pre-wrap">In addition, to reduce server load, we always acknowledge receipt of an invalidation immediately when we receive it from the cache invalidation server. We re-dispatch invalidations to the extension ourselves and use a backoff policy to prevent a faulty/malicious app from causing its background page to be woken up excessively.<br /></span></font><b><br /><span style="vertical-align:baseline;white-space:pre-wrap">Alright Doctor, one last challenge:  </span><br /><span style="vertical-align:baseline;white-space:pre-wrap">Could a consumer of your API cause any permanent change to the user’s system using your API that would not be reversed when that consumer is removed from the system?</span><br /><span style="font-weight:normal;vertical-align:baseline;white-space:pre-wrap">No. We unregister all object IDs registered on behalf of an extension when it is uninstalled.</span></b><b><font><font size="2"><span style="white-space:pre-wrap"><br /></span></font></font></b><br /><span style="font-weight:bold;vertical-align:baseline;white-space:pre-wrap">How would you implement your desired features if this API didn't exist?</span><br />The user would have to make sure the app was constantly open for any "background" functionality to work as expected. In the case of Google Talk, this would require that the roster window always be opened.<br /><br /><span style="font-weight:bold;vertical-align:baseline;white-space:pre-wrap">Draft API spec</span><br />API reference: chrome.pushMessaging</font></div><div style="background-color:transparent"><font face="arial, sans-serif"><br /></font></div><div style="background-color:transparent"><font face="arial, sans-serif">Methods:</font></div><div style="background-color:transparent"><font face="arial, sans-serif"><br /></font></div><div style="background-color:transparent"><i><font face="arial, sans-serif">getChannelId</font></i></div><div style="background-color:transparent"><i><font face="arial, sans-serif">chrome.pushMessaging.getChannelId(function callback)</font></i></div><div style="background-color:transparent"><font face="arial, sans-serif">Retrieves the channel ID associated with an extension. This contains the obfuscated user ID combined with the extension ID; the typical usage is for the extension to send the channel ID to its app server to allow the app server to trigger push messages.</font></div><div style="background-color:transparent"><font face="arial, sans-serif"><br /></font></div><div style="background-color:transparent"><i><font face="arial, sans-serif">callback ( function )</font></i></div><div style="background-color:transparent"><font face="arial, sans-serif">Called when channel ID has been retrieved.</font></div><div style="background-color:transparent"><font face="arial, sans-serif"><br /></font></div><div style="background-color:transparent"><i><font face="arial, sans-serif">Callback function:</font></i></div><div style="background-color:transparent"><font face="arial, sans-serif">The callback parameter should specify a function that looks like this:</font></div><div style="background-color:transparent"><i><font face="arial, sans-serif">function(string channelID) {...};</font></i></div><div style="background-color:transparent"><font face="arial, sans-serif"><br /></font></div><div style="background-color:transparent"><i><font face="arial, sans-serif">channelID ( string )</font></i></div><div style="background-color:transparent"><font face="arial, sans-serif">Contains the channel ID of the extension.</font></div><div style="background-color:transparent"><font face="arial, sans-serif"><br /></font></div><div style="background-color:transparent"><font face="arial, sans-serif">Events:</font></div><div style="background-color:transparent"><font face="arial, sans-serif"><br /></font></div><div style="background-color:transparent"><i><font face="arial, sans-serif">onMessage</font></i></div><div style="background-color:transparent"><i><font face="arial, sans-serif">chrome.pushMessaging.onMessage.addListener(function(Message message) { ... });</font></i></div><div style="background-color:transparent"><font face="arial, sans-serif">Fired when a push message is received.</font></div><div style="background-color:transparent"><font face="arial, sans-serif"><br /></font></div><div style="background-color:transparent"><i><font face="arial, sans-serif">Listener parameters:</font></i></div><div style="background-color:transparent"><i><font face="arial, sans-serif">message ( Message )</font></i></div><div style="background-color:transparent"><font face="arial, sans-serif">The data associated with the message.</font></div><div style="background-color:transparent"><font face="arial, sans-serif"><br /></font></div><div style="background-color:transparent"><font face="arial, sans-serif">Types:</font></div><div style="background-color:transparent"><i><font face="arial, sans-serif">Message</font></i></div><div style="background-color:transparent"><i><font face="arial, sans-serif">( object )</font></i></div><div style="background-color:transparent"><font face="arial, sans-serif">Stores data about a push message.</font></div><div style="background-color:transparent"><font face="arial, sans-serif"><br /></font></div><div style="background-color:transparent"><i><font face="arial, sans-serif">  subchannel ( number )</font></i></div><div style="background-color:transparent"><font face="arial, sans-serif">    The subchannel the push message was received for.</font></div><div style="background-color:transparent"><font face="arial, sans-serif"><br /></font></div><div style="background-color:transparent"><i><font face="arial, sans-serif">  payload ( string)</font></i></div><div style="background-color:transparent"><font face="arial, sans-serif">    The payload associated with the push message. Delivery of the payload is not guaranteed; failure to deliver the payload will result in value being set to an empty string.</font></div><div style="background-color:transparent"><font face="arial, sans-serif"><br /></font></div><div style="background-color:transparent"><i><font face="arial, sans-serif">  willAcknowledge ( function )</font></i></div><div style="background-color:transparent"><font face="arial, sans-serif">    An extension can call this to indicate that it will manually acknowledge the receipt of the message. This is useful if the extension wants to do something asynchronous in response to a push message and wants it to be re-delivered if it isn't successfully handled for some reason.</font></div><div style="background-color:transparent"><font face="arial, sans-serif"><br /><i>  acknowledge ( function )<br /></i>    Allows an extension which called willAcknowledge() to acknowledge receipt of the push message.<br /><br /><span style="font-weight:bold;vertical-align:baseline;white-space:pre-wrap">Open questions</span><br />willAcknowledge() and acknowledge() may not be possible to implement.</font></div></div></div></div></td></tr></tbody></table>
</div> 
</div> 
<div id="sites-canvas-bottom-panel">
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_page-subpages"> </div>
<div id="sites-attachments-container">
</div>
<a xmlns="http://www.w3.org/1999/xhtml" name="page-comments"></a>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_page-comments"><div class="sites-comment-docos-wrapper"><div class="sites-comment-docos"><div class="sites-comment-docos-background"></div><div class="sites-comment-docos-header"><div class="sites-comment-docos-header-title">Comments</div></div><div id="sites-comment-docos-pane" class="sites-comment-docos-pane"></div></div></div></div>
</div>
</div> 
</td> 
</tr>
</table> 
</div> 
</div> 
<div id="sites-chrome-footer-wrapper">
<div id="sites-chrome-footer-wrapper-inside">
<div id="sites-chrome-footer">
</div>
</div>
</div>
</div> 
</div> 
<div id="sites-chrome-adminfooter-container">
<div xmlns="http://www.w3.org/1999/xhtml" class="sites-adminfooter" role="navigation"><p><a class="sites-system-link" href="https://www.google.com/a/UniversalLogin?service=jotspot&amp;continue=https://sites.google.com/a/chromium.org/dev/developers/design-documents/extensions/proposed-changes/apis-under-development/push-messaging">Sign in</a><span aria-hidden="true">|</span><a class="sites-system-link" href="/system/app/pages/recentChanges">Recent Site Activity</a><span aria-hidden="true">|</span><a class="sites-system-link" href="/system/app/pages/reportAbuse" target="_blank">Report Abuse</a><span aria-hidden="true">|</span><a class="sites-system-link" href="javascript:;" onclick="window.open(webspace.printUrl)">Print Page</a><span aria-hidden="true">|</span><span class="sites-system-link">Powered By</span> <b class="powered-by"><a href="http://sites.google.com">Google Sites</a></b></p></div>
</div>
</div> 
</div> 
<div id="sites-chrome-onebar-footer">
</div>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    window.jstiming.load.tick('sjl');
  </script>
<script xmlns="http://www.w3.org/1999/xhtml" src="https://ssl.gstatic.com/sites/p/56e332/system/js/jot_min_view__en.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    window.jstiming.load.tick('jl');
  </script>
<script xmlns="http://www.w3.org/1999/xhtml">
      
          sites.core.Analytics.createTracker();
          sites.core.Analytics.trackPageview();
        
    </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
                    sites.Searchbox.initialize(
                        'sites-searchbox-search-button',
                        {"object":[]}['object'],
                        'search-site',
                        {"label":"Configure search options...","url":"/system/app/pages/admin/settings"});
                  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
      gsites.HoverPopupMenu.createSiteDropdownMenus('sites-header-nav-dropdown', false);
    </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
            JOT_setupNav("7648876402527094", "Navigation", false);
            JOT_addListener('titleChange', 'JOT_NAVIGATION_titleChange', 'COMP_7648876402527094');
          </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
            JOT_setupNav("14720868319272995", "Quick links", false);
            JOT_addListener('titleChange', 'JOT_NAVIGATION_titleChange', 'COMP_14720868319272995');
          </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
            JOT_setupNav("19690813310444355", "Other sites", false);
            JOT_addListener('titleChange', 'JOT_NAVIGATION_titleChange', 'COMP_19690813310444355');
          </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
              new sites.CommentPane('//docs.google.com/comments/d/AAHRpnXvrAwjAfmld0ObrebBiGRq9nURLcQD-OwryuFwn0iOaI17v67JAO1GMMBnmNK5paEZZ7XZTWxiecLByKtYlrk9eSX4CtP94vLosyl_xXyoFtQNDPoThFtDVIKpg_kK3Q2DP87SM/api/js?anon=true',
                  false, false);
            </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
  setTimeout(function() {
    var fingerprint = gsites.date.TimeZone.getFingerprint([]);
    gsites.Xhr.send('https://www.chromium.org/_/tz', null, null, 'GET', null, null, { afjstz: fingerprint });
  }, 500);
</script>
<script xmlns="http://www.w3.org/1999/xhtml">
                    window.onload = function() {
                      if (false) {
                        JOT_setMobilePreview();
                      }
                      var loadTimer = window.jstiming.load;
                      loadTimer.tick("ol");
                      loadTimer["name"] = "load," + webspace.page.type + ",user_page";
                      window.jstiming.report(loadTimer, {}, 'https://gg.google.com/csi');
                    }
                  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
        JOT_insertAnalyticsCode(false,
            false);
      </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    var maestroRunner = new gsites.pages.view.SitesMaestroRunner(
        webspace, "en");
    maestroRunner.initListeners();
    maestroRunner.installEditRender();
  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
  //<![CDATA[
    // Decorate any fastUI buttons on the page with a class of 'goog-button'.
    if (webspace.user.hasWriteAccess) {
      JOT_decorateButtons();
    }

    // Fires delayed events.
    (function() {
      JOT_fullyLoaded = true;
      var delayedEvents = JOT_delayedEvents;
      for (var x = 0; x < delayedEvents.length; x++) {
        var event = delayedEvents[x];
        JOT_postEvent(event.eventName, event.eventSrc, event.payload);
      }
      JOT_delayedEvents = null;
      JOT_postEvent('pageLoaded');
    })();
  //]]>
</script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    JOT_postEvent('decorateGvizCharts');
  </script>
<script type="text/javascript">
          JOT_setupPostRenderingManager();
        </script>
<script type="text/javascript">
          JOT_postEvent('renderPlus', null, 'sites-chrome-main');
        </script>
<div id="server-timer-div" style="display:none"> </div>
<script type="text/javascript">
          window.jstiming.load.tick('render');
          JOT_postEvent('usercontentrendered', this);
        </script>
</body>
</html>
