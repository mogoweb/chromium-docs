<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/WebPage">
<head>
<meta http-equiv="X-UA-Compatible" content="chrome=1" />
<script type="text/javascript">/* Copyright 2008 Google. */ (function() { var e="wtsrt_",g="tbsd_",h="tbnd_",k="start",l="_wtsrt",m="_tbnd",n="CSI/";(function(){function f(a){this.t={};this.tick=function(a,c,b){this.t[a]=[void 0!=b?b:(new Date).getTime(),c];if(void 0==b)try{window.console.timeStamp(n+a)}catch(d){}};this.tick(k,null,a)}var a;window.performance&&(a=window.performance.timing);var p=a?new f(a.responseStart):new f;window.jstiming={Timer:f,load:p};if(a){var c=a.navigationStart,d=a.responseStart;0<c&&d>=c&&(window.jstiming.srt=d-c)}if(a){var b=window.jstiming.load;0<c&&d>=c&&(b.tick(l,void 0,c),b.tick(e,l,d),b.tick(g,e))}try{a=null,
window.chrome&&window.chrome.csi&&(a=Math.floor(window.chrome.csi().pageT),b&&0<c&&(b.tick(m,void 0,window.chrome.csi().startE),b.tick(h,m,c))),null==a&&window.gtbExternal&&(a=window.gtbExternal.pageT()),null==a&&window.external&&(a=window.external.pageT,b&&0<c&&(b.tick(m,void 0,window.external.startE),b.tick(h,m,c))),a&&(window.jstiming.pt=a)}catch(q){}})(); })()
</script>
<link rel="shortcut icon" href="http://www.chromium.org/_/rsrc/1354323194313/favicon.ico" type="image/x-icon" />
<link rel="apple-touch-icon" href="http://www.gstatic.com/sites/p/56e332/system/app/images/apple-touch-icon.png" type="image/png" />
<script type="text/javascript">/* Copyright 2008 Google. */ (function() { var d="",g="__duration__",h="function";function k(c){return document.getElementById(c)}window.byId=k;function l(c){return c.replace(/^\s+|\s+$/g,d)}window.trim=l;var m=[],n=0;window.JOT_addListener=function(c,a,b){var e=new String(n++);c={eventName:c,handler:a,compId:b,key:e};m.push(c);return e};window.JOT_removeListenerByKey=function(c){for(var a=0;a<m.length;a++)if(m[a].key==c){m.splice(a,1);break}};
window.JOT_removeAllListenersForName=function(c){for(var a=0;a<m.length;a++)m[a].eventName==c&&m.splice(a,1)};window.JOT_postEvent=function(c,a,b){var e={eventName:c,eventSrc:a||{},payload:b||{}};if(window.JOT_fullyLoaded)for(a=m.length,b=0;b<a&&b<m.length;b++){var f=m[b];f&&f.eventName==c&&(e.listenerCompId=f.compId||d,(f=typeof f.handler==h?f.handler:window[f.handler])&&f(e))}else window.JOT_delayedEvents.push({eventName:c,eventSrc:a,payload:b})};window.JOT_delayedEvents=[];
window.JOT_fullyLoaded=!1;window.JOT_formatRelativeToNow=function(c,a){var b=((new Date).getTime()-c)/6E4;if(1440<=b||0>b)return null;var e=0;60<=b&&(b/=60,e=2);2<=b&&e++;return a?window.JOT_siteRelTimeStrs[e].replace(g,Math.floor(b)):window.JOT_userRelTimeStrs[e].replace(g,Math.floor(b))}; })()
</script>
<script>

  

  var breadcrumbs = [{"path":"/developers","deleted":false,"title":"For Developers","dir":"ltr"},{"path":"/developers/design-documents","deleted":false,"title":"Design Documents","dir":"ltr"},{"path":"/developers/design-documents/embedding-flash-fullscreen-in-the-browser-window","deleted":false,"title":"Embedding Flash Fullscreen in the Browser Window","dir":"ltr"}];
  var JOT_clearDotPath = 'http://www.gstatic.com/sites/p/56e332/system/app/images/cleardot.gif';

  
  var JOT_userRelTimeStrs = ["a minute ago","__duration__ minutes ago","an hour ago","__duration__ hours ago"];

  
  

  

  var webspace = {"enableAnalytics":true,"pageSharingId":"jotspot_page","enableUniversalAnalytics":false,"sharingPolicy":"OPENED_WITH_INDICATOR","siteTitle":"The Chromium Projects","isStartPageEnabled":true,"adsensePublisherId":null,"features":{"languageSelectDefaultTextSetToDefault":true,"validateClientGvizDataSourceUrls":true,"moreMobileStyleImprovements":true,"newInsertMenuIcons":true,"accessibleSortingButtons":true,"domainAnalyticsInGAOnly":true,"noCaptcha":true,"fileCabinetScreenReaderFix":true,"updatedTosAndPrivacyLinks":null,"pageDrafts":false,"mobileOrientationFix":true,"plusBadge":false,"pdfEmbedSupport":false,"jsClickFix":true},"isPublic":true,"isConsumer":false,"serverFlags":{"cajaBaseUrl":"//www.gstatic.com/caja","cajaDebugMode":false},"onepickBaseUrl":"https://docs.google.com","domainAnalyticsAccountId":"","plusPageId":"","signInUrl":"https://www.google.com/a/SelectSession?continue\u003dhttp://sites.google.com/a/chromium.org/dev/developers/design-documents/embedding-flash-fullscreen-in-the-browser-window\u0026service\u003djotspot","analyticsAccountId":"UA-5484340-1","scottyUrl":"/_/upload","homePath":"/","siteNoticeUrlEnabled":null,"plusPageUrl":"","adsensePromoClickedOrSiteIneligible":true,"csiReportUri":"http://csi.gstatic.com/csi","sharingId":"jotspot","termsUrl":"//www.google.com/intl/en/policies/terms/","gvizVersion":1,"editorResources":{"sitelayout":["http://www.gstatic.com/sites/p/56e332/system/app/css/sitelayouteditor.css"],"text":["http://www.gstatic.com/sites/p/56e332/system/js/codemirror.js","http://www.gstatic.com/sites/p/56e332/system/app/css/codemirror_css.css","http://www.gstatic.com/sites/p/56e332/system/js/trog_edit__en.js","http://www.gstatic.com/sites/p/56e332/system/app/css/trogedit.css","/_/rsrc/1441580320000/system/app/css/editor.css","http://www.gstatic.com/sites/p/56e332/system/app/css/codeeditor.css","/_/rsrc/1441580320000/system/app/css/camelot/editor-jfk-wlb.css"]},"sharingUrlPrefix":"/_/sharing","isAdsenseEnabled":true,"domain":"chromium.org","baseUri":"","name":"dev","siteTemplateId":false,"siteNoticeRevision":null,"siteNoticeUrlAddress":null,"siteNoticeMessage":null,"page":{"isRtlLocale":false,"canDeleteWebspace":null,"isPageDraft":null,"parentPath":"/developers/design-documents","parentWuid":"wuid:gx:359ef223e0fb14ac","siteLocale":"en","timeZone":"America/Los_Angeles","type":"text","title":"Embedding Flash Fullscreen in the Browser Window","locale":"en","wuid":"wuid:gx:38435ec0c02c43d1","revision":2,"path":"/developers/design-documents/embedding-flash-fullscreen-in-the-browser-window","isSiteRtlLocale":false,"pageInheritsPermissions":null,"name":"embedding-flash-fullscreen-in-the-browser-window","canChangePath":true,"state":"","properties":{},"bidiEnabled":false,"currentTemplate":{"path":"/system/app/pagetemplates/text","title":"Web Page"}},"canPublishScriptToAnyone":true,"user":{"keyboardShortcuts":true,"sessionIndex":"","guest_":true,"displayNameOrEmail":"guest","userName":"guest","uid":"","renderMobile":false,"domain":"","namespace":"","hasWriteAccess":false,"namespaceUser":false,"primaryEmail":"guest","hasAdminAccess":false},"gadgets":{"baseUri":"/system/app/pages/gadgets"}};
  webspace.page.breadcrumbs = breadcrumbs;

  
  var JOT_siteRelTimeStrs = ["a minute ago","__duration__ minutes ago","an hour ago","__duration__ hours ago"];

</script>
<script type="text/javascript">
                window.jstiming.load.tick('scl');
              </script>
<meta name="title" content="Embedding Flash Fullscreen in the Browser Window - The Chromium Projects" />
<meta itemprop="name" content="Embedding Flash Fullscreen in the Browser Window - The Chromium Projects" />
<meta property="og:title" content="Embedding Flash Fullscreen in the Browser Window - The Chromium Projects" />
<meta name="description" content="Home of the Chromium Open Source Project" />
<meta itemprop="description" content="Home of the Chromium Open Source Project" />
<meta id="meta-tag-description" property="og:description" content="Home of the Chromium Open Source Project" />
<style type="text/css">
</style>
<link rel="stylesheet" type="text/css" href="http://www.gstatic.com/sites/p/56e332/system/app/themes/beigeandblue/standard-css-beigeandblue-ltr-ltr.css" />
<link rel="stylesheet" type="text/css" href="http://www.chromium.org/_/rsrc/1441580320000/system/app/css/overlay.css?cb=beigeandblueundefineda100%25%25150goog-ws-leftthemedefaultstandard" />
<link rel="stylesheet" type="text/css" href="http://www.chromium.org/_/rsrc/1441580320000/system/app/css/camelot/allthemes-view.css" />
<!--[if IE]>
          <link rel="stylesheet" type="text/css" href="/system/app/css/camelot/allthemes%2die.css" />
        <![endif]-->
<title>Embedding Flash Fullscreen in the Browser Window - The Chromium Projects</title>
<meta itemprop="image" content="http://www.chromium.org/_/rsrc/1379119228990/developers/design-documents/embedding-flash-fullscreen-in-the-browser-window/Design%20Doc-%20Flash%20Fullscreen%20in%20Browser.png.1379119228467.png" />
<meta property="og:image" content="http://www.chromium.org/_/rsrc/1379119228990/developers/design-documents/embedding-flash-fullscreen-in-the-browser-window/Design%20Doc-%20Flash%20Fullscreen%20in%20Browser.png.1379119228467.png" />
<script type="text/javascript">
                window.jstiming.load.tick('cl');
              </script>
</head>
<body xmlns="http://www.google.com/ns/jotspot" id="body" class=" en            ">
<div id="sites-page-toolbar" class="sites-header-divider">
<div xmlns="http://www.w3.org/1999/xhtml" id="sites-status" class="sites-status" style="display:none;"><div id="sites-notice" class="sites-notice" role="status" aria-live="assertive"> </div></div>
</div>
<div id="sites-chrome-everything-scrollbar">
<div id="sites-chrome-everything" class="">
<div id="sites-chrome-page-wrapper" style="direction: ltr">
<div id="sites-chrome-page-wrapper-inside">
<div xmlns="http://www.w3.org/1999/xhtml" id="sites-chrome-header-wrapper" style="height:auto;">
<table id="sites-chrome-header" class="sites-layout-hbox" cellspacing="0" style="height:auto;">
<tr class="sites-header-primary-row" id="sites-chrome-userheader">
<td id="sites-header-title" class="" role="banner"><div class="sites-header-cell-buffer-wrapper"><a href="http://www.chromium.org/" id="sites-chrome-userheader-logo"><img id="logo-img-id" src="http://www.chromium.org/_/rsrc/1438879449147/config/customLogo.gif?revision=3" alt="The Chromium Projects" class="sites-logo  " /></a><h2><a href="http://www.chromium.org/" dir="ltr" id="sites-chrome-userheader-title">The Chromium Projects</a></h2></div></td><td class="sites-layout-searchbox  "><div class="sites-header-cell-buffer-wrapper"><form id="sites-searchbox-form" action="http://www.chromium.org/system/app/pages/search" role="search"><input type="hidden" id="sites-searchbox-scope" name="scope" value="search-site" /><input type="text" id="jot-ui-searchInput" name="q" size="20" value="" aria-label="Search this site" /><div id="sites-searchbox-button-set" class="goog-inline-block"><div role="button" id="sites-searchbox-search-button" class="goog-inline-block jfk-button jfk-button-standard" tabindex="0">Search this site</div></div></form></div></td>
</tr>
<tr class="sites-header-secondary-row" id="sites-chrome-horizontal-nav">
<td colspan="2" id="sites-chrome-header-horizontal-nav-container" role="navigation">
</td>
</tr>
</table>
</div>
<div id="sites-chrome-main-wrapper">
<div id="sites-chrome-main-wrapper-inside">
<table id="sites-chrome-main" class="sites-layout-hbox" cellspacing="0" cellpadding="{scmCellpadding}" border="0">
<tr>
<td id="sites-chrome-sidebar-left" class="sites-layout-sidebar-left initial" style="width:150px">
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_7648876402527094" class="sites-embed" role="navigation"><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotId="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="http://www.chromium.org/chromium-projects" jotId="wuid:gx:10ae433dadbbab13" class="sites-navigation-link">Home</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="../../Home.html" jotId="wuid:gx:43582b9d2029d3af" class="sites-navigation-link">Chromium</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="../../chromium-os.html" jotId="wuid:gx:83df2ab1f8880ba" class="sites-navigation-link">Chromium OS</a></div></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_14720868319272995" class="sites-embed" role="navigation"><h4 class="sites-embed-title">Quick links</h4><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotId="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="../../for-testers/bug-reporting-guidelines.html" class="sites-navigation-link">Report bugs</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="../discussion-groups.html" class="sites-navigation-link">Discuss</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="http://www.chromium.org/system/app/pages/sitemap/hierarchy" jotId="wuid:gx:fe204a485666144" class="sites-navigation-link">Sitemap</a></div></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_19690813310444355" class="sites-embed" role="navigation"><h4 class="sites-embed-title">Other sites</h4><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotId="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="http://blog.chromium.org/" class="sites-navigation-link">Chromium Blog</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="http://code.google.com/chrome/extensions/" class="sites-navigation-link">Google Chrome Extensions</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="https://developers.google.com/chrome/chrome-frame/" class="sites-navigation-link">Google Chrome Frame</a></div></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_19695218559354544" class="sites-embed" role="complementary"><h4 class="sites-embed-title"></h4><div class="sites-embed-content sites-embed-content-sidebar-textbox"><div dir="ltr"><span style="font-size:x-small">Except as otherwise </span><a href="http://developers.google.com/site-policies.html#restrictions"><span style="font-size:x-small">noted</span></a><span style="font-size:x-small">, the content of this page is licensed under a </span><a href="http://creativecommons.org/licenses/by/2.5/"><span style="font-size:x-small">Creative Commons Attribution 2.5 license</span></a><span style="font-size:x-small">, and examples are licensed under the </span><a href="http://src.chromium.org/viewvc/chrome/trunk/src/LICENSE" target="_blank"><span style="font-size:x-small">BSD License</span></a><span style="font-size:x-small">.<br /></span></div></div></div>
</td>
<td id="sites-canvas-wrapper">
<div id="sites-canvas" role="main">
<div id="goog-ws-editor-toolbar-container"> </div>
<div xmlns="http://www.w3.org/1999/xhtml" id="title-crumbs" style="">
<A href="http://www.chromium.org/developers" dir="ltr">For Developers</A>‎ &gt; ‎<A href="../design-documents.html" dir="ltr">Design Documents</A>‎ &gt; ‎
  </div>
<h3 xmlns="http://www.w3.org/1999/xhtml" id="sites-page-title-header" style="" align="left">
<span id="sites-page-title" dir="ltr" tabindex="-1" style="outline: none">Embedding Flash Fullscreen in the Browser Window</span>
</h3>
<div id="sites-canvas-main" class="sites-canvas-main">
<div id="sites-canvas-main-content">
<table xmlns="http://www.w3.org/1999/xhtml" cellspacing="0" class="sites-layout-name-one-column sites-layout-hbox"><tbody><tr><td class="sites-layout-tile sites-tile-name-content-1"><div dir="ltr"><span><h1 dir="ltr" style="text-align:left;line-height:1;margin-top:12pt;margin-bottom:12pt"><a name="TOC-Author:-Yuri-Wiitala-miu-chromium.org-"></a><span style="background-color:transparent;font-family:Verdana;white-space:pre-wrap;line-height:1;font-size:10pt;font-weight:normal">Author: Yuri Wiitala (miu@chromium.org)</span></h1><br /><h1 dir="ltr" style="line-height:1;margin-top:10pt;margin-bottom:12pt"><a name="TOC-Objective"></a><span style="font-size:24px;font-family:Verdana;color:rgb(61,133,198);background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Objective</span></h1><p dir="ltr" style="line-height:1;margin-top:0pt;margin-bottom:0pt"><span style="font-family:Verdana;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Enhance the [Pepper] Flash fullscreen user experience in Chromium to match the HTML5 fullscreen experience.  This would provide users with a single, consistent fullscreen-mode experience, with Flash fullscreen gaining the improved window/desktop management behaviors of HTML5 fullscreen.  For example, on Mac, one cannot switch to other apps from Flash fullscreen, but this action is intelligently handled in the HTML5 fullscreen case.</span></p><br /><p dir="ltr" style="line-height:1;margin-top:0pt;margin-bottom:0pt"><span style="font-family:Verdana;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Side note: Later on, we seek to improve the fullscreen UX further by introducing a new "Fullscreen in Tab" concept for tab capture/screencasting (</span><a href="http://crbug.com/256870" style="text-decoration:none"><span style="font-family:Verdana;color:rgb(17,85,204);background-color:transparent;text-decoration:underline;vertical-align:baseline;white-space:pre-wrap">http://crbug.com/256870</span></a><span style="font-family:Verdana;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">).  While a user is "casting," fullscreen content is being displayed on a remote screen.  Therefore, the local screen should be usable for other tabs or applications.  The changes proposed in this document are a necessary prerequisite for this.</span></p><br /><br /><p dir="ltr" style="line-height:1;margin-top:0pt;margin-bottom:0pt"><span style="font-size:24px;font-family:Verdana;color:rgb(61,133,198);background-color:transparent;font-weight:bold;vertical-align:baseline;white-space:pre-wrap">Background</span></p><br /><p dir="ltr" style="line-height:1;margin-top:0pt;margin-bottom:0pt"><span style="font-family:Verdana;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Currently, Flash fullscreen is implemented in the "content" component where a raw, platform-dependent fullscreen window is created.  Some minimal focus/keyboard control logic is added to support exit and mouse-lock.  The entire stack assumes the Flash plugin handles the user permissions with respect to allowing fullscreen and/or mouse-locking, and so blindly allows all requests.</span></p><br /><p dir="ltr" style="line-height:1;margin-top:0pt;margin-bottom:0pt"><span style="font-family:Verdana;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Fullscreen mode is initiated by the render process, which is proxying the request from the Pepper Flash process.  It sends a "create" message followed immediately by a "show" message.  Once the fullscreen window is shown, a resize message is sent back to the renderer as a signal that painting may begin.</span></p><br /><p dir="ltr" style="line-height:1;margin-top:0pt;margin-bottom:0pt"><span style="font-family:Verdana;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">The control flow for entering and exiting Flash fullscreen is as follows:</span></p><br /><div style="display:block;text-align:left"><a href="http://www.chromium.org/developers/design-documents/embedding-flash-fullscreen-in-the-browser-window/Design%20Doc-%20Flash%20Fullscreen%20in%20Browser.png.1379119228467.png?attredirects=0" imageanchor="1"><img border="0" src="http://www.chromium.org/_/rsrc/1379119228990/developers/design-documents/embedding-flash-fullscreen-in-the-browser-window/Design%20Doc-%20Flash%20Fullscreen%20in%20Browser.png.1379119228467.png" /></a></div><br /><p dir="ltr" style="line-height:1;margin-top:0pt;margin-bottom:0pt"><span style="font-family:Verdana;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">On the other hand, the Browser (user-initiated, "F11") and Tab/HTML5 (renderer-initiated) fullscreen modes are controlled by the browser UI implementation in the "chrome" component, one abstraction level higher.  The browser uses FullscreenController to manage the window sizing and show "permissions balloons" for both modes, and handles the transitions of switching in-between or in-and-out.</span></p><br /><p dir="ltr" style="line-height:1;margin-top:0pt;margin-bottom:0pt"><span style="font-family:Verdana;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">To engage fullscreen mode for an HTML5 element, the renderer sends a "toggle" message to the browser process.  Unlike Flash fullscreen, no new widgets are created.  FullscreenController instructs the browser window to expand to fill the screen, and this causes the tab content view to be resized via the layout process.  Then, the renderer process receives a resize message signalling that fullscreen mode is on.  The originating HTML5 element (e.g., a video element), will then be resized to fill the content area.</span></p><br /><p dir="ltr" style="line-height:1;margin-top:0pt;margin-bottom:0pt"><span style="font-family:Verdana;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">The control flow for entering and exiting HTML5 fullscreen is as follows:</span></p><br /><div style="display:block;text-align:left"><a href="http://www.chromium.org/developers/design-documents/embedding-flash-fullscreen-in-the-browser-window/Design%20Doc-%20Flash%20Fullscreen%20in%20Browser%20%281%29.png.1379119292169.png?attredirects=0" imageanchor="1"><img border="0" src="http://www.chromium.org/_/rsrc/1379119292389/developers/design-documents/embedding-flash-fullscreen-in-the-browser-window/Design%20Doc-%20Flash%20Fullscreen%20in%20Browser%20%281%29.png.1379119292169.png" /></a></div><br /><p dir="ltr" style="line-height:1;margin-top:0pt;margin-bottom:0pt"><span style="font-family:Verdana;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Thus, there exist two separate fullscreen control/view implementations in Chromium that operate independently and at different component layers.  There actually exists a conflict, should a page choose to initiate HTML5 fullscreen during Flash fullscreen or vice versa.</span></p><br /><h1 dir="ltr" style="line-height:1;margin-top:10pt;margin-bottom:12pt"><a name="TOC-Observations-and-Goals"></a><span style="font-size:24px;font-family:Verdana;color:rgb(61,133,198);background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Observations and Goals</span></h1><p dir="ltr" style="line-height:1;margin-top:0pt;margin-bottom:0pt"><span style="font-family:Verdana;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Fortunately, there are key similarities between the implementations of Flash fullscreen and HTML5 fullscreen that suggests the former can be merged into the machinery of the latter.  First, renderer-side, both send one or more messages to the browser process to engage fullscreen mode, and both expect an asynchronous ViewMsg_Resize message to confirm and receive the fullscreen dimensions.  Second, browser-side, the messages from the renderer are handled by delegating to the same WebContentsImpl instance to initialize and kick-off.  Finally, the browser process sends one or more ViewMsg_Resize messages to notify the renderer of "screen size" changes, and a ViewMsg_Close to shut down rendering of the widget.</span></p><br /><p dir="ltr" style="line-height:1;margin-top:0pt;margin-bottom:0pt"><span style="font-family:Verdana;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">In the past, developing for the Pepper Flash plugin required overcoming very temperamental compatibility issues.  Since one permeating goal is to ensure Flash fullscreen does not break, no changes will be made that could be observable by the renderer process (and, by proxy, the pepper flash plugin).  This means no changes to IPC messaging, with the ordering and content of the messages being exactly the same as in the current implementation.</span></p><br /><p dir="ltr" style="line-height:1;margin-top:0pt;margin-bottom:0pt"><span style="font-family:Verdana;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">If we are to proceed, one UX issue to resolve is the "Press Esc to Exit Fullscreen" message rendered by the Pepper Flash plugin: Ideally, for consistency, this would be removed in favor of the balloon pop-up shown by FullscreenController.  If this is not possible, then the balloon pop-up should not be displayed for Flash.</span></p><br /><h1 dir="ltr" style="line-height:1;margin-top:10pt;margin-bottom:12pt"><a name="TOC-Design"></a><span style="font-size:24px;font-family:Verdana;color:rgb(61,133,198);background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Design</span></h1><p dir="ltr" style="line-height:1;margin-top:0pt;margin-bottom:0pt"><span style="font-family:Verdana;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">A three-part change to the existing design is proposed.  First, the Flash "fullscreen" render widget will become embedded within the browser window.  More specifically, it will replace the normal tab content view in the view hierarchy and participate in layout like any other widget.  The owner and creator of the widget will remain the same and, from the renderer's perspective, Flash will still be painting into its own dedicated "fullscreen" widget.</span></p><br /><p dir="ltr" style="line-height:1;margin-top:0pt;margin-bottom:0pt"><span style="font-family:Verdana;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Second, the FullscreenController will be used to manage the the sizing/expansion of the browser window for all fullscreen modes, including Flash, and will treat Flash fullscreen in the same way as HTML5 fullscreen.  As an embedded widget within the browser window, the Flash fullscreen widget will become expanded to fill the entire screen during the layout process.  FullscreenController itself will need only small tweaks: Just as for HTML5 fullscreen, it will be tasked to decide whether the fullscreen and mouse-lock privileges are allowed, but will instead treat Flash fullscreen mode as fully-privileged by default.</span></p><br /><p dir="ltr" style="line-height:1;margin-top:0pt;margin-bottom:0pt"><span style="font-family:Verdana;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Finally, WebContentsImpl will be modified to invoke the new "embedded widget" code paths for startup and shutdown (described in detail below).  Use of the new code paths versus the old will be switchable via a new WebContentsDelegate method, EmbedsFullscreenWidget().  This method will declare whether the browser implements embedded Flash fullscreen and whether it is enabled/disabled via command-line flags.</span></p><br /><p dir="ltr" style="line-height:1;margin-top:0pt;margin-bottom:0pt"><span style="font-family:Verdana;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">The control flow for entering and exiting embedded Flash fullscreen is as follows (additions/changes in </span><span style="font-family:Verdana;color:rgb(153,0,0);background-color:transparent;vertical-align:baseline;white-space:pre-wrap">red</span><span style="font-family:Verdana;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">):</span></p><br /><div style="display:block;text-align:left"><a href="http://www.chromium.org/developers/design-documents/embedding-flash-fullscreen-in-the-browser-window/Design%20Doc-%20Flash%20Fullscreen%20in%20Browser%20%282%29.png.1379119349348.png?attredirects=0" imageanchor="1"><img border="0" src="http://www.chromium.org/_/rsrc/1379119349755/developers/design-documents/embedding-flash-fullscreen-in-the-browser-window/Design%20Doc-%20Flash%20Fullscreen%20in%20Browser%20%282%29.png.1379119349348.png" /></a></div><br /><h2 dir="ltr" style="line-height:1;margin-top:10pt;margin-bottom:0pt"><a name="TOC-Entering-Embedded-Flash-Fullscreen-Mode"></a><span style="font-size:17px;font-family:Trebuchet MS;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Entering Embedded Flash Fullscreen Mode</span></h2><br /><p dir="ltr" style="line-height:1;margin-top:0pt;margin-bottom:0pt"><span style="font-family:Verdana;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">WebContentsImpl drives this process, being the delegate of the RenderViewHostImpl which receives the "show" message from the renderer.  Instead of showing the window it created as a raw, fullscreened window, the behavior of ShowCreatedFullscreenWidget() changes to the following:</span></p><br /><ol style="margin-top:0pt;margin-bottom:0pt"><li dir="ltr" style="list-style-type:decimal;font-family:Verdana;background-color:transparent;vertical-align:baseline"><p dir="ltr" style="line-height:1;margin-top:0pt;margin-bottom:0pt"><span style="background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Toggle the Browser into fullscreen mode via the same code path as for HTML5 fullscreen.  This triggers FullscreenController's logic which will cause the BrowserWindow to expand and re-layout for full-screen.  In addition, the "Allow/Exit" balloon pop-up will be shown, if appropriate.</span></p></li><li dir="ltr" style="list-style-type:decimal;font-family:Verdana;background-color:transparent;vertical-align:baseline"><p dir="ltr" style="line-height:1;margin-top:0pt;margin-bottom:0pt"><span style="background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Invoke WebContentsObserver::DidShowFullscreenWidget() for all observers.  This will be received by WebView (or TabContentsController for Mac), which is the child view within BrowserWindow that contains the tab content.  WebView will alter its child window hierarchy to embed the Flash fullscreen widget within itself and, therefore, within the fullscreened BrowserWindow.  WebView accesses the Flash fullscreen widget via a new WebContents::GetFullscreenRenderWidget() method.</span></p></li></ol><br /><h2 dir="ltr" style="line-height:1;margin-top:10pt;margin-bottom:0pt"><a name="TOC-Exiting-Embedded-Flash-Fullscreen-Mode"></a><span style="font-size:17px;font-family:Trebuchet MS;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Exiting Embedded Flash Fullscreen Mode</span></h2><br /><p dir="ltr" style="line-height:1;margin-top:0pt;margin-bottom:0pt"><span style="font-family:Verdana;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Exiting must be considered from two possible originators.  When the exit is requested by the Flash widget itself, RenderWidgetHostImpl::Shutdown() will be invoked in the browser process, which in turn calls WebContentsImpl::RenderWidgetDeleted().  From here, two steps are taken:</span></p><br /><ol style="margin-top:0pt;margin-bottom:0pt"><li dir="ltr" style="list-style-type:decimal;font-family:Verdana;background-color:transparent;vertical-align:baseline"><p dir="ltr" style="line-height:1;margin-top:0pt;margin-bottom:0pt"><span style="background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Toggle the Browser out of fullscreen mode.  FullscreenController performs the same actions as it would for coming out of HTML5 fullscreen, restoring the original size and layout of the BrowserWindow.</span></p></li><li dir="ltr" style="list-style-type:decimal;font-family:Verdana;background-color:transparent;vertical-align:baseline"><p dir="ltr" style="line-height:1;margin-top:0pt;margin-bottom:0pt"><span style="background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Invoke WebContentsObserver::DidHideFullscreenWidget() for all observers.  WebView receives this and responds by re-attaching the normal tab content view in its child window hierarchy.</span></p></li></ol><br /><p dir="ltr" style="line-height:1;margin-top:0pt;margin-bottom:0pt"><span style="font-family:Verdana;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">When the exit originates from the Browser UI (e.g., user action in the "Allow/Exit" balloon):</span></p><br /><ol style="margin-top:0pt;margin-bottom:0pt"><li dir="ltr" style="list-style-type:decimal;font-family:Verdana;background-color:transparent;vertical-align:baseline"><p dir="ltr" style="line-height:1;margin-top:0pt;margin-bottom:0pt"><span style="background-color:transparent;vertical-align:baseline;white-space:pre-wrap">FullscreenController takes the BrowserWindow out of fullscreen mode, just like HTML5 fullscreen mode.</span></p></li><li dir="ltr" style="list-style-type:decimal;font-family:Verdana;background-color:transparent;vertical-align:baseline"><p dir="ltr" style="line-height:1;margin-top:0pt;margin-bottom:0pt"><span style="background-color:transparent;vertical-align:baseline;white-space:pre-wrap">FullscreenController invokes RenderViewHostImpl::ExitFullscreen().  Again, this is just like HTML5 fullscreen mode.</span></p></li><li dir="ltr" style="list-style-type:decimal;font-family:Verdana;background-color:transparent;vertical-align:baseline"><p dir="ltr" style="line-height:1;margin-top:0pt;margin-bottom:0pt"><span style="background-color:transparent;vertical-align:baseline;white-space:pre-wrap">At this point, RenderViewHostImpl notices a Flash fullscreen widget is active, and invokes its RenderWidgetHostImpl::Shutdown() method.  As described above, shutting down the widget will cause the DidHideFullscreenWidget() notification to be sent to WebView, restoring the normal tab content view in the browser window.</span></p></li></ol><br /><h2 dir="ltr" style="line-height:1;margin-top:10pt;margin-bottom:0pt"><a name="TOC-Other-Considerations"></a><span style="font-size:17px;font-family:Trebuchet MS;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Other Considerations</span></h2><br /><p dir="ltr" style="line-height:1;margin-top:0pt;margin-bottom:0pt"><span style="font-family:Verdana;background-color:transparent;font-weight:bold;vertical-align:baseline;white-space:pre-wrap">Windows 8 Metro Snap mode</span><span style="font-family:Verdana;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">: When entering Flash fullscreen mode, the FullscreenController will no-op.  However, WebView will still receive the DidShowFullscreenWidget() notification, allowing it to correctly embed the Flash fullscreen widget within itself, all properly laid out within the Metro-Snapped browser window.</span></p><br /><p dir="ltr" style="line-height:1;margin-top:0pt;margin-bottom:0pt"><span style="font-family:Verdana;background-color:transparent;font-weight:bold;vertical-align:baseline;white-space:pre-wrap">Kiosk (Fullscreen App) mode</span><span style="font-family:Verdana;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">: Just like Windows 8 Metro Snap mode, the FullscreenController will no-op and WebView will correctly embed the Flash fullscreen widget.</span></p><br /><p dir="ltr" style="line-height:1;margin-top:0pt;margin-bottom:0pt"><span style="font-family:Verdana;background-color:transparent;font-weight:bold;vertical-align:baseline;white-space:pre-wrap">Content Shell and non-Chromium applications</span><span style="font-family:Verdana;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> that use src/content/ as a library: By default, the non-embed Flash fullscreen code path will be used.  The key to this is the new WebContentsDelegate::EmbedsFullscreenWidget() method, whose default implementation returns false.  The method is only overridden to return true for the Chromium browser on supported platforms.</span></p><br /><h1 dir="ltr" style="line-height:1;margin-top:10pt;margin-bottom:12pt"><a name="TOC-Work-Plan"></a><span style="font-size:24px;font-family:Verdana;color:rgb(61,133,198);background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Work Plan</span></h1><p dir="ltr" style="line-height:1;margin-top:0pt;margin-bottom:0pt"><span style="font-family:Verdana;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Prototyping/Feasibility of Design: </span><span style="font-family:Verdana;background-color:transparent;font-weight:bold;vertical-align:baseline;white-space:pre-wrap">Completed</span><span style="font-family:Verdana;background-color:transparent;vertical-align:baseline;white-space:pre-wrap"> (</span><a href="http://crrev.com/23656002" style="text-decoration:none"><span style="font-family:Verdana;color:rgb(17,85,204);background-color:transparent;text-decoration:underline;vertical-align:baseline;white-space:pre-wrap">http://crrev.com/23656002</span></a><span style="font-family:Verdana;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">).</span></p><br /><p dir="ltr" style="line-height:1;margin-top:0pt;margin-bottom:0pt"><span style="font-family:Verdana;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Implementation for Aura, Windows and Mac; disabled by default, behind feature flag: M31 (<a href="http://crrev.com/23477051">http://crrev.com/23477051</a>).</span></p><p dir="ltr" style="line-height:1;margin-top:0pt;margin-bottom:0pt"><span style="font-family:Verdana;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Implementation for GTK: M32 (with M31 as a stretch goal).</span></p><br /><p dir="ltr" style="line-height:1;margin-top:0pt;margin-bottom:0pt"><span style="font-family:Verdana;background-color:transparent;vertical-align:baseline;white-space:pre-wrap">Launch goal: Tested, UI review, and enabled by default for M32.</span></p><br /></span></div></td></tr></tbody></table>
</div> 
</div> 
<div id="sites-canvas-bottom-panel">
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_page-subpages"> </div>
<div id="sites-attachments-container">
</div>
<a xmlns="http://www.w3.org/1999/xhtml" name="page-comments"></a>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_page-comments"><div class="sites-comment-docos-wrapper"><div class="sites-comment-docos"><div class="sites-comment-docos-background"></div><div class="sites-comment-docos-header"><div class="sites-comment-docos-header-title">Comments</div></div><div id="sites-comment-docos-pane" class="sites-comment-docos-pane"></div></div></div></div>
</div>
</div> 
</td> 
</tr>
</table> 
</div> 
</div> 
<div id="sites-chrome-footer-wrapper">
<div id="sites-chrome-footer-wrapper-inside">
<div id="sites-chrome-footer">
</div>
</div>
</div>
</div> 
</div> 
<div id="sites-chrome-adminfooter-container">
<div xmlns="http://www.w3.org/1999/xhtml" class="sites-adminfooter" role="navigation"><p><a class="sites-system-link" href="https://www.google.com/a/UniversalLogin?service=jotspot&amp;continue=http://sites.google.com/a/chromium.org/dev/developers/design-documents/embedding-flash-fullscreen-in-the-browser-window">Sign in</a><span aria-hidden="true">|</span><a class="sites-system-link" href="http://www.chromium.org/system/app/pages/recentChanges">Recent Site Activity</a><span aria-hidden="true">|</span><a class="sites-system-link" href="http://www.chromium.org/system/app/pages/reportAbuse" target="_blank">Report Abuse</a><span aria-hidden="true">|</span><a class="sites-system-link" href="javascript:;" onclick="window.open(webspace.printUrl)">Print Page</a><span aria-hidden="true">|</span><span class="sites-system-link">Powered By</span> <b class="powered-by"><a href="http://sites.google.com">Google Sites</a></b></p></div>
</div>
</div> 
</div> 
<div id="sites-chrome-onebar-footer">
</div>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    window.jstiming.load.tick('sjl');
  </script>
<script xmlns="http://www.w3.org/1999/xhtml" src="http://www.gstatic.com/sites/p/56e332/system/js/jot_min_view__en.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    window.jstiming.load.tick('jl');
  </script>
<script xmlns="http://www.w3.org/1999/xhtml">
      
          sites.core.Analytics.createTracker();
          sites.core.Analytics.trackPageview();
        
    </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
                    sites.Searchbox.initialize(
                        'sites-searchbox-search-button',
                        {"object":[]}['object'],
                        'search-site',
                        {"label":"Configure search options...","url":"/system/app/pages/admin/settings"});
                  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
      gsites.HoverPopupMenu.createSiteDropdownMenus('sites-header-nav-dropdown', false);
    </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
            JOT_setupNav("7648876402527094", "Navigation", false);
            JOT_addListener('titleChange', 'JOT_NAVIGATION_titleChange', 'COMP_7648876402527094');
          </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
            JOT_setupNav("14720868319272995", "Quick links", false);
            JOT_addListener('titleChange', 'JOT_NAVIGATION_titleChange', 'COMP_14720868319272995');
          </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
            JOT_setupNav("19690813310444355", "Other sites", false);
            JOT_addListener('titleChange', 'JOT_NAVIGATION_titleChange', 'COMP_19690813310444355');
          </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
              new sites.CommentPane('//docs.google.com/comments/d/AAHRpnXvrAwjAfmld0ObrebBiGRq94dJy8F1b4SpB8JQMXdnVD_glDrI-gb5iUKbtaG6iAgRTB9LmHukF5j8k_7Qhn6TaDM3ChAK4AXqR1bkiZlyRvu8Gy-XI6o5azkGhI4SpIBlGw3-i/api/js?anon=true',
                  false, false);
            </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
  setTimeout(function() {
    var fingerprint = gsites.date.TimeZone.getFingerprint([]);
    gsites.Xhr.send('http://www.chromium.org/_/tz', null, null, 'GET', null, null, { afjstz: fingerprint });
  }, 500);
</script>
<script xmlns="http://www.w3.org/1999/xhtml">
                    window.onload = function() {
                      if (false) {
                        JOT_setMobilePreview();
                      }
                      var loadTimer = window.jstiming.load;
                      loadTimer.tick("ol");
                      loadTimer["name"] = "load," + webspace.page.type + ",user_page";
                      window.jstiming.report(loadTimer, {}, 'http://csi.gstatic.com/csi');
                    }
                  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
        JOT_insertAnalyticsCode(false,
            false);
      </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    var maestroRunner = new gsites.pages.view.SitesMaestroRunner(
        webspace, "en");
    maestroRunner.initListeners();
    maestroRunner.installEditRender();
  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
  //<![CDATA[
    // Decorate any fastUI buttons on the page with a class of 'goog-button'.
    if (webspace.user.hasWriteAccess) {
      JOT_decorateButtons();
    }

    // Fires delayed events.
    (function() {
      JOT_fullyLoaded = true;
      var delayedEvents = JOT_delayedEvents;
      for (var x = 0; x < delayedEvents.length; x++) {
        var event = delayedEvents[x];
        JOT_postEvent(event.eventName, event.eventSrc, event.payload);
      }
      JOT_delayedEvents = null;
      JOT_postEvent('pageLoaded');
    })();
  //]]>
</script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    JOT_postEvent('decorateGvizCharts');
  </script>
<script type="text/javascript">
          JOT_setupPostRenderingManager();
        </script>
<script type="text/javascript">
          JOT_postEvent('renderPlus', null, 'sites-chrome-main');
        </script>
<div id="server-timer-div" style="display:none"> </div>
<script type="text/javascript">
          window.jstiming.load.tick('render');
          JOT_postEvent('usercontentrendered', this);
        </script>
</body>
</html>
