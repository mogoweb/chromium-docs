<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/WebPage">
<head>
<meta http-equiv="X-UA-Compatible" content="chrome=1" />
<script type="text/javascript">/* Copyright 2008 Google. */ (function() { var e="wtsrt_",g="tbsd_",h="tbnd_",k="start",l="_wtsrt",m="_tbnd",n="CSI/";(function(){function f(a){this.t={};this.tick=function(a,c,b){this.t[a]=[void 0!=b?b:(new Date).getTime(),c];if(void 0==b)try{window.console.timeStamp(n+a)}catch(d){}};this.tick(k,null,a)}var a;window.performance&&(a=window.performance.timing);var p=a?new f(a.responseStart):new f;window.jstiming={Timer:f,load:p};if(a){var c=a.navigationStart,d=a.responseStart;0<c&&d>=c&&(window.jstiming.srt=d-c)}if(a){var b=window.jstiming.load;0<c&&d>=c&&(b.tick(l,void 0,c),b.tick(e,l,d),b.tick(g,e))}try{a=null,
window.chrome&&window.chrome.csi&&(a=Math.floor(window.chrome.csi().pageT),b&&0<c&&(b.tick(m,void 0,window.chrome.csi().startE),b.tick(h,m,c))),null==a&&window.gtbExternal&&(a=window.gtbExternal.pageT()),null==a&&window.external&&(a=window.external.pageT,b&&0<c&&(b.tick(m,void 0,window.external.startE),b.tick(h,m,c))),a&&(window.jstiming.pt=a)}catch(q){}})(); })()
</script>
<link rel="shortcut icon" href="/_/rsrc/1354323194313/favicon.ico" type="image/x-icon" />
<link rel="apple-touch-icon" href="https://ssl.gstatic.com/sites/p/56e332/system/app/images/apple-touch-icon.png" type="image/png" />
<script type="text/javascript">/* Copyright 2008 Google. */ (function() { var d="",g="__duration__",h="function";function k(c){return document.getElementById(c)}window.byId=k;function l(c){return c.replace(/^\s+|\s+$/g,d)}window.trim=l;var m=[],n=0;window.JOT_addListener=function(c,a,b){var e=new String(n++);c={eventName:c,handler:a,compId:b,key:e};m.push(c);return e};window.JOT_removeListenerByKey=function(c){for(var a=0;a<m.length;a++)if(m[a].key==c){m.splice(a,1);break}};
window.JOT_removeAllListenersForName=function(c){for(var a=0;a<m.length;a++)m[a].eventName==c&&m.splice(a,1)};window.JOT_postEvent=function(c,a,b){var e={eventName:c,eventSrc:a||{},payload:b||{}};if(window.JOT_fullyLoaded)for(a=m.length,b=0;b<a&&b<m.length;b++){var f=m[b];f&&f.eventName==c&&(e.listenerCompId=f.compId||d,(f=typeof f.handler==h?f.handler:window[f.handler])&&f(e))}else window.JOT_delayedEvents.push({eventName:c,eventSrc:a,payload:b})};window.JOT_delayedEvents=[];
window.JOT_fullyLoaded=!1;window.JOT_formatRelativeToNow=function(c,a){var b=((new Date).getTime()-c)/6E4;if(1440<=b||0>b)return null;var e=0;60<=b&&(b/=60,e=2);2<=b&&e++;return a?window.JOT_siteRelTimeStrs[e].replace(g,Math.floor(b)):window.JOT_userRelTimeStrs[e].replace(g,Math.floor(b))}; })()
</script>
<script>

  

  var breadcrumbs = [{"path":"/developers","deleted":false,"title":"For Developers","dir":"ltr"},{"path":"/developers/design-documents","deleted":false,"title":"Design Documents","dir":"ltr"},{"path":"/developers/design-documents/http-authentication","deleted":false,"title":"HTTP authentication","dir":"ltr"},{"path":"/developers/design-documents/http-authentication/writing-a-spnego-authenticator-for-chrome-on-android","deleted":false,"title":"Writing a SPNEGO Authenticator for Chrome on Android","dir":"ltr"}];
  var JOT_clearDotPath = 'https://ssl.gstatic.com/sites/p/56e332/system/app/images/cleardot.gif';

  
  var JOT_userRelTimeStrs = ["a minute ago","__duration__ minutes ago","an hour ago","__duration__ hours ago"];

  
  

  

  var webspace = {"enableAnalytics":true,"pageSharingId":"jotspot_page","enableUniversalAnalytics":false,"sharingPolicy":"OPENED_WITH_INDICATOR","siteTitle":"The Chromium Projects","isStartPageEnabled":true,"adsensePublisherId":null,"features":{"languageSelectDefaultTextSetToDefault":true,"validateClientGvizDataSourceUrls":true,"moreMobileStyleImprovements":true,"newInsertMenuIcons":true,"accessibleSortingButtons":true,"domainAnalyticsInGAOnly":true,"noCaptcha":true,"fileCabinetScreenReaderFix":true,"updatedTosAndPrivacyLinks":null,"pageDrafts":false,"mobileOrientationFix":true,"plusBadge":false,"pdfEmbedSupport":false,"jsClickFix":true},"isPublic":true,"isConsumer":false,"serverFlags":{"cajaBaseUrl":"//www.gstatic.com/caja","cajaDebugMode":false},"onepickBaseUrl":"https://docs.google.com","domainAnalyticsAccountId":"","plusPageId":"","signInUrl":"https://www.google.com/a/SelectSession?continue\u003dhttps://sites.google.com/a/chromium.org/dev/developers/design-documents/http-authentication/writing-a-spnego-authenticator-for-chrome-on-android\u0026service\u003djotspot","analyticsAccountId":"UA-5484340-1","scottyUrl":"/_/upload","homePath":"/","siteNoticeUrlEnabled":null,"plusPageUrl":"","adsensePromoClickedOrSiteIneligible":true,"csiReportUri":"https://gg.google.com/csi","sharingId":"jotspot","termsUrl":"//www.google.com/intl/en/policies/terms/","gvizVersion":1,"editorResources":{"sitelayout":["https://ssl.gstatic.com/sites/p/56e332/system/app/css/sitelayouteditor.css"],"text":["https://ssl.gstatic.com/sites/p/56e332/system/js/codemirror.js","https://ssl.gstatic.com/sites/p/56e332/system/app/css/codemirror_css.css","https://ssl.gstatic.com/sites/p/56e332/system/js/trog_edit__en.js","https://ssl.gstatic.com/sites/p/56e332/system/app/css/trogedit.css","/_/rsrc/1441580320000/system/app/css/editor.css","https://ssl.gstatic.com/sites/p/56e332/system/app/css/codeeditor.css","/_/rsrc/1441580320000/system/app/css/camelot/editor-jfk-wlb.css"]},"sharingUrlPrefix":"/_/sharing","isAdsenseEnabled":true,"domain":"chromium.org","baseUri":"","name":"dev","siteTemplateId":false,"siteNoticeRevision":null,"siteNoticeUrlAddress":null,"siteNoticeMessage":null,"page":{"isRtlLocale":false,"canDeleteWebspace":null,"isPageDraft":null,"parentPath":"/developers/design-documents/http-authentication","parentWuid":"wuid:gx:690eac1b421dc752","siteLocale":"en","timeZone":"America/Los_Angeles","type":"text","title":"Writing a SPNEGO Authenticator for Chrome on Android","locale":"en","wuid":"wuid:gx:4123d8639c441f50","revision":7,"path":"/developers/design-documents/http-authentication/writing-a-spnego-authenticator-for-chrome-on-android","isSiteRtlLocale":false,"pageInheritsPermissions":null,"name":"writing-a-spnego-authenticator-for-chrome-on-android","canChangePath":true,"state":"","properties":{},"bidiEnabled":false,"currentTemplate":{"path":"/system/app/pagetemplates/text","title":"Web Page"}},"canPublishScriptToAnyone":true,"user":{"keyboardShortcuts":true,"sessionIndex":"","guest_":true,"displayNameOrEmail":"guest","userName":"guest","uid":"","renderMobile":false,"domain":"","namespace":"","hasWriteAccess":false,"namespaceUser":false,"primaryEmail":"guest","hasAdminAccess":false},"gadgets":{"baseUri":"/system/app/pages/gadgets"}};
  webspace.page.breadcrumbs = breadcrumbs;

  
  var JOT_siteRelTimeStrs = ["a minute ago","__duration__ minutes ago","an hour ago","__duration__ hours ago"];

</script>
<script type="text/javascript">
                window.jstiming.load.tick('scl');
              </script>
<meta name="title" content="Writing a SPNEGO Authenticator for Chrome on Android - The Chromium Projects" />
<meta itemprop="name" content="Writing a SPNEGO Authenticator for Chrome on Android - The Chromium Projects" />
<meta property="og:title" content="Writing a SPNEGO Authenticator for Chrome on Android - The Chromium Projects" />
<meta name="description" content="Home of the Chromium Open Source Project" />
<meta itemprop="description" content="Home of the Chromium Open Source Project" />
<meta id="meta-tag-description" property="og:description" content="Home of the Chromium Open Source Project" />
<style type="text/css">
</style>
<link rel="stylesheet" type="text/css" href="https://ssl.gstatic.com/sites/p/56e332/system/app/themes/beigeandblue/standard-css-beigeandblue-ltr-ltr.css" />
<link rel="stylesheet" type="text/css" href="/_/rsrc/1441580320000/system/app/css/overlay.css?cb=beigeandblueundefineda100%25%25150goog-ws-leftthemedefaultstandard" />
<link rel="stylesheet" type="text/css" href="/_/rsrc/1441580320000/system/app/css/camelot/allthemes-view.css" />
<!--[if IE]>
          <link rel="stylesheet" type="text/css" href="/system/app/css/camelot/allthemes%2die.css" />
        <![endif]-->
<title>Writing a SPNEGO Authenticator for Chrome on Android - The Chromium Projects</title>
<meta itemprop="image" content="/_/rsrc/1438879449147/config/customLogo.gif?revision=3" />
<meta property="og:image" content="/_/rsrc/1438879449147/config/customLogo.gif?revision=3" />
<script type="text/javascript">
                window.jstiming.load.tick('cl');
              </script>
</head>
<body xmlns="http://www.google.com/ns/jotspot" id="body" class=" en            ">
<div id="sites-page-toolbar" class="sites-header-divider">
<div xmlns="http://www.w3.org/1999/xhtml" id="sites-status" class="sites-status" style="display:none;"><div id="sites-notice" class="sites-notice" role="status" aria-live="assertive"> </div></div>
</div>
<div id="sites-chrome-everything-scrollbar">
<div id="sites-chrome-everything" class="">
<div id="sites-chrome-page-wrapper" style="direction: ltr">
<div id="sites-chrome-page-wrapper-inside">
<div xmlns="http://www.w3.org/1999/xhtml" id="sites-chrome-header-wrapper" style="height:auto;">
<table id="sites-chrome-header" class="sites-layout-hbox" cellspacing="0" style="height:auto;">
<tr class="sites-header-primary-row" id="sites-chrome-userheader">
<td id="sites-header-title" class="" role="banner"><div class="sites-header-cell-buffer-wrapper"><a href="https://www.chromium.org/" id="sites-chrome-userheader-logo"><img id="logo-img-id" src="/_/rsrc/1438879449147/config/customLogo.gif?revision=3" alt="The Chromium Projects" class="sites-logo  " /></a><h2><a href="https://www.chromium.org/" dir="ltr" id="sites-chrome-userheader-title">The Chromium Projects</a></h2></div></td><td class="sites-layout-searchbox  "><div class="sites-header-cell-buffer-wrapper"><form id="sites-searchbox-form" action="/system/app/pages/search" role="search"><input type="hidden" id="sites-searchbox-scope" name="scope" value="search-site" /><input type="text" id="jot-ui-searchInput" name="q" size="20" value="" aria-label="Search this site" /><div id="sites-searchbox-button-set" class="goog-inline-block"><div role="button" id="sites-searchbox-search-button" class="goog-inline-block jfk-button jfk-button-standard" tabindex="0">Search this site</div></div></form></div></td>
</tr>
<tr class="sites-header-secondary-row" id="sites-chrome-horizontal-nav">
<td colspan="2" id="sites-chrome-header-horizontal-nav-container" role="navigation">
</td>
</tr>
</table>
</div>
<div id="sites-chrome-main-wrapper">
<div id="sites-chrome-main-wrapper-inside">
<table id="sites-chrome-main" class="sites-layout-hbox" cellspacing="0" cellpadding="{scmCellpadding}" border="0">
<tr>
<td id="sites-chrome-sidebar-left" class="sites-layout-sidebar-left initial" style="width:150px">
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_7648876402527094" class="sites-embed" role="navigation"><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotId="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="/chromium-projects" jotId="wuid:gx:10ae433dadbbab13" class="sites-navigation-link">Home</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="/Home" jotId="wuid:gx:43582b9d2029d3af" class="sites-navigation-link">Chromium</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="/chromium-os" jotId="wuid:gx:83df2ab1f8880ba" class="sites-navigation-link">Chromium OS</a></div></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_14720868319272995" class="sites-embed" role="navigation"><h4 class="sites-embed-title">Quick links</h4><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotId="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="http://www.chromium.org/for-testers/bug-reporting-guidelines" class="sites-navigation-link">Report bugs</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="http://www.chromium.org/developers/discussion-groups" class="sites-navigation-link">Discuss</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="/system/app/pages/sitemap/hierarchy" jotId="wuid:gx:4b58a9a350ad12f" class="sites-navigation-link">网站地图</a></div></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_19690813310444355" class="sites-embed" role="navigation"><h4 class="sites-embed-title">Other sites</h4><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotId="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="http://blog.chromium.org/" class="sites-navigation-link">Chromium Blog</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="http://code.google.com/chrome/extensions/" class="sites-navigation-link">Google Chrome Extensions</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="https://developers.google.com/chrome/chrome-frame/" class="sites-navigation-link">Google Chrome Frame</a></div></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_19695218559354544" class="sites-embed" role="complementary"><h4 class="sites-embed-title"></h4><div class="sites-embed-content sites-embed-content-sidebar-textbox"><div dir="ltr"><span style="font-size:x-small">Except as otherwise </span><a href="http://developers.google.com/site-policies.html#restrictions"><span style="font-size:x-small">noted</span></a><span style="font-size:x-small">, the content of this page is licensed under a </span><a href="http://creativecommons.org/licenses/by/2.5/"><span style="font-size:x-small">Creative Commons Attribution 2.5 license</span></a><span style="font-size:x-small">, and examples are licensed under the </span><a href="http://src.chromium.org/viewvc/chrome/trunk/src/LICENSE" target="_blank"><span style="font-size:x-small">BSD License</span></a><span style="font-size:x-small">.<br /></span></div></div></div>
</td>
<td id="sites-canvas-wrapper">
<div id="sites-canvas" role="main">
<div id="goog-ws-editor-toolbar-container"> </div>
<div xmlns="http://www.w3.org/1999/xhtml" id="title-crumbs" style="">
<A href="/developers" dir="ltr">For Developers</A>‎ &gt; ‎<A href="/developers/design-documents" dir="ltr">Design Documents</A>‎ &gt; ‎<A href="/developers/design-documents/http-authentication" dir="ltr">HTTP authentication</A>‎ &gt; ‎
  </div>
<h3 xmlns="http://www.w3.org/1999/xhtml" id="sites-page-title-header" style="" align="left">
<span id="sites-page-title" dir="ltr" tabindex="-1" style="outline: none">Writing a SPNEGO Authenticator for Chrome on Android</span>
</h3>
<div id="sites-canvas-main" class="sites-canvas-main">
<div id="sites-canvas-main-content">
<table xmlns="http://www.w3.org/1999/xhtml" cellspacing="0" class="sites-layout-name-one-column sites-layout-hbox"><tbody><tr><td class="sites-layout-tile sites-tile-name-content-1"><div dir="ltr"><span><p dir="ltr" style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"><span style="font-size:14.6666666666667px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">As described in </span><span style="font-size:14.6666666666667px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent"> </span><a href="https://docs.google.com/document/d/1G7WAaYEKMzj16PTHT_cIYuKXJG6bBcrQ7QQBQ6ihOcQ/edit?usp=sharing" style="font-size:13.3333330154419px;line-height:18.3999996185303px;text-decoration:none"><span style="font-size:14.6666666666667px;font-family:Arial;color:rgb(17,85,204);text-decoration:underline;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">Kerberos for Chrome on Android</span></a><span style="font-size:14.6666666666667px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">, in Chrome M46 third parties can </span><span style="font-family:Arial;font-size:14.6666666666667px;white-space:pre-wrap;line-height:1.38;background-color:transparent">enable SPNEGO authentication in Chrome for Android. To do this they must provide a SPNEGO Authenticator. This page describes the interface between Chrome and the SPNEGO Authenticator.</span></p><br /><h1 dir="ltr" style="line-height:1.38;margin-top:10pt;margin-bottom:0pt"><a name="TOC-Basics"></a><span style="font-size:21.3333333333333px;font-family:Trebuchet MS;font-weight:normal;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">Basics</span></h1><br /><p dir="ltr" style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"><span style="font-size:14.6666666666667px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">The SPNEGO Authenticator is provided by an Android Service. This must be incorporated in an app, provided by the third party, installed on the user’s device. The app is responsible for managing any accounts used for SPNEGO authentication, and for all communication with the SPNEGO server.</span></p><br /><p dir="ltr" style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"><span style="font-size:14.6666666666667px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">The SPNEGO Authenticator is an Android AccountAuthenticator. As such it must follow the pattern described in </span><a href="http://developer.android.com/reference/android/accounts/AbstractAccountAuthenticator.html" style="text-decoration:none"><span style="font-size:14.6666666666667px;font-family:Arial;color:rgb(17,85,204);text-decoration:underline;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">AbstractAccountAuthenticator</span></a><span style="font-size:14.6666666666667px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">. In particular it must implement an authenticator class derived from AbstractAccountAuthenticator.</span></p><br /><p dir="ltr" style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"><span style="font-size:14.6666666666667px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">The SPNEGO Authenticator must define a new account type. Its name should be derived from the writer’s domain name (e.g. com.example.spnego). As explained in </span><a href="https://docs.google.com/document/d/1G7WAaYEKMzj16PTHT_cIYuKXJG6bBcrQ7QQBQ6ihOcQ/edit?usp=sharing" style="text-decoration:none"><span style="font-size:14.6666666666667px;font-family:Arial;color:rgb(17,85,204);text-decoration:underline;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">Kerberos for Chrome on Android</span></a><span style="font-size:14.6666666666667px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">, the account type must be defined to use </span><a href="http://developer.android.com/reference/android/R.attr.html#customTokens" style="text-decoration:none"><span style="font-size:14.6666666666667px;font-family:Arial;color:rgb(17,85,204);text-decoration:underline;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">customTokens</span></a><span style="font-size:14.6666666666667px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">. The account type must support the “SPNEGO” feature (HttpNegotiateConstants.SPNEGO_FEATURE</span><span style="font-size:14.6666666666667px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">).</span></p><br /><h1 dir="ltr" style="line-height:1.38;margin-top:10pt;margin-bottom:0pt"><a name="TOC-Interface-to-Chrome"></a><span style="font-size:21.3333333333333px;font-family:Trebuchet MS;font-weight:normal;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">Interface to Chrome</span></h1><br /><p dir="ltr" style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"><span style="font-size:14.6666666666667px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">Chrome finds the SPNEGO authenticator through the Android account type it provides. This is defined by the authenticator, and passed to Chrome through the  AuthAndroidNegotiateAccountType policy.</span></p><br /><p dir="ltr" style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"><span style="font-size:14.6666666666667px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">The interface to Chrome is through the Android account management framework, and in particular through </span><a href="http://developer.android.com/reference/android/accounts/AbstractAccountAuthenticator.html#getAuthToken(android.accounts.AccountAuthenticatorResponse,%20android.accounts.Account,%20java.lang.String,%20android.os.Bundle)" style="text-decoration:none"><span style="font-size:14.6666666666667px;font-family:Arial;color:rgb(17,85,204);text-decoration:underline;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">AbstractAccountManager.getAuthToken</span></a><span style="font-size:14.6666666666667px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">. Chrome, in </span><a href="https://code.google.com/p/chromium/codesearch#chromium/src/net/android/java/src/org/chromium/net/HttpNegotiateConstants.java&amp;q=HttpNeg&amp;sq=package:chromium&amp;l=10" style="text-decoration:none"><span style="font-size:14.6666666666667px;font-family:Arial;color:rgb(17,85,204);text-decoration:underline;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">org.chromium.net.HttpNegotiateConstants</span></a><span style="font-size:14.6666666666667px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">, defines some additional keys and values that are used in the arguments to getAuthToken, and in the returned result bundle.</span></p><h2 dir="ltr" style="line-height:1.38;margin-top:10pt;margin-bottom:0pt"><a name="TOC-getAuthToken-arguments"></a><span style="font-size:17.3333333333333px;font-family:Trebuchet MS;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">getAuthToken arguments</span></h2><p dir="ltr" style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"><span style="font-size:14.6666666666667px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">When </span><a href="http://developer.android.com/reference/android/accounts/AbstractAccountAuthenticator.html#getAuthToken(android.accounts.AccountAuthenticatorResponse,%20android.accounts.Account,%20java.lang.String,%20android.os.Bundle)" style="text-decoration:none"><span style="font-size:14.6666666666667px;font-family:Arial;color:rgb(17,85,204);text-decoration:underline;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">getAuthToken</span></a><span style="font-size:14.6666666666667px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent"> is called the </span><span style="font-size:14.6666666666667px;font-family:Courier New;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">authTokenType</span><span style="font-size:14.6666666666667px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent"> will be "SPNEGO:HOSTBASED:&lt;spn&gt;" where &lt;spn&gt; is the principal for the request. This will always be a host based principal (in the current implementation; future versions may allow other types of principal, but if they do so they will use a different prefix. SPNEGO Authenticators should check the prefix).</span></p><p dir="ltr" style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"><span style="font-size:14.6666666666667px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">The </span><span style="font-size:14.6666666666667px;font-family:Courier New;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">options</span><span style="font-size:14.6666666666667px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent"> bundle  will contain the keys:</span></p><ul style="margin-top:0pt;margin-bottom:0pt"><li dir="ltr" style="list-style-type:disc;font-size:14.6666666666667px;font-family:Courier New;vertical-align:baseline;background-color:transparent"><p dir="ltr" style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"><a href="http://developer.android.com/reference/android/accounts/AccountManager.html#KEY_CALLER_PID" style="text-decoration:none"><span style="font-size:14.6666666666667px;color:rgb(17,85,204);text-decoration:underline;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">KEY_CALLER_PID</span></a></p></li><li dir="ltr" style="list-style-type:disc;font-size:14.6666666666667px;font-family:Courier New;vertical-align:baseline;background-color:transparent"><p dir="ltr" style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"><a href="http://developer.android.com/reference/android/accounts/AccountManager.html#KEY_CALLER_UID" style="text-decoration:none"><span style="font-size:14.6666666666667px;color:rgb(17,85,204);text-decoration:underline;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">KEY_CALLER_UID</span></a></p></li><li dir="ltr" style="list-style-type:disc;font-size:14.6666666666667px;font-family:Arial;vertical-align:baseline;background-color:transparent"><p dir="ltr" style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"><span style="font-size:14.6666666666667px;font-family:Courier New;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">HttpNegotiateConstants.KEY_CAN_DELEGATE</span><span style="font-size:14.6666666666667px;vertical-align:baseline;white-space:pre-wrap;background-color:transparent"> - True if delegation is allowed, false otherwise.</span></p></li></ul><br /><p dir="ltr" style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"><span style="font-size:14.6666666666667px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">If this is the second or later round of multi-round authentication sequence it will also contain.</span></p><br /><ul style="margin-top:0pt;margin-bottom:0pt"><li dir="ltr" style="list-style-type:disc;font-size:14.6666666666667px;font-family:Arial;vertical-align:baseline;background-color:transparent"><p dir="ltr" style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"><span style="font-size:14.6666666666667px;font-family:Courier New;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">HttpNegotiateConstants.KEY_INCOMING_AUTH_TOKEN</span><span style="font-size:14.6666666666667px;vertical-align:baseline;white-space:pre-wrap;background-color:transparent"> - The incoming token from the WWW-Authenticate header, Base64 encoded.</span></p></li><li dir="ltr" style="list-style-type:disc;font-size:14.6666666666667px;font-family:Arial;vertical-align:baseline;background-color:transparent"><p dir="ltr" style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"><span style="font-size:14.6666666666667px;font-family:Courier New;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">HttpNegotiateConstants.KEY_SPNEGO_CONTEXT</span><span style="font-size:14.6666666666667px;vertical-align:baseline;white-space:pre-wrap;background-color:transparent"> - The SPNEGO context provided by the authenticator on the previous round. This is a bundle. Chrome treats this as an opaque object and simply preservers it between rounds.</span></p></li></ul><h2 dir="ltr" style="line-height:1.38;margin-top:10pt;margin-bottom:0pt"><a name="TOC-getAuthToken-result-bundle"></a><span style="font-size:17.3333333333333px;font-family:Trebuchet MS;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">getAuthToken result bundle</span></h2><p dir="ltr" style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"><span style="font-size:14.6666666666667px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">The final result bundle of </span><a href="http://developer.android.com/reference/android/accounts/AbstractAccountAuthenticator.html#getAuthToken(android.accounts.AccountAuthenticatorResponse,%20android.accounts.Account,%20java.lang.String,%20android.os.Bundle)" style="text-decoration:none"><span style="font-size:14.6666666666667px;font-family:Arial;color:rgb(17,85,204);text-decoration:underline;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">getAuthToken</span></a><span style="font-size:14.6666666666667px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent"> (returned either as the return value of getAuthToken, or through the </span><a href="http://developer.android.com/reference/android/accounts/AccountAuthenticatorResponse.html" style="text-decoration:none"><span style="font-size:14.6666666666667px;font-family:Arial;color:rgb(17,85,204);text-decoration:underline;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">AccountAuthenticatorResponse</span></a><span style="font-size:14.6666666666667px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">) should contain the account name, account type, and token as defined in the Android documentation. The token should be Base64  encoded. In addition the bundle should contain the keys:</span></p><ul style="margin-top:0pt;margin-bottom:0pt"><li dir="ltr" style="list-style-type:disc;font-size:14.6666666666667px;font-family:Arial;vertical-align:baseline;background-color:transparent"><p dir="ltr" style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"><span style="font-size:14.6666666666667px;font-family:Courier New;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">HttpNegotiateConstants.KEY_SPNEGO_RESULT</span><span style="font-size:14.6666666666667px;vertical-align:baseline;white-space:pre-wrap;background-color:transparent"> - the SPNEGO result code. This should be one of the values defined in </span><a href="https://code.google.com/p/chromium/codesearch#chromium/src/net/android/java/src/org/chromium/net/HttpNegotiateConstants.java&amp;q=HttpNeg&amp;sq=package:chromium&amp;l=10" style="text-decoration:none"><span style="font-size:14.6666666666667px;color:rgb(17,85,204);text-decoration:underline;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">HttpNegotiateConstants</span></a><span style="font-size:14.6666666666667px;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">.</span></p></li><li dir="ltr" style="list-style-type:disc;font-size:14.6666666666667px;font-family:Arial;vertical-align:baseline;background-color:transparent"><p dir="ltr" style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"><span style="font-size:14.6666666666667px;font-family:Courier New;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">HttpNegotiateConstants.KEY_SPNEGO_CONTEXT</span><span style="font-size:14.6666666666667px;vertical-align:baseline;white-space:pre-wrap;background-color:transparent"> - a context to be returned to the authenticator in the next authentication round. This is only required if authentication is incomplete.</span></p></li></ul><h1 dir="ltr" style="line-height:1.38;margin-top:10pt;margin-bottom:0pt"><a name="TOC-Implementation-recommendations"></a><span style="font-size:21.3333333333333px;font-family:Trebuchet MS;font-weight:normal;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">Implementation recommendations</span></h1><ul style="margin-top:0pt;margin-bottom:0pt"><li dir="ltr" style="list-style-type:disc;font-size:14.6666666666667px;font-family:Arial;vertical-align:baseline;background-color:transparent"><p dir="ltr" style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"><span style="font-size:14.6666666666667px;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">Each account provided by an SPNEGO Account Authenticator should correspond to a single user principal (account) provided by single key distribution center.</span></p></li><li dir="ltr" style="list-style-type:disc;font-size:14.6666666666667px;font-family:Arial;vertical-align:baseline;background-color:transparent"><p dir="ltr" style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"><span style="font-size:14.6666666666667px;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">The account authenticator should not store any passwords. Instead it should store TGTs for the user principles, and require the users to re-enter their passwords (or other authentication data) when their TGT expires.</span></p></li><li dir="ltr" style="list-style-type:disc;font-size:14.6666666666667px;font-family:Arial;vertical-align:baseline;background-color:transparent"><p dir="ltr" style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"><span style="font-size:14.6666666666667px;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">The account authenticator should keep a list of authorized applications (or application signatures) for each account, and refuse to provide service tokens to other applications. The list of authorized applications may be:</span></p></li><ul style="margin-top:0pt;margin-bottom:0pt"><li dir="ltr" style="list-style-type:circle;font-size:14.6666666666667px;font-family:Arial;vertical-align:baseline;background-color:transparent"><p dir="ltr" style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"><span style="font-size:14.6666666666667px;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">Built into the account authenticator.</span></p></li><li dir="ltr" style="list-style-type:circle;font-size:14.6666666666667px;font-family:Arial;vertical-align:baseline;background-color:transparent"><p dir="ltr" style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"><span style="font-size:14.6666666666667px;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">Configurable by the system administrator</span></p></li><li dir="ltr" style="list-style-type:circle;font-size:14.6666666666667px;font-family:Arial;vertical-align:baseline;background-color:transparent"><p dir="ltr" style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"><span style="font-size:14.6666666666667px;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">Configurable by the user. In this case the account authenticator might choose to allow the user to authorize new applications dynamically when they first request access.</span></p></li></ul></ul><p dir="ltr" style="line-height:1.38;margin-top:0pt;margin-bottom:0pt;margin-left:36pt"><span style="font-size:14.6666666666667px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">The authenticator can get the uid of the calling app using the KEY_CALLER_UID field of the options bundle, and then identify the requesting application using </span><span style="font-size:14.6666666666667px;font-family:Arial;font-style:italic;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">context.getPackageManager().getNameForUid()</span><span style="font-size:14.6666666666667px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent"> or similar.</span></p><p dir="ltr" style="line-height:1.38;margin-top:0pt;margin-bottom:0pt;margin-left:36pt"><span style="font-size:14.6666666666667px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">This is required to ensure that malicious apps run by the user cannot use the user’s credentials to access services in unintended ways. This is particularly important since using the custom tokens option (as described above) disables Android’s own signature check when getting auth tokens.</span></p><ul style="margin-top:0pt;margin-bottom:0pt"><li dir="ltr" style="list-style-type:disc;font-size:14.6666666666667px;font-family:Arial;vertical-align:baseline;background-color:transparent"><p dir="ltr" style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"><span style="font-size:14.6666666666667px;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">Unless it is built into the account authenticator, the system administrator or user will need to be able to configure the location of the key distribution center.</span></p></li></ul><h1 dir="ltr" style="line-height:1.38;margin-top:10pt;margin-bottom:0pt"><a name="TOC-Use-and-testing-with-Chrome"></a><span style="font-size:21.3333333333333px;font-family:Trebuchet MS;font-weight:normal;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">Use, and testing, with Chrome</span></h1><p dir="ltr" style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"><span style="font-size:14.6666666666667px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">Chrome defines <a href="http://dev.chromium.org/administrators/policy-list-3#HTTPAuthentication" target="_blank">a number of policies for controlling the use of SPNEGO authentication</a>.</span><span style="font-size:14.6666666666667px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent"> In particular to enable SPNEGO authentication the </span><a href="http://dev.chromium.org/administrators/policy-list-3#AuthServerWhitelist" style="text-decoration:none"><span style="font-size:14.6666666666667px;font-family:Arial;color:rgb(17,85,204);text-decoration:underline;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">AuthServerWhitelist</span></a><span style="font-size:14.6666666666667px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent"> must not be empty, and the <a href="http://www.chromium.org/administrators/policy-list-3#AuthAndroidNegotiateAccountType">AuthAndroidNegotiateAccountType</a> must match the account type provided by the SPNEGO authenticator.</span></p><br /><p dir="ltr" style="line-height:1.38;margin-top:0pt;margin-bottom:0pt"><span style="font-size:14.6666666666667px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">To simplify testing of SPNEGO authentication Chrome on Android supports command line options corresponding to these policies. These are “</span><span style="font-size:14.6667px;vertical-align:baseline;white-space:pre-wrap;background-color:transparent"><font face="courier new, monospace">--auth-server-whitelist=<i>&lt;whitelist&gt;</i></font></span><span style="font-size:14.6666666666667px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">” and “</span><span style="font-size:14.6667px;vertical-align:baseline;white-space:pre-wrap;background-color:transparent"><font face="courier new, monospace">--auth-spnego-account-type=<i>&lt;account type&gt;</i></font></span><span style="font-size:14.6666666666667px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">”. To set these, <a href="https://www.chromium.org/developers/how-tos/run-chromium-with-flags#TOC-Setting-Flags-for-Chrome-on-Android" target="_blank">add them to the command line on the device</a> (requires a rooted device)</span><span style="font-size:14.6666666666667px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">.</span></p><div><span style="font-size:14.6666666666667px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent"><br /></span></div></span></div></td></tr></tbody></table>
</div> 
</div> 
<div id="sites-canvas-bottom-panel">
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_page-subpages"> </div>
<div id="sites-attachments-container">
</div>
<a xmlns="http://www.w3.org/1999/xhtml" name="page-comments"></a>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_page-comments"><div class="sites-comment-docos-wrapper"><div class="sites-comment-docos"><div class="sites-comment-docos-background"></div><div class="sites-comment-docos-header"><div class="sites-comment-docos-header-title">Comments</div></div><div id="sites-comment-docos-pane" class="sites-comment-docos-pane"></div></div></div></div>
</div>
</div> 
</td> 
</tr>
</table> 
</div> 
</div> 
<div id="sites-chrome-footer-wrapper">
<div id="sites-chrome-footer-wrapper-inside">
<div id="sites-chrome-footer">
</div>
</div>
</div>
</div> 
</div> 
<div id="sites-chrome-adminfooter-container">
<div xmlns="http://www.w3.org/1999/xhtml" class="sites-adminfooter" role="navigation"><p><a class="sites-system-link" href="https://www.google.com/a/UniversalLogin?service=jotspot&amp;continue=https://sites.google.com/a/chromium.org/dev/developers/design-documents/http-authentication/writing-a-spnego-authenticator-for-chrome-on-android">Sign in</a><span aria-hidden="true">|</span><a class="sites-system-link" href="/system/app/pages/recentChanges">Recent Site Activity</a><span aria-hidden="true">|</span><a class="sites-system-link" href="/system/app/pages/reportAbuse" target="_blank">Report Abuse</a><span aria-hidden="true">|</span><a class="sites-system-link" href="javascript:;" onclick="window.open(webspace.printUrl)">Print Page</a><span aria-hidden="true">|</span><span class="sites-system-link">Powered By</span> <b class="powered-by"><a href="http://sites.google.com">Google Sites</a></b></p></div>
</div>
</div> 
</div> 
<div id="sites-chrome-onebar-footer">
</div>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    window.jstiming.load.tick('sjl');
  </script>
<script xmlns="http://www.w3.org/1999/xhtml" src="https://ssl.gstatic.com/sites/p/56e332/system/js/jot_min_view__en.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    window.jstiming.load.tick('jl');
  </script>
<script xmlns="http://www.w3.org/1999/xhtml">
      
          sites.core.Analytics.createTracker();
          sites.core.Analytics.trackPageview();
        
    </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
                    sites.Searchbox.initialize(
                        'sites-searchbox-search-button',
                        {"object":[]}['object'],
                        'search-site',
                        {"label":"Configure search options...","url":"/system/app/pages/admin/settings"});
                  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
      gsites.HoverPopupMenu.createSiteDropdownMenus('sites-header-nav-dropdown', false);
    </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
            JOT_setupNav("7648876402527094", "Navigation", false);
            JOT_addListener('titleChange', 'JOT_NAVIGATION_titleChange', 'COMP_7648876402527094');
          </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
            JOT_setupNav("14720868319272995", "Quick links", false);
            JOT_addListener('titleChange', 'JOT_NAVIGATION_titleChange', 'COMP_14720868319272995');
          </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
            JOT_setupNav("19690813310444355", "Other sites", false);
            JOT_addListener('titleChange', 'JOT_NAVIGATION_titleChange', 'COMP_19690813310444355');
          </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
              new sites.CommentPane('//docs.google.com/comments/d/AAHRpnXvrAwjAfmld0ObrebBiGRq9L8SPh1P8ySTa7VrUYoyFhTFBfXXQJItKsmF2sQY5HTCFItIyPiIrBxwl8vP9_LMWOBoPyPyFbgI2REFI4-5eApJ1ZpA0SiNkNC8Yz-3xfHwWqYIU/api/js?anon=true',
                  false, false);
            </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
  setTimeout(function() {
    var fingerprint = gsites.date.TimeZone.getFingerprint([]);
    gsites.Xhr.send('https://www.chromium.org/_/tz', null, null, 'GET', null, null, { afjstz: fingerprint });
  }, 500);
</script>
<script xmlns="http://www.w3.org/1999/xhtml">
                    window.onload = function() {
                      if (false) {
                        JOT_setMobilePreview();
                      }
                      var loadTimer = window.jstiming.load;
                      loadTimer.tick("ol");
                      loadTimer["name"] = "load," + webspace.page.type + ",user_page";
                      window.jstiming.report(loadTimer, {}, 'https://gg.google.com/csi');
                    }
                  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
        JOT_insertAnalyticsCode(false,
            false);
      </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    var maestroRunner = new gsites.pages.view.SitesMaestroRunner(
        webspace, "en");
    maestroRunner.initListeners();
    maestroRunner.installEditRender();
  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
  //<![CDATA[
    // Decorate any fastUI buttons on the page with a class of 'goog-button'.
    if (webspace.user.hasWriteAccess) {
      JOT_decorateButtons();
    }

    // Fires delayed events.
    (function() {
      JOT_fullyLoaded = true;
      var delayedEvents = JOT_delayedEvents;
      for (var x = 0; x < delayedEvents.length; x++) {
        var event = delayedEvents[x];
        JOT_postEvent(event.eventName, event.eventSrc, event.payload);
      }
      JOT_delayedEvents = null;
      JOT_postEvent('pageLoaded');
    })();
  //]]>
</script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    JOT_postEvent('decorateGvizCharts');
  </script>
<script type="text/javascript">
          JOT_setupPostRenderingManager();
        </script>
<script type="text/javascript">
          JOT_postEvent('renderPlus', null, 'sites-chrome-main');
        </script>
<div id="server-timer-div" style="display:none"> </div>
<script type="text/javascript">
          window.jstiming.load.tick('render');
          JOT_postEvent('usercontentrendered', this);
        </script>
</body>
</html>
