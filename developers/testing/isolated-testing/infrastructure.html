<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/WebPage">
<head>
<meta http-equiv="X-UA-Compatible" content="chrome=1" />
<script type="text/javascript">/* Copyright 2008 Google. */ (function() { var e="wtsrt_",g="tbsd_",h="tbnd_",k="start",l="_wtsrt",m="_tbnd",n="CSI/";(function(){function f(a){this.t={};this.tick=function(a,c,b){this.t[a]=[void 0!=b?b:(new Date).getTime(),c];if(void 0==b)try{window.console.timeStamp(n+a)}catch(d){}};this.tick(k,null,a)}var a;window.performance&&(a=window.performance.timing);var p=a?new f(a.responseStart):new f;window.jstiming={Timer:f,load:p};if(a){var c=a.navigationStart,d=a.responseStart;0<c&&d>=c&&(window.jstiming.srt=d-c)}if(a){var b=window.jstiming.load;0<c&&d>=c&&(b.tick(l,void 0,c),b.tick(e,l,d),b.tick(g,e))}try{a=null,
window.chrome&&window.chrome.csi&&(a=Math.floor(window.chrome.csi().pageT),b&&0<c&&(b.tick(m,void 0,window.chrome.csi().startE),b.tick(h,m,c))),null==a&&window.gtbExternal&&(a=window.gtbExternal.pageT()),null==a&&window.external&&(a=window.external.pageT,b&&0<c&&(b.tick(m,void 0,window.external.startE),b.tick(h,m,c))),a&&(window.jstiming.pt=a)}catch(q){}})(); })()
</script>
<link rel="shortcut icon" href="../../../_/rsrc/1354323194313/favicon.ico" type="image/x-icon" />
<link rel="apple-touch-icon" href="https://ssl.gstatic.com/sites/p/56e332/system/app/images/apple-touch-icon.png" type="image/png" />
<script type="text/javascript">/* Copyright 2008 Google. */ (function() { var d="",g="__duration__",h="function";function k(c){return document.getElementById(c)}window.byId=k;function l(c){return c.replace(/^\s+|\s+$/g,d)}window.trim=l;var m=[],n=0;window.JOT_addListener=function(c,a,b){var e=new String(n++);c={eventName:c,handler:a,compId:b,key:e};m.push(c);return e};window.JOT_removeListenerByKey=function(c){for(var a=0;a<m.length;a++)if(m[a].key==c){m.splice(a,1);break}};
window.JOT_removeAllListenersForName=function(c){for(var a=0;a<m.length;a++)m[a].eventName==c&&m.splice(a,1)};window.JOT_postEvent=function(c,a,b){var e={eventName:c,eventSrc:a||{},payload:b||{}};if(window.JOT_fullyLoaded)for(a=m.length,b=0;b<a&&b<m.length;b++){var f=m[b];f&&f.eventName==c&&(e.listenerCompId=f.compId||d,(f=typeof f.handler==h?f.handler:window[f.handler])&&f(e))}else window.JOT_delayedEvents.push({eventName:c,eventSrc:a,payload:b})};window.JOT_delayedEvents=[];
window.JOT_fullyLoaded=!1;window.JOT_formatRelativeToNow=function(c,a){var b=((new Date).getTime()-c)/6E4;if(1440<=b||0>b)return null;var e=0;60<=b&&(b/=60,e=2);2<=b&&e++;return a?window.JOT_siteRelTimeStrs[e].replace(g,Math.floor(b)):window.JOT_userRelTimeStrs[e].replace(g,Math.floor(b))}; })()
</script>
<script>

  

  var breadcrumbs = [{"path":"/developers","deleted":false,"title":"For Developers","dir":"ltr"},{"path":"/developers/testing","deleted":false,"title":"Testing and infrastructure","dir":"ltr"},{"path":"/developers/testing/isolated-testing","deleted":false,"title":"Isolated Testing","dir":"ltr"},{"path":"/developers/testing/isolated-testing/infrastructure","deleted":false,"title":"Isolated Testing Infrastructure","dir":"ltr"}];
  var JOT_clearDotPath = 'https://ssl.gstatic.com/sites/p/56e332/system/app/images/cleardot.gif';

  
  var JOT_userRelTimeStrs = ["a minute ago","__duration__ minutes ago","an hour ago","__duration__ hours ago"];

  
  

  

  var webspace = {"enableAnalytics":true,"pageSharingId":"jotspot_page","enableUniversalAnalytics":false,"sharingPolicy":"OPENED_WITH_INDICATOR","siteTitle":"The Chromium Projects","isStartPageEnabled":true,"adsensePublisherId":null,"features":{"languageSelectDefaultTextSetToDefault":true,"validateClientGvizDataSourceUrls":true,"moreMobileStyleImprovements":true,"newInsertMenuIcons":true,"accessibleSortingButtons":true,"domainAnalyticsInGAOnly":true,"noCaptcha":true,"fileCabinetScreenReaderFix":true,"updatedTosAndPrivacyLinks":null,"pageDrafts":false,"mobileOrientationFix":true,"plusBadge":false,"pdfEmbedSupport":false,"jsClickFix":true},"isPublic":true,"isConsumer":false,"serverFlags":{"cajaBaseUrl":"//www.gstatic.com/caja","cajaDebugMode":false},"onepickBaseUrl":"https://docs.google.com","domainAnalyticsAccountId":"","plusPageId":"","signInUrl":"https://www.google.com/a/SelectSession?continue\u003dhttps://sites.google.com/a/chromium.org/dev/developers/testing/isolated-testing/infrastructure\u0026service\u003djotspot","analyticsAccountId":"UA-5484340-1","scottyUrl":"/_/upload","homePath":"/","siteNoticeUrlEnabled":null,"plusPageUrl":"","adsensePromoClickedOrSiteIneligible":true,"csiReportUri":"https://gg.google.com/csi","sharingId":"jotspot","termsUrl":"//www.google.com/intl/en/policies/terms/","gvizVersion":1,"editorResources":{"sitelayout":["https://ssl.gstatic.com/sites/p/56e332/system/app/css/sitelayouteditor.css"],"text":["https://ssl.gstatic.com/sites/p/56e332/system/js/codemirror.js","https://ssl.gstatic.com/sites/p/56e332/system/app/css/codemirror_css.css","https://ssl.gstatic.com/sites/p/56e332/system/js/trog_edit__en.js","https://ssl.gstatic.com/sites/p/56e332/system/app/css/trogedit.css","/_/rsrc/1441580320000/system/app/css/editor.css","https://ssl.gstatic.com/sites/p/56e332/system/app/css/codeeditor.css","/_/rsrc/1441580320000/system/app/css/camelot/editor-jfk-wlb.css"]},"sharingUrlPrefix":"/_/sharing","isAdsenseEnabled":true,"domain":"chromium.org","baseUri":"","name":"dev","siteTemplateId":false,"siteNoticeRevision":null,"siteNoticeUrlAddress":null,"siteNoticeMessage":null,"page":{"isRtlLocale":false,"canDeleteWebspace":null,"isPageDraft":null,"parentPath":"/developers/testing/isolated-testing","parentWuid":"wuid:gx:10f79ca11e86af6","siteLocale":"en","timeZone":"America/Los_Angeles","type":"text","title":"Isolated Testing Infrastructure","locale":"en","wuid":"wuid:gx:2bb4d578b4a0c939","revision":25,"path":"/developers/testing/isolated-testing/infrastructure","isSiteRtlLocale":false,"pageInheritsPermissions":null,"name":"infrastructure","canChangePath":true,"state":"","properties":{},"bidiEnabled":false,"currentTemplate":{"path":"/system/app/pagetemplates/text","title":"Web Page"}},"canPublishScriptToAnyone":true,"user":{"keyboardShortcuts":true,"sessionIndex":"","guest_":true,"displayNameOrEmail":"guest","userName":"guest","uid":"","renderMobile":false,"domain":"","namespace":"","hasWriteAccess":false,"namespaceUser":false,"primaryEmail":"guest","hasAdminAccess":false},"gadgets":{"baseUri":"/system/app/pages/gadgets"}};
  webspace.page.breadcrumbs = breadcrumbs;

  
  var JOT_siteRelTimeStrs = ["a minute ago","__duration__ minutes ago","an hour ago","__duration__ hours ago"];

</script>
<script type="text/javascript">
                window.jstiming.load.tick('scl');
              </script>
<meta name="title" content="Isolated Testing Infrastructure - The Chromium Projects" />
<meta itemprop="name" content="Isolated Testing Infrastructure - The Chromium Projects" />
<meta property="og:title" content="Isolated Testing Infrastructure - The Chromium Projects" />
<meta name="description" content="Home of the Chromium Open Source Project" />
<meta itemprop="description" content="Home of the Chromium Open Source Project" />
<meta id="meta-tag-description" property="og:description" content="Home of the Chromium Open Source Project" />
<style type="text/css">
</style>
<link rel="stylesheet" type="text/css" href="https://ssl.gstatic.com/sites/p/56e332/system/app/themes/beigeandblue/standard-css-beigeandblue-ltr-ltr.css" />
<link rel="stylesheet" type="text/css" href="../../../_/rsrc/1441580320000/system/app/css/overlay.css%3Fcb=beigeandblueundefineda100%2525%2525150goog-ws-leftthemedefaultstandard.css" />
<link rel="stylesheet" type="text/css" href="../../../_/rsrc/1441580320000/system/app/css/camelot/allthemes-view.css" />
<!--[if IE]>
          <link rel="stylesheet" type="text/css" href="/system/app/css/camelot/allthemes%2die.css" />
        <![endif]-->
<title>Isolated Testing Infrastructure - The Chromium Projects</title>
<meta itemprop="image" content="/_/rsrc/1438879449147/config/customLogo.gif?revision=3" />
<meta property="og:image" content="/_/rsrc/1438879449147/config/customLogo.gif?revision=3" />
<script type="text/javascript">
                window.jstiming.load.tick('cl');
              </script>
</head>
<body xmlns="http://www.google.com/ns/jotspot" id="body" class=" en            ">
<div id="sites-page-toolbar" class="sites-header-divider">
<div xmlns="http://www.w3.org/1999/xhtml" id="sites-status" class="sites-status" style="display:none;"><div id="sites-notice" class="sites-notice" role="status" aria-live="assertive"> </div></div>
</div>
<div id="sites-chrome-everything-scrollbar">
<div id="sites-chrome-everything" class="">
<div id="sites-chrome-page-wrapper" style="direction: ltr">
<div id="sites-chrome-page-wrapper-inside">
<div xmlns="http://www.w3.org/1999/xhtml" id="sites-chrome-header-wrapper" style="height:auto;">
<table id="sites-chrome-header" class="sites-layout-hbox" cellspacing="0" style="height:auto;">
<tr class="sites-header-primary-row" id="sites-chrome-userheader">
<td id="sites-header-title" class="" role="banner"><div class="sites-header-cell-buffer-wrapper"><a href="../../../index.html" id="sites-chrome-userheader-logo"><img id="logo-img-id" src="../../../_/rsrc/1438879449147/config/customLogo.gif%3Frevision=3" alt="The Chromium Projects" class="sites-logo  " /></a><h2><a href="../../../index.html" dir="ltr" id="sites-chrome-userheader-title">The Chromium Projects</a></h2></div></td><td class="sites-layout-searchbox  "><div class="sites-header-cell-buffer-wrapper"><form id="sites-searchbox-form" action="https://www.chromium.org/system/app/pages/search" role="search"><input type="hidden" id="sites-searchbox-scope" name="scope" value="search-site" /><input type="text" id="jot-ui-searchInput" name="q" size="20" value="" aria-label="Search this site" /><div id="sites-searchbox-button-set" class="goog-inline-block"><div role="button" id="sites-searchbox-search-button" class="goog-inline-block jfk-button jfk-button-standard" tabindex="0">Search this site</div></div></form></div></td>
</tr>
<tr class="sites-header-secondary-row" id="sites-chrome-horizontal-nav">
<td colspan="2" id="sites-chrome-header-horizontal-nav-container" role="navigation">
</td>
</tr>
</table>
</div>
<div id="sites-chrome-main-wrapper">
<div id="sites-chrome-main-wrapper-inside">
<table id="sites-chrome-main" class="sites-layout-hbox" cellspacing="0" cellpadding="{scmCellpadding}" border="0">
<tr>
<td id="sites-chrome-sidebar-left" class="sites-layout-sidebar-left initial" style="width:150px">
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_7648876402527094" class="sites-embed" role="navigation"><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotId="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="../../../chromium-projects.html" jotId="wuid:gx:10ae433dadbbab13" class="sites-navigation-link">Home</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="../../../Home.1.html" jotId="wuid:gx:43582b9d2029d3af" class="sites-navigation-link">Chromium</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="../../../chromium-os.1.html" jotId="wuid:gx:83df2ab1f8880ba" class="sites-navigation-link">Chromium OS</a></div></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_14720868319272995" class="sites-embed" role="navigation"><h4 class="sites-embed-title">Quick links</h4><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotId="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="../../../for-testers/bug-reporting-guidelines.html" class="sites-navigation-link">Report bugs</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="../../discussion-groups.html" class="sites-navigation-link">Discuss</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="../../../system/app/pages/sitemap/hierarchy.html" jotId="wuid:gx:4b58a9a350ad12f" class="sites-navigation-link">网站地图</a></div></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_19690813310444355" class="sites-embed" role="navigation"><h4 class="sites-embed-title">Other sites</h4><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotId="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="http://blog.chromium.org/" class="sites-navigation-link">Chromium Blog</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="http://code.google.com/chrome/extensions/" class="sites-navigation-link">Google Chrome Extensions</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="https://developers.google.com/chrome/chrome-frame/" class="sites-navigation-link">Google Chrome Frame</a></div></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_19695218559354544" class="sites-embed" role="complementary"><h4 class="sites-embed-title"></h4><div class="sites-embed-content sites-embed-content-sidebar-textbox"><div dir="ltr"><span style="font-size:x-small">Except as otherwise </span><a href="http://developers.google.com/site-policies.html#restrictions"><span style="font-size:x-small">noted</span></a><span style="font-size:x-small">, the content of this page is licensed under a </span><a href="http://creativecommons.org/licenses/by/2.5/"><span style="font-size:x-small">Creative Commons Attribution 2.5 license</span></a><span style="font-size:x-small">, and examples are licensed under the </span><a href="http://src.chromium.org/viewvc/chrome/trunk/src/LICENSE" target="_blank"><span style="font-size:x-small">BSD License</span></a><span style="font-size:x-small">.<br /></span></div></div></div>
</td>
<td id="sites-canvas-wrapper">
<div id="sites-canvas" role="main">
<div id="goog-ws-editor-toolbar-container"> </div>
<div xmlns="http://www.w3.org/1999/xhtml" id="title-crumbs" style="">
<A href="../../../developers.1.html" dir="ltr">For Developers</A>‎ &gt; ‎<A href="../../testing.1.html" dir="ltr">Testing and infrastructure</A>‎ &gt; ‎<A href="../isolated-testing.1.html" dir="ltr">Isolated Testing</A>‎ &gt; ‎
  </div>
<h3 xmlns="http://www.w3.org/1999/xhtml" id="sites-page-title-header" style="" align="left">
<span id="sites-page-title" dir="ltr" tabindex="-1" style="outline: none">Isolated Testing Infrastructure</span>
</h3>
<div id="sites-canvas-main" class="sites-canvas-main">
<div id="sites-canvas-main-content">
<table xmlns="http://www.w3.org/1999/xhtml" cellspacing="0" class="sites-layout-name-one-column sites-layout-hbox"><tbody><tr><td class="sites-layout-tile sites-tile-name-content-1"><div dir="ltr"><div><div class="sites-embed-align-right-wrapping-on"><div class="sites-embed-border-off sites-embed" style="width:250px;"><div class="sites-embed-content sites-embed-type-toc"><div class="goog-toc sites-embed-toc-maxdepth-6"><p>Contents</p><ol class="goog-toc"><li class="goog-toc"><a href="infrastructure.html#TOC-Objective"><strong>1 </strong>Objective</a></li><li class="goog-toc"><a href="infrastructure.html#TOC-Background"><strong>2 </strong>Background</a></li><li class="goog-toc"><a href="infrastructure.html#TOC-Overview"><strong>3 </strong>Overview</a></li><li class="goog-toc"><a href="infrastructure.html#TOC-How-the-infrastructure-works"><strong>4 </strong>How the infrastructure works</a></li><li class="goog-toc"><a href="infrastructure.html#TOC-Here-are-pretty-graphs:"><strong>5 </strong>Here are pretty graphs:</a></li><li class="goog-toc"><a href="infrastructure.html#TOC-Project-information"><strong>6 </strong>Project information</a><ol class="goog-toc"><li class="goog-toc"><a href="infrastructure.html#TOC-Appengine-Servers"><strong>6.1 </strong>Appengine Servers</a></li><li class="goog-toc"><a href="infrastructure.html#TOC-Canary-Setup"><strong>6.2 </strong>Canary Setup</a></li></ol></li><li class="goog-toc"><a href="infrastructure.html#TOC-Roadmap"><strong>7 </strong>Roadmap</a></li><li class="goog-toc"><a href="infrastructure.html#TOC-Utilization-Stats"><strong>8 </strong>Utilization Stats</a></li><li class="goog-toc"><a href="infrastructure.html#TOC-Caveats"><strong>9 </strong>Caveats</a></li><li class="goog-toc"><a href="infrastructure.html#TOC-Latency"><strong>10 </strong>Latency</a></li><li class="goog-toc"><a href="infrastructure.html#TOC-Scalability"><strong>11 </strong>Scalability</a></li><li class="goog-toc"><a href="infrastructure.html#TOC-Redundancy-and-Reliability"><strong>12 </strong>Redundancy and Reliability</a></li><li class="goog-toc"><a href="infrastructure.html#TOC-Security-Consideration"><strong>13 </strong>Security Consideration</a></li><li class="goog-toc"><a href="infrastructure.html#TOC-Testing-Plan"><strong>14 </strong>Testing Plan</a></li><li class="goog-toc"><a href="infrastructure.html#TOC-FAQ"><strong>15 </strong>FAQ</a><ol class="goog-toc"><li class="goog-toc"><a href="infrastructure.html#TOC-Why-not-a-faulty-file-system-like-FUSE-"><strong>15.1 </strong>Why not a faulty file system like FUSE?</a></li></ol></li></ol></div></div></div></div></div><h2><a name="TOC-Objective"></a>Objective</h2><p>"<i>Build and test at scale</i>". This is focusing on the test part. Drastically reduce whole test cycle time by scaling test sharding across multiple slaves seamlessly. It does so by integrating <a href="http://code.google.com/p/swarming/">Swarming</a> within the Try Server and the Continuous Integration masters.</p><p>This page is about the Chromium specific Swarming infrastructure. For the general Swarming Design, see <a href="https://github.com/luci/luci-py/wiki/Swarming-Design">github.com/luci/luci-py/wiki/Swarming-Design</a>.</p><h2><a name="TOC-Background"></a>Background</h2><ul><li><span style="font-size:10pt">The Chromium waterfall used completely manual test sharding. A "builder" slave compiles and creates a .zip of the build output. Then "testers" download the zip, checkout the sources, unpack the zip inside the source checkout and run a few tests.</span></li><li><span style="font-size:10pt;background-color:transparent">While we can continue throwing more faster hardware at the problem, the fundamental issue remains; as tests gets larger and slower, the end-to-end test latency will continue to increase, slowing down developer productivity.</span></li><li><span style="font-size:10pt">This is a natural extension of the Chromium Try Server (initiated and written by maruel@ in 2008) that scaled up through the years and the Commit Queue (initiated and written by maruel@ in 2011).</span></li><li><span style="font-size:10pt">Before the </span><a href="../try-server-usage/design.html" style="font-size:10pt">Try Server</a><span style="font-size:10pt">, team members were not testing on other platforms than the one they were developing on, causing constant breakage. This helped getting at 50 commits/day.</span></li><li><span style="font-size:10pt">Before the </span><a href="../commit-queue/design.html" style="font-size:10pt">Commit Queue</a><span style="font-size:10pt">, the overhead of manually triggered proper tests on all the important configuration was becoming increasingly cumbersome. This could be automated and was done. This helped sustain 200 commits/day.</span></li></ul><p>But these are not sufficient to scale the team velocity at over 200 commits per day. Big design flaws remain in the way the team is working. In particular, to scale the Chromium team productivity, significant changes in the infrastructure need to happen. In particular, the latency of the testing across platforms need to be drastically reduced. That requires getting the test result in O(1) time, independent of:<br /></p><ol><li><span style="font-size:10pt">Number of platforms to test on.</span></li><li><span style="font-size:10pt">Number of test executables.</span></li><li><span style="font-size:10pt">Number of test cases.</span></li><li><span style="font-size:10pt">Duration of each test cases, especially in the worse case.</span></li><li><span style="font-size:10pt">Size of the data required to run the test.</span></li><li><span style="font-size:10pt">Size of the checkout.</span></li></ol><p>To achieve this, sharding a test must be a constant cost. This is what the Swarming integration is about.</p><h2><a name="TOC-Overview"></a>Overview</h2><p><span style="font-size:10pt;font-weight:normal">Using Swarming works around <a href="http://buildbot.net/">Buildbot</a>'s limitations and permits sharding automatically and in an unlimited way. For example, it permits sharding the test cases on a large smoke test across multiple bots to reduce the latency of running it. Buildbot on the other hand requires manual configuration to shard the tests and is not very efficient at large scale.</span></p><div>By reusing the Isolated testing effort, we're going to be able to shard efficiently the Swarming bots. By integrating Swarming infrastructure inside <a href="http://buildbot.net/">Buildbot</a>, we work around the manual sharding that buildbot requires.</div><div><br />To recapitulate the Isolated design doc, <code>isolateserver.py</code> is used to archive all the run time dependencies of a unit tests on the "builder" to Isolate Server. Since the content store is content-addressed by the SHA-1 of the content, only new contents are archived. Then only the SHA-1 of the manifest describing the whole dependency is sent to the Swaming bots, with an index of the shards that it needs to run. That is, <b>40 bytes for the hash plus 2 integers</b> is all that is required to know what OS is needed and what files are needed to run a shard of test cases along <code>run_isolated.py</code>.<h2><a name="TOC-How-the-infrastructure-works"></a>How the infrastructure works</h2><div>For each buildbot slave using Swarming:</div><div><ol><li>Checks out sources.</li><li>Compile</li><li>Runs 'isolate tests'. This<span style="font-size:10pt;background-color:transparent"> archives the builds on </span><a href="https://isolateserver.appspot.com" style="font-size:10pt;background-color:transparent">https://isolateserver.appspot.com</a><span style="font-size:10pt;background-color:transparent">.</span></li><li>Triggers Swarming tasks.</li><li>Runs anything that needs to run locally.</li><li>Collects Swarming tasks results.</li></ol><div><div>The Commit Queue uses Swarming indirectly via the Try Server.</div><div><br /></div><div><div>So there is really 2 layers of control involved. The first being <b>Buildbot master</b> which controls the overall "build", which includes syncing the sources, compiling, requesting the test to be run on Swarming and asking it to report success or failure. The second layer is the <b>Swarming server</b> itself which "micro-distribute" test shards. Each test shard is actually a subset of the test cases for a single unit test executable. All the unit tests are run concurrently. So for example for a Try Job that requests <code>base_unittests</code>, <code>net_unittests</code>, <code>unit_tests</code> and <code>browser_tests</code> to be run, they are all run simultaneously on different Swarming bot, and slow tests, like browser_tests, are further sharded across multiple bots, all simultaneously.<br /><h2><a name="TOC-Here-are-pretty-graphs:"></a>Here are pretty graphs:</h2></div></div><div><div><span style="font-size:10pt;background-color:transparent">How the Try Server is using Swarming</span></div></div><div><div class="sites-embed-align-left-wrapping-off"><div class="sites-embed-border-on sites-embed" style="width:600px;"><h4 class="sites-embed-title">Chromium Try Server Swarming Infrastructure</h4><div class="sites-embed-object-title" style="display:none;">Chromium Try Server Swarming Infrastructure</div><div class="sites-embed-content sites-embed-type-sketchy"><iframe src="https://docs.google.com/drawings/d/1JM5vQ9AcdzMgwljxJ4jWAYK2vkibDlSkRTocx4HN5tU/preview?h=450&amp;hl=en&amp;w=600" width="600" height="450" title="Chromium Try Server Swarming Infrastructure" frameborder="0" id="489675832" allowfullscreen="true" mozallowfullscreen="true" webkitallowfullscreen="true"></iframe></div></div></div></div></div></div><div><br /></div><div>How using Swarming directly looks like</div><div><div><div class="sites-embed-align-left-wrapping-off"><div class="sites-embed-border-on sites-embed" style="width:600px;"><h4 class="sites-embed-title">Using Swarming directly</h4><div class="sites-embed-object-title" style="display:none;">Using Swarming directly</div><div class="sites-embed-content sites-embed-type-sketchy"><iframe src="https://docs.google.com/drawings/d/1LpeoL1894P_P8ZlODTdmoJha3QBTTUshMm6vLjob0vo/preview?h=450&amp;hl=en&amp;w=600" width="600" height="450" title="Using Swarming directly" frameborder="0" id="793392013" allowfullscreen="true" mozallowfullscreen="true" webkitallowfullscreen="true"></iframe></div></div></div></div><br /></div><h2><a name="TOC-Project-information"></a>Project information</h2><ul><li><span style="font-size:10pt">This project is an integral part of the Chromium Continuous Integration infrastructure and the Chromium Try Server.</span></li><li><span style="font-size:10pt">While this project will greatly improve the Chromium Commit Queue performance, it has no direct relationship and the performance improvement, while we're aiming for it, is totally a side-effect of the reduced Try Server testing latency.</span></li><li><span style="font-size:10pt">Active project members: maruel@, tandrii@, vadimsh@</span><span style="font-size:10pt">.</span></li><li><span style="font-size:10pt">Code: </span><a href="https://github.com/luci/luci-py">github.com/luci/luci-py</a><span style="font-size:10pt">.</span></li></ul><h3><a name="TOC-Appengine-Servers"></a>Appengine Servers</h3><div><ul><li><a href="https://chromium-swarm.appspot.com" style="font-size:10pt">chromium-swarm.appspot.com</a>: manages task execution</li><li><a href="https://isolateserver.appspot.com/" style="font-size:10pt">isolateserver.appspot.com</a>: build output cache</li></ul></div><h3><a name="TOC-Canary-Setup"></a>Canary Setup</h3><div><ul><li><a href="http://build.chromium.org/p/chromium.swarm/waterfall">build.chromium.org/p/chromium.swarm/waterfall</a></li><li><a href="https://chromium-swarm-dev.appspot.com">chromium-swarm-dev.appspot.com</a></li><li><a href="https://isolateserver-dev.appspot.com">isolateserver-dev.appspot.com</a></li></ul><div><h2><a name="TOC-Roadmap"></a>Roadmap</h2><div><ol><li><span style="background-color:transparent;font-size:10pt">Adding more tests and more configurations. The .isolate format itself is evolving to improve the N-dimension matrix that needs to be reduced.</span></li><ol><li><span style="background-color:transparent;font-size:10pt">For example, </span>Debug, Chromium on ChromiumOS, ASAN, Component builds, etc.</li></ol></ol></div></div></div><h2><a name="TOC-Utilization-Stats"></a>Utilization Stats</h2><div><ul><li><a href="https://chromium-swarm.appspot.com/stats">chromium-swarm.appspot.com/stats</a></li><li><a href="https://isolateserver.appspot.com/stats">isolateserver.appspot.com/stats</a></li></ul></div><h2><a name="TOC-Caveats"></a>Caveats</h2>The overhead becomes large at around ~6Gib of archived data per build.<br /><h2><a name="TOC-Latency"></a>Latency</h2>This project is primarily aimed at reducing the overall latency from "ask for green light signal for a CL" to getting the signal. The CL can be "not committed yet" or "just committed", the former being the Try Server, the later the Continuous Integration servers. The latency is reduced by enabling a higher of parallel shard execution and removing the constant costs of syncing the sources and zipping the test executables, both which are extremely slow, in the orders of minutes.<br />Other latencies includes;<br /><ol><li><span style="font-size:10pt">Time to archive the dependencies to the Isolate Server.</span></li><li><span style="font-size:10pt">Time to trigger a Swarming run.</span></li><li><span style="font-size:10pt">Time for the slaves to react to a Swarming run request.</span></li><li><span style="font-size:10pt">Time for the slaves to fetch the dependencies, map them in a temporary directory.</span></li><li><span style="font-size:10pt">Time for the slaves to cleanup the temporary directory and report back stdout/stderr to the Swarming master.</span></li><li><span style="font-size:10pt">Time for the Swaming master to react and return the information to the Swarming client running on the buildbot slave.</span></li></ol><h2><a name="TOC-Scalability"></a>Scalability</h2>All servers run on AppEngine. It scales just fine.<h2><a name="TOC-Redundancy-and-Reliability"></a>Redundancy and Reliability</h2>There are multiple single points of failures<br /><ol><li><span style="font-size:10pt">The Isolate Server which is hosted on AppEngine.</span></li><li><span style="font-size:10pt">The Swarming master, which is also hosted on AppEngine.</span></li><li><span style="font-size:10pt">The buildbot masters, which are single-threaded processes written in python.</span></li></ol>There is currently no redundancy for the buildbot infrastructure, if a VM dies, it is simply replaced right away by a sysadmin. The swarming bots are intrinsically redundant. The Isolate Server data store isn't redundant or reliable, it can be rebuilt from sources if needed. If it fails, it will block the infrastructure.<h2><a name="TOC-Security-Consideration"></a>Security Consideration</h2>Since the whole infrastructure is visible from the internet, like this design doc, proper DACL need to be used. Both the Swarming master and the Isolate Server require valid Google accounts. The credential verification is completely managed by <a href="https://github.com/luci/luci-py/tree/master/appengine/auth_service">auth_service</a>.<br /><h2><a name="TOC-Testing-Plan"></a>Testing Plan</h2>All the code (Swarming master, Isolate Server and swarming_client code) are tested in canary before being rolled out to prod. See the Canary Setup above.<br /><h2><a name="TOC-FAQ"></a>FAQ</h2><div><h3><a name="TOC-Why-not-a-faulty-file-system-like-FUSE-"></a>Why not a faulty file system like FUSE?</h3>Faulty file systems are inherently slow: every time a file is missing, the whole process hangs, the FUSE adapter downloads the file synchronously, then the process resume. Multiply 8000x; that's what browser_tests lists. With a pre-loaded content-addressed file-system, all the files can be cached safely locally and be downloaded simultaneously. The saving and speed improvement is enormous.</div><div></div></div></div></td></tr></tbody></table>
</div> 
</div> 
<div id="sites-canvas-bottom-panel">
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_page-subpages"> </div>
<div id="sites-attachments-container">
</div>
<a xmlns="http://www.w3.org/1999/xhtml" name="page-comments"></a>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_page-comments"><div class="sites-comment-docos-wrapper"><div class="sites-comment-docos"><div class="sites-comment-docos-background"></div><div class="sites-comment-docos-header"><div class="sites-comment-docos-header-title">Comments</div></div><div id="sites-comment-docos-pane" class="sites-comment-docos-pane"></div></div></div></div>
</div>
</div> 
</td> 
</tr>
</table> 
</div> 
</div> 
<div id="sites-chrome-footer-wrapper">
<div id="sites-chrome-footer-wrapper-inside">
<div id="sites-chrome-footer">
</div>
</div>
</div>
</div> 
</div> 
<div id="sites-chrome-adminfooter-container">
<div xmlns="http://www.w3.org/1999/xhtml" class="sites-adminfooter" role="navigation"><p><a class="sites-system-link" href="https://www.google.com/a/UniversalLogin?service=jotspot&amp;continue=https://sites.google.com/a/chromium.org/dev/developers/testing/isolated-testing/infrastructure">Sign in</a><span aria-hidden="true">|</span><a class="sites-system-link" href="../../../system/app/pages/recentChanges.html">Recent Site Activity</a><span aria-hidden="true">|</span><a class="sites-system-link" href="../../../system/app/pages/reportAbuse.html" target="_blank">Report Abuse</a><span aria-hidden="true">|</span><a class="sites-system-link" href="javascript:;" onclick="window.open(webspace.printUrl)">Print Page</a><span aria-hidden="true">|</span><span class="sites-system-link">Powered By</span> <b class="powered-by"><a href="http://sites.google.com">Google Sites</a></b></p></div>
</div>
</div> 
</div> 
<div id="sites-chrome-onebar-footer">
</div>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    window.jstiming.load.tick('sjl');
  </script>
<script xmlns="http://www.w3.org/1999/xhtml" src="https://ssl.gstatic.com/sites/p/56e332/system/js/jot_min_view__en.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    window.jstiming.load.tick('jl');
  </script>
<script xmlns="http://www.w3.org/1999/xhtml">
      
          sites.core.Analytics.createTracker();
          sites.core.Analytics.trackPageview();
        
    </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
                    sites.Searchbox.initialize(
                        'sites-searchbox-search-button',
                        {"object":[]}['object'],
                        'search-site',
                        {"label":"Configure search options...","url":"/system/app/pages/admin/settings"});
                  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
      gsites.HoverPopupMenu.createSiteDropdownMenus('sites-header-nav-dropdown', false);
    </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
            JOT_setupNav("7648876402527094", "Navigation", false);
            JOT_addListener('titleChange', 'JOT_NAVIGATION_titleChange', 'COMP_7648876402527094');
          </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
            JOT_setupNav("14720868319272995", "Quick links", false);
            JOT_addListener('titleChange', 'JOT_NAVIGATION_titleChange', 'COMP_14720868319272995');
          </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
            JOT_setupNav("19690813310444355", "Other sites", false);
            JOT_addListener('titleChange', 'JOT_NAVIGATION_titleChange', 'COMP_19690813310444355');
          </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
              new sites.CommentPane('//docs.google.com/comments/d/AAHRpnXvrAwjAfmld0ObrebBiGRq9XtX81Vmhl9RyDRAzrP9x0zttYGIOdklZj_tHz4Hy6imdCylrzmhl7XMCoI2wu0JUU8fS9im9a8IeeXflHarpBpp7DXFejXB0nSJl2NwKLUIQUn_3/api/js?anon=true',
                  false, false);
            </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
  setTimeout(function() {
    var fingerprint = gsites.date.TimeZone.getFingerprint([]);
    gsites.Xhr.send('https://www.chromium.org/_/tz', null, null, 'GET', null, null, { afjstz: fingerprint });
  }, 500);
</script>
<script xmlns="http://www.w3.org/1999/xhtml">
                    window.onload = function() {
                      if (false) {
                        JOT_setMobilePreview();
                      }
                      var loadTimer = window.jstiming.load;
                      loadTimer.tick("ol");
                      loadTimer["name"] = "load," + webspace.page.type + ",user_page";
                      window.jstiming.report(loadTimer, {}, 'https://gg.google.com/csi');
                    }
                  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
        JOT_insertAnalyticsCode(false,
            false);
      </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    var maestroRunner = new gsites.pages.view.SitesMaestroRunner(
        webspace, "en");
    maestroRunner.initListeners();
    maestroRunner.installEditRender();
  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
  //<![CDATA[
    // Decorate any fastUI buttons on the page with a class of 'goog-button'.
    if (webspace.user.hasWriteAccess) {
      JOT_decorateButtons();
    }

    // Fires delayed events.
    (function() {
      JOT_fullyLoaded = true;
      var delayedEvents = JOT_delayedEvents;
      for (var x = 0; x < delayedEvents.length; x++) {
        var event = delayedEvents[x];
        JOT_postEvent(event.eventName, event.eventSrc, event.payload);
      }
      JOT_delayedEvents = null;
      JOT_postEvent('pageLoaded');
    })();
  //]]>
</script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    JOT_postEvent('decorateGvizCharts');
  </script>
<script type="text/javascript">
          JOT_setupPostRenderingManager();
        </script>
<script type="text/javascript">
          JOT_postEvent('renderPlus', null, 'sites-chrome-main');
        </script>
<div id="server-timer-div" style="display:none"> </div>
<script type="text/javascript">
          window.jstiming.load.tick('render');
          JOT_postEvent('usercontentrendered', this);
        </script>
</body>
</html>
