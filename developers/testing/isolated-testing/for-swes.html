<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/WebPage">
<head>
<meta http-equiv="X-UA-Compatible" content="chrome=1" />
<script type="text/javascript">/* Copyright 2008 Google. */ (function() { var e="wtsrt_",g="tbsd_",h="tbnd_",k="start",l="_wtsrt",m="_tbnd",n="CSI/";(function(){function f(a){this.t={};this.tick=function(a,c,b){this.t[a]=[void 0!=b?b:(new Date).getTime(),c];if(void 0==b)try{window.console.timeStamp(n+a)}catch(d){}};this.tick(k,null,a)}var a;window.performance&&(a=window.performance.timing);var p=a?new f(a.responseStart):new f;window.jstiming={Timer:f,load:p};if(a){var c=a.navigationStart,d=a.responseStart;0<c&&d>=c&&(window.jstiming.srt=d-c)}if(a){var b=window.jstiming.load;0<c&&d>=c&&(b.tick(l,void 0,c),b.tick(e,l,d),b.tick(g,e))}try{a=null,
window.chrome&&window.chrome.csi&&(a=Math.floor(window.chrome.csi().pageT),b&&0<c&&(b.tick(m,void 0,window.chrome.csi().startE),b.tick(h,m,c))),null==a&&window.gtbExternal&&(a=window.gtbExternal.pageT()),null==a&&window.external&&(a=window.external.pageT,b&&0<c&&(b.tick(m,void 0,window.external.startE),b.tick(h,m,c))),a&&(window.jstiming.pt=a)}catch(q){}})(); })()
</script>
<link rel="shortcut icon" href="../../../_/rsrc/1354323194313/favicon.ico" type="image/x-icon" />
<link rel="apple-touch-icon" href="https://ssl.gstatic.com/sites/p/56e332/system/app/images/apple-touch-icon.png" type="image/png" />
<script type="text/javascript">/* Copyright 2008 Google. */ (function() { var d="",g="__duration__",h="function";function k(c){return document.getElementById(c)}window.byId=k;function l(c){return c.replace(/^\s+|\s+$/g,d)}window.trim=l;var m=[],n=0;window.JOT_addListener=function(c,a,b){var e=new String(n++);c={eventName:c,handler:a,compId:b,key:e};m.push(c);return e};window.JOT_removeListenerByKey=function(c){for(var a=0;a<m.length;a++)if(m[a].key==c){m.splice(a,1);break}};
window.JOT_removeAllListenersForName=function(c){for(var a=0;a<m.length;a++)m[a].eventName==c&&m.splice(a,1)};window.JOT_postEvent=function(c,a,b){var e={eventName:c,eventSrc:a||{},payload:b||{}};if(window.JOT_fullyLoaded)for(a=m.length,b=0;b<a&&b<m.length;b++){var f=m[b];f&&f.eventName==c&&(e.listenerCompId=f.compId||d,(f=typeof f.handler==h?f.handler:window[f.handler])&&f(e))}else window.JOT_delayedEvents.push({eventName:c,eventSrc:a,payload:b})};window.JOT_delayedEvents=[];
window.JOT_fullyLoaded=!1;window.JOT_formatRelativeToNow=function(c,a){var b=((new Date).getTime()-c)/6E4;if(1440<=b||0>b)return null;var e=0;60<=b&&(b/=60,e=2);2<=b&&e++;return a?window.JOT_siteRelTimeStrs[e].replace(g,Math.floor(b)):window.JOT_userRelTimeStrs[e].replace(g,Math.floor(b))}; })()
</script>
<script>

  

  var breadcrumbs = [{"path":"/developers","deleted":false,"title":"For Developers","dir":"ltr"},{"path":"/developers/testing","deleted":false,"title":"Testing and infrastructure","dir":"ltr"},{"path":"/developers/testing/isolated-testing","deleted":false,"title":"Isolated Testing","dir":"ltr"},{"path":"/developers/testing/isolated-testing/for-swes","deleted":false,"title":"Isolated Testing for SWEs","dir":"ltr"}];
  var JOT_clearDotPath = 'https://ssl.gstatic.com/sites/p/56e332/system/app/images/cleardot.gif';

  
  var JOT_userRelTimeStrs = ["a minute ago","__duration__ minutes ago","an hour ago","__duration__ hours ago"];

  
  

  

  var webspace = {"enableAnalytics":true,"pageSharingId":"jotspot_page","enableUniversalAnalytics":false,"sharingPolicy":"OPENED_WITH_INDICATOR","siteTitle":"The Chromium Projects","isStartPageEnabled":true,"adsensePublisherId":null,"features":{"languageSelectDefaultTextSetToDefault":true,"validateClientGvizDataSourceUrls":true,"moreMobileStyleImprovements":true,"newInsertMenuIcons":true,"accessibleSortingButtons":true,"domainAnalyticsInGAOnly":true,"noCaptcha":true,"fileCabinetScreenReaderFix":true,"updatedTosAndPrivacyLinks":null,"pageDrafts":false,"mobileOrientationFix":true,"plusBadge":false,"pdfEmbedSupport":false,"jsClickFix":true},"isPublic":true,"isConsumer":false,"serverFlags":{"cajaBaseUrl":"//www.gstatic.com/caja","cajaDebugMode":false},"onepickBaseUrl":"https://docs.google.com","domainAnalyticsAccountId":"","plusPageId":"","signInUrl":"https://www.google.com/a/SelectSession?continue\u003dhttps://sites.google.com/a/chromium.org/dev/developers/testing/isolated-testing/for-swes\u0026service\u003djotspot","analyticsAccountId":"UA-5484340-1","scottyUrl":"/_/upload","homePath":"/","siteNoticeUrlEnabled":null,"plusPageUrl":"","adsensePromoClickedOrSiteIneligible":true,"csiReportUri":"https://gg.google.com/csi","sharingId":"jotspot","termsUrl":"//www.google.com/intl/en/policies/terms/","gvizVersion":1,"editorResources":{"sitelayout":["https://ssl.gstatic.com/sites/p/56e332/system/app/css/sitelayouteditor.css"],"text":["https://ssl.gstatic.com/sites/p/56e332/system/js/codemirror.js","https://ssl.gstatic.com/sites/p/56e332/system/app/css/codemirror_css.css","https://ssl.gstatic.com/sites/p/56e332/system/js/trog_edit__en.js","https://ssl.gstatic.com/sites/p/56e332/system/app/css/trogedit.css","/_/rsrc/1441580320000/system/app/css/editor.css","https://ssl.gstatic.com/sites/p/56e332/system/app/css/codeeditor.css","/_/rsrc/1441580320000/system/app/css/camelot/editor-jfk-wlb.css"]},"sharingUrlPrefix":"/_/sharing","isAdsenseEnabled":true,"domain":"chromium.org","baseUri":"","name":"dev","siteTemplateId":false,"siteNoticeRevision":null,"siteNoticeUrlAddress":null,"siteNoticeMessage":null,"page":{"isRtlLocale":false,"canDeleteWebspace":null,"isPageDraft":null,"parentPath":"/developers/testing/isolated-testing","parentWuid":"wuid:gx:10f79ca11e86af6","siteLocale":"en","timeZone":"America/Los_Angeles","type":"text","title":"Isolated Testing for SWEs","locale":"en","wuid":"wuid:gx:be87cd4fca1d981","revision":34,"path":"/developers/testing/isolated-testing/for-swes","isSiteRtlLocale":false,"pageInheritsPermissions":null,"name":"for-swes","canChangePath":true,"state":"","properties":{},"bidiEnabled":false,"currentTemplate":{"path":"/system/app/pagetemplates/text","title":"Web Page"}},"canPublishScriptToAnyone":true,"user":{"keyboardShortcuts":true,"sessionIndex":"","guest_":true,"displayNameOrEmail":"guest","userName":"guest","uid":"","renderMobile":false,"domain":"","namespace":"","hasWriteAccess":false,"namespaceUser":false,"primaryEmail":"guest","hasAdminAccess":false},"gadgets":{"baseUri":"/system/app/pages/gadgets"}};
  webspace.page.breadcrumbs = breadcrumbs;

  
  var JOT_siteRelTimeStrs = ["a minute ago","__duration__ minutes ago","an hour ago","__duration__ hours ago"];

</script>
<script type="text/javascript">
                window.jstiming.load.tick('scl');
              </script>
<meta name="title" content="Isolated Testing for SWEs - The Chromium Projects" />
<meta itemprop="name" content="Isolated Testing for SWEs - The Chromium Projects" />
<meta property="og:title" content="Isolated Testing for SWEs - The Chromium Projects" />
<meta name="description" content="Home of the Chromium Open Source Project" />
<meta itemprop="description" content="Home of the Chromium Open Source Project" />
<meta id="meta-tag-description" property="og:description" content="Home of the Chromium Open Source Project" />
<style type="text/css">
</style>
<link rel="stylesheet" type="text/css" href="https://ssl.gstatic.com/sites/p/56e332/system/app/themes/beigeandblue/standard-css-beigeandblue-ltr-ltr.css" />
<link rel="stylesheet" type="text/css" href="../../../_/rsrc/1441580320000/system/app/css/overlay.css%3Fcb=beigeandblueundefineda100%2525%2525150goog-ws-leftthemedefaultstandard.css" />
<link rel="stylesheet" type="text/css" href="../../../_/rsrc/1441580320000/system/app/css/camelot/allthemes-view.css" />
<!--[if IE]>
          <link rel="stylesheet" type="text/css" href="/system/app/css/camelot/allthemes%2die.css" />
        <![endif]-->
<title>Isolated Testing for SWEs - The Chromium Projects</title>
<meta itemprop="image" content="/_/rsrc/1438879449147/config/customLogo.gif?revision=3" />
<meta property="og:image" content="/_/rsrc/1438879449147/config/customLogo.gif?revision=3" />
<script type="text/javascript">
                window.jstiming.load.tick('cl');
              </script>
</head>
<body xmlns="http://www.google.com/ns/jotspot" id="body" class=" en            ">
<div id="sites-page-toolbar" class="sites-header-divider">
<div xmlns="http://www.w3.org/1999/xhtml" id="sites-status" class="sites-status" style="display:none;"><div id="sites-notice" class="sites-notice" role="status" aria-live="assertive"> </div></div>
</div>
<div id="sites-chrome-everything-scrollbar">
<div id="sites-chrome-everything" class="">
<div id="sites-chrome-page-wrapper" style="direction: ltr">
<div id="sites-chrome-page-wrapper-inside">
<div xmlns="http://www.w3.org/1999/xhtml" id="sites-chrome-header-wrapper" style="height:auto;">
<table id="sites-chrome-header" class="sites-layout-hbox" cellspacing="0" style="height:auto;">
<tr class="sites-header-primary-row" id="sites-chrome-userheader">
<td id="sites-header-title" class="" role="banner"><div class="sites-header-cell-buffer-wrapper"><a href="../../../index.html" id="sites-chrome-userheader-logo"><img id="logo-img-id" src="../../../_/rsrc/1438879449147/config/customLogo.gif%3Frevision=3" alt="The Chromium Projects" class="sites-logo  " /></a><h2><a href="../../../index.html" dir="ltr" id="sites-chrome-userheader-title">The Chromium Projects</a></h2></div></td><td class="sites-layout-searchbox  "><div class="sites-header-cell-buffer-wrapper"><form id="sites-searchbox-form" action="https://www.chromium.org/system/app/pages/search" role="search"><input type="hidden" id="sites-searchbox-scope" name="scope" value="search-site" /><input type="text" id="jot-ui-searchInput" name="q" size="20" value="" aria-label="Search this site" /><div id="sites-searchbox-button-set" class="goog-inline-block"><div role="button" id="sites-searchbox-search-button" class="goog-inline-block jfk-button jfk-button-standard" tabindex="0">Search this site</div></div></form></div></td>
</tr>
<tr class="sites-header-secondary-row" id="sites-chrome-horizontal-nav">
<td colspan="2" id="sites-chrome-header-horizontal-nav-container" role="navigation">
</td>
</tr>
</table>
</div>
<div id="sites-chrome-main-wrapper">
<div id="sites-chrome-main-wrapper-inside">
<table id="sites-chrome-main" class="sites-layout-hbox" cellspacing="0" cellpadding="{scmCellpadding}" border="0">
<tr>
<td id="sites-chrome-sidebar-left" class="sites-layout-sidebar-left initial" style="width:150px">
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_7648876402527094" class="sites-embed" role="navigation"><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotId="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="../../../chromium-projects.html" jotId="wuid:gx:10ae433dadbbab13" class="sites-navigation-link">Home</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="../../../Home.1.html" jotId="wuid:gx:43582b9d2029d3af" class="sites-navigation-link">Chromium</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="../../../chromium-os.1.html" jotId="wuid:gx:83df2ab1f8880ba" class="sites-navigation-link">Chromium OS</a></div></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_14720868319272995" class="sites-embed" role="navigation"><h4 class="sites-embed-title">Quick links</h4><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotId="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="../../../for-testers/bug-reporting-guidelines.html" class="sites-navigation-link">Report bugs</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="../../discussion-groups.html" class="sites-navigation-link">Discuss</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="../../../system/app/pages/sitemap/hierarchy.html" jotId="wuid:gx:4b58a9a350ad12f" class="sites-navigation-link">网站地图</a></div></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_19690813310444355" class="sites-embed" role="navigation"><h4 class="sites-embed-title">Other sites</h4><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotId="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="http://blog.chromium.org/" class="sites-navigation-link">Chromium Blog</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="http://code.google.com/chrome/extensions/" class="sites-navigation-link">Google Chrome Extensions</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="https://developers.google.com/chrome/chrome-frame/" class="sites-navigation-link">Google Chrome Frame</a></div></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_19695218559354544" class="sites-embed" role="complementary"><h4 class="sites-embed-title"></h4><div class="sites-embed-content sites-embed-content-sidebar-textbox"><div dir="ltr"><span style="font-size:x-small">Except as otherwise </span><a href="http://developers.google.com/site-policies.html#restrictions"><span style="font-size:x-small">noted</span></a><span style="font-size:x-small">, the content of this page is licensed under a </span><a href="http://creativecommons.org/licenses/by/2.5/"><span style="font-size:x-small">Creative Commons Attribution 2.5 license</span></a><span style="font-size:x-small">, and examples are licensed under the </span><a href="http://src.chromium.org/viewvc/chrome/trunk/src/LICENSE" target="_blank"><span style="font-size:x-small">BSD License</span></a><span style="font-size:x-small">.<br /></span></div></div></div>
</td>
<td id="sites-canvas-wrapper">
<div id="sites-canvas" role="main">
<div id="goog-ws-editor-toolbar-container"> </div>
<div xmlns="http://www.w3.org/1999/xhtml" id="title-crumbs" style="">
<A href="../../../developers.1.html" dir="ltr">For Developers</A>‎ &gt; ‎<A href="../../testing.1.html" dir="ltr">Testing and infrastructure</A>‎ &gt; ‎<A href="../isolated-testing.1.html" dir="ltr">Isolated Testing</A>‎ &gt; ‎
  </div>
<h3 xmlns="http://www.w3.org/1999/xhtml" id="sites-page-title-header" style="" align="left">
<span id="sites-page-title" dir="ltr" tabindex="-1" style="outline: none">Isolated Testing for SWEs</span>
</h3>
<div id="sites-canvas-main" class="sites-canvas-main">
<div id="sites-canvas-main-content">
<table xmlns="http://www.w3.org/1999/xhtml" cellspacing="0" class="sites-layout-name-one-column sites-layout-hbox"><tbody><tr><td class="sites-layout-tile sites-tile-name-content-1"><div dir="ltr"><div><div><div class="sites-embed-align-right-wrapping-on"><div class="sites-embed-border-off sites-embed" style="width:250px;"><div class="sites-embed-content sites-embed-type-toc"><div class="goog-toc sites-embed-toc-maxdepth-6"><p>Contents</p><ol class="goog-toc"><li class="goog-toc"><a href="for-swes.html#TOC-Overview"><strong>1 </strong>Overview</a></li><li class="goog-toc"><a href="for-swes.html#TOC-What-s-Isolate-"><strong>2 </strong>What's "Isolate"?</a></li><li class="goog-toc"><a href="for-swes.html#TOC-What-s-Swarming-"><strong>3 </strong>What's "Swarming"?</a></li><li class="goog-toc"><a href="for-swes.html#TOC-What-are-the-advantages-"><strong>4 </strong>What are the advantages?</a></li><li class="goog-toc"><a href="for-swes.html#TOC-How-to-run-a-test-isolated-locally-"><strong>5 </strong>How to run a test isolated locally?</a></li><li class="goog-toc"><a href="for-swes.html#TOC-Adding-a-new-test"><strong>6 </strong>Adding a new test</a><ol class="goog-toc"><li class="goog-toc"><a href="for-swes.html#TOC-TL-DR"><strong>6.1 </strong>TL;DR</a></li><li class="goog-toc"><a href="for-swes.html#TOC-foo_unittests_run-GYP-target"><strong>6.2 </strong>foo_unittests_run GYP target</a></li></ol></li><li class="goog-toc"><a href="for-swes.html#TOC-.isolate-file-format"><strong>7 </strong>.isolate file format</a><ol class="goog-toc"><li class="goog-toc"><a href="for-swes.html#TOC-Minimal-.isolate-file"><strong>7.1 </strong>Minimal .isolate file</a></li><li class="goog-toc"><a href="for-swes.html#TOC-Simplifying-.isolate-files"><strong>7.2 </strong>Simplifying .isolate files</a></li></ol></li><li class="goog-toc"><a href="for-swes.html#TOC-isolate.py"><strong>8 </strong>isolate.py</a></li><li class="goog-toc"><a href="for-swes.html#TOC-Dogfood"><strong>9 </strong>Dogfood</a><ol class="goog-toc"><li class="goog-toc"><a href="for-swes.html#TOC-Eligibility"><strong>9.1 </strong>Eligibility</a></li><li class="goog-toc"><a href="for-swes.html#TOC-Get-the-Swarming-client-code"><strong>9.2 </strong>Get the Swarming client code</a></li><li class="goog-toc"><a href="for-swes.html#TOC-Login-on-the-services"><strong>9.3 </strong>Login on the services</a></li><li class="goog-toc"><a href="for-swes.html#TOC-Run-the-example"><strong>9.4 </strong>Run the example</a></li><li class="goog-toc"><a href="for-swes.html#TOC-Generate-a-.isolated-file"><strong>9.5 </strong>Generate a .isolated file</a></li><li class="goog-toc"><a href="for-swes.html#TOC-Trigger-the-task"><strong>9.6 </strong>Trigger the task</a></li><li class="goog-toc"><a href="for-swes.html#TOC-Additional-Notes"><strong>9.7 </strong>Additional Notes</a></li></ol></li><li class="goog-toc"><a href="for-swes.html#TOC-FAQ"><strong>10 </strong>FAQ</a><ol class="goog-toc"><li class="goog-toc"><a href="for-swes.html#TOC-I-run-a-task-on-Swarming-and-it-hangs-there"><strong>10.1 </strong>I run a task on Swarming and it hangs there</a></li><li class="goog-toc"><a href="for-swes.html#TOC-It-seems-tedious-to-list-each-test-data-file-individually-can-I-just-list-src-"><strong>10.2 </strong>It seems tedious to list each test data file individually, can I just list src/ ?</a></li><li class="goog-toc"><a href="for-swes.html#TOC-Where-can-I-find-the-.isolated-file-"><strong>10.3 </strong>Where can I find the .isolated file?</a></li><li class="goog-toc"><a href="for-swes.html#TOC-Where-should-I-file-bugs-"><strong>10.4 </strong>Where should I file bugs?</a></li></ol></li></ol></div></div></div></div></div><h2><a name="TOC-Overview"></a>Overview</h2><div>This page explains how to convert a googletest executable into a fully isolated test. <span style="font-size:10pt">This is done by describing </span><i style="font-size:10pt">runtime dependencies</i><span style="font-size:10pt"> for a test.</span></div><div><br /></div><div>For information about the infrastructure itself and the roadmap, see <a href="infrastructure.html">Isolated Testing Infrastructure</a>.</div><div><h2><a name="TOC-What-s-Isolate-"></a>What's "Isolate"?</h2><div><b>Goal: describe the exact list of files needed to run a executable.</b></div><div><br /></div><div>The isolate project is all the file formats, tools and server code to make this work <b>fast</b> and efficiently. Every test executable list the data files it depends on, <span style="font-size:10pt">which allows the testers bots to only download the files they need instead of the whole Chromium source tree.</span></div><h2><a name="TOC-What-s-Swarming-"></a>What's "Swarming"?</h2><div><span style="font-size:10pt"><b>Goal: distribute tasks fast and efficiently in an hetegeneous fleet of bots.</b></span></div><div><span style="font-size:10pt"><br /></span></div><div><span style="font-size:10pt">The swarming project is all the tools, server and bot code to run a step (like a unit test) on a remote bot and get results back. It has native google-test sharding capability.</span></div><h2><a name="TOC-What-are-the-advantages-"></a>What are the advantages?</h2><div>By reducing the amount of data that we need to transfer to the tester machines, it becomes much easier to increase the number of tester bots that we have using Swarming (part of <a href="https://github.com/luci/">LUCI</a>).</div><h2><a name="TOC-How-to-run-a-test-isolated-locally-"></a>How to run a test isolated locally?</h2><div class="sites-codeblock sites-codesnippet-block"><div><span style="font-size:10pt"><code>ninja -C out/Release browser_tests_run</code></span></div><div><code>python tools/swarming_client/isolate.py run -s out/Release/browser_tests.isolated</code></div><div></div></div><div><br /></div><div><a href="infrastructure.html#TOC-Roadmap">See the Roadmap</a> for what can or can't be done.</div></div><h2><a name="TOC-Adding-a-new-test"></a>Adding a new test</h2><div><ul><li>For each gyp <code>XXX</code> test executable target, a new <code>XXX_run</code> target is added. For example, <code>base_unittests_run</code> is the target to run <code>base_unittests</code>.</li><ul><li><a href="http://src.chromium.org/viewvc/chrome/trunk/src/base/base.gyp?view=markup">src/base/base.gyp</a> defines <code>base_unittests_run</code>.</li><li><a href="http://src.chromium.org/viewvc/chrome/trunk/src/base/base_unittests.isolate?view=markup">src/base/base_unittests.isolate</a> contains the runtime dependencies of the executable <span style="color:rgb(0,96,0);font-family:monospace">base_unittests</span>.</li></ul><li>All the required data files, executables started by the test executable* required by the test to succeed are listed in the .isolate file.</li><ul><li>For example, <code>browser_tests.exe</code> needs <code>chrome.exe</code>, which needs <code>resources.pak</code>, etc.</li><li>See <a href="http://src.chromium.org/viewvc/chrome/trunk/src/chrome/browser_tests.isolate?view=markup">src/chrome/browser_tests.isolate</a> for a more complicated example.</li></ul></ul><div>Expectations of the tests:</div><ul><li>Must <b>not</b> do directory walking or otherwise try to guess what should be tested.</li><li>Must <b>not</b> edit any input file.</li><li>Must <b>not</b> write at all in the current directory. It must only use the temporary directory for temporary files.</li></ul><h3><a name="TOC-TL-DR"></a>TL;DR</h3><div>To create a new isolated test, do the following section in order:</div><div><ol><li>Create a "foo_unittests_run GYP target as explained below"</li><li>Write a "<a href="https://github.com/luci/luci-py/blob/master/appengine/isolate/doc/client/Isolate-User-Guide.md#minimal-isolate-file">minimal .isolate file</a>"</li><li>Use <code>src/testing/buildbot/manage.py --convert foo_unittests</code> to convert your test to run on Swarming everywhere.</li></ol></div><h3><a name="TOC-foo_unittests_run-GYP-target"></a>foo_unittests_run GYP target</h3><div>A <code>foo_unittests_run</code> target is added along side the <code>foo_unittests</code> target in the relevant GYP file. For example, <a href="http://src.chromium.org/viewvc/chrome/trunk/src/base/base.gyp?view=markup">base_unittests_run in base.gyp</a>:<br /><br /></div><div><div></div></div><div class="sites-codeblock sites-codesnippet-block"><div><div><code>{</code></div><div><code>  'conditions': [</code></div><div><code>    ['test_isolation_mode != "noop"', {</code></div><div><code>      'targets': [</code></div><div><code>        {</code></div><div><code>          'target_name': 'base_unittests_run',</code></div><div><code>          'type': 'none',</code></div><div><code>          'dependencies': [</code></div><div><code>            'base_unittests',</code></div><div><code>          ],</code></div><div><code>          'includes': [</code></div><div><code>            '../build/isolate.gypi',<br /></code><span style="color:rgb(0,96,0);font-size:10pt;line-height:1">                      ],</span></div><div><code>          'sources': [</code></div><div><code>            'base_unittests.isolate',</code></div><div><code>          ],</code></div><div><code>        },</code></div><div><code>      ],</code></div><div><code>    }],</code></div></div><div><code>  ],</code></div><div><code>}</code></div></div><div><br /></div><div>See <a href="http://src.chromium.org/viewvc/chrome/trunk/src/build/isolate.gypi?view=markup">src/build/isolate.gypi</a> for the gory details.</div><div><h2><a name="TOC-.isolate-file-format"></a>.isolate file format</h2><p>See <a href="https://github.com/luci/luci-py/blob/master/appengine/isolate/doc/client/Design.md#isolate-file-format">github.com/luci/luci-py/blob/master/appengine/isolate/doc/client/Design.md#isolate-file-format</a> for the guts.</p><p><span style="font-size:10pt">The </span><code style="font-size:10pt">.isolate</code><span style="font-size:10pt"> format is </span><span style="font-size:10pt">will reject any file containing variables or data structure it doesn't understand.</span></p></div><h3><a name="TOC-Minimal-.isolate-file"></a>Minimal .isolate file</h3><div>See <a href="https://github.com/luci/luci-py/blob/master/appengine/isolate/doc/client/Isolate-User-Guide.md#minimal-isolate-file" style="font-size:13.3333px;background-color:transparent">github.com/luci/luci-py/blob/master/appengine/isolate/doc/client/Isolate-User-Guide.md#minimal-isolate-file</a></div><div><span style="font-size:10pt"><br /></span></div><div><span style="font-size:10pt">In general, it is preferable to:</span></div><div><ol><li>When running tests linux, run them under XVFB. Prepend the <code>command</code> list with <code>['../testing/xvfb.py', '&lt;(PRODUCT_DIR)']</code> to achieve this.</li><li>On other platforms, use the <code>test_env.py</code> wrapper script to setup the environment. Prefix the command list with <code>['../</code><code>testing/</code><code>test_env.py']</code>.</li></ol><span style="font-size:10pt;background-color:transparent">See </span><a href="http://src.chromium.org/viewvc/chrome/trunk/src/base/base_unittests.isolate?view=markup" style="font-size:10pt;background-color:transparent">src/base/base_unittests.isolate</a><span style="font-size:10pt;background-color:transparent"> as a good example.</span></div><div><h3><a name="TOC-Simplifying-.isolate-files"></a>Simplifying .isolate files</h3><p>By default a directory is only included if <b>all the files</b> in it are needed. If most of the directory is used and you feel that it makes sense to make the full directory available to simplify the .isolate file,  feel free to replace the individual listings with a single directory listing.</p></div><div><h2><a name="TOC-isolate.py"></a>isolate.py</h2><div>Refer to <a href="https://github.com/luci/luci-py/blob/master/appengine/isolate/doc/client/Isolate-User-Guide.md">github.com/luci/luci-py/blob/master/appengine/isolate/doc/client/Isolate-User-Guide.md</a> for the up to date user manual.</div><div><br /></div><div><code style="font-size:10pt">isolate.py</code><span style="font-size:10pt"> is run by the </span><code style="font-size:10pt">foo_unittests_run</code><span style="font-size:10pt"> gyp target and is the front end to do all the commands. It reads a single </span><code style="font-size:10pt">.isolate</code><span style="font-size:10pt"> file.</span></div><div><ul><li>The logic is implemented in <code>tools/swarming_client/isolate.py</code>. Its action depends on the subcommand.</li><li>All the <code>XXX_run</code> targets run this script and pass the argument <code>&lt;(test_isolation_mode)</code>.</li><ul><li><font color="#006000" face="monospace">test_isolation_mode</font> is a <code>GYP_DEFINES</code> variable that can be overridden, the default is set in <code>build/common.gypi</code> and can vary between <code>noop</code> and <code>prepare</code>, based on the environment.</li><li>Builders have a different value than the developers; they archive the dependencies on the Isolate Server.</li></ul><li><span style="font-size:10pt">Then Swarming picks up the archived files and runs it across a fleet of slaves.</span></li></ul></div><div>See <font color="#006000" face="monospace">src/tools/swarming_client/isolate.py --help</font> for the up-to-date behavior description.</div></div></div></div><h2><a name="TOC-Dogfood"></a>Dogfood</h2><h3><a name="TOC-Eligibility"></a>Eligibility</h3><div><p>Right now, only users @google.com can use the infrastructure. <span style="background-color:transparent;font-size:10pt">For others, we'll try to make it available to Chromium committers eventually. Note that the whole <a href="https://github.com/luci/luci-py">Swarming infrastructure is open source</a> so if any other company would help to recreate the same infrastructure internally, send us a note at <a href="https://groups.google.com/forum/#!forum/swarming-eng">swarming-eng@googlegroups.com</a></span></p><h3><a name="TOC-Get-the-Swarming-client-code"></a><span style="background-color:transparent">Get the Swarming client code</span></h3><p>If you have a chromium checkout, you already have everything you need in <code>src/tools/swarming_client/</code>.</p></div><h3><a name="TOC-Login-on-the-services"></a><span style="font-size:medium;background-color:transparent">Login on the services</span></h3><p><span style="background-color:transparent;font-size:10pt">By login first, you have access tokens so that the following commands do not have to constantly prompt for your identity. </span></p><div class="sites-codeblock sites-codesnippet-block"><code>python tools/swarming_client/auth.py login --service=https://isolateserver.appspot.com </code><br /><code>python tools/swarming_client/auth.py login --service=https://chromium-swarm.appspot.com </code><div></div></div><p><span style="background-color:transparent;font-size:10pt">If you are running through a text only session on a remote machine, append argument <code>--auth-no-local-webserver</code></span></p><h3><a name="TOC-Run-the-example"></a><span style="background-color:transparent"><font size="3">Run the example</font></span></h3><div><p><span style="background-color:transparent;font-size:10pt">This is a good sanity check to ensure that everything works:</span></p><div><div class="sites-codeblock sites-codesnippet-block"><span style="background-color:transparent;font-size:10pt"><code>python </code></span><span style="background-color:transparent"><font color="#006000" face="monospace">tools/swarming_client/</font></span><span style="line-height:1;font-size:10pt;background-color:transparent"><code>example/3_swarming_trigger_collect.py </code></span><span style="line-height:1;font-size:10pt;background-color:transparent"><code>-I isolateserver.appspot.com</code></span><span style="line-height:1;font-size:10pt;background-color:transparent"><code> \<br /></code></span><span style="background-color:transparent"><font color="#006000" face="monospace">    -S chromium-swarm.appspot.com</font></span></div></div><div><p><span style="background-color:transparent;font-size:10pt">If this doesn't work, see the FAQ before continuing or ping us, we're friendly.</span></p><h3><a name="TOC-Generate-a-.isolated-file"></a><span style="background-color:transparent"><font size="3">Generate a .isolated file</font></span></h3></div><div><p><span style="background-color:transparent;font-size:10pt">For example, let's take base_unittests and c</span><span style="background-color:transparent">reate out/Release/base_unittests.isolated:</span></p><div class="sites-codeblock sites-codesnippet-block"><span style="background-color:transparent;font-size:10pt"><code>ninja -C out/Release base_unittests_run</code></span><br /></div><p>Still scratching your head about what base_unittests_run is? Read the top of this page. It compiles base_unittests.isolate into <span style="background-color:transparent;font-size:10pt">base_unittests.isolated so it can be archived properly.</span></p><div><h3><a name="TOC-Trigger-the-task"></a>Trigger the task</h3><p>Now you built something, time to archives it to the isolate server and request Swarming to run it on your behalf.</p><div><div class="sites-codeblock sites-codesnippet-block"><span style="background-color:transparent;font-size:10pt"><code>python </code></span><span style="background-color:transparent"><font color="#006000" face="monospace">tools/swarming_client/</font></span><span style="line-height:1;font-size:10pt;background-color:transparent"><code>swarming.py run \<br />    -I isolateserver.appspot.com \<br /></code></span><span style="line-height:1;font-size:10pt;background-color:transparent"><code>    -S chromium-swarm.appspot.com \<br /></code></span><span style="background-color:transparent"><code><span style="font-size:10pt;line-height:1">    -d os Windows-7-SP1 \</span><br /><span style="font-size:10pt;line-height:1">    -d gpu none \</span><br />    --verbose \<br /></code></span><span style="line-height:1;font-size:10pt;background-color:transparent"><code>    out/Release/base_unittests.isolated</code></span></div></div><div><br /></div><div>First thing it does is to archive the binary. Depending on your connection speed and the size of the executable, it may take up to a minute. <span style="background-color:transparent;font-size:10pt">Then it triggers the task and wait for results. </span><span style="background-color:transparent;font-size:10pt">OS currently available:</span></div><div><ul><li><span style="background-color:transparent">Windows-XP-SP3<span style="font-size:10pt"> (32 bits)</span></span></li><li><span style="background-color:transparent">Windows-Vista-SP2<span style="font-size:10pt"> (64 bits)</span></span></li><li><span style="background-color:transparent"><font size="2">Windows-7-SP1 (64 bits)</font></span></li><li><span style="background-color:transparent;font-size:10pt">Ubuntu-12.04 (64 bits)</span></li><li><span style="font-size:10pt;background-color:transparent">Mac-10.6</span></li><li><font style="font-size:10pt;background-color:transparent">Mac-10.8</font></li><li><font style="font-size:10pt;background-color:transparent">Mac-10.9</font></li></ul><span style="font-size:10pt;background-color:transparent">Visit </span><a href="https://chromium-swarm.appspot.com/restricted/bots" style="font-size:10pt;background-color:transparent">chromium-swarm.appspot.com/restricted/bots</a><span style="font-size:10pt;background-color:transparent"> to see all the values available. </span><span style="font-size:10pt;background-color:transparent">That's it. Feel free to contact the team at </span><a href="https://groups.google.com/a/chromium.org/forum/#!forum/isolate" style="font-size:10pt;background-color:transparent">isolate@chromium.org</a><span style="font-size:10pt;background-color:transparent"> for any chromium open source specific questions.</span></div></div><div><h3><a name="TOC-Additional-Notes"></a>Additional Notes</h3></div><div><ul><li><span style="font-size:small;background-color:transparent">Running an executable on a swarming bot is documented at </span><span style="background-color:transparent"><font size="2"><a href="https://github.com/luci/luci-py/blob/master/appengine/swarming/doc/User-Guide.md">github.com/luci/luci-py/blob/master/appengine/swarming/doc/User-Guide.md</a>.</font></span></li><li>Monitor the running tasks by visiting <a href="https://chromium-swarm.appspot.com">chromium-swarm.appspot.com</a>.</li><ul><li>See usage statistics at <a href="https://chromium-swarm.appspot.com/user/tasks">chromium-swarm.appspot.com/user/tasks</a>.</li></ul></ul></div><h2><a name="TOC-FAQ"></a>FAQ</h2><h3><a name="TOC-I-run-a-task-on-Swarming-and-it-hangs-there"></a>I run a task on Swarming and it hangs there</h3><div>It is possible that all the bots are currently fully utilized.</div><h3><a name="TOC-It-seems-tedious-to-list-each-test-data-file-individually-can-I-just-list-src-"></a>It seems tedious to list each test data file individually, can I just list src/ ?</h3><div>In theory yes, in practice please don't and keep the list to the strict minimum. The goal is not to run the tests more slowly and having the slaves download 20 gb of data. Reasons includes:</div><div><ol><li>Isolate Server is optimized for &lt; 50000 files scenario. There's a 2ms/file cost per cache hit. So for example, layout tests are currently out of the use case since there's &gt; 80000 files.</li><li><span style="font-size:10pt">It's always possible to go coarser but it's much harder to get back stricter.</span></li></ol></div><h3><a name="TOC-Where-can-I-find-the-.isolated-file-"></a><font size="3">Where can I find the .isolated file?</font></h3><div><span style="font-size:small">The .isolated files are generated when you build the isolation specific version of a target, e.g. out/Debug or out/Release. The isolation target name is just the normal target name with a _run added to the end.</span></div><h3><a name="TOC-Where-should-I-file-bugs-"></a>Where should I file bugs?</h3><div>Swarming specific bugs can be filed on <a href="https://github.com/luci/luci-py/issues">github.com/luci/luci-py/issues</a>. Chromium specific bugs at <a href="http://crbug.com">http://crbug.com</a>.</div></div></div></div></td></tr></tbody></table>
</div> 
</div> 
<div id="sites-canvas-bottom-panel">
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_page-subpages"> </div>
<div id="sites-attachments-container">
</div>
<a xmlns="http://www.w3.org/1999/xhtml" name="page-comments"></a>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_page-comments"><div class="sites-comment-docos-wrapper"><div class="sites-comment-docos"><div class="sites-comment-docos-background"></div><div class="sites-comment-docos-header"><div class="sites-comment-docos-header-title">Comments</div></div><div id="sites-comment-docos-pane" class="sites-comment-docos-pane"></div></div></div></div>
</div>
</div> 
</td> 
</tr>
</table> 
</div> 
</div> 
<div id="sites-chrome-footer-wrapper">
<div id="sites-chrome-footer-wrapper-inside">
<div id="sites-chrome-footer">
</div>
</div>
</div>
</div> 
</div> 
<div id="sites-chrome-adminfooter-container">
<div xmlns="http://www.w3.org/1999/xhtml" class="sites-adminfooter" role="navigation"><p><a class="sites-system-link" href="https://www.google.com/a/UniversalLogin?service=jotspot&amp;continue=https://sites.google.com/a/chromium.org/dev/developers/testing/isolated-testing/for-swes">Sign in</a><span aria-hidden="true">|</span><a class="sites-system-link" href="../../../system/app/pages/recentChanges.html">Recent Site Activity</a><span aria-hidden="true">|</span><a class="sites-system-link" href="../../../system/app/pages/reportAbuse.html" target="_blank">Report Abuse</a><span aria-hidden="true">|</span><a class="sites-system-link" href="javascript:;" onclick="window.open(webspace.printUrl)">Print Page</a><span aria-hidden="true">|</span><span class="sites-system-link">Powered By</span> <b class="powered-by"><a href="http://sites.google.com">Google Sites</a></b></p></div>
</div>
</div> 
</div> 
<div id="sites-chrome-onebar-footer">
</div>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    window.jstiming.load.tick('sjl');
  </script>
<script xmlns="http://www.w3.org/1999/xhtml" src="https://ssl.gstatic.com/sites/p/56e332/system/js/jot_min_view__en.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    window.jstiming.load.tick('jl');
  </script>
<script xmlns="http://www.w3.org/1999/xhtml">
      
          sites.core.Analytics.createTracker();
          sites.core.Analytics.trackPageview();
        
    </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
                    sites.Searchbox.initialize(
                        'sites-searchbox-search-button',
                        {"object":[]}['object'],
                        'search-site',
                        {"label":"Configure search options...","url":"/system/app/pages/admin/settings"});
                  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
      gsites.HoverPopupMenu.createSiteDropdownMenus('sites-header-nav-dropdown', false);
    </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
            JOT_setupNav("7648876402527094", "Navigation", false);
            JOT_addListener('titleChange', 'JOT_NAVIGATION_titleChange', 'COMP_7648876402527094');
          </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
            JOT_setupNav("14720868319272995", "Quick links", false);
            JOT_addListener('titleChange', 'JOT_NAVIGATION_titleChange', 'COMP_14720868319272995');
          </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
            JOT_setupNav("19690813310444355", "Other sites", false);
            JOT_addListener('titleChange', 'JOT_NAVIGATION_titleChange', 'COMP_19690813310444355');
          </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
              new sites.CommentPane('//docs.google.com/comments/d/AAHRpnXukca4jaDOG9SuQz_G8t7Hlwxii-i7U9C1j6LZx3e7kl9Lhyor1RtmbekPqmoHm_sVbk0CVxdzC53UyPza7pXMohHOmyPZICj9Aw00-uboIyVrE-8Q-4J0KlLtGqe-D4FMfoKUs/api/js?anon=true',
                  false, false);
            </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
  setTimeout(function() {
    var fingerprint = gsites.date.TimeZone.getFingerprint([]);
    gsites.Xhr.send('https://www.chromium.org/_/tz', null, null, 'GET', null, null, { afjstz: fingerprint });
  }, 500);
</script>
<script xmlns="http://www.w3.org/1999/xhtml">
                    window.onload = function() {
                      if (false) {
                        JOT_setMobilePreview();
                      }
                      var loadTimer = window.jstiming.load;
                      loadTimer.tick("ol");
                      loadTimer["name"] = "load," + webspace.page.type + ",user_page";
                      window.jstiming.report(loadTimer, {}, 'https://gg.google.com/csi');
                    }
                  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
        JOT_insertAnalyticsCode(false,
            false);
      </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    var maestroRunner = new gsites.pages.view.SitesMaestroRunner(
        webspace, "en");
    maestroRunner.initListeners();
    maestroRunner.installEditRender();
  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
  //<![CDATA[
    // Decorate any fastUI buttons on the page with a class of 'goog-button'.
    if (webspace.user.hasWriteAccess) {
      JOT_decorateButtons();
    }

    // Fires delayed events.
    (function() {
      JOT_fullyLoaded = true;
      var delayedEvents = JOT_delayedEvents;
      for (var x = 0; x < delayedEvents.length; x++) {
        var event = delayedEvents[x];
        JOT_postEvent(event.eventName, event.eventSrc, event.payload);
      }
      JOT_delayedEvents = null;
      JOT_postEvent('pageLoaded');
    })();
  //]]>
</script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    JOT_postEvent('decorateGvizCharts');
  </script>
<script type="text/javascript">
          JOT_setupPostRenderingManager();
        </script>
<script type="text/javascript">
          JOT_postEvent('renderPlus', null, 'sites-chrome-main');
        </script>
<div id="server-timer-div" style="display:none"> </div>
<script type="text/javascript">
          window.jstiming.load.tick('render');
          JOT_postEvent('usercontentrendered', this);
        </script>
</body>
</html>
