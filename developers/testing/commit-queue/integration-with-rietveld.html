<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/WebPage">
<head>
<meta http-equiv="X-UA-Compatible" content="chrome=1" />
<script type="text/javascript">/* Copyright 2008 Google. */ (function() { var e="wtsrt_",g="tbsd_",h="tbnd_",k="start",l="_wtsrt",m="_tbnd",n="CSI/";(function(){function f(a){this.t={};this.tick=function(a,c,b){this.t[a]=[void 0!=b?b:(new Date).getTime(),c];if(void 0==b)try{window.console.timeStamp(n+a)}catch(d){}};this.tick(k,null,a)}var a;window.performance&&(a=window.performance.timing);var p=a?new f(a.responseStart):new f;window.jstiming={Timer:f,load:p};if(a){var c=a.navigationStart,d=a.responseStart;0<c&&d>=c&&(window.jstiming.srt=d-c)}if(a){var b=window.jstiming.load;0<c&&d>=c&&(b.tick(l,void 0,c),b.tick(e,l,d),b.tick(g,e))}try{a=null,
window.chrome&&window.chrome.csi&&(a=Math.floor(window.chrome.csi().pageT),b&&0<c&&(b.tick(m,void 0,window.chrome.csi().startE),b.tick(h,m,c))),null==a&&window.gtbExternal&&(a=window.gtbExternal.pageT()),null==a&&window.external&&(a=window.external.pageT,b&&0<c&&(b.tick(m,void 0,window.external.startE),b.tick(h,m,c))),a&&(window.jstiming.pt=a)}catch(q){}})(); })()
</script>
<link rel="shortcut icon" href="../../../_/rsrc/1354323194313/favicon.ico" type="image/x-icon" />
<link rel="apple-touch-icon" href="https://ssl.gstatic.com/sites/p/56e332/system/app/images/apple-touch-icon.png" type="image/png" />
<script type="text/javascript">/* Copyright 2008 Google. */ (function() { var d="",g="__duration__",h="function";function k(c){return document.getElementById(c)}window.byId=k;function l(c){return c.replace(/^\s+|\s+$/g,d)}window.trim=l;var m=[],n=0;window.JOT_addListener=function(c,a,b){var e=new String(n++);c={eventName:c,handler:a,compId:b,key:e};m.push(c);return e};window.JOT_removeListenerByKey=function(c){for(var a=0;a<m.length;a++)if(m[a].key==c){m.splice(a,1);break}};
window.JOT_removeAllListenersForName=function(c){for(var a=0;a<m.length;a++)m[a].eventName==c&&m.splice(a,1)};window.JOT_postEvent=function(c,a,b){var e={eventName:c,eventSrc:a||{},payload:b||{}};if(window.JOT_fullyLoaded)for(a=m.length,b=0;b<a&&b<m.length;b++){var f=m[b];f&&f.eventName==c&&(e.listenerCompId=f.compId||d,(f=typeof f.handler==h?f.handler:window[f.handler])&&f(e))}else window.JOT_delayedEvents.push({eventName:c,eventSrc:a,payload:b})};window.JOT_delayedEvents=[];
window.JOT_fullyLoaded=!1;window.JOT_formatRelativeToNow=function(c,a){var b=((new Date).getTime()-c)/6E4;if(1440<=b||0>b)return null;var e=0;60<=b&&(b/=60,e=2);2<=b&&e++;return a?window.JOT_siteRelTimeStrs[e].replace(g,Math.floor(b)):window.JOT_userRelTimeStrs[e].replace(g,Math.floor(b))}; })()
</script>
<script>

  

  var breadcrumbs = [{"path":"/developers","deleted":false,"title":"For Developers","dir":"ltr"},{"path":"/developers/testing","deleted":false,"title":"Testing and infrastructure","dir":"ltr"},{"path":"/developers/testing/commit-queue","deleted":false,"title":"Chromium Commit Queue","dir":"ltr"},{"path":"/developers/testing/commit-queue/integration-with-rietveld","deleted":false,"title":"Design: 3-way Integration with Rietveld and the Try Server","dir":"ltr"}];
  var JOT_clearDotPath = 'https://ssl.gstatic.com/sites/p/56e332/system/app/images/cleardot.gif';

  
  var JOT_userRelTimeStrs = ["a minute ago","__duration__ minutes ago","an hour ago","__duration__ hours ago"];

  
  

  

  var webspace = {"enableAnalytics":true,"pageSharingId":"jotspot_page","enableUniversalAnalytics":false,"sharingPolicy":"OPENED_WITH_INDICATOR","siteTitle":"The Chromium Projects","isStartPageEnabled":true,"adsensePublisherId":null,"features":{"languageSelectDefaultTextSetToDefault":true,"validateClientGvizDataSourceUrls":true,"moreMobileStyleImprovements":true,"newInsertMenuIcons":true,"accessibleSortingButtons":true,"domainAnalyticsInGAOnly":true,"noCaptcha":true,"fileCabinetScreenReaderFix":true,"updatedTosAndPrivacyLinks":null,"pageDrafts":false,"mobileOrientationFix":true,"plusBadge":false,"pdfEmbedSupport":false,"jsClickFix":true},"isPublic":true,"isConsumer":false,"serverFlags":{"cajaBaseUrl":"//www.gstatic.com/caja","cajaDebugMode":false},"onepickBaseUrl":"https://docs.google.com","domainAnalyticsAccountId":"","plusPageId":"","signInUrl":"https://www.google.com/a/SelectSession?continue\u003dhttps://sites.google.com/a/chromium.org/dev/developers/testing/commit-queue/integration-with-rietveld\u0026service\u003djotspot","analyticsAccountId":"UA-5484340-1","scottyUrl":"/_/upload","homePath":"/","siteNoticeUrlEnabled":null,"plusPageUrl":"","adsensePromoClickedOrSiteIneligible":true,"csiReportUri":"https://gg.google.com/csi","sharingId":"jotspot","termsUrl":"//www.google.com/intl/en/policies/terms/","gvizVersion":1,"editorResources":{"sitelayout":["https://ssl.gstatic.com/sites/p/56e332/system/app/css/sitelayouteditor.css"],"text":["https://ssl.gstatic.com/sites/p/56e332/system/js/codemirror.js","https://ssl.gstatic.com/sites/p/56e332/system/app/css/codemirror_css.css","https://ssl.gstatic.com/sites/p/56e332/system/js/trog_edit__en.js","https://ssl.gstatic.com/sites/p/56e332/system/app/css/trogedit.css","/_/rsrc/1441580320000/system/app/css/editor.css","https://ssl.gstatic.com/sites/p/56e332/system/app/css/codeeditor.css","/_/rsrc/1441580320000/system/app/css/camelot/editor-jfk-wlb.css"]},"sharingUrlPrefix":"/_/sharing","isAdsenseEnabled":true,"domain":"chromium.org","baseUri":"","name":"dev","siteTemplateId":false,"siteNoticeRevision":null,"siteNoticeUrlAddress":null,"siteNoticeMessage":null,"page":{"isRtlLocale":false,"canDeleteWebspace":null,"isPageDraft":null,"parentPath":"/developers/testing/commit-queue","parentWuid":"wuid:gx:31c23927450dc52e","siteLocale":"en","timeZone":"America/Los_Angeles","type":"text","title":"Design: 3-way Integration with Rietveld and the Try Server","locale":"en","wuid":"wuid:gx:71add928afd9e46","revision":5,"path":"/developers/testing/commit-queue/integration-with-rietveld","isSiteRtlLocale":false,"pageInheritsPermissions":null,"name":"integration-with-rietveld","canChangePath":true,"state":"","properties":{},"bidiEnabled":false,"currentTemplate":{"path":"/system/app/pagetemplates/text","title":"Web Page"}},"canPublishScriptToAnyone":true,"user":{"keyboardShortcuts":true,"sessionIndex":"","guest_":true,"displayNameOrEmail":"guest","userName":"guest","uid":"","renderMobile":false,"domain":"","namespace":"","hasWriteAccess":false,"namespaceUser":false,"primaryEmail":"guest","hasAdminAccess":false},"gadgets":{"baseUri":"/system/app/pages/gadgets"}};
  webspace.page.breadcrumbs = breadcrumbs;

  
  var JOT_siteRelTimeStrs = ["a minute ago","__duration__ minutes ago","an hour ago","__duration__ hours ago"];

</script>
<script type="text/javascript">
                window.jstiming.load.tick('scl');
              </script>
<meta name="title" content="Design: 3-way Integration with Rietveld and the Try Server - The Chromium Projects" />
<meta itemprop="name" content="Design: 3-way Integration with Rietveld and the Try Server - The Chromium Projects" />
<meta property="og:title" content="Design: 3-way Integration with Rietveld and the Try Server - The Chromium Projects" />
<meta name="description" content="Home of the Chromium Open Source Project" />
<meta itemprop="description" content="Home of the Chromium Open Source Project" />
<meta id="meta-tag-description" property="og:description" content="Home of the Chromium Open Source Project" />
<style type="text/css">
</style>
<link rel="stylesheet" type="text/css" href="https://ssl.gstatic.com/sites/p/56e332/system/app/themes/beigeandblue/standard-css-beigeandblue-ltr-ltr.css" />
<link rel="stylesheet" type="text/css" href="../../../_/rsrc/1441580320000/system/app/css/overlay.css%3Fcb=beigeandblueundefineda100%2525%2525150goog-ws-leftthemedefaultstandard.css" />
<link rel="stylesheet" type="text/css" href="../../../_/rsrc/1441580320000/system/app/css/camelot/allthemes-view.css" />
<!--[if IE]>
          <link rel="stylesheet" type="text/css" href="/system/app/css/camelot/allthemes%2die.css" />
        <![endif]-->
<title>Design: 3-way Integration with Rietveld and the Try Server - The Chromium Projects</title>
<meta itemprop="image" content="/_/rsrc/1438879449147/config/customLogo.gif?revision=3" />
<meta property="og:image" content="/_/rsrc/1438879449147/config/customLogo.gif?revision=3" />
<script type="text/javascript">
                window.jstiming.load.tick('cl');
              </script>
</head>
<body xmlns="http://www.google.com/ns/jotspot" id="body" class=" en            ">
<div id="sites-page-toolbar" class="sites-header-divider">
<div xmlns="http://www.w3.org/1999/xhtml" id="sites-status" class="sites-status" style="display:none;"><div id="sites-notice" class="sites-notice" role="status" aria-live="assertive"> </div></div>
</div>
<div id="sites-chrome-everything-scrollbar">
<div id="sites-chrome-everything" class="">
<div id="sites-chrome-page-wrapper" style="direction: ltr">
<div id="sites-chrome-page-wrapper-inside">
<div xmlns="http://www.w3.org/1999/xhtml" id="sites-chrome-header-wrapper" style="height:auto;">
<table id="sites-chrome-header" class="sites-layout-hbox" cellspacing="0" style="height:auto;">
<tr class="sites-header-primary-row" id="sites-chrome-userheader">
<td id="sites-header-title" class="" role="banner"><div class="sites-header-cell-buffer-wrapper"><a href="../../../index.html" id="sites-chrome-userheader-logo"><img id="logo-img-id" src="../../../_/rsrc/1438879449147/config/customLogo.gif%3Frevision=3" alt="The Chromium Projects" class="sites-logo  " /></a><h2><a href="../../../index.html" dir="ltr" id="sites-chrome-userheader-title">The Chromium Projects</a></h2></div></td><td class="sites-layout-searchbox  "><div class="sites-header-cell-buffer-wrapper"><form id="sites-searchbox-form" action="https://www.chromium.org/system/app/pages/search" role="search"><input type="hidden" id="sites-searchbox-scope" name="scope" value="search-site" /><input type="text" id="jot-ui-searchInput" name="q" size="20" value="" aria-label="Search this site" /><div id="sites-searchbox-button-set" class="goog-inline-block"><div role="button" id="sites-searchbox-search-button" class="goog-inline-block jfk-button jfk-button-standard" tabindex="0">Search this site</div></div></form></div></td>
</tr>
<tr class="sites-header-secondary-row" id="sites-chrome-horizontal-nav">
<td colspan="2" id="sites-chrome-header-horizontal-nav-container" role="navigation">
</td>
</tr>
</table>
</div>
<div id="sites-chrome-main-wrapper">
<div id="sites-chrome-main-wrapper-inside">
<table id="sites-chrome-main" class="sites-layout-hbox" cellspacing="0" cellpadding="{scmCellpadding}" border="0">
<tr>
<td id="sites-chrome-sidebar-left" class="sites-layout-sidebar-left initial" style="width:150px">
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_7648876402527094" class="sites-embed" role="navigation"><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotId="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="../../../chromium-projects.html" jotId="wuid:gx:10ae433dadbbab13" class="sites-navigation-link">Home</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="../../../Home.1.html" jotId="wuid:gx:43582b9d2029d3af" class="sites-navigation-link">Chromium</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="../../../chromium-os.1.html" jotId="wuid:gx:83df2ab1f8880ba" class="sites-navigation-link">Chromium OS</a></div></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_14720868319272995" class="sites-embed" role="navigation"><h4 class="sites-embed-title">Quick links</h4><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotId="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="../../../for-testers/bug-reporting-guidelines.html" class="sites-navigation-link">Report bugs</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="../../discussion-groups.html" class="sites-navigation-link">Discuss</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="../../../system/app/pages/sitemap/hierarchy.html" jotId="wuid:gx:4b58a9a350ad12f" class="sites-navigation-link">网站地图</a></div></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_19690813310444355" class="sites-embed" role="navigation"><h4 class="sites-embed-title">Other sites</h4><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotId="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="http://blog.chromium.org/" class="sites-navigation-link">Chromium Blog</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="http://code.google.com/chrome/extensions/" class="sites-navigation-link">Google Chrome Extensions</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="https://developers.google.com/chrome/chrome-frame/" class="sites-navigation-link">Google Chrome Frame</a></div></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_19695218559354544" class="sites-embed" role="complementary"><h4 class="sites-embed-title"></h4><div class="sites-embed-content sites-embed-content-sidebar-textbox"><div dir="ltr"><span style="font-size:x-small">Except as otherwise </span><a href="http://developers.google.com/site-policies.html#restrictions"><span style="font-size:x-small">noted</span></a><span style="font-size:x-small">, the content of this page is licensed under a </span><a href="http://creativecommons.org/licenses/by/2.5/"><span style="font-size:x-small">Creative Commons Attribution 2.5 license</span></a><span style="font-size:x-small">, and examples are licensed under the </span><a href="http://src.chromium.org/viewvc/chrome/trunk/src/LICENSE" target="_blank"><span style="font-size:x-small">BSD License</span></a><span style="font-size:x-small">.<br /></span></div></div></div>
</td>
<td id="sites-canvas-wrapper">
<div id="sites-canvas" role="main">
<div id="goog-ws-editor-toolbar-container"> </div>
<div xmlns="http://www.w3.org/1999/xhtml" id="title-crumbs" style="">
<A href="../../../developers.1.html" dir="ltr">For Developers</A>‎ &gt; ‎<A href="../../testing.1.html" dir="ltr">Testing and infrastructure</A>‎ &gt; ‎<A href="../commit-queue.1.html" dir="ltr">Chromium Commit Queue</A>‎ &gt; ‎
  </div>
<h3 xmlns="http://www.w3.org/1999/xhtml" id="sites-page-title-header" style="" align="left">
<span id="sites-page-title" dir="ltr" tabindex="-1" style="outline: none">Design: 3-way Integration with Rietveld and the Try Server</span>
</h3>
<div id="sites-canvas-main" class="sites-canvas-main">
<div id="sites-canvas-main-content">
<table xmlns="http://www.w3.org/1999/xhtml" cellspacing="0" class="sites-layout-name-one-column sites-layout-hbox"><tbody><tr><td class="sites-layout-tile sites-tile-name-content-1"><div dir="ltr"><div><div class="sites-embed-align-right-wrapping-on"><div class="sites-embed-border-off sites-embed" style="width:250px;"><div class="sites-embed-content sites-embed-type-toc"><div class="goog-toc sites-embed-toc-maxdepth-6"><p>Contents</p><ol class="goog-toc"><li class="goog-toc"><a href="integration-with-rietveld.html#TOC-Objective"><strong>1 </strong>Objective</a></li><li class="goog-toc"><a href="integration-with-rietveld.html#TOC-Background"><strong>2 </strong>Background</a></li><li class="goog-toc"><a href="integration-with-rietveld.html#TOC-Overview"><strong>3 </strong>Overview</a></li><li class="goog-toc"><a href="integration-with-rietveld.html#TOC-Infrastructure"><strong>4 </strong>Infrastructure</a></li><li class="goog-toc"><a href="integration-with-rietveld.html#TOC-Detailed-Design"><strong>5 </strong>Detailed Design</a><ol class="goog-toc"><li class="goog-toc"><a href="integration-with-rietveld.html#TOC-1.-Trusting-try-jobs"><strong>5.1 </strong>1. Trusting try jobs</a></li><li class="goog-toc"><a href="integration-with-rietveld.html#TOC-2.-Polling-for-pending-CLs"><strong>5.2 </strong>2. Polling for pending CLs</a></li><li class="goog-toc"><a href="integration-with-rietveld.html#TOC-3.-Reacting-to-CL-modifications"><strong>5.3 </strong>3. Reacting to CL modifications</a></li></ol></li><li class="goog-toc"><a href="integration-with-rietveld.html#TOC-Project-Information"><strong>6 </strong>Project Information</a></li><li class="goog-toc"><a href="integration-with-rietveld.html#TOC-Caveats"><strong>7 </strong>Caveats</a></li><li class="goog-toc"><a href="integration-with-rietveld.html#TOC-Latency"><strong>8 </strong>Latency</a></li><li class="goog-toc"><a href="integration-with-rietveld.html#TOC-Scalability"><strong>9 </strong>Scalability</a></li><li class="goog-toc"><a href="integration-with-rietveld.html#TOC-Redundancy-and-Reliability"><strong>10 </strong>Redundancy and Reliability</a></li><li class="goog-toc"><a href="integration-with-rietveld.html#TOC-Security-Consideration"><strong>11 </strong>Security Consideration</a></li><li class="goog-toc"><a href="integration-with-rietveld.html#TOC-Testing-Plan"><strong>12 </strong>Testing Plan</a></li></ol></div></div></div></div></div><h2><a name="TOC-Objective"></a>Objective</h2><div>Drastically reduce the <i>perceived time</i> (wall-clock time) from asking the infrastructure to commit a change list (CL) to the time it is committed. This reduces the time a developer has to care about a particular CL, by getting it in or refusing it as fast as possible.</div><h2><a name="TOC-Background"></a>Background</h2><div>The Chromium team uses the <a href="design.html">Commit Queue</a>, which in turn uses the <a href="../try-server-usage/design.html">Try Server</a>, to perform automated testing of their pending CL on multiple platforms in multiple configurations. <a href="http://code.google.com/p/rietveld/">Rietveld</a> is used for code reviews and the Chromium team uses a <a href="http://code.google.com/p/rietveld/source/browse/?name=chromium">slightly forked version</a> to better integrate it with the rest of the Chromium infrastructure.</div><div><br /></div><div>Before the integration, the Commit Queue is awaken as soon as the CL author, or one of his reviewer, checks the infamous <i>Commit checkbox</i> on Rietveld. The Commit Queue polls updates from Rietveld at a rate of 0.1hz to get new CLs to test.</div><div><br /></div><div>This means that pre-commit verifications, which include code styling, OWNERS check, a proper LGTM from at least one Chromium Committer, properly testing the patches on the Try Server, only starts at the moment the checkbox is set. This means a maximal time is spent between the moment the checkbox is checked and the change is committed.</div><div><br /></div><div>Also, before the integration, because of the way try jobs are triggered, the Commit Queue cannot trust the try jobs triggered by anyone but itself. The "previous way" of triggering try jobs is to commit a raw diff into subversion. Let's just say that it is <i>suboptimal</i>.</div><h2><a name="TOC-Overview"></a>Overview</h2><div>This project is about implementing techniques in the integration so the Commit Queue can efficiently run presubmit checks and Try Jobs on the Try Server before the CL author request the commit to be merged into the source tree;</div><div><br /></div><div>The Commit Queue is also trusting the try jobs triggered by others than itself. The new way involves the Try Server polling Rietveld directly to fetch the diff <i>directly</i> from the code review. This is the reason the try jobs can be "trusted".</div><div><br /></div><div>Rietveld acts as a datastore to map a Verification steps to a Patchset.</div><h2><a name="TOC-Infrastructure"></a>Infrastructure</h2><div>The infrastructure consist of:</div><div><ol><li>Rietveld is running on AppEngine, using AppEngine's supplied GAIA account management.</li><ol><li>It becomes the primary database for the try job results.</li></ol><li>The Commit Queue process, which is a stand alone process.</li><li>The Try Server, which is an infrastructure itself.</li></ol><h2><a name="TOC-Detailed-Design"></a>Detailed Design</h2></div><h3><a name="TOC-1.-Trusting-try-jobs"></a>1. Trusting try jobs</h3><div>The first task is to make sure Try Jobs results on Rietveld can be trusted. This is done by differentiating try jobs triggered directly from Rietveld from any other try jobs. The polling code is in <a href="http://src.chromium.org/viewvc/chrome/trunk/tools/build/scripts/master/try_job_rietveld.py?view=markup">try_job_rietveld.py</a> and sets the build property <code>try_job_key</code> that is then used to certify this try jobs was indeed triggered from Rietveld in <a href="http://code.google.com/p/rietveld/source/browse/codereview/views_chromium.py?name=chromium">view_chromium.py</a>. The json packets are pushed via Buildbot's <a href="http://src.chromium.org/viewvc/chrome/trunk/tools/build/third_party/buildbot_8_4p1/buildbot/status/status_push.py?view=markup">HttpStatusPush implementation</a> from the Try Server back into Rietveld's /status_listener URL as HTTP POST requests.</div><h3><a name="TOC-2.-Polling-for-pending-CLs"></a>2. Polling for pending CLs</h3><div>Rietveld already has a mechanism to search for issues with specific criteria. For example, </div><div><a href="https://codereview.chromium.org/search?closed=3&amp;commit=3&amp;modified_after=2012-09-18&amp;format=json&amp;limit=10">https://codereview.chromium.org/search?closed=3&amp;commit=3&amp;modified_after=2012-09-18&amp;format=json&amp;limit=10</a></div><div>While polling it really not optimal, it permits reusing the current API. The <code>/search</code> interface supports specifying an opaque datastore <code>cursor</code> so only new issues are returned. The cursor to use on the next request is returned inside the json data.</div><h3><a name="TOC-3.-Reacting-to-CL-modifications"></a>3. Reacting to CL modifications</h3><div>For each new CL modified, the CQ must decide if it reacts to the CL. To enable preemptive CL verification, the following steps are used on each new CL;</div><div><ol><li>Determine if the CL author is a trusted author, e.g. a <a href="../../../getting-involved/become-a-committer.html">Chromium Committer</a>.</li><ol><li>If it is and the user asked for review, initiate checks.</li><li>If not, wait for a LGTM from a trusted reviewer. Note that it's not waiting for the Commit checkbox to be checked.</li></ol><li>Keep track of the previous checks for the last patchset, discarding data as new patchsets are uploaded.</li><li>Add a note on the issue if a check failure occurs.</li></ol><div>Then for commit time;</div><ol><li>Upon Commit checkbox signal, only re-run the Secure Checks and commit.</li><ol><li>Secure checks include things that must not change; the CL description must have stayed the same, the tree is open, etc.</li></ol></ol></div><h2><a name="TOC-Project-Information"></a>Project Information</h2><div>This project is driven primary by rogerta@ and maruel@. It benefits immediately from Try Server enhancement projects like the <a href="../../../system/errors/NodeNotFound%3Fsuri=wuid:gx:1270d94247b40e4f.html" class="disabled">Swarm integration project</a> but it is still designed to work without Try Server performance boost and work around its general sluggishness.</div><h2><a name="TOC-Caveats"></a>Caveats</h2><div><ol><li>Presubmit checks are not yet run on the Try Server but are run locally instead. This needs to be changed to accelerate the CQ and keep its integrity.</li><li>This significantly increases the Try Server utilization. Without the <a href="../../../system/errors/NodeNotFound%3Fsuri=wuid:gx:1270d94247b40e4f.html" class="disabled">Swarm integration project</a>, this would likely overload the Try Server.</li></ol></div><h2><a name="TOC-Latency"></a>Latency</h2><div>The whole purpose of this project is to reduce the latency of the pre-commit checks. The latency will boils down to</div><div><ol><li>Poll rate.</li><li>Pre-commit forced checks.</li></ol><div>At that point, we are not aiming at optimizing the commit delay below 30 seconds, lower than that is a nice to have.</div></div><h2><a name="TOC-Scalability"></a>Scalability</h2><div>The Commit Queue is a single threaded process. As such, it is bound by its slowest operations. This currently include the PRESUBMIT checks and applying/commiting CLs. The goal is to make checks happen earlier and reuse the results from previous checks whenever they are trusted, not to make the checks faster.</div><h2><a name="TOC-Redundancy-and-Reliability"></a>Redundancy and Reliability</h2><div>There are multiple single points of failure;</div><div><ol><li>Rietveld on AppEngine. If AppEngine blows up, we're screwed.</li><li>The Try Server, which is a single-threaded process. Restarting it, in case of hard failure, is only lossy for the jobs in progress at the time of shutdown. In case of catastrophic failure, all the previous try jobs would need to be re-run. This already happened in the past and can be handled relatively fast, within an hour or so.</li><li>The Commit Queue process itself is also single-threaded and single-homed. It is designed to be mostly lossless when restarted or if an exception occurs. The Try Jobs database can be reconstructed from the information stored on Rietveld.</li></ol></div><h2><a name="TOC-Security-Consideration"></a>Security Consideration</h2><div>The security is using the following assumptions;</div><div><ol><li>Rietveld administrators are not rogue.</li><li>Rietveld does not permit a CL author to fake its identity and the patchsets, once created, are immutable.</li><ol><li>The commit queue ensures the CL description is not modified between the moment it is running its presubmit check and the moment it is committing.</li></ol><li>The Commit Queue is doing proper verification w.r.t. which is a trusted committer.</li><ol><li>In the end, the Commit Queue process is the one deciding if a commit gets in or not and doing it.</li></ol><li>The committer are trusted. They already can commit anything they want. It is an non-goal to restrict what committers can commit.</li></ol></div><h2><a name="TOC-Testing-Plan"></a>Testing Plan</h2><div>The integration itself, being an integration project, is mostly tested directly "on prod". While there are a few unit tests to check basic functionality, most of the bugs are at integration points. This being a productivity tool for developers, it is expected that they have some clue about what's going wrong.</div></div></td></tr></tbody></table>
</div> 
</div> 
<div id="sites-canvas-bottom-panel">
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_page-subpages"> </div>
<div id="sites-attachments-container">
</div>
<a xmlns="http://www.w3.org/1999/xhtml" name="page-comments"></a>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_page-comments"><div class="sites-comment-docos-wrapper"><div class="sites-comment-docos"><div class="sites-comment-docos-background"></div><div class="sites-comment-docos-header"><div class="sites-comment-docos-header-title">Comments</div></div><div id="sites-comment-docos-pane" class="sites-comment-docos-pane"></div></div></div></div>
</div>
</div> 
</td> 
</tr>
</table> 
</div> 
</div> 
<div id="sites-chrome-footer-wrapper">
<div id="sites-chrome-footer-wrapper-inside">
<div id="sites-chrome-footer">
</div>
</div>
</div>
</div> 
</div> 
<div id="sites-chrome-adminfooter-container">
<div xmlns="http://www.w3.org/1999/xhtml" class="sites-adminfooter" role="navigation"><p><a class="sites-system-link" href="https://www.google.com/a/UniversalLogin?service=jotspot&amp;continue=https://sites.google.com/a/chromium.org/dev/developers/testing/commit-queue/integration-with-rietveld">Sign in</a><span aria-hidden="true">|</span><a class="sites-system-link" href="../../../system/app/pages/recentChanges.html">Recent Site Activity</a><span aria-hidden="true">|</span><a class="sites-system-link" href="../../../system/app/pages/reportAbuse.html" target="_blank">Report Abuse</a><span aria-hidden="true">|</span><a class="sites-system-link" href="javascript:;" onclick="window.open(webspace.printUrl)">Print Page</a><span aria-hidden="true">|</span><span class="sites-system-link">Powered By</span> <b class="powered-by"><a href="http://sites.google.com">Google Sites</a></b></p></div>
</div>
</div> 
</div> 
<div id="sites-chrome-onebar-footer">
</div>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    window.jstiming.load.tick('sjl');
  </script>
<script xmlns="http://www.w3.org/1999/xhtml" src="https://ssl.gstatic.com/sites/p/56e332/system/js/jot_min_view__en.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    window.jstiming.load.tick('jl');
  </script>
<script xmlns="http://www.w3.org/1999/xhtml">
      
          sites.core.Analytics.createTracker();
          sites.core.Analytics.trackPageview();
        
    </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
                    sites.Searchbox.initialize(
                        'sites-searchbox-search-button',
                        {"object":[]}['object'],
                        'search-site',
                        {"label":"Configure search options...","url":"/system/app/pages/admin/settings"});
                  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
      gsites.HoverPopupMenu.createSiteDropdownMenus('sites-header-nav-dropdown', false);
    </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
            JOT_setupNav("7648876402527094", "Navigation", false);
            JOT_addListener('titleChange', 'JOT_NAVIGATION_titleChange', 'COMP_7648876402527094');
          </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
            JOT_setupNav("14720868319272995", "Quick links", false);
            JOT_addListener('titleChange', 'JOT_NAVIGATION_titleChange', 'COMP_14720868319272995');
          </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
            JOT_setupNav("19690813310444355", "Other sites", false);
            JOT_addListener('titleChange', 'JOT_NAVIGATION_titleChange', 'COMP_19690813310444355');
          </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
              new sites.CommentPane('//docs.google.com/comments/d/AAHRpnXukca4jaDOG9SuQz_G8t7Hlvxr3kAGutwA0ty5u59ULHClFlhOUsv7_CcdqedPBJP-de0BJNJ__NFGqyW0SQlgNqC0Lknxat1PLBpGr5PT8OZx72LmCB-T2HsVpB-MV098tbGd-/api/js?anon=true',
                  false, false);
            </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
  setTimeout(function() {
    var fingerprint = gsites.date.TimeZone.getFingerprint([]);
    gsites.Xhr.send('https://www.chromium.org/_/tz', null, null, 'GET', null, null, { afjstz: fingerprint });
  }, 500);
</script>
<script xmlns="http://www.w3.org/1999/xhtml">
                    window.onload = function() {
                      if (false) {
                        JOT_setMobilePreview();
                      }
                      var loadTimer = window.jstiming.load;
                      loadTimer.tick("ol");
                      loadTimer["name"] = "load," + webspace.page.type + ",user_page";
                      window.jstiming.report(loadTimer, {}, 'https://gg.google.com/csi');
                    }
                  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
        JOT_insertAnalyticsCode(false,
            false);
      </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    var maestroRunner = new gsites.pages.view.SitesMaestroRunner(
        webspace, "en");
    maestroRunner.initListeners();
    maestroRunner.installEditRender();
  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
  //<![CDATA[
    // Decorate any fastUI buttons on the page with a class of 'goog-button'.
    if (webspace.user.hasWriteAccess) {
      JOT_decorateButtons();
    }

    // Fires delayed events.
    (function() {
      JOT_fullyLoaded = true;
      var delayedEvents = JOT_delayedEvents;
      for (var x = 0; x < delayedEvents.length; x++) {
        var event = delayedEvents[x];
        JOT_postEvent(event.eventName, event.eventSrc, event.payload);
      }
      JOT_delayedEvents = null;
      JOT_postEvent('pageLoaded');
    })();
  //]]>
</script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    JOT_postEvent('decorateGvizCharts');
  </script>
<script type="text/javascript">
          JOT_setupPostRenderingManager();
        </script>
<script type="text/javascript">
          JOT_postEvent('renderPlus', null, 'sites-chrome-main');
        </script>
<div id="server-timer-div" style="display:none"> </div>
<script type="text/javascript">
          window.jstiming.load.tick('render');
          JOT_postEvent('usercontentrendered', this);
        </script>
</body>
</html>
