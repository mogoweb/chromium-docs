<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/WebPage">
<head>
<meta http-equiv="X-UA-Compatible" content="chrome=1" />
<script type="text/javascript">/* Copyright 2008 Google. */ (function() { var e="wtsrt_",g="tbsd_",h="tbnd_",k="start",l="_wtsrt",m="_tbnd",n="CSI/";(function(){function f(a){this.t={};this.tick=function(a,c,b){this.t[a]=[void 0!=b?b:(new Date).getTime(),c];if(void 0==b)try{window.console.timeStamp(n+a)}catch(d){}};this.tick(k,null,a)}var a;window.performance&&(a=window.performance.timing);var p=a?new f(a.responseStart):new f;window.jstiming={Timer:f,load:p};if(a){var c=a.navigationStart,d=a.responseStart;0<c&&d>=c&&(window.jstiming.srt=d-c)}if(a){var b=window.jstiming.load;0<c&&d>=c&&(b.tick(l,void 0,c),b.tick(e,l,d),b.tick(g,e))}try{a=null,
window.chrome&&window.chrome.csi&&(a=Math.floor(window.chrome.csi().pageT),b&&0<c&&(b.tick(m,void 0,window.chrome.csi().startE),b.tick(h,m,c))),null==a&&window.gtbExternal&&(a=window.gtbExternal.pageT()),null==a&&window.external&&(a=window.external.pageT,b&&0<c&&(b.tick(m,void 0,window.external.startE),b.tick(h,m,c))),a&&(window.jstiming.pt=a)}catch(q){}})(); })()
</script>
<link rel="shortcut icon" href="/_/rsrc/1354323194313/favicon.ico" type="image/x-icon" />
<link rel="apple-touch-icon" href="https://ssl.gstatic.com/sites/p/56e332/system/app/images/apple-touch-icon.png" type="image/png" />
<script type="text/javascript">/* Copyright 2008 Google. */ (function() { var d="",g="__duration__",h="function";function k(c){return document.getElementById(c)}window.byId=k;function l(c){return c.replace(/^\s+|\s+$/g,d)}window.trim=l;var m=[],n=0;window.JOT_addListener=function(c,a,b){var e=new String(n++);c={eventName:c,handler:a,compId:b,key:e};m.push(c);return e};window.JOT_removeListenerByKey=function(c){for(var a=0;a<m.length;a++)if(m[a].key==c){m.splice(a,1);break}};
window.JOT_removeAllListenersForName=function(c){for(var a=0;a<m.length;a++)m[a].eventName==c&&m.splice(a,1)};window.JOT_postEvent=function(c,a,b){var e={eventName:c,eventSrc:a||{},payload:b||{}};if(window.JOT_fullyLoaded)for(a=m.length,b=0;b<a&&b<m.length;b++){var f=m[b];f&&f.eventName==c&&(e.listenerCompId=f.compId||d,(f=typeof f.handler==h?f.handler:window[f.handler])&&f(e))}else window.JOT_delayedEvents.push({eventName:c,eventSrc:a,payload:b})};window.JOT_delayedEvents=[];
window.JOT_fullyLoaded=!1;window.JOT_formatRelativeToNow=function(c,a){var b=((new Date).getTime()-c)/6E4;if(1440<=b||0>b)return null;var e=0;60<=b&&(b/=60,e=2);2<=b&&e++;return a?window.JOT_siteRelTimeStrs[e].replace(g,Math.floor(b)):window.JOT_userRelTimeStrs[e].replace(g,Math.floor(b))}; })()
</script>
<script>

  

  var breadcrumbs = [{"path":"/developers","deleted":false,"title":"For Developers","dir":"ltr"},{"path":"/developers/testing","deleted":false,"title":"Testing and infrastructure","dir":"ltr"},{"path":"/developers/testing/memorysanitizer","deleted":false,"title":"MemorySanitizer (MSan)","dir":"ltr"}];
  var JOT_clearDotPath = 'https://ssl.gstatic.com/sites/p/56e332/system/app/images/cleardot.gif';

  
  var JOT_userRelTimeStrs = ["a minute ago","__duration__ minutes ago","an hour ago","__duration__ hours ago"];

  
  

  

  var webspace = {"enableAnalytics":true,"pageSharingId":"jotspot_page","enableUniversalAnalytics":false,"sharingPolicy":"OPENED_WITH_INDICATOR","siteTitle":"The Chromium Projects","isStartPageEnabled":true,"adsensePublisherId":null,"features":{"languageSelectDefaultTextSetToDefault":true,"validateClientGvizDataSourceUrls":true,"moreMobileStyleImprovements":true,"newInsertMenuIcons":true,"accessibleSortingButtons":true,"domainAnalyticsInGAOnly":true,"noCaptcha":true,"fileCabinetScreenReaderFix":true,"updatedTosAndPrivacyLinks":null,"pageDrafts":false,"mobileOrientationFix":true,"plusBadge":false,"pdfEmbedSupport":false,"jsClickFix":true},"isPublic":true,"isConsumer":false,"serverFlags":{"cajaBaseUrl":"//www.gstatic.com/caja","cajaDebugMode":false},"onepickBaseUrl":"https://docs.google.com","domainAnalyticsAccountId":"","plusPageId":"","signInUrl":"https://www.google.com/a/SelectSession?continue\u003dhttps://sites.google.com/a/chromium.org/dev/developers/testing/memorysanitizer\u0026service\u003djotspot","analyticsAccountId":"UA-5484340-1","scottyUrl":"/_/upload","homePath":"/","siteNoticeUrlEnabled":null,"plusPageUrl":"","adsensePromoClickedOrSiteIneligible":true,"csiReportUri":"https://gg.google.com/csi","sharingId":"jotspot","termsUrl":"//www.google.com/intl/en/policies/terms/","gvizVersion":1,"editorResources":{"sitelayout":["https://ssl.gstatic.com/sites/p/56e332/system/app/css/sitelayouteditor.css"],"text":["https://ssl.gstatic.com/sites/p/56e332/system/js/codemirror.js","https://ssl.gstatic.com/sites/p/56e332/system/app/css/codemirror_css.css","https://ssl.gstatic.com/sites/p/56e332/system/js/trog_edit__en.js","https://ssl.gstatic.com/sites/p/56e332/system/app/css/trogedit.css","/_/rsrc/1441580320000/system/app/css/editor.css","https://ssl.gstatic.com/sites/p/56e332/system/app/css/codeeditor.css","/_/rsrc/1441580320000/system/app/css/camelot/editor-jfk-wlb.css"]},"sharingUrlPrefix":"/_/sharing","isAdsenseEnabled":true,"domain":"chromium.org","baseUri":"","name":"dev","siteTemplateId":false,"siteNoticeRevision":null,"siteNoticeUrlAddress":null,"siteNoticeMessage":null,"page":{"isRtlLocale":false,"canDeleteWebspace":null,"isPageDraft":null,"parentPath":"/developers/testing","parentWuid":"wuid:gx:1415bd4fdab62446","siteLocale":"en","timeZone":"America/Los_Angeles","type":"text","title":"MemorySanitizer (MSan)","locale":"en","wuid":"wuid:gx:35aa3cc44f120757","revision":61,"path":"/developers/testing/memorysanitizer","isSiteRtlLocale":false,"pageInheritsPermissions":null,"name":"memorysanitizer","canChangePath":true,"state":"","properties":{},"bidiEnabled":false,"currentTemplate":{"path":"/system/app/pagetemplates/text","title":"Web Page"}},"canPublishScriptToAnyone":true,"user":{"keyboardShortcuts":true,"sessionIndex":"","guest_":true,"displayNameOrEmail":"guest","userName":"guest","uid":"","renderMobile":false,"domain":"","namespace":"","hasWriteAccess":false,"namespaceUser":false,"primaryEmail":"guest","hasAdminAccess":false},"gadgets":{"baseUri":"/system/app/pages/gadgets"}};
  webspace.page.breadcrumbs = breadcrumbs;

  
  var JOT_siteRelTimeStrs = ["a minute ago","__duration__ minutes ago","an hour ago","__duration__ hours ago"];

</script>
<script type="text/javascript">
                window.jstiming.load.tick('scl');
              </script>
<meta name="title" content="MemorySanitizer (MSan) - The Chromium Projects" />
<meta itemprop="name" content="MemorySanitizer (MSan) - The Chromium Projects" />
<meta property="og:title" content="MemorySanitizer (MSan) - The Chromium Projects" />
<meta name="description" content="Home of the Chromium Open Source Project" />
<meta itemprop="description" content="Home of the Chromium Open Source Project" />
<meta id="meta-tag-description" property="og:description" content="Home of the Chromium Open Source Project" />
<style type="text/css">
</style>
<link rel="stylesheet" type="text/css" href="https://ssl.gstatic.com/sites/p/56e332/system/app/themes/beigeandblue/standard-css-beigeandblue-ltr-ltr.css" />
<link rel="stylesheet" type="text/css" href="/_/rsrc/1441580320000/system/app/css/overlay.css?cb=beigeandblueundefineda100%25%25150goog-ws-leftthemedefaultstandard" />
<link rel="stylesheet" type="text/css" href="/_/rsrc/1441580320000/system/app/css/camelot/allthemes-view.css" />
<!--[if IE]>
          <link rel="stylesheet" type="text/css" href="/system/app/css/camelot/allthemes%2die.css" />
        <![endif]-->
<title>MemorySanitizer (MSan) - The Chromium Projects</title>
<meta itemprop="image" content="/_/rsrc/1438879449147/config/customLogo.gif?revision=3" />
<meta property="og:image" content="/_/rsrc/1438879449147/config/customLogo.gif?revision=3" />
<script type="text/javascript">
                window.jstiming.load.tick('cl');
              </script>
</head>
<body xmlns="http://www.google.com/ns/jotspot" id="body" class=" en            ">
<div id="sites-page-toolbar" class="sites-header-divider">
<div xmlns="http://www.w3.org/1999/xhtml" id="sites-status" class="sites-status" style="display:none;"><div id="sites-notice" class="sites-notice" role="status" aria-live="assertive"> </div></div>
</div>
<div id="sites-chrome-everything-scrollbar">
<div id="sites-chrome-everything" class="">
<div id="sites-chrome-page-wrapper" style="direction: ltr">
<div id="sites-chrome-page-wrapper-inside">
<div xmlns="http://www.w3.org/1999/xhtml" id="sites-chrome-header-wrapper" style="height:auto;">
<table id="sites-chrome-header" class="sites-layout-hbox" cellspacing="0" style="height:auto;">
<tr class="sites-header-primary-row" id="sites-chrome-userheader">
<td id="sites-header-title" class="" role="banner"><div class="sites-header-cell-buffer-wrapper"><a href="https://www.chromium.org/" id="sites-chrome-userheader-logo"><img id="logo-img-id" src="/_/rsrc/1438879449147/config/customLogo.gif?revision=3" alt="The Chromium Projects" class="sites-logo  " /></a><h2><a href="https://www.chromium.org/" dir="ltr" id="sites-chrome-userheader-title">The Chromium Projects</a></h2></div></td><td class="sites-layout-searchbox  "><div class="sites-header-cell-buffer-wrapper"><form id="sites-searchbox-form" action="/system/app/pages/search" role="search"><input type="hidden" id="sites-searchbox-scope" name="scope" value="search-site" /><input type="text" id="jot-ui-searchInput" name="q" size="20" value="" aria-label="Search this site" /><div id="sites-searchbox-button-set" class="goog-inline-block"><div role="button" id="sites-searchbox-search-button" class="goog-inline-block jfk-button jfk-button-standard" tabindex="0">Search this site</div></div></form></div></td>
</tr>
<tr class="sites-header-secondary-row" id="sites-chrome-horizontal-nav">
<td colspan="2" id="sites-chrome-header-horizontal-nav-container" role="navigation">
</td>
</tr>
</table>
</div>
<div id="sites-chrome-main-wrapper">
<div id="sites-chrome-main-wrapper-inside">
<table id="sites-chrome-main" class="sites-layout-hbox" cellspacing="0" cellpadding="{scmCellpadding}" border="0">
<tr>
<td id="sites-chrome-sidebar-left" class="sites-layout-sidebar-left initial" style="width:150px">
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_7648876402527094" class="sites-embed" role="navigation"><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotId="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="/chromium-projects" jotId="wuid:gx:10ae433dadbbab13" class="sites-navigation-link">Home</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="/Home" jotId="wuid:gx:43582b9d2029d3af" class="sites-navigation-link">Chromium</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="/chromium-os" jotId="wuid:gx:83df2ab1f8880ba" class="sites-navigation-link">Chromium OS</a></div></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_14720868319272995" class="sites-embed" role="navigation"><h4 class="sites-embed-title">Quick links</h4><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotId="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="http://www.chromium.org/for-testers/bug-reporting-guidelines" class="sites-navigation-link">Report bugs</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="http://www.chromium.org/developers/discussion-groups" class="sites-navigation-link">Discuss</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="/system/app/pages/sitemap/hierarchy" jotId="wuid:gx:4b58a9a350ad12f" class="sites-navigation-link">网站地图</a></div></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_19690813310444355" class="sites-embed" role="navigation"><h4 class="sites-embed-title">Other sites</h4><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotId="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="http://blog.chromium.org/" class="sites-navigation-link">Chromium Blog</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="http://code.google.com/chrome/extensions/" class="sites-navigation-link">Google Chrome Extensions</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="https://developers.google.com/chrome/chrome-frame/" class="sites-navigation-link">Google Chrome Frame</a></div></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_19695218559354544" class="sites-embed" role="complementary"><h4 class="sites-embed-title"></h4><div class="sites-embed-content sites-embed-content-sidebar-textbox"><div dir="ltr"><span style="font-size:x-small">Except as otherwise </span><a href="http://developers.google.com/site-policies.html#restrictions"><span style="font-size:x-small">noted</span></a><span style="font-size:x-small">, the content of this page is licensed under a </span><a href="http://creativecommons.org/licenses/by/2.5/"><span style="font-size:x-small">Creative Commons Attribution 2.5 license</span></a><span style="font-size:x-small">, and examples are licensed under the </span><a href="http://src.chromium.org/viewvc/chrome/trunk/src/LICENSE" target="_blank"><span style="font-size:x-small">BSD License</span></a><span style="font-size:x-small">.<br /></span></div></div></div>
</td>
<td id="sites-canvas-wrapper">
<div id="sites-canvas" role="main">
<div id="goog-ws-editor-toolbar-container"> </div>
<div xmlns="http://www.w3.org/1999/xhtml" id="title-crumbs" style="">
<A href="/developers" dir="ltr">For Developers</A>‎ &gt; ‎<A href="/developers/testing" dir="ltr">Testing and infrastructure</A>‎ &gt; ‎
  </div>
<h3 xmlns="http://www.w3.org/1999/xhtml" id="sites-page-title-header" style="" align="left">
<span id="sites-page-title" dir="ltr" tabindex="-1" style="outline: none">MemorySanitizer (MSan)</span>
</h3>
<div id="sites-canvas-main" class="sites-canvas-main">
<div id="sites-canvas-main-content">
<table xmlns="http://www.w3.org/1999/xhtml" cellspacing="0" class="sites-layout-name-one-column sites-layout-hbox"><tbody><tr><td class="sites-layout-tile sites-tile-name-content-1"><div dir="ltr">MemorySanitizer (MSan) is a tool that detects use of uninitialized memory.<div>MSan is supported on x86_64 Linux. <span style="font-size:10pt;background-color:transparent">Additional info on the tool is available at </span><a href="http://clang.llvm.org/docs/MemorySanitizer.html" rel="nofollow" style="font-size:10pt;background-color:transparent">http://clang.llvm.org/docs/MemorySanitizer.html</a><span style="font-size:10pt;background-color:transparent">.</span><div><br /></div><div>MSan in Chromium is unlikely to be usable on systems other than Ubuntu Precise/Trusty - please see the note on instrumented libraries below.</div><div><br /></div><div>MSan bots are running on <a href="http://build.chromium.org/p/chromium.memory.fyi/waterfall?builder=Chromium+Linux+MSan+Builder&amp;builder=Linux+MSan+Tests&amp;builder=Chromium+Linux+ChromeOS+MSan+Builder&amp;builder=Linux+ChromeOS+MSan+Tests&amp;reload=none">chromium.memory.fyi</a>, <a href="http://build.chromium.org/p/client.webrtc/builders/Linux%20MSan">client.webrtc</a> and <a href="http://build.chromium.org/p/chromium.webkit/builders/WebKit%20Linux%20MSAN">chromium.webkit</a>. <span style="font-size:10pt;background-color:transparent">There are also two LKGR builders for ClusterFuzz: </span><a href="http://build.chromium.org/p/chromium.lkgr/builders/MSAN%20Release%20(no%20origins)" style="font-size:10pt;background-color:transparent">no origins</a><span style="font-size:10pt;background-color:transparent">, </span><a href="http://build.chromium.org/p/chromium.lkgr/builders/MSAN%20Release%20(chained%20origins)" style="font-size:10pt;background-color:transparent">chained origins</a><span style="font-size:10pt;background-color:transparent"> (see below for explanation). V8 deployment is ongoing.</span></div><div><span style="font-size:10pt;background-color:transparent"><br /></span></div><div><span style="font-size:10pt;background-color:transparent">Trybots: </span><span style="background-color:transparent"><a href="http://build.chromium.org/p/tryserver.chromium.linux/builders/linux_chromium_msan_rel_ng/">linux_chromium_msan_rel_ng</a>, <a href="http://build.chromium.org/p/tryserver.chromium.linux/builders/linux_chromium_chromeos_msan_rel_ng/">linux_chromium_chromeos_msan_rel_ng</a>.</span></div><div><div><div class="sites-embed-align-left-wrapping-off"><div class="sites-embed-border-off sites-embed" style="width:250px;"><div class="sites-embed-content sites-embed-type-toc"><div class="goog-toc sites-embed-toc-maxdepth-6"><p>Contents</p><ol class="goog-toc"><li class="goog-toc"><a href="#TOC-Pre-built-Chrome-binaries"><strong>1 </strong>Pre-built Chrome binaries</a></li><li class="goog-toc"><a href="#TOC-How-to-build-and-run"><strong>2 </strong>How to build and run</a><ol class="goog-toc"><li class="goog-toc"><a href="#TOC-Origin-tracking"><strong>2.1 </strong>Origin tracking</a></li><li class="goog-toc"><a href="#TOC-Suppressions"><strong>2.2 </strong>Suppressions</a></li></ol></li><li class="goog-toc"><a href="#TOC-Debugging-MSan-reports"><strong>3 </strong>Debugging MSan reports</a></li></ol></div></div></div></div></div><h2><a name="TOC-Pre-built-Chrome-binaries"></a>Pre-built Chrome binaries</h2>You can grab fresh Chrome binaries for Linux built with MSan <a href="http://commondatastorage.googleapis.com/chromium-browser-msan/index.html">here</a>.<h2><a name="TOC-How-to-build-and-run"></a>How to build and run</h2></div><div>To set up an MSan build in GN <span style="font-size:13.3333px;background-color:transparent">(setting GYP_DEFINES and running gclient are necessary the first time to make it download the instrumented libraries ☹):</span></div><div><div style="font-size:13.3333px"><div><br /></div><div></div><div class="sites-codeblock sites-codesnippet-block"><div><code>GYP_DEFINES='msan=1 use_prebuilt_instrumented_libraries=1' gclient runhooks</code></div><div><font color="#006000" face="monospace">gn args out/msan</font></div></div></div><div style="font-size:13.3333px"><br /></div></div><div style="font-size:13.3333px">In the resulting editor, set the build variables:</div><div style="font-size:13.3333px"><br /></div></div><blockquote style="margin:0 0 0 40px;border:none;padding:0px"><div><div style="font-size:13.3333px"><div style="font-size:13.3333px"><font face="courier new, monospace">is_msan = true</font></div></div></div></blockquote><blockquote style="margin:0 0 0 40px;border:none;padding:0px"><div><div style="font-size:13.3333px"><div style="font-size:13.3333px"><span style="font-family:courier new,monospace;font-size:13.3333px;background-color:transparent">use_prebuilt_instrumented_libraries = true</span></div><div style="font-size:13.3333px"><span style="font-family:courier new,monospace;font-size:13.3333px;background-color:transparent">is_debug = false  <font color="#999999"># Release build.</font></span></div></div></div></blockquote><blockquote style="margin:0 0 0 40px;border:none;padding:0px"><div style="font-size:13.3333px"><blockquote style="font-size:13.3333px;margin:0px 0px 0px 40px;border:none;padding:0px"><div style="font-size:13.3333px"></div></blockquote><div style="font-size:13.3333px"><font face="courier new, monospace">enable_nacl = false  <font color="#999999"># Necessary until the NaCl GN build is more complete.</font></font></div></div></blockquote><div><div style="font-size:13.3333px"><br /></div><div>In GYP:</div><div><div><br /></div><div></div><div class="sites-codeblock sites-codesnippet-block"><div><code>GYP_DEFINES='use_goma=1 msan=1 use_prebuilt_instrumented_libraries=1' gclient runhooks</code></div><div><code>ninja -C out/Release base_unittests</code></div></div></div><div><br /></div><div><span style="font-size:10pt;background-color:transparent">Flags breakdown:</span></div><div><ul><li><code>is_msan<font color="#000000" face="arial, sans-serif"> / </font>msan</code>: Enable MSan support in Chromium binaries.</li><li><code style="font-size:10pt;background-color:transparent">use_prebuilt_instrumented_libraries</code><span style="font-size:10pt;background-color:transparent">: Download a set of sanitizer-instrumented system libraries. Without those, MSan will produce lots of bogus reports, making it unusable.</span></li></ul><div>Instrumented libraries are enabled with a separate flag because certain smaller targets do not need them. This applies to targets such as <code>pdfium_test</code> and <code>d8</code>, which do not depend on any external libraries.</div><div>Note that instrumented libraries are supported on Ubuntu Precise/Trusty only. More information: <a href="https://www.chromium.org/developers/testing/instrumented-libraries-for-dynamic-tools">instrumented-libraries-for-dynamic-tools</a>.</div><div><br /></div><div>The following flags are implied by <code>msan=1</code> (i.e. you don't have to set them explicitly):</div><ul><li><code>use_custom_libcxx=1</code>: <span style="font-size:10pt;background-color:transparent">Use a just-built, MSan-instrumented libc++ instead of the system-wide</span><span style="font-size:10pt;background-color:transparent"> libstdc++. This is required to avoid false reports whenever </span><span style="font-size:10pt;background-color:transparent">the C++ standard library is used.</span></li><li><code>v8_target_arch=arm64</code>: JavaScript code will be compiled for ARM64 and run on an ARM64 simulator. This allows MSan to instrument JS code. Without this flag there will be false reports.</li></ul><div>Run the resulting binaries as usual. Pipe the output through <code>tools/valgrind/asan/asan_symbolize.py</code> to get symbolized reports.</div></div><div><br /></div><div>Chrome must not use hardware OpenGL when running under MSan. This is because libgl.so is not instrumented and will crash the GPU process. OSMesa can be used as a software OpenGL implementation, although it is extremely slow. There are several ways to proceed:</div><div><ul><li><span style="font-size:10pt;background-color:transparent"><code>--use-osmesa --disable-gpu-compositing</code>: This is a reasonable combination of flags which enables Chrome's software compositor (much faster than OSMesa compositing) but still uses OSMesa for things like Flash and WebGL. Be aware that software compositing is not otherwise used by default, so you'll be testing a code path that is not enabled for most users. If you're not happy with that, you can drop the second flag.</span></li><li><font color="#006000" face="monospace">--disable-gpu<span style="color:rgb(0,0,0);font-family:Arial,Verdana,sans-serif;font-size:13.6000003814697px">:</span></font><span style="font-size:13.6000003814697px"> This forces Chrome to use the software path for everything (not just compositing). WebGL will not be supported at all, but other GL-accelerated features may perform better compared to the combination of flags above.</span></li><li><code>--use-osmesa --disable-gl-drawing-for-tests</code><span style="font-size:13.6000003814697px">: Use this if you don't care about the actual pixel output. This exercises the default code paths, however expensive OSMesa calls are replaced with stubs (i.e. nothing actually gets drawn to the screen).</span></li></ul><div>If neither flag is specified, Chrome will fall back to the first option after the GPU process crashes with an MSan report.</div></div><div><div><h3><a name="TOC-Origin-tracking"></a>Origin tracking</h3></div></div><div><span style="background-color:transparent">MSan allows the user to trade off execution speed for the amount of information provided in reports. This is controlled by the GN/GYP flag </span><code style="background-color:transparent">msan_track_origins</code><span style="background-color:transparent">:</span></div><div><ul><li><span style="background-color:transparent"><code>msan_track_origins=0</code>: MSan will tell you where the uninitialized value was used, but not where it came from. This is the fastest mode.</span></li><li><span style="background-color:transparent"><code>msan_track_origins=1</code> (deprecated): MSan will also tell you where the uninitialized value was originally allocated (e.g. which malloc() call, or which local variable). This mode is not significantly faster than <code>msan_track_origins=2</code>, and its use is discouraged. We do not provide pre-built instrumented libraries for this mode.</span></li><li><span style="background-color:transparent"><code>msan_track_origins=2</code><span style="font-size:13.3333330154419px"> (default)</span>: MSan will also report the chain of stores that copied the uninitialized value to its final location. If there are more than 7 stores in the chain, only the first 7 will be reported. Note that compilation time may increase in this mode.</span></li></ul><h3><a name="TOC-Suppressions"></a>Suppressions</h3></div><div>MSan does not support suppressions. This is an intentional design choice.</div><div><br /></div><div>We have a <a href="https://code.google.com/p/chromium/codesearch/#chromium/src/tools/msan/blacklist.txt">blacklist file</a> which is applied at compile time, and is used mainly to compensate for tool issues. Blacklist rules do not work the way suppression rules do - rather than suppressing reports with matching stack traces, they change the way MSan instrumentation is applied to the matched function. In addition, blacklist changes require a full clobber to take efffect. Please refrain from making changes to the blacklist file unless you know what you are doing.</div><div><br /></div><div>Note also that instrumented libraries use separate blacklist files.</div><div><br /></div><h2><a name="TOC-Debugging-MSan-reports"></a>Debugging MSan reports</h2>Important caveats:<div><ul><li>Please keep in mind that simply reading/copying uninitialized memory will not cause an MSan report. Even simple arithmetic computations will work. To produce a report, the code has to do something significant with the uninitialized value, e.g. branch on it, pass it to a libc function or use it to index an array.</li><li><span style="font-size:10pt;background-color:transparent">When you examine a stack trace in an MSan report, all third-party libraries you see in it (with the exception of libc and its components) should reside under </span><code style="font-size:10pt;background-color:transparent">out/Release/instrumented_libraries</code><span style="font-size:10pt;background-color:transparent">. If you see a DSO under a system-wide directory (e.g. /</span><code style="font-size:10pt;background-color:transparent">lib/</code><span style="font-size:10pt;background-color:transparent">), then the report is likely bogus and should be fixed by simply adding that DSO to the list of instrumented libraries (please ping earthdok@).</span></li><li><span style="font-size:10pt;background-color:transparent">Inline assembly is also likely to cause bogus reports. Consequently, assembly-optimized third-party code (such as libjpeg_turbo, libvpx, libyuv, ffmpeg) will have those optimizations disabled in MSan builds.</span></li><li><span style="font-size:13.6000003814697px;background-color:transparent">If you're trying to debug a V8-related issue, please keep in mind that MSan builds run V8 in ARM64 mode, as explained below.</span></li></ul></div><div><div><span style="font-size:10pt;background-color:transparent">MSan reserves a separate memory region ("shadow memory") in which it tracks the status of application memory. The correspondence between the two is bit-to-bit: if the shadow bit is set to 1, the corresponding bit in the application memory is considered "poisoned" (i.e. uninitialized). The header file </span><code style="font-size:10pt;background-color:transparent">&lt;sanitizer/msan_interface.h&gt;</code><span style="font-size:10pt;background-color:transparent"> declares interface functions which can be used to examine and manipulate the shadow state without changing the application memory, which comes in handy when debugging MSan reports.</span></div><div><br /></div><div><span style="font-size:13.6000003814697px">Print the complete shadow state of a range of application memory, including the origins of all uninitialized values, if any. (Note: though initializedness is tracked on bit level, origins have 4-byte granularity.)</span></div><div></div><div class="sites-codeblock sites-codesnippet-block"><div><code>void __msan_print_shadow(const volatile void *x, size_t size);</code></div><div></div></div><br /><div>The following prints a more minimalistic report which shows only the shadow memory:</div><div></div><div class="sites-codeblock sites-codesnippet-block"><div><code>void __msan_dump_shadow(const volatile void *x, size_t size);</code></div><div></div></div><br /><div><span style="font-size:10pt;background-color:transparent">To mark a memory range as fully uninitialized/initialized:</span></div><div></div><div class="sites-codeblock sites-codesnippet-block"><div><span style="background-color:transparent"><code>void __msan_poison(const volatile void *a, size_t size);</code></span></div><div><code>void __msan_unpoison(const volatile void *a, size_t size);</code></div><div><code>void __msan_unpoison_string(const volatile char *a);</code></div></div><div><br /></div><div>The following forces an MSan check, i.e. if any bits in the memory range are uninitialized the call will crash with an MSan report.</div><div><div class="sites-codeblock sites-codesnippet-block"><code>void __msan_check_mem_is_initialized(const volatile void *x, size_t size);</code></div></div><div><br /></div><div>This milder check returns the offset of the first (at least partially) poisoned byte in the range, or -1 if the whole range is good:</div><div><div class="sites-codeblock sites-codesnippet-block"><code>intptr_t __msan_test_shadow(const volatile void *x, size_t size);</code></div></div><div><br /></div><div>Hint: sometimes to reduce log spam it makes sense to query <code>__msan_test_shadow()</code> before calling <code>__msan_print_shadow()</code>.</div><div><br /></div><div>The complete interface can be found in <code>src/third_party/llvm-build/Release+Asserts/lib/clang/3.6.0/include/sanitizer/msan_interface.h</code>. Functions such as <code>__msan_unpoison()</code> can also be used to permanently annotate your code for MSan, but please CC earthdok@ or eugenis@ if you intend to do so.</div><div><br /></div><div><br /></div></div></div></div></td></tr></tbody></table>
</div> 
</div> 
<div id="sites-canvas-bottom-panel">
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_page-subpages"> </div>
<div id="sites-attachments-container">
</div>
<a xmlns="http://www.w3.org/1999/xhtml" name="page-comments"></a>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_page-comments"><div class="sites-comment-docos-wrapper"><div class="sites-comment-docos"><div class="sites-comment-docos-background"></div><div class="sites-comment-docos-header"><div class="sites-comment-docos-header-title">Comments</div></div><div id="sites-comment-docos-pane" class="sites-comment-docos-pane"></div></div></div></div>
</div>
</div> 
</td> 
</tr>
</table> 
</div> 
</div> 
<div id="sites-chrome-footer-wrapper">
<div id="sites-chrome-footer-wrapper-inside">
<div id="sites-chrome-footer">
</div>
</div>
</div>
</div> 
</div> 
<div id="sites-chrome-adminfooter-container">
<div xmlns="http://www.w3.org/1999/xhtml" class="sites-adminfooter" role="navigation"><p><a class="sites-system-link" href="https://www.google.com/a/UniversalLogin?service=jotspot&amp;continue=https://sites.google.com/a/chromium.org/dev/developers/testing/memorysanitizer">Sign in</a><span aria-hidden="true">|</span><a class="sites-system-link" href="/system/app/pages/recentChanges">Recent Site Activity</a><span aria-hidden="true">|</span><a class="sites-system-link" href="/system/app/pages/reportAbuse" target="_blank">Report Abuse</a><span aria-hidden="true">|</span><a class="sites-system-link" href="javascript:;" onclick="window.open(webspace.printUrl)">Print Page</a><span aria-hidden="true">|</span><span class="sites-system-link">Powered By</span> <b class="powered-by"><a href="http://sites.google.com">Google Sites</a></b></p></div>
</div>
</div> 
</div> 
<div id="sites-chrome-onebar-footer">
</div>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    window.jstiming.load.tick('sjl');
  </script>
<script xmlns="http://www.w3.org/1999/xhtml" src="https://ssl.gstatic.com/sites/p/56e332/system/js/jot_min_view__en.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    window.jstiming.load.tick('jl');
  </script>
<script xmlns="http://www.w3.org/1999/xhtml">
      
          sites.core.Analytics.createTracker();
          sites.core.Analytics.trackPageview();
        
    </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
                    sites.Searchbox.initialize(
                        'sites-searchbox-search-button',
                        {"object":[]}['object'],
                        'search-site',
                        {"label":"Configure search options...","url":"/system/app/pages/admin/settings"});
                  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
      gsites.HoverPopupMenu.createSiteDropdownMenus('sites-header-nav-dropdown', false);
    </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
            JOT_setupNav("7648876402527094", "Navigation", false);
            JOT_addListener('titleChange', 'JOT_NAVIGATION_titleChange', 'COMP_7648876402527094');
          </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
            JOT_setupNav("14720868319272995", "Quick links", false);
            JOT_addListener('titleChange', 'JOT_NAVIGATION_titleChange', 'COMP_14720868319272995');
          </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
            JOT_setupNav("19690813310444355", "Other sites", false);
            JOT_addListener('titleChange', 'JOT_NAVIGATION_titleChange', 'COMP_19690813310444355');
          </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
              new sites.CommentPane('//docs.google.com/comments/d/AAHRpnXvrAwjAfmld0ObrebBiGRq9PsjnH6Z7swrbIuFccoFlY_7HbsOcJzn3ddCamojD93JuVpmLRdm-_Tw3HXjaEKIzTDWjartbvVzN7FyLp390WUKZGAERESvAaF5fbcqanQ4Xojlj/api/js?anon=true',
                  false, false);
            </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
  setTimeout(function() {
    var fingerprint = gsites.date.TimeZone.getFingerprint([]);
    gsites.Xhr.send('https://www.chromium.org/_/tz', null, null, 'GET', null, null, { afjstz: fingerprint });
  }, 500);
</script>
<script xmlns="http://www.w3.org/1999/xhtml">
                    window.onload = function() {
                      if (false) {
                        JOT_setMobilePreview();
                      }
                      var loadTimer = window.jstiming.load;
                      loadTimer.tick("ol");
                      loadTimer["name"] = "load," + webspace.page.type + ",user_page";
                      window.jstiming.report(loadTimer, {}, 'https://gg.google.com/csi');
                    }
                  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
        JOT_insertAnalyticsCode(false,
            false);
      </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    var maestroRunner = new gsites.pages.view.SitesMaestroRunner(
        webspace, "en");
    maestroRunner.initListeners();
    maestroRunner.installEditRender();
  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
  //<![CDATA[
    // Decorate any fastUI buttons on the page with a class of 'goog-button'.
    if (webspace.user.hasWriteAccess) {
      JOT_decorateButtons();
    }

    // Fires delayed events.
    (function() {
      JOT_fullyLoaded = true;
      var delayedEvents = JOT_delayedEvents;
      for (var x = 0; x < delayedEvents.length; x++) {
        var event = delayedEvents[x];
        JOT_postEvent(event.eventName, event.eventSrc, event.payload);
      }
      JOT_delayedEvents = null;
      JOT_postEvent('pageLoaded');
    })();
  //]]>
</script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    JOT_postEvent('decorateGvizCharts');
  </script>
<script type="text/javascript">
          JOT_setupPostRenderingManager();
        </script>
<script type="text/javascript">
          JOT_postEvent('renderPlus', null, 'sites-chrome-main');
        </script>
<div id="server-timer-div" style="display:none"> </div>
<script type="text/javascript">
          window.jstiming.load.tick('render');
          JOT_postEvent('usercontentrendered', this);
        </script>
</body>
</html>
