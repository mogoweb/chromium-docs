<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/WebPage">
<head>
<meta http-equiv="X-UA-Compatible" content="chrome=1" />
<script type="text/javascript">/* Copyright 2008 Google. */ (function() { var e="wtsrt_",g="tbsd_",h="tbnd_",k="start",l="_wtsrt",m="_tbnd",n="CSI/";(function(){function f(a){this.t={};this.tick=function(a,c,b){this.t[a]=[void 0!=b?b:(new Date).getTime(),c];if(void 0==b)try{window.console.timeStamp(n+a)}catch(d){}};this.tick(k,null,a)}var a;window.performance&&(a=window.performance.timing);var p=a?new f(a.responseStart):new f;window.jstiming={Timer:f,load:p};if(a){var c=a.navigationStart,d=a.responseStart;0<c&&d>=c&&(window.jstiming.srt=d-c)}if(a){var b=window.jstiming.load;0<c&&d>=c&&(b.tick(l,void 0,c),b.tick(e,l,d),b.tick(g,e))}try{a=null,
window.chrome&&window.chrome.csi&&(a=Math.floor(window.chrome.csi().pageT),b&&0<c&&(b.tick(m,void 0,window.chrome.csi().startE),b.tick(h,m,c))),null==a&&window.gtbExternal&&(a=window.gtbExternal.pageT()),null==a&&window.external&&(a=window.external.pageT,b&&0<c&&(b.tick(m,void 0,window.external.startE),b.tick(h,m,c))),a&&(window.jstiming.pt=a)}catch(q){}})(); })()
</script>
<link rel="shortcut icon" href="/_/rsrc/1354323194313/favicon.ico" type="image/x-icon" />
<link rel="apple-touch-icon" href="https://ssl.gstatic.com/sites/p/56e332/system/app/images/apple-touch-icon.png" type="image/png" />
<script type="text/javascript">/* Copyright 2008 Google. */ (function() { var d="",g="__duration__",h="function";function k(c){return document.getElementById(c)}window.byId=k;function l(c){return c.replace(/^\s+|\s+$/g,d)}window.trim=l;var m=[],n=0;window.JOT_addListener=function(c,a,b){var e=new String(n++);c={eventName:c,handler:a,compId:b,key:e};m.push(c);return e};window.JOT_removeListenerByKey=function(c){for(var a=0;a<m.length;a++)if(m[a].key==c){m.splice(a,1);break}};
window.JOT_removeAllListenersForName=function(c){for(var a=0;a<m.length;a++)m[a].eventName==c&&m.splice(a,1)};window.JOT_postEvent=function(c,a,b){var e={eventName:c,eventSrc:a||{},payload:b||{}};if(window.JOT_fullyLoaded)for(a=m.length,b=0;b<a&&b<m.length;b++){var f=m[b];f&&f.eventName==c&&(e.listenerCompId=f.compId||d,(f=typeof f.handler==h?f.handler:window[f.handler])&&f(e))}else window.JOT_delayedEvents.push({eventName:c,eventSrc:a,payload:b})};window.JOT_delayedEvents=[];
window.JOT_fullyLoaded=!1;window.JOT_formatRelativeToNow=function(c,a){var b=((new Date).getTime()-c)/6E4;if(1440<=b||0>b)return null;var e=0;60<=b&&(b/=60,e=2);2<=b&&e++;return a?window.JOT_siteRelTimeStrs[e].replace(g,Math.floor(b)):window.JOT_userRelTimeStrs[e].replace(g,Math.floor(b))}; })()
</script>
<script>

  

  var breadcrumbs = [{"path":"/developers","deleted":false,"title":"For Developers","dir":"ltr"},{"path":"/developers/how-tos","deleted":false,"title":"How-Tos","dir":"ltr"},{"path":"/developers/how-tos/debugging-gpu-related-code","deleted":false,"title":"Debugging GPU related code","dir":"ltr"}];
  var JOT_clearDotPath = 'https://ssl.gstatic.com/sites/p/56e332/system/app/images/cleardot.gif';

  
  var JOT_userRelTimeStrs = ["a minute ago","__duration__ minutes ago","an hour ago","__duration__ hours ago"];

  
  

  

  var webspace = {"enableAnalytics":true,"pageSharingId":"jotspot_page","enableUniversalAnalytics":false,"sharingPolicy":"OPENED_WITH_INDICATOR","siteTitle":"The Chromium Projects","isStartPageEnabled":true,"adsensePublisherId":null,"features":{"languageSelectDefaultTextSetToDefault":true,"validateClientGvizDataSourceUrls":true,"moreMobileStyleImprovements":true,"newInsertMenuIcons":true,"accessibleSortingButtons":true,"domainAnalyticsInGAOnly":true,"noCaptcha":true,"fileCabinetScreenReaderFix":true,"updatedTosAndPrivacyLinks":null,"pageDrafts":false,"mobileOrientationFix":true,"plusBadge":false,"pdfEmbedSupport":false,"jsClickFix":true},"isPublic":true,"isConsumer":false,"serverFlags":{"cajaBaseUrl":"//www.gstatic.com/caja","cajaDebugMode":false},"onepickBaseUrl":"https://docs.google.com","domainAnalyticsAccountId":"","plusPageId":"","signInUrl":"https://www.google.com/a/SelectSession?continue\u003dhttps://sites.google.com/a/chromium.org/dev/developers/how-tos/debugging-gpu-related-code\u0026service\u003djotspot","analyticsAccountId":"UA-5484340-1","scottyUrl":"/_/upload","homePath":"/","siteNoticeUrlEnabled":null,"plusPageUrl":"","adsensePromoClickedOrSiteIneligible":true,"csiReportUri":"https://gg.google.com/csi","sharingId":"jotspot","termsUrl":"//www.google.com/intl/en/policies/terms/","gvizVersion":1,"editorResources":{"sitelayout":["https://ssl.gstatic.com/sites/p/56e332/system/app/css/sitelayouteditor.css"],"text":["https://ssl.gstatic.com/sites/p/56e332/system/js/codemirror.js","https://ssl.gstatic.com/sites/p/56e332/system/app/css/codemirror_css.css","https://ssl.gstatic.com/sites/p/56e332/system/js/trog_edit__en.js","https://ssl.gstatic.com/sites/p/56e332/system/app/css/trogedit.css","/_/rsrc/1441580320000/system/app/css/editor.css","https://ssl.gstatic.com/sites/p/56e332/system/app/css/codeeditor.css","/_/rsrc/1441580320000/system/app/css/camelot/editor-jfk-wlb.css"]},"sharingUrlPrefix":"/_/sharing","isAdsenseEnabled":true,"domain":"chromium.org","baseUri":"","name":"dev","siteTemplateId":false,"siteNoticeRevision":null,"siteNoticeUrlAddress":null,"siteNoticeMessage":null,"page":{"isRtlLocale":false,"canDeleteWebspace":null,"isPageDraft":null,"parentPath":"/developers/how-tos","parentWuid":"wuid:gx:21c4408ba07e936a","siteLocale":"en","timeZone":"America/Los_Angeles","type":"text","title":"Debugging GPU related code","locale":"en","wuid":"wuid:gx:4d149b53afbee62b","revision":10,"path":"/developers/how-tos/debugging-gpu-related-code","isSiteRtlLocale":false,"pageInheritsPermissions":null,"name":"debugging-gpu-related-code","canChangePath":true,"state":"","properties":{},"bidiEnabled":false,"currentTemplate":{"path":"/system/app/pagetemplates/text","title":"Web Page"}},"canPublishScriptToAnyone":true,"user":{"keyboardShortcuts":true,"sessionIndex":"","guest_":true,"displayNameOrEmail":"guest","userName":"guest","uid":"","renderMobile":false,"domain":"","namespace":"","hasWriteAccess":false,"namespaceUser":false,"primaryEmail":"guest","hasAdminAccess":false},"gadgets":{"baseUri":"/system/app/pages/gadgets"}};
  webspace.page.breadcrumbs = breadcrumbs;

  
  var JOT_siteRelTimeStrs = ["a minute ago","__duration__ minutes ago","an hour ago","__duration__ hours ago"];

</script>
<script type="text/javascript">
                window.jstiming.load.tick('scl');
              </script>
<meta name="title" content="Debugging GPU related code - The Chromium Projects" />
<meta itemprop="name" content="Debugging GPU related code - The Chromium Projects" />
<meta property="og:title" content="Debugging GPU related code - The Chromium Projects" />
<meta name="description" content="Home of the Chromium Open Source Project" />
<meta itemprop="description" content="Home of the Chromium Open Source Project" />
<meta id="meta-tag-description" property="og:description" content="Home of the Chromium Open Source Project" />
<style type="text/css">
</style>
<link rel="stylesheet" type="text/css" href="https://ssl.gstatic.com/sites/p/56e332/system/app/themes/beigeandblue/standard-css-beigeandblue-ltr-ltr.css" />
<link rel="stylesheet" type="text/css" href="/_/rsrc/1441580320000/system/app/css/overlay.css?cb=beigeandblueundefineda100%25%25150goog-ws-leftthemedefaultstandard" />
<link rel="stylesheet" type="text/css" href="/_/rsrc/1441580320000/system/app/css/camelot/allthemes-view.css" />
<!--[if IE]>
          <link rel="stylesheet" type="text/css" href="/system/app/css/camelot/allthemes%2die.css" />
        <![endif]-->
<title>Debugging GPU related code - The Chromium Projects</title>
<meta itemprop="image" content="/_/rsrc/1438879449147/config/customLogo.gif?revision=3" />
<meta property="og:image" content="/_/rsrc/1438879449147/config/customLogo.gif?revision=3" />
<script type="text/javascript">
                window.jstiming.load.tick('cl');
              </script>
</head>
<body xmlns="http://www.google.com/ns/jotspot" id="body" class=" en            ">
<div id="sites-page-toolbar" class="sites-header-divider">
<div xmlns="http://www.w3.org/1999/xhtml" id="sites-status" class="sites-status" style="display:none;"><div id="sites-notice" class="sites-notice" role="status" aria-live="assertive"> </div></div>
</div>
<div id="sites-chrome-everything-scrollbar">
<div id="sites-chrome-everything" class="">
<div id="sites-chrome-page-wrapper" style="direction: ltr">
<div id="sites-chrome-page-wrapper-inside">
<div xmlns="http://www.w3.org/1999/xhtml" id="sites-chrome-header-wrapper" style="height:auto;">
<table id="sites-chrome-header" class="sites-layout-hbox" cellspacing="0" style="height:auto;">
<tr class="sites-header-primary-row" id="sites-chrome-userheader">
<td id="sites-header-title" class="" role="banner"><div class="sites-header-cell-buffer-wrapper"><a href="https://www.chromium.org/" id="sites-chrome-userheader-logo"><img id="logo-img-id" src="/_/rsrc/1438879449147/config/customLogo.gif?revision=3" alt="The Chromium Projects" class="sites-logo  " /></a><h2><a href="https://www.chromium.org/" dir="ltr" id="sites-chrome-userheader-title">The Chromium Projects</a></h2></div></td><td class="sites-layout-searchbox  "><div class="sites-header-cell-buffer-wrapper"><form id="sites-searchbox-form" action="/system/app/pages/search" role="search"><input type="hidden" id="sites-searchbox-scope" name="scope" value="search-site" /><input type="text" id="jot-ui-searchInput" name="q" size="20" value="" aria-label="Search this site" /><div id="sites-searchbox-button-set" class="goog-inline-block"><div role="button" id="sites-searchbox-search-button" class="goog-inline-block jfk-button jfk-button-standard" tabindex="0">Search this site</div></div></form></div></td>
</tr>
<tr class="sites-header-secondary-row" id="sites-chrome-horizontal-nav">
<td colspan="2" id="sites-chrome-header-horizontal-nav-container" role="navigation">
</td>
</tr>
</table>
</div>
<div id="sites-chrome-main-wrapper">
<div id="sites-chrome-main-wrapper-inside">
<table id="sites-chrome-main" class="sites-layout-hbox" cellspacing="0" cellpadding="{scmCellpadding}" border="0">
<tr>
<td id="sites-chrome-sidebar-left" class="sites-layout-sidebar-left initial" style="width:150px">
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_7648876402527094" class="sites-embed" role="navigation"><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotId="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="/chromium-projects" jotId="wuid:gx:10ae433dadbbab13" class="sites-navigation-link">Home</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="/Home" jotId="wuid:gx:43582b9d2029d3af" class="sites-navigation-link">Chromium</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="/chromium-os" jotId="wuid:gx:83df2ab1f8880ba" class="sites-navigation-link">Chromium OS</a></div></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_14720868319272995" class="sites-embed" role="navigation"><h4 class="sites-embed-title">Quick links</h4><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotId="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="http://www.chromium.org/for-testers/bug-reporting-guidelines" class="sites-navigation-link">Report bugs</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="http://www.chromium.org/developers/discussion-groups" class="sites-navigation-link">Discuss</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="/system/app/pages/sitemap/hierarchy" jotId="wuid:gx:4b58a9a350ad12f" class="sites-navigation-link">网站地图</a></div></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_19690813310444355" class="sites-embed" role="navigation"><h4 class="sites-embed-title">Other sites</h4><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotId="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="http://blog.chromium.org/" class="sites-navigation-link">Chromium Blog</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="http://code.google.com/chrome/extensions/" class="sites-navigation-link">Google Chrome Extensions</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="https://developers.google.com/chrome/chrome-frame/" class="sites-navigation-link">Google Chrome Frame</a></div></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_19695218559354544" class="sites-embed" role="complementary"><h4 class="sites-embed-title"></h4><div class="sites-embed-content sites-embed-content-sidebar-textbox"><div dir="ltr"><span style="font-size:x-small">Except as otherwise </span><a href="http://developers.google.com/site-policies.html#restrictions"><span style="font-size:x-small">noted</span></a><span style="font-size:x-small">, the content of this page is licensed under a </span><a href="http://creativecommons.org/licenses/by/2.5/"><span style="font-size:x-small">Creative Commons Attribution 2.5 license</span></a><span style="font-size:x-small">, and examples are licensed under the </span><a href="http://src.chromium.org/viewvc/chrome/trunk/src/LICENSE" target="_blank"><span style="font-size:x-small">BSD License</span></a><span style="font-size:x-small">.<br /></span></div></div></div>
</td>
<td id="sites-canvas-wrapper">
<div id="sites-canvas" role="main">
<div id="goog-ws-editor-toolbar-container"> </div>
<div xmlns="http://www.w3.org/1999/xhtml" id="title-crumbs" style="">
<A href="/developers" dir="ltr">For Developers</A>‎ &gt; ‎<A href="/developers/how-tos" dir="ltr">How-Tos</A>‎ &gt; ‎
  </div>
<h3 xmlns="http://www.w3.org/1999/xhtml" id="sites-page-title-header" style="" align="left">
<span id="sites-page-title" dir="ltr" tabindex="-1" style="outline: none">Debugging GPU related code</span>
</h3>
<div id="sites-canvas-main" class="sites-canvas-main">
<div id="sites-canvas-main-content">
<table xmlns="http://www.w3.org/1999/xhtml" cellspacing="0" class="sites-layout-name-one-column sites-layout-hbox"><tbody><tr><td class="sites-layout-tile sites-tile-name-content-1"><div dir="ltr"><div><div><div class="sites-embed-align-left-wrapping-off"><div class="sites-embed-border-off sites-embed" style="width:250px;"><div class="sites-embed-content sites-embed-type-toc"><div class="goog-toc sites-embed-toc-maxdepth-6"><p>Contents</p><ol class="goog-toc"><li class="goog-toc"><a href="#TOC-Renderer-Process-Code"><strong>1 </strong>Renderer Process Code</a><ol class="goog-toc"><li class="goog-toc"><a href="#TOC--enable-gpu-client-logging"><strong>1.1 </strong>--enable-gpu-client-logging</a></li><li class="goog-toc"><a href="#TOC-Checking-about:gpu"><strong>1.2 </strong>Checking about:gpu</a></li><li class="goog-toc"><a href="#TOC-Breaking-on-GL-Error"><strong>1.3 </strong>Breaking on GL Error</a></li><li class="goog-toc"><a href="#TOC-Labeling-your-calls"><strong>1.4 </strong>Labeling your calls</a></li><li class="goog-toc"><a href="#TOC-Making-a-reduced-test-case."><strong>1.5 </strong>Making a reduced test case.</a></li><li class="goog-toc"><a href="#TOC-Debugging-the-renderer-process"><strong>1.6 </strong>Debugging the renderer process</a></li></ol></li><li class="goog-toc"><a href="#TOC-GPU-Process-Code"><strong>2 </strong>GPU Process Code</a><ol class="goog-toc"><li class="goog-toc"><a href="#TOC--enable-gpu-service-logging"><strong>2.1 </strong>--enable-gpu-service-logging</a></li><li class="goog-toc"><a href="#TOC--enable-gpu-debugging"><strong>2.2 </strong>--enable-gpu-debugging</a></li><li class="goog-toc"><a href="#TOC--enable-gpu-command-logging"><strong>2.3 </strong>--enable-gpu-command-logging</a></li><li class="goog-toc"><a href="#TOC-Debugging-in-the-GPU-Process"><strong>2.4 </strong>Debugging in the GPU Process</a></li><li class="goog-toc"><a href="#TOC-GPU-PARSE-ERROR"><strong>2.5 </strong>GPU PARSE ERROR</a></li></ol></li><li class="goog-toc"><a href="#TOC-Debugging-Performance"><strong>3 </strong>Debugging Performance</a></li></ol></div></div></div></div></div><br /></div>Chromium's GPU system is multi process which can make debugging it rather difficult. See <a href="https://www.chromium.org/developers/design-documents/gpu-command-buffer">GPU Command Buffer for some of the nitty gitty</a>. These are just a few notes to help with debugging.<h3><a name="TOC-Renderer-Process-Code"></a>Renderer Process Code</h3><h4><a name="TOC--enable-gpu-client-logging"></a><span style="font-size:10pt">--enable-gpu-client-logging</span></h4><div><span style="font-size:10pt">If the bug you are trying to track down is in the renderer (compositor, WebGL, skia/ganesh, aura), using a debug build you can add the command line option <font face="courier new, monospace">--enable-gpu-client-logging</font> which will show every 'simulated' GL call. By simulated i mean that the actual calls into the GL driver happen in another process but from the point of view of the renderer it's speaking OpenGL ES 2.0 and this option will show those calls.<br /><br /></span></div><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div><div><font face="courier new, monospace" size="2">[4782:4782:1219/141706:INFO:gles2_implementation.cc(1026)] [.WebGLRenderingContext] glUseProgram(3)</font></div></div><div><div><font face="courier new, monospace" size="2">[4782:4782:1219/141706:INFO:gles2_implementation_impl_autogen.h(401)] [.WebGLRenderingContext] glGenBuffers(1, 0x7fffc9e1269c)</font></div></div><div><div><font face="courier new, monospace" size="2">[4782:4782:1219/141706:INFO:gles2_implementation_impl_autogen.h(416)]   0: 1</font></div></div><div><div><font face="courier new, monospace" size="2">[4782:4782:1219/141706:INFO:gles2_implementation_impl_autogen.h(23)] [.WebGLRenderingContext] glBindBuffer(GL_ARRAY_BUFFER, 1)</font></div></div><div><div><font face="courier new, monospace" size="2">[4782:4782:1219/141706:INFO:gles2_implementation.cc(1313)] [.WebGLRenderingContext] glBufferData(GL_ARRAY_BUFFER, 36, 0x7fd268580120, GL_STATIC_DRAW)</font></div></div><div><div><font face="courier new, monospace" size="2">[4782:4782:1219/141706:INFO:gles2_implementation.cc(2480)] [.WebGLRenderingContext] glEnableVertexAttribArray(0)</font></div></div><div><div><font face="courier new, monospace" size="2">[4782:4782:1219/141706:INFO:gles2_implementation.cc(1140)] [.WebGLRenderingContext] glVertexAttribPointer(0, 3, GL_FLOAT, GL_FALSE, 0, 0)</font></div></div><div><div><font face="courier new, monospace" size="2">[4782:4782:1219/141706:INFO:gles2_implementation_impl_autogen.h(135)] [.WebGLRenderingContext] glClear(16640)</font></div></div><div><div><font face="courier new, monospace" size="2">[4782:4782:1219/141706:INFO:gles2_implementation.cc(2490)] [.WebGLRenderingContext] glDrawArrays(GL_TRIANGLES, 0, 3)</font></div></div></blockquote><h4><a name="TOC-Checking-about:gpu"></a>Checking about:gpu</h4><div>The GPU process logs many errors and warnings. You can see these by going to about:gpu. They'll appear at the bottom of the page. You can also see them if Chromium is run from the command line in Linux, possibly Mac. On Windows I believe you need to be running in a debugger or us WinDbg or something similar to connect to the debug output stream.</div><div><br /></div><div>NOTE: If about:gpu is telling you that your gpu is disabled and hardware acceleration is unavailable it might be a problem with your gpu being unsupported.  To override this and turn on hardware acceleration you can use the --ignore-gpu-blacklist command line option when starting chromium. </div><h4><a name="TOC-Breaking-on-GL-Error"></a>Breaking on GL Error</h4><div>In src/gpu/command_buffer/gles2_implementation.h there is some code like this<br /><br /></div><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div><div><font face="courier new, monospace">#if defined(GPU_CLIENT_DEBUG)</font></div></div><div><div><font face="courier new, monospace">  // Set to 1 to have the client fail when a GL error is generated.</font></div></div><div><div><font face="courier new, monospace">  // This helps find bugs in the renderer since the debugger stops on the error.</font></div></div><div><div><font face="courier new, monospace">#  if 0</font></div></div><div><div><font face="courier new, monospace">#    define GL_CLIENT_FAIL_GL_ERRORS</font></div></div><div><div><font face="courier new, monospace">#  endif</font></div></div><div><div><font face="courier new, monospace">#endif</font></div></div></blockquote><div><br /></div><div>Change that "if 0" to "if 1" and build a debug build then run in a debugger. The debugger will break when any renderer code sees a GL error and you should be able to back up the call stack to find the issue.</div><h4><a name="TOC-Labeling-your-calls"></a>Labeling your calls</h4><div>The output of all of the errors, warnings and debug logs are prefixed. You can set this prefix by calling glPushGroupMarkerEXT, glPopGroupMarkerEXT and glInsertEventMarkerEXT.  glPushGroupMarkerEXT appends a string to the end of the current log prefix (think namespace in c++). glPopGroupmarkerEXT pops off the last string appended. glInsertEventMarkerEXT sets a suffix for the current string.  Example:</div><div><br /></div><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div><font face="courier new, monospace">glPushGroupMarkerEXT(0, "Foo");        // -&gt; log prefix = "Foo"</font></div><div><font face="courier new, monospace">glInsertEventMarkerEXT(0, "This");     // -&gt; log prefix = "Foo.This"</font></div><div><font face="courier new, monospace">glInsertEventMarkerEXT(0, "That");     // -&gt; log prefix = "Foo.That"</font></div><div><font face="courier new, monospace">glPushGroupMarkerEXT(0, "Bar");        // -&gt; log prefix = "Foo.Bar"</font></div><div><span style="font-family:courier new,monospace;font-size:10pt">glInsertEventMarkerEXT(0, "Orange");   // -&gt; log prefix = "Foo.Bar.Orange"</span></div><div><span style="font-family:courier new,monospace;font-size:10pt">glInsertEventMarkerEXT(0, "Banana");   // -&gt; log prefix = "Foo.Bar.Banana"<br />glPopGroupMarkerEXT();                 // -&gt; log prefix = "Foo.That"</span></div></blockquote><h4><a name="TOC-Making-a-reduced-test-case."></a>Making a reduced test case.</h4><div>You can often make a simple OpenGL ES 2.0 only C++ reduced test case that is relatively quick to compile and test by adding tests to the 'gl_tests' target. Those tests exist in src/gpu/command_buffer/tests and are made part of the build in src/gpu/gpu.gyp. Build with 'make gl_tests' or 'ninja -C out/Debug gl_tests' etc. All the same command line options listed on this page will work with the gl_tests as well as --gtest_filter=NameOfTest to run a specific test. Note the gl_tests are not multi-process so they probably won't help with race conditions but they do go through most of the same code and are much easier to debug.</div><h4><a name="TOC-Debugging-the-renderer-process"></a>Debugging the renderer process</h4><div>Given that Chrome starts many renderer processes I find it's easier if I either have a remote webpage I can access or I make one locally and then use a local server to serve it like 'python -m SimpleHTTPServer'. Then</div><div><br /></div><div><span style="font-size:10pt">On Linux this works for me</span></div><div><br /></div><blockquote style="margin:0 0 0 40px;border:none;padding:0px"><div><font face="courier new, monospace">out/Debug/chromium --no-sandbox --renderer-cmd-prefix="xterm -e gdb --args" http://localhost:8000/page-to-repo.html</font></div></blockquote><div><br /></div><div>On OSX this works for me</div><div><br /></div><blockquote style="margin:0 0 0 40px;border:none;padding:0px"><div><div><font face="courier new, monospace">out/Debug/Chromium.app/Contents/MacOSX/Chromium --no-sandbox --renderer-cmd-prefix="xterm -e gdb --args" </font><span style="font-family:courier new,monospace;font-size:10pt">http://localhost:8000/page-to-repo.html</span></div></div></blockquote><div><br /></div><div>On Windows I use --renderer-startup-dialog and then connect to the listed process.</div><div><br /></div><div>Note: On Linux and OSX I use 'cgdb' instead of 'gdb'.</div><h3><a name="TOC-GPU-Process-Code"></a>GPU Process Code</h3><h4><a name="TOC--enable-gpu-service-logging"></a><span style="font-size:10pt">--enable-gpu-service-logging</span></h4><div><span style="font-size:10pt">In a debug build this will print all actual calls into the GL driver.<br /><br /></span></div><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div><div><span style="font-family:courier new,monospace;font-size:10pt">[5497:5497:1219/142413:ERROR:gles2_cmd_decoder.cc(3301)] [.WebGLRenderingContext]cmd: kEnableVertexAttribArray</span></div><div><font face="courier new, monospace">[5497:5497:1219/142413:INFO:gl_bindings_autogen_gl.cc(905)] glEnableVertexAttribArray(0)</font></div><div><font face="courier new, monospace">[5497:5497:1219/142413:ERROR:gles2_cmd_decoder.cc(3301)] [.WebGLRenderingContext]cmd: kVertexAttribPointer</font></div><div><font face="courier new, monospace">[5497:5497:1219/142413:INFO:gl_bindings_autogen_gl.cc(1573)] glVertexAttribPointer(0, 3, GL_FLOAT, GL_FALSE, 0, 0)</font></div><div><font face="courier new, monospace">[5497:5497:1219/142413:ERROR:gles2_cmd_decoder.cc(3301)] [.WebGLRenderingContext]cmd: kClear</font></div><div><font face="courier new, monospace">[5497:5497:1219/142413:INFO:gl_bindings_autogen_gl.cc(746)] glColorMask(GL_TRUE, GL_TRUE, GL_TRUE, GL_TRUE)</font></div><div><font face="courier new, monospace">[5497:5497:1219/142413:INFO:gl_bindings_autogen_gl.cc(840)] glDepthMask(GL_TRUE)</font></div><div><font face="courier new, monospace">[5497:5497:1219/142413:INFO:gl_bindings_autogen_gl.cc(900)] glEnable(GL_DEPTH_TEST)</font></div><div><font face="courier new, monospace">[5497:5497:1219/142413:INFO:gl_bindings_autogen_gl.cc(1371)] glStencilMaskSeparate(GL_FRONT, 4294967295)</font></div><div><font face="courier new, monospace">[5497:5497:1219/142413:INFO:gl_bindings_autogen_gl.cc(1371)] glStencilMaskSeparate(GL_BACK, 4294967295)</font></div><div><font face="courier new, monospace">[5497:5497:1219/142413:INFO:gl_bindings_autogen_gl.cc(860)] glDisable(GL_STENCIL_TEST)</font></div><div><font face="courier new, monospace">[5497:5497:1219/142413:INFO:gl_bindings_autogen_gl.cc(860)] glDisable(GL_CULL_FACE)</font></div><div><font face="courier new, monospace">[5497:5497:1219/142413:INFO:gl_bindings_autogen_gl.cc(860)] glDisable(GL_SCISSOR_TEST)</font></div><div><font face="courier new, monospace">[5497:5497:1219/142413:INFO:gl_bindings_autogen_gl.cc(900)] glEnable(GL_BLEND)</font></div><div><font face="courier new, monospace">[5497:5497:1219/142413:INFO:gl_bindings_autogen_gl.cc(721)] glClear(16640)</font></div><div><font face="courier new, monospace">[5497:5497:1219/142413:ERROR:gles2_cmd_decoder.cc(3301)] [.WebGLRenderingContext]cmd: kDrawArrays</font></div><div><font face="courier new, monospace">[5497:5497:1219/142413:INFO:gl_bindings_autogen_gl.cc(870)] glDrawArrays(GL_TRIANGLES, 0, 3)</font></div><br /></div></blockquote><span style="font-size:10pt">Note that gl calls into the driver are not currently prefixed (todo?). But, you can tell from the commands logged which command, from which context caused the following GL calls to be made.</span><div><br /></div><div>Also note that client resource ids are virtual ids so calls into the real GL driver will not match. Some commands though print the mapping. Examples:</div><div><br /></div><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div><div><font face="courier new, monospace">[5497:5497:1219/142413:ERROR:gles2_cmd_decoder.cc(3301)] [.WebGLRenderingContext]cmd: kBindTexture</font></div></div><div><div><font face="courier new, monospace">[5497:5497:1219/142413:INFO:gles2_cmd_decoder.cc(837)] [.WebGLRenderingContext] glBindTexture: client_id = 2, service_id = 10</font></div></div><div><div><font face="courier new, monospace">[5497:5497:1219/142413:INFO:gl_bindings_autogen_gl.cc(662)] glBindTexture(GL_TEXTURE_2D, 10)</font></div></div><div><div><font face="courier new, monospace">[5497:5497:1219/142413:ERROR:gles2_cmd_decoder.cc(3301)] [0052064A367F0000]cmd: kBindBuffer</font></div></div><div><div><font face="courier new, monospace">[5497:5497:1219/142413:INFO:gles2_cmd_decoder.cc(837)] [0052064A367F0000] glBindBuffer: client_id = 2, service_id = 6</font></div></div><div><div><font face="courier new, monospace">[5497:5497:1219/142413:INFO:gl_bindings_autogen_gl.cc(637)] glBindBuffer(GL_ARRAY_BUFFER, 6)</font></div></div><div><div><div><font face="courier new, monospace">[5497:5497:1219/142413:ERROR:gles2_cmd_decoder.cc(3301)] [.WebGLRenderingContext]cmd: kBindFramebuffer</font></div></div></div><div><div><div><font face="courier new, monospace">[5497:5497:1219/142413:INFO:gles2_cmd_decoder.cc(837)] [.WebGLRenderingContext] glBindFramebuffer: client_id = 1, service_id = 3</font></div></div></div><div><div><div><font face="courier new, monospace">[5497:5497:1219/142413:INFO:gl_bindings_autogen_gl.cc(652)] glBindFramebufferEXT(GL_FRAMEBUFFER, 3)</font></div></div></div></blockquote><div><div><br /></div><div>etc... so that you can see renderer process code would be using the client ids where as the gpu process is using the service ids. This is useful for matching up calls if you're dumping both client and service GL logs.</div><h4><a name="TOC--enable-gpu-debugging"></a>--enable-gpu-debugging</h4><div><span style="font-size:10pt">In any build, this will call glGetError after each command</span></div><h4><a name="TOC--enable-gpu-command-logging"></a>--enable-gpu-command-logging</h4><div><span style="font-size:10pt">This will print the name of each GPU command before it is executed.</span></div><div><span style="font-size:10pt"><br /></span></div><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div><span style="font-size:10pt"><font face="courier new, monospace"><div>[5234:5234:1219/052139:ERROR:gles2_cmd_decoder.cc(3301)] [.WebGLRenderingContext]cmd: kBindBuffer</div></font></span></div><div><span style="font-size:10pt"><font face="courier new, monospace"><div>[5234:5234:1219/052139:ERROR:gles2_cmd_decoder.cc(3301)] [.WebGLRenderingContext]cmd: kBufferData</div></font></span></div><div><span style="font-size:10pt"><font face="courier new, monospace"><div>[5234:5234:1219/052139:ERROR:gles2_cmd_decoder.cc(3301)] [.WebGLRenderingContext]cmd: SetToken</div></font></span></div><div><span style="font-size:10pt"><font face="courier new, monospace"><div>[5234:5234:1219/052139:ERROR:gles2_cmd_decoder.cc(3301)] [.WebGLRenderingContext]cmd: kEnableVertexAttribArray</div></font></span></div><div><span style="font-size:10pt"><font face="courier new, monospace"><div>[5234:5234:1219/052139:ERROR:gles2_cmd_decoder.cc(3301)] [.WebGLRenderingContext]cmd: kVertexAttribPointer</div></font></span></div><div><span style="font-size:10pt"><font face="courier new, monospace"><div>[5234:5234:1219/052139:ERROR:gles2_cmd_decoder.cc(3301)] [.WebGLRenderingContext]cmd: kClear</div></font></span></div><div><span style="font-size:10pt"><font face="courier new, monospace"><div>[5234:5234:1219/052139:ERROR:gles2_cmd_decoder.cc(3301)] [.WebGLRenderingContext]cmd: kDrawArrays</div></font></span></div></blockquote><h4><a name="TOC-Debugging-in-the-GPU-Process"></a>Debugging in the GPU Process</h4><div><div><div>Given the multi-processness of chromium it can be hard to debug both sides. Turing on all the logging and having a small test case is useful. One minor suggestion, if you have some idea where the bug is happening a call to some obscure gl function like glHint() can give you a place to catch a command being processed in the GPU process (put a break point on gpu::gles2::GLES2DecoderImpl::HandleHint. Once in you can follow the commands after that. All of them go through gpu::gles2::GLES2DecoderImpl::DoCommand. </div></div><div><br /></div><div>To actually debug the gpu process:</div><div><br /></div><div><span style="font-size:10pt">On Linux this works for me</span></div><div><br /></div><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><font face="courier new, monospace">out/Debug/chromium --no-sandbox --gpu-launcher="xterm -e gdb --args" http://localhost:8000/page-to-repo.html</font></blockquote><div><br /></div><div>On OSX this works for me</div><div><br /></div><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><font face="courier new, monospace">out/Debug/Chromium.app/Contents/MacOSX/Chromium --no-sandbox --gpu-launcher="xterm -e gdb --args" </font><span style="font-family:courier new,monospace;font-size:10pt">http://localhost:8000/page-to-repo.html</span></blockquote><div><br /></div><div>On Windows I use --gpu-startup-dialog and then connect to the listed process.</div></div><h4><a name="TOC-GPU-PARSE-ERROR"></a><span style="font-size:10pt">GPU PARSE ERROR</span></h4><div><span style="font-size:10pt">If you see this message in about:gpu or your console and you did't cause it directly (by calling glLoseContextCHROMIUM) and it's something other than 5 that means there's likely a bug. Please file an issue at </span><a href="http://crbug.com" style="font-size:10pt">http://crbug.com</a></div><h3><a name="TOC-Debugging-Performance"></a>Debugging Performance</h3><div>If you have something to add here please add it. Most perf debugging is done using about:tracing. <a href="https://www.chromium.org/developers/how-tos/trace-event-profiling-tool">See Trace Event Profiling for details</a>. Otherwise, though this is probably obvious, be aware the system is multi-process so calling <br /><br /></div><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div><font face="courier new, monospace">start = GetTime()</font></div><div><font face="courier new, monospace">DoSomething()</font></div><div><font face="courier new, monospace">glFinish()</font></div><div><font face="courier new, monospace">end = GetTime</font></div><div><font face="courier new, monospace">printf("elapsedTime = %f\n", end - start);</font></div></blockquote><div><br /></div><div>Will not give you meaningful results.</div><div><br /></div></div></div></td></tr></tbody></table>
</div> 
</div> 
<div id="sites-canvas-bottom-panel">
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_page-subpages"> </div>
<div id="sites-attachments-container">
</div>
<a xmlns="http://www.w3.org/1999/xhtml" name="page-comments"></a>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_page-comments"><div class="sites-comment-docos-wrapper"><div class="sites-comment-docos"><div class="sites-comment-docos-background"></div><div class="sites-comment-docos-header"><div class="sites-comment-docos-header-title">Comments</div></div><div id="sites-comment-docos-pane" class="sites-comment-docos-pane"></div></div></div></div>
</div>
</div> 
</td> 
</tr>
</table> 
</div> 
</div> 
<div id="sites-chrome-footer-wrapper">
<div id="sites-chrome-footer-wrapper-inside">
<div id="sites-chrome-footer">
</div>
</div>
</div>
</div> 
</div> 
<div id="sites-chrome-adminfooter-container">
<div xmlns="http://www.w3.org/1999/xhtml" class="sites-adminfooter" role="navigation"><p><a class="sites-system-link" href="https://www.google.com/a/UniversalLogin?service=jotspot&amp;continue=https://sites.google.com/a/chromium.org/dev/developers/how-tos/debugging-gpu-related-code">Sign in</a><span aria-hidden="true">|</span><a class="sites-system-link" href="/system/app/pages/recentChanges">Recent Site Activity</a><span aria-hidden="true">|</span><a class="sites-system-link" href="/system/app/pages/reportAbuse" target="_blank">Report Abuse</a><span aria-hidden="true">|</span><a class="sites-system-link" href="javascript:;" onclick="window.open(webspace.printUrl)">Print Page</a><span aria-hidden="true">|</span><span class="sites-system-link">Powered By</span> <b class="powered-by"><a href="http://sites.google.com">Google Sites</a></b></p></div>
</div>
</div> 
</div> 
<div id="sites-chrome-onebar-footer">
</div>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    window.jstiming.load.tick('sjl');
  </script>
<script xmlns="http://www.w3.org/1999/xhtml" src="https://ssl.gstatic.com/sites/p/56e332/system/js/jot_min_view__en.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    window.jstiming.load.tick('jl');
  </script>
<script xmlns="http://www.w3.org/1999/xhtml">
      
          sites.core.Analytics.createTracker();
          sites.core.Analytics.trackPageview();
        
    </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
                    sites.Searchbox.initialize(
                        'sites-searchbox-search-button',
                        {"object":[]}['object'],
                        'search-site',
                        {"label":"Configure search options...","url":"/system/app/pages/admin/settings"});
                  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
      gsites.HoverPopupMenu.createSiteDropdownMenus('sites-header-nav-dropdown', false);
    </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
            JOT_setupNav("7648876402527094", "Navigation", false);
            JOT_addListener('titleChange', 'JOT_NAVIGATION_titleChange', 'COMP_7648876402527094');
          </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
            JOT_setupNav("14720868319272995", "Quick links", false);
            JOT_addListener('titleChange', 'JOT_NAVIGATION_titleChange', 'COMP_14720868319272995');
          </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
            JOT_setupNav("19690813310444355", "Other sites", false);
            JOT_addListener('titleChange', 'JOT_NAVIGATION_titleChange', 'COMP_19690813310444355');
          </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
              new sites.CommentPane('//docs.google.com/comments/d/AAHRpnXvrAwjAfmld0ObrebBiGRq9u-zK1e-ssVJoJof5WO36BxpWTyuLVfB4gKVOSu_5OfNLuYDRZOPaxsc_i80uoK5f04VQh_QgV01QMGFgYqjWq1-WxBKojPkYmeFr7WAD4a1_A4Ft/api/js?anon=true',
                  false, false);
            </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
  setTimeout(function() {
    var fingerprint = gsites.date.TimeZone.getFingerprint([]);
    gsites.Xhr.send('https://www.chromium.org/_/tz', null, null, 'GET', null, null, { afjstz: fingerprint });
  }, 500);
</script>
<script xmlns="http://www.w3.org/1999/xhtml">
                    window.onload = function() {
                      if (false) {
                        JOT_setMobilePreview();
                      }
                      var loadTimer = window.jstiming.load;
                      loadTimer.tick("ol");
                      loadTimer["name"] = "load," + webspace.page.type + ",user_page";
                      window.jstiming.report(loadTimer, {}, 'https://gg.google.com/csi');
                    }
                  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
        JOT_insertAnalyticsCode(false,
            false);
      </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    var maestroRunner = new gsites.pages.view.SitesMaestroRunner(
        webspace, "en");
    maestroRunner.initListeners();
    maestroRunner.installEditRender();
  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
  //<![CDATA[
    // Decorate any fastUI buttons on the page with a class of 'goog-button'.
    if (webspace.user.hasWriteAccess) {
      JOT_decorateButtons();
    }

    // Fires delayed events.
    (function() {
      JOT_fullyLoaded = true;
      var delayedEvents = JOT_delayedEvents;
      for (var x = 0; x < delayedEvents.length; x++) {
        var event = delayedEvents[x];
        JOT_postEvent(event.eventName, event.eventSrc, event.payload);
      }
      JOT_delayedEvents = null;
      JOT_postEvent('pageLoaded');
    })();
  //]]>
</script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    JOT_postEvent('decorateGvizCharts');
  </script>
<script type="text/javascript">
          JOT_setupPostRenderingManager();
        </script>
<script type="text/javascript">
          JOT_postEvent('renderPlus', null, 'sites-chrome-main');
        </script>
<div id="server-timer-div" style="display:none"> </div>
<script type="text/javascript">
          window.jstiming.load.tick('render');
          JOT_postEvent('usercontentrendered', this);
        </script>
</body>
</html>
