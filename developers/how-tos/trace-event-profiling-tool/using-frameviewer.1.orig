<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/WebPage">
<head>
<meta http-equiv="X-UA-Compatible" content="chrome=1" />
<script type="text/javascript">/* Copyright 2008 Google. */ (function() { var e="wtsrt_",g="tbsd_",h="tbnd_",k="start",l="_wtsrt",m="_tbnd",n="CSI/";(function(){function f(a){this.t={};this.tick=function(a,c,b){this.t[a]=[void 0!=b?b:(new Date).getTime(),c];if(void 0==b)try{window.console.timeStamp(n+a)}catch(d){}};this.tick(k,null,a)}var a;window.performance&&(a=window.performance.timing);var p=a?new f(a.responseStart):new f;window.jstiming={Timer:f,load:p};if(a){var c=a.navigationStart,d=a.responseStart;0<c&&d>=c&&(window.jstiming.srt=d-c)}if(a){var b=window.jstiming.load;0<c&&d>=c&&(b.tick(l,void 0,c),b.tick(e,l,d),b.tick(g,e))}try{a=null,
window.chrome&&window.chrome.csi&&(a=Math.floor(window.chrome.csi().pageT),b&&0<c&&(b.tick(m,void 0,window.chrome.csi().startE),b.tick(h,m,c))),null==a&&window.gtbExternal&&(a=window.gtbExternal.pageT()),null==a&&window.external&&(a=window.external.pageT,b&&0<c&&(b.tick(m,void 0,window.external.startE),b.tick(h,m,c))),a&&(window.jstiming.pt=a)}catch(q){}})(); })()
</script>
<link rel="shortcut icon" href="/_/rsrc/1354323194313/favicon.ico" type="image/x-icon" />
<link rel="apple-touch-icon" href="https://ssl.gstatic.com/sites/p/56e332/system/app/images/apple-touch-icon.png" type="image/png" />
<script type="text/javascript">/* Copyright 2008 Google. */ (function() { var d="",g="__duration__",h="function";function k(c){return document.getElementById(c)}window.byId=k;function l(c){return c.replace(/^\s+|\s+$/g,d)}window.trim=l;var m=[],n=0;window.JOT_addListener=function(c,a,b){var e=new String(n++);c={eventName:c,handler:a,compId:b,key:e};m.push(c);return e};window.JOT_removeListenerByKey=function(c){for(var a=0;a<m.length;a++)if(m[a].key==c){m.splice(a,1);break}};
window.JOT_removeAllListenersForName=function(c){for(var a=0;a<m.length;a++)m[a].eventName==c&&m.splice(a,1)};window.JOT_postEvent=function(c,a,b){var e={eventName:c,eventSrc:a||{},payload:b||{}};if(window.JOT_fullyLoaded)for(a=m.length,b=0;b<a&&b<m.length;b++){var f=m[b];f&&f.eventName==c&&(e.listenerCompId=f.compId||d,(f=typeof f.handler==h?f.handler:window[f.handler])&&f(e))}else window.JOT_delayedEvents.push({eventName:c,eventSrc:a,payload:b})};window.JOT_delayedEvents=[];
window.JOT_fullyLoaded=!1;window.JOT_formatRelativeToNow=function(c,a){var b=((new Date).getTime()-c)/6E4;if(1440<=b||0>b)return null;var e=0;60<=b&&(b/=60,e=2);2<=b&&e++;return a?window.JOT_siteRelTimeStrs[e].replace(g,Math.floor(b)):window.JOT_userRelTimeStrs[e].replace(g,Math.floor(b))}; })()
</script>
<script>

  

  var breadcrumbs = [{"path":"/developers","deleted":false,"title":"For Developers","dir":"ltr"},{"path":"/developers/how-tos","deleted":false,"title":"How-Tos","dir":"ltr"},{"path":"/developers/how-tos/trace-event-profiling-tool","deleted":false,"title":"The Trace Event Profiling Tool (about:tracing)","dir":"ltr"},{"path":"/developers/how-tos/trace-event-profiling-tool/using-frameviewer","deleted":false,"title":"FrameViewer How-To","dir":"ltr"}];
  var JOT_clearDotPath = 'https://ssl.gstatic.com/sites/p/56e332/system/app/images/cleardot.gif';

  
  var JOT_userRelTimeStrs = ["a minute ago","__duration__ minutes ago","an hour ago","__duration__ hours ago"];

  
  

  

  var webspace = {"enableAnalytics":true,"pageSharingId":"jotspot_page","enableUniversalAnalytics":false,"sharingPolicy":"OPENED_WITH_INDICATOR","siteTitle":"The Chromium Projects","isStartPageEnabled":true,"adsensePublisherId":null,"features":{"languageSelectDefaultTextSetToDefault":true,"validateClientGvizDataSourceUrls":true,"moreMobileStyleImprovements":true,"newInsertMenuIcons":true,"accessibleSortingButtons":true,"domainAnalyticsInGAOnly":true,"noCaptcha":true,"fileCabinetScreenReaderFix":true,"updatedTosAndPrivacyLinks":null,"pageDrafts":false,"mobileOrientationFix":true,"plusBadge":false,"pdfEmbedSupport":false,"jsClickFix":true},"isPublic":true,"isConsumer":false,"serverFlags":{"cajaBaseUrl":"//www.gstatic.com/caja","cajaDebugMode":false},"onepickBaseUrl":"https://docs.google.com","domainAnalyticsAccountId":"","plusPageId":"","signInUrl":"https://www.google.com/a/SelectSession?continue\u003dhttps://sites.google.com/a/chromium.org/dev/developers/how-tos/trace-event-profiling-tool/using-frameviewer\u0026service\u003djotspot","analyticsAccountId":"UA-5484340-1","scottyUrl":"/_/upload","homePath":"/","siteNoticeUrlEnabled":null,"plusPageUrl":"","adsensePromoClickedOrSiteIneligible":true,"csiReportUri":"https://gg.google.com/csi","sharingId":"jotspot","termsUrl":"//www.google.com/intl/en/policies/terms/","gvizVersion":1,"editorResources":{"sitelayout":["https://ssl.gstatic.com/sites/p/56e332/system/app/css/sitelayouteditor.css"],"text":["https://ssl.gstatic.com/sites/p/56e332/system/js/codemirror.js","https://ssl.gstatic.com/sites/p/56e332/system/app/css/codemirror_css.css","https://ssl.gstatic.com/sites/p/56e332/system/js/trog_edit__en.js","https://ssl.gstatic.com/sites/p/56e332/system/app/css/trogedit.css","/_/rsrc/1441580320000/system/app/css/editor.css","https://ssl.gstatic.com/sites/p/56e332/system/app/css/codeeditor.css","/_/rsrc/1441580320000/system/app/css/camelot/editor-jfk-wlb.css"]},"sharingUrlPrefix":"/_/sharing","isAdsenseEnabled":true,"domain":"chromium.org","baseUri":"","name":"dev","siteTemplateId":false,"siteNoticeRevision":null,"siteNoticeUrlAddress":null,"siteNoticeMessage":null,"page":{"isRtlLocale":false,"canDeleteWebspace":null,"isPageDraft":null,"parentPath":"/developers/how-tos/trace-event-profiling-tool","parentWuid":"wuid:gx:33634d51f825446f","siteLocale":"en","timeZone":"America/Los_Angeles","type":"text","title":"FrameViewer How-To","locale":"en","wuid":"wuid:gx:51159ec9c528f11e","revision":19,"path":"/developers/how-tos/trace-event-profiling-tool/using-frameviewer","isSiteRtlLocale":false,"pageInheritsPermissions":null,"name":"using-frameviewer","canChangePath":true,"state":"","properties":{},"bidiEnabled":false,"currentTemplate":{"path":"/system/app/pagetemplates/text","title":"Web Page"}},"canPublishScriptToAnyone":true,"user":{"keyboardShortcuts":true,"sessionIndex":"","guest_":true,"displayNameOrEmail":"guest","userName":"guest","uid":"","renderMobile":false,"domain":"","namespace":"","hasWriteAccess":false,"namespaceUser":false,"primaryEmail":"guest","hasAdminAccess":false},"gadgets":{"baseUri":"/system/app/pages/gadgets"}};
  webspace.page.breadcrumbs = breadcrumbs;

  
  var JOT_siteRelTimeStrs = ["a minute ago","__duration__ minutes ago","an hour ago","__duration__ hours ago"];

</script>
<script type="text/javascript">
                window.jstiming.load.tick('scl');
              </script>
<meta name="title" content="FrameViewer How-To - The Chromium Projects" />
<meta itemprop="name" content="FrameViewer How-To - The Chromium Projects" />
<meta property="og:title" content="FrameViewer How-To - The Chromium Projects" />
<meta name="description" content="Home of the Chromium Open Source Project" />
<meta itemprop="description" content="Home of the Chromium Open Source Project" />
<meta id="meta-tag-description" property="og:description" content="Home of the Chromium Open Source Project" />
<style type="text/css">
</style>
<link rel="stylesheet" type="text/css" href="https://ssl.gstatic.com/sites/p/56e332/system/app/themes/beigeandblue/standard-css-beigeandblue-ltr-ltr.css" />
<link rel="stylesheet" type="text/css" href="/_/rsrc/1441580320000/system/app/css/overlay.css?cb=beigeandblueundefineda100%25%25150goog-ws-leftthemedefaultstandard" />
<link rel="stylesheet" type="text/css" href="/_/rsrc/1441580320000/system/app/css/camelot/allthemes-view.css" />
<!--[if IE]>
          <link rel="stylesheet" type="text/css" href="/system/app/css/camelot/allthemes%2die.css" />
        <![endif]-->
<title>FrameViewer How-To - The Chromium Projects</title>
<meta itemprop="image" content="https://www.chromium.org/_/rsrc/1416330188546/developers/how-tos/trace-event-profiling-tool/using-frameviewer/01-followalong.png" />
<meta property="og:image" content="https://www.chromium.org/_/rsrc/1416330188546/developers/how-tos/trace-event-profiling-tool/using-frameviewer/01-followalong.png" />
<script type="text/javascript">
                window.jstiming.load.tick('cl');
              </script>
</head>
<body xmlns="http://www.google.com/ns/jotspot" id="body" class=" en            ">
<div id="sites-page-toolbar" class="sites-header-divider">
<div xmlns="http://www.w3.org/1999/xhtml" id="sites-status" class="sites-status" style="display:none;"><div id="sites-notice" class="sites-notice" role="status" aria-live="assertive"> </div></div>
</div>
<div id="sites-chrome-everything-scrollbar">
<div id="sites-chrome-everything" class="">
<div id="sites-chrome-page-wrapper" style="direction: ltr">
<div id="sites-chrome-page-wrapper-inside">
<div xmlns="http://www.w3.org/1999/xhtml" id="sites-chrome-header-wrapper" style="height:auto;">
<table id="sites-chrome-header" class="sites-layout-hbox" cellspacing="0" style="height:auto;">
<tr class="sites-header-primary-row" id="sites-chrome-userheader">
<td id="sites-header-title" class="" role="banner"><div class="sites-header-cell-buffer-wrapper"><a href="https://www.chromium.org/" id="sites-chrome-userheader-logo"><img id="logo-img-id" src="/_/rsrc/1438879449147/config/customLogo.gif?revision=3" alt="The Chromium Projects" class="sites-logo  " /></a><h2><a href="https://www.chromium.org/" dir="ltr" id="sites-chrome-userheader-title">The Chromium Projects</a></h2></div></td><td class="sites-layout-searchbox  "><div class="sites-header-cell-buffer-wrapper"><form id="sites-searchbox-form" action="/system/app/pages/search" role="search"><input type="hidden" id="sites-searchbox-scope" name="scope" value="search-site" /><input type="text" id="jot-ui-searchInput" name="q" size="20" value="" aria-label="Search this site" /><div id="sites-searchbox-button-set" class="goog-inline-block"><div role="button" id="sites-searchbox-search-button" class="goog-inline-block jfk-button jfk-button-standard" tabindex="0">Search this site</div></div></form></div></td>
</tr>
<tr class="sites-header-secondary-row" id="sites-chrome-horizontal-nav">
<td colspan="2" id="sites-chrome-header-horizontal-nav-container" role="navigation">
</td>
</tr>
</table>
</div>
<div id="sites-chrome-main-wrapper">
<div id="sites-chrome-main-wrapper-inside">
<table id="sites-chrome-main" class="sites-layout-hbox" cellspacing="0" cellpadding="{scmCellpadding}" border="0">
<tr>
<td id="sites-chrome-sidebar-left" class="sites-layout-sidebar-left initial" style="width:150px">
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_7648876402527094" class="sites-embed" role="navigation"><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotId="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="/chromium-projects" jotId="wuid:gx:10ae433dadbbab13" class="sites-navigation-link">Home</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="/Home" jotId="wuid:gx:43582b9d2029d3af" class="sites-navigation-link">Chromium</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="/chromium-os" jotId="wuid:gx:83df2ab1f8880ba" class="sites-navigation-link">Chromium OS</a></div></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_14720868319272995" class="sites-embed" role="navigation"><h4 class="sites-embed-title">Quick links</h4><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotId="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="http://www.chromium.org/for-testers/bug-reporting-guidelines" class="sites-navigation-link">Report bugs</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="http://www.chromium.org/developers/discussion-groups" class="sites-navigation-link">Discuss</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="/system/app/pages/sitemap/hierarchy" jotId="wuid:gx:4b58a9a350ad12f" class="sites-navigation-link">网站地图</a></div></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_19690813310444355" class="sites-embed" role="navigation"><h4 class="sites-embed-title">Other sites</h4><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotId="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="http://blog.chromium.org/" class="sites-navigation-link">Chromium Blog</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="http://code.google.com/chrome/extensions/" class="sites-navigation-link">Google Chrome Extensions</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="https://developers.google.com/chrome/chrome-frame/" class="sites-navigation-link">Google Chrome Frame</a></div></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_19695218559354544" class="sites-embed" role="complementary"><h4 class="sites-embed-title"></h4><div class="sites-embed-content sites-embed-content-sidebar-textbox"><div dir="ltr"><span style="font-size:x-small">Except as otherwise </span><a href="http://developers.google.com/site-policies.html#restrictions"><span style="font-size:x-small">noted</span></a><span style="font-size:x-small">, the content of this page is licensed under a </span><a href="http://creativecommons.org/licenses/by/2.5/"><span style="font-size:x-small">Creative Commons Attribution 2.5 license</span></a><span style="font-size:x-small">, and examples are licensed under the </span><a href="http://src.chromium.org/viewvc/chrome/trunk/src/LICENSE" target="_blank"><span style="font-size:x-small">BSD License</span></a><span style="font-size:x-small">.<br /></span></div></div></div>
</td>
<td id="sites-canvas-wrapper">
<div id="sites-canvas" role="main">
<div id="goog-ws-editor-toolbar-container"> </div>
<div xmlns="http://www.w3.org/1999/xhtml" id="title-crumbs" style="">
<A href="/developers" dir="ltr">For Developers</A>‎ &gt; ‎<A href="/developers/how-tos" dir="ltr">How-Tos</A>‎ &gt; ‎<A href="/developers/how-tos/trace-event-profiling-tool" dir="ltr">The Trace Event Profiling Tool (about:tracing)</A>‎ &gt; ‎
  </div>
<h3 xmlns="http://www.w3.org/1999/xhtml" id="sites-page-title-header" style="" align="left">
<span id="sites-page-title" dir="ltr" tabindex="-1" style="outline: none">FrameViewer How-To</span>
</h3>
<div id="sites-canvas-main" class="sites-canvas-main">
<div id="sites-canvas-main-content">
<table xmlns="http://www.w3.org/1999/xhtml" cellspacing="0" class="sites-layout-name-one-column sites-layout-hbox"><tbody><tr><td class="sites-layout-tile sites-tile-name-content-1"><div dir="ltr"><span><h1 dir="ltr" style="line-height:1.15;margin-top:10pt;margin-bottom:0pt"><a name="TOC-wiltzius-"></a><span style="font-family:Arial;font-size:15px;white-space:pre-wrap;line-height:1.15;font-weight:normal;background-color:transparent"><i><div style="display:block;text-align:left"></div>wiltzius@</i></span></h1><div><span><br /></span></div><br /><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">For a web application to respond smoothly to user touch input the application needs to receive input events in JavaScript, react to them, and then allow time for the browser to render any changes made to the page -- all within a 16ms frame budget.</span></p><br /><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">This can be challenging, and it can be instructive to look under the hood to see what the browser is doing each frame. This is what Chromium’s Frame Viewer does, although it was built with debugging </span><span style="font-size:15px;font-family:Arial;font-style:italic;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">Chrome</span><span style="font-size:15px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent"> in mind, not debugging web apps. Chromium devs and adventurous outsiders may nevertheless be curious what’s happening in the browser on a per-frame basis.</span></p><br /><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">Prerequisites:</span></p><ul style="margin-top:0pt;margin-bottom:0pt"><li style="list-style-type:disc;font-size:15px;font-family:Arial;vertical-align:baseline;background-color:transparent"><p style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><a href="http://www.chromium.org/developers/how-tos/trace-event-profiling-tool/recording-tracing-runs" style="text-decoration:none"><span style="color:rgb(17,85,204);text-decoration:underline;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">Get set up to record traces</span></a><span style="vertical-align:baseline;white-space:pre-wrap;background-color:transparent">; recommended to use </span><span style="white-space:pre-wrap;background-color:transparent">adb_profile_chrome.py from </span><a href="https://github.com/johnmccutchan/adb_trace" style="line-height:1.15;text-decoration:none;background-color:transparent"><span style="color:rgb(17,85,204);text-decoration:underline;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">https://github.com/johnmccutchan/adb_trace</span></a><span style="line-height:1.15;vertical-align:baseline;white-space:pre-wrap;background-color:transparent"> (also in Chrome’s source tree under src/tools/perf/)</span></p></li><li style="list-style-type:disc;font-size:15px;font-family:Arial;vertical-align:baseline;background-color:transparent"><p style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="vertical-align:baseline;white-space:pre-wrap;background-color:transparent">Read the <a href="https://www.chromium.org/developers/how-tos/trace-event-profiling-tool/frame-viewer">Frame Viewer Overview</a> for information on how to record a frame viewer trace, rather than a standard trace. The short version is y</span><span style="line-height:1.15;white-space:pre-wrap;background-color:transparent">ou need a number of non-default tracing categories enabled; the easiest way to do this is to use the adb_prorfile_chrome script (see above) and pass --trace-frame-viewer to it.</span></p></li><li style="list-style-type:disc;font-size:15px;font-family:Arial;vertical-align:baseline;background-color:transparent"><p style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="vertical-align:baseline;white-space:pre-wrap;background-color:transparent">Frame-viewer only works on the latest versions of Chrome, and with the latest rendering architecture. For some features to work both the version of Chrome used to view traces and the version used to record traces must be run with impl-side-painting enabled (--enable-impl-side-painting), and the version of Chrome used to view the trace must be run additionally with --enable-skia-benchmarking. See Frame Viewer’s </span><a href="http://dev.chromium.org/developers/how-tos/trace-event-profiling-tool/frame-viewer" style="text-decoration:none"><span style="color:rgb(17,85,204);text-decoration:underline;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">Getting Started</span></a><span style="vertical-align:baseline;white-space:pre-wrap;background-color:transparent"> for an example command line.</span></p></li><li style="list-style-type:disc;font-size:15px;font-family:Arial;vertical-align:baseline;background-color:transparent"><p style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="vertical-align:baseline;white-space:pre-wrap;background-color:transparent">This entire document assume you know a lot about how the web platform works and a lot about how Chrome works. Performance of a sophisticated rendering system like a modern browser is </span><span style="font-style:italic;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">very</span><span style="vertical-align:baseline;white-space:pre-wrap;background-color:transparent"> complicated, so please do not use this to blindly infer that any particular operation is cheap or expensive -- rather, use this tool to inform your own experimentation and debugging.  </span></p></li></ul><br /><h3 dir="ltr" style="line-height:1.15;margin-top:8pt;margin-bottom:0pt"><a name="TOC-Simplified-Version-of-Browser-Rendering"></a><span style="font-family:Trebuchet MS;color:rgb(102,102,102);vertical-align:baseline;white-space:pre-wrap;background-color:transparent">Simplified Version of Browser Rendering</span></h3><br /><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">Before trying to read a Frame Viewer trace, a few fundamentals:</span></p><br /><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">After its loaded, the page changes in response to two inputs: user interaction mediated by the user agent (default pressed button styles, scrolling, etc) and updates to the DOM from JavaScript. From there, a cascade of effects through several rendering sub-systems eventually produces new pixels on the user’s screen.</span></p><br /><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">The main subsystems are:</span></p><br /><ol style="margin-top:0pt;margin-bottom:0pt"><li dir="ltr" style="list-style-type:decimal;font-size:15px;font-family:Arial;vertical-align:baseline;background-color:transparent"><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="vertical-align:baseline;white-space:pre-wrap;background-color:transparent">Parsing, which turns a chunk of HTML into DOM nodes</span></p></li><li dir="ltr" style="list-style-type:decimal;font-size:15px;font-family:Arial;vertical-align:baseline;background-color:transparent"><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="vertical-align:baseline;white-space:pre-wrap;background-color:transparent">Style, which resolves CSS on the DOM</span></p></li><li dir="ltr" style="list-style-type:decimal;font-size:15px;font-family:Arial;vertical-align:baseline;background-color:transparent"><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="vertical-align:baseline;white-space:pre-wrap;background-color:transparent">Layout, which figures out where DOM elements end up relative to one another</span></p></li><li dir="ltr" style="list-style-type:decimal;font-size:15px;font-family:Arial;vertical-align:baseline;background-color:transparent"><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="vertical-align:baseline;white-space:pre-wrap;background-color:transparent">Paint setup, sometimes referred to as recording, which converts styled DOM elements into a display list (SkPicture) of drawing commands to paint later, on a per-layer basis</span></p></li><li dir="ltr" style="list-style-type:decimal;font-size:15px;font-family:Arial;vertical-align:baseline;background-color:transparent"><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="vertical-align:baseline;white-space:pre-wrap;background-color:transparent">Painting, which converts the SkPicture of drawing commands into pixels in a bitmap somewhere (either in system memory or on the GPU if using Ganesh)</span></p></li><li dir="ltr" style="list-style-type:decimal;font-size:15px;font-family:Arial;vertical-align:baseline;background-color:transparent"><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="vertical-align:baseline;white-space:pre-wrap;background-color:transparent">Compositing, which assembles all layers into a final screen image</span></p></li><li dir="ltr" style="list-style-type:decimal;font-size:15px;font-family:Arial;vertical-align:baseline;background-color:transparent"><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="vertical-align:baseline;white-space:pre-wrap;background-color:transparent">and, less obviously, the presentation infrastructure responsible for actually pushing a new frame to the OS (i.e. the browser UI and its compositor, the GPU process which actually communicates with the GL driver, etc).</span></p></li></ol><br /><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">We’ll focus on 1-6; the browser compositor and GPU process take up resources too but these operations don't map very meaningfully to page content.</span></p><br /><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">Adding a new DOM element that’s visible on-screen will trigger work in every one of the systems above. In bad cases any one of them can cost tens of milliseconds (or more), meaning every one of them can be considered a liability for staying within frame budget.</span></p><br /><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">One way to keep your animations inexpensive is to avoid stages of this pipeline altogether. For instance, if the DOM remains untouched in a given frame but one particular &lt;div&gt; changes from a red background to a blue background, no parsing needs to happen -- but style needs to be updated on at least that &lt;div&gt;, and because CSS’s inherited nature this can often trigger style recalculation on other parts of the DOM as well.</span></p><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">Note that user interactions that the browser handles, rather than the application, are largely unexceptional: clicking a button changes its style (adding pseudo-classes) and those style changes need to be resolved and later stages of the pipeline run (e.g. the depressed button state needs to be painted, and then the page needs to be re-composited with that new painted content).</span></p><br /><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">The browser has multiple threads, and because of the dependencies implied in the above pipeline which thread an operation runs on matters a lot when it comes to finding the rendering bottleneck. Style, layout, and some paint setup operations run on the renderer’s main thread, which is the same place that JavaScript runs. Parsing gets in own thread (in most cases), as does compositing and painting.</span></p><br /><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">Keep in mind that JavaScript is single threaded and does not yield by default, which means that JavaScript events, style, and layout operations will block one another. That means if e.g. the style system is running, Javascript can’t receive new events. More obviously, it also means that other JavaScript events (such as a timer firing, or an XHR success callback, etc) will block JS events that may be very timely -- like touch events. NB this essentially means </span><span style="font-size:15px;font-family:Arial;font-weight:bold;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">applications responding to touch input must consider the JavaScript main thread the application’s UI thread, and not block it for more than a few milliseconds</span><span style="font-size:15px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">.</span></p><br /><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">The above explanation simplifies a lot, but should be enough to get going. Two exceptions worth pointing out though: first, scrolling is “special” in that it happens outside of the main JavaScript context, and scroll positions are asynchronously reported back to the main thread and updated in the DOM. This prevents janky scrolling even if the page executes a lot of JavaScript, but it can get in the way if the page is well-behaved and wants to respond to scrolling. Second, the pipeline above isn’t strictly hierarchically ordered -- that is, sometimes you can update style without needing to re-lay-out anything and without needing to repaint anything. A key example is CSS transforms, which don’t alter layout and hence can skip directly from style resolution (e.g. changing the transform offset) to compositing if the necessary content is already painted.</span></p><br /><h3 dir="ltr" style="line-height:1.15;margin-top:8pt;margin-bottom:0pt"><a name="TOC-Introducing-Frameviewer"></a><span style="font-family:Trebuchet MS;color:rgb(102,102,102);vertical-align:baseline;white-space:pre-wrap;background-color:transparent">Introducing Frameviewer</span></h3><br /><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">For the rest of this document to make sense you’ll need to get set up to record frame viewer traces. See the <a href="https://www.chromium.org/developers/how-tos/trace-event-profiling-tool/frame-viewer">Frame Viewer Overview</a> for instructions.</span></p><br /><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">Caveats: Frame Viewer only works on the very latest Chrome rendering architecture (both for the Chrome where the trace is recorded and the Chrome where its viewed; see the above link for info on how to get Chrome into that mode), and it… can be buggy. Don’t say we didn’t warn you.</span></p><br /><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">Let’s start with something simple. Here’s a frame viewer trace of scrolling mobile.nytimes.com</span></p><br /><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">The trace file being screenshotted in this section is attached to this page, as are all the traces referenced here, and can be <a href="https://www.chromium.org/developers/how-tos/trace-event-profiling-tool/using-frameviewer/nytimes_scroll_trace?attredirects=0&amp;d=1">downloaded</a> and opened in about:tracing to follow along.</span></p><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent"><br /></span></p><div style="display:block;text-align:left"><a href="https://www.chromium.org/developers/how-tos/trace-event-profiling-tool/using-frameviewer/01-followalong.png?attredirects=0" imageanchor="1"><img border="0" src="https://www.chromium.org/_/rsrc/1416330188546/developers/how-tos/trace-event-profiling-tool/using-frameviewer/01-followalong.png" style="width:100%" /></a></div><br /><p dir="ltr" style="text-align:left;line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent"><br /></span></p><p dir="ltr" style="text-align:left;line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">Lots of stuff on the screen. Let’s try to make sense of it.</span></p><br /><h3 dir="ltr" style="line-height:1.15;margin-top:8pt;margin-bottom:0pt"><a name="TOC-Navigating-the-Basic-Tracing-View"></a><span style="font-family:Trebuchet MS;color:rgb(102,102,102);vertical-align:baseline;white-space:pre-wrap;background-color:transparent">Navigating the Basic Tracing View</span></h3><p dir="ltr" style="line-height:1.15;margin-top:12pt;margin-bottom:2pt"><span style="font-size:15px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">Before even touching the Frame Viewer, let’s examine some standard trace events as a refresher. There’s more detail in </span><a href="http://www.chromium.org/developers/how-tos/trace-event-profiling-tool/trace-event-reading" style="text-decoration:none"><span style="font-size:15px;font-family:Arial;color:rgb(17,85,204);text-decoration:underline;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">this document</span></a><span style="font-size:15px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent"> about trace events and how to read them, but it’s a bit stale. Below is an updated, shortened recap.</span></p><h4 dir="ltr" style="line-height:1.15;margin-top:12pt;margin-bottom:2pt"><a name="TOC-Processes-Timelines"></a><span style="font-size:15px;font-family:Arial;color:#666666;background-color:#ffffff;font-weight:normal;font-style:italic;font-variant:normal;text-decoration:none;vertical-align:baseline;white-space:pre-wrap">Processes &amp; Timelines</span></h4><h4 dir="ltr" style="line-height:1.15;margin-top:12pt;margin-bottom:2pt"><a name="TOC-What-you-re-seeing-is-Chrome-s-multi-process-architecture-at-work-scrolling-your-page.-The-first-thing-to-notice-is-that-there-are-three-processes-running:-the-browser-pid-16099-and-the-renderer-process-for-nytimes.com-pid-23360-.Each-process-has-a-separat"></a><span style="font-weight:normal"><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">What you’re seeing is Chrome's multi-process architecture at work, scrolling your page. The first thing to notice is that there are three processes running: the browser (pid=16099) and the renderer process for nytimes.com (pid=23360).</span></p><br /><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">Each process has a separate horizontal track, filled with trace events. The track is basically an event timeline for events on that thread/process. Events are the colored, rectangular blocks on the timeline tracks. Time moves from left to right.</span></p><div><span style="font-size:15px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent"><br /></span></div></span></h4><div style="display:block;text-align:left"><a href="https://www.chromium.org/developers/how-tos/trace-event-profiling-tool/using-frameviewer/02-lefttoright.png?attredirects=0" imageanchor="1"><img border="0" src="https://www.chromium.org/_/rsrc/1416330320866/developers/how-tos/trace-event-profiling-tool/using-frameviewer/02-lefttoright.png" style="width:100%" /></a></div><br /><p dir="ltr" style="text-align:center;line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-family:Arial;vertical-align:baseline;white-space:pre-wrap"><br /></span></p><h4 dir="ltr" style="line-height:1.15;margin-top:12pt;margin-bottom:2pt"><a name="TOC-Panning-and-Zooming-with-the-Keyboard"></a><span style="font-size:15px;font-family:Arial;color:#666666;background-color:#ffffff;font-weight:normal;font-style:italic;font-variant:normal;text-decoration:none;vertical-align:baseline;white-space:pre-wrap">Panning and Zooming with the Keyboard</span></h4><h4 dir="ltr" style="line-height:1.15;margin-top:12pt;margin-bottom:2pt"><a name="TOC-The-keyboard-can-be-used-to-zoom-and-pan-around-inside-the-timeline.-The-w-and-s-keys-zoom-in-centered-around-the-mouse-and-the-a-and-d-keys-pan-the-timeline-left-and-right."></a><b style="font-weight:normal"><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Arial;color:#000000;background-color:transparent;font-weight:normal;font-style:normal;font-variant:normal;text-decoration:none;vertical-align:baseline;white-space:pre-wrap">The keyboard can be used to zoom and pan around inside the timeline. The ‘w’ and ‘s’ keys zoom in centered around the mouse, and the ‘a’ and ‘d’ keys pan the timeline left and right.</span></p></b></h4><h4 dir="ltr" style="line-height:1.15;margin-top:12pt;margin-bottom:2pt"><a name="TOC-Trace-Events"></a><span style="font-size:15px;font-family:Arial;color:#666666;background-color:#ffffff;font-weight:normal;font-style:italic;font-variant:normal;text-decoration:none;vertical-align:baseline;white-space:pre-wrap">Trace Events</span></h4><h4 dir="ltr" style="line-height:1.15;margin-top:12pt;margin-bottom:2pt"><a name="TOC-In-this-case-the-data-being-shown-is-5-seconds.-Zooming-in-on-a-section-of-the-trace-for-more-detail-we-can-make-out-individual-trace-event-records."></a><span style="font-weight:normal"><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">In this case, the data being shown is ~5 seconds. Zooming in on a section of the trace for more detail, we can make out individual trace event records.</span></p><div><span style="font-size:15px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent"><br /></span></div></span></h4><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-family:Arial;vertical-align:baseline;white-space:pre-wrap"><br /></span></p><div style="display:block;text-align:center;margin-right:auto;margin-left:auto"><a href="https://www.chromium.org/developers/how-tos/trace-event-profiling-tool/using-frameviewer/03-individual%20trace.png?attredirects=0" imageanchor="1"><img border="0" src="https://www.chromium.org/_/rsrc/1416330398755/developers/how-tos/trace-event-profiling-tool/using-frameviewer/03-individual%20trace.png" /></a></div><br /></span><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-family:Arial;vertical-align:baseline;white-space:pre-wrap"><br /></span></p><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Arial;color:#000000;background-color:transparent;font-weight:normal;font-style:normal;font-variant:normal;text-decoration:none;vertical-align:baseline;white-space:pre-wrap">A single rectangle represents a TRACE_EVENT: where it began, and where it ended. When you see a stack of different rectangles on top of each other, it means that trace events were issued inside one another on the same thread. For example:</span></p><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><b style="font-weight:normal"><br /></b></p><div class="sites-codeblock sites-codesnippet-block"><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt;margin-left:30pt"><span style="font-size:13px;font-family:Courier New;color:#000000;background-color:#ffffff;font-weight:normal;font-style:normal;font-variant:normal;text-decoration:none;vertical-align:baseline;white-space:pre-wrap"><code>foo() {</code></span></p><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt;margin-left:30pt"><span style="font-size:13px;font-family:Courier New;color:#000000;background-color:#ffffff;font-weight:normal;font-style:normal;font-variant:normal;text-decoration:none;vertical-align:baseline;white-space:pre-wrap"><code> sleep 10ms</code></span></p><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt;margin-left:30pt"><span style="font-size:13px;font-family:Courier New;color:#000000;background-color:#ffffff;font-weight:normal;font-style:normal;font-variant:normal;text-decoration:none;vertical-align:baseline;white-space:pre-wrap"><code> bar()</code></span></p><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt;margin-left:30pt"><span style="font-size:13px;font-family:Courier New;color:#000000;background-color:#ffffff;font-weight:normal;font-style:normal;font-variant:normal;text-decoration:none;vertical-align:baseline;white-space:pre-wrap"><code> sleep 5ms</code></span></p><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt;margin-left:30pt"><span style="font-size:13px;font-family:Courier New;color:#000000;background-color:#ffffff;font-weight:normal;font-style:normal;font-variant:normal;text-decoration:none;vertical-align:baseline;white-space:pre-wrap"><code>}</code></span></p><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt;margin-left:30pt"><span style="font-size:13px;font-family:Courier New;color:#000000;background-color:#ffffff;font-weight:normal;font-style:normal;font-variant:normal;text-decoration:none;vertical-align:baseline;white-space:pre-wrap"><code>bar() {</code></span></p><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt;margin-left:30pt"><span style="font-size:13px;font-family:Courier New;color:#000000;background-color:#ffffff;font-weight:normal;font-style:normal;font-variant:normal;text-decoration:none;vertical-align:baseline;white-space:pre-wrap"><code> sleep 5ms</code></span></p><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt;margin-left:30pt"><span style="font-size:13px;font-family:Courier New;color:#000000;background-color:#ffffff;font-weight:normal;font-style:normal;font-variant:normal;text-decoration:none;vertical-align:baseline;white-space:pre-wrap"><code>}</code></span></p></div><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><br /><span style="font-size:15px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">Would look like this:</span></p><br /><div style="display:block;text-align:left"></div><div style="display:block;text-align:left"><a href="https://www.chromium.org/developers/how-tos/trace-event-profiling-tool/using-frameviewer/1.png?attredirects=0" imageanchor="1"><img border="0" src="https://www.chromium.org/_/rsrc/1425562955756/developers/how-tos/trace-event-profiling-tool/using-frameviewer/1.png" /></a></div><br /><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span><span style="font-size:15px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">To study individual rectangles, you can click on them. This will display information about the rectangle: its Duration, ThreadDuration (CPU time), SelfTime (time spent in the current slice, subtracting the time of all the children slices), ThreadSelfTime (CPU time spent in the current slice, subtracting the CPU time for all the children) and Occurrences (the number of times that event appeared in the selection). The information is sortable. Clicking on a title from the info table will expand all the slices for that event.</span></span></p><br /><div style="display:block;text-align:left"><a href="https://www.chromium.org/developers/how-tos/trace-event-profiling-tool/using-frameviewer/04-information%20is.png?attredirects=0" imageanchor="1"><img border="0" src="https://www.chromium.org/_/rsrc/1416330454846/developers/how-tos/trace-event-profiling-tool/using-frameviewer/04-information%20is.png" style="width:100%" /></a></div><br /><br /><font face="arial, sans-serif" size="2"><br /></font><span><br /><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">For the Foo/Bar example, the SelfTime for Foo will be 15ms (20 - 5), while the SelfTime for Bar will be 5ms (Since it has no traced children).</span></p><br /><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">The ThreadDuration is not available for all events and for all platforms, the SelfTime is omitted in cases where the Slice has no known children. Asynchronous events has no SelfTime by definition.</span></p><br /><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">In addition to clicking, you can drag the mouse in a rectangle over a group of trace events. This will give you a list of events that intersect that rectangle and summarize them for you:</span></p><br /><br /></span><span><br /><br /><div style="display:block;text-align:center;margin-right:auto;margin-left:auto"><a href="https://www.chromium.org/developers/how-tos/trace-event-profiling-tool/using-frameviewer/summarize.png?attredirects=0" imageanchor="1"><img border="0" src="https://www.chromium.org/_/rsrc/1416330593114/developers/how-tos/trace-event-profiling-tool/using-frameviewer/summarize.png" /></a></div></span><br /><h3 dir="ltr" style="line-height:1.15;margin-top:8pt;margin-bottom:0pt"><a name="TOC-Navigating-Frame-Viewer-Mode"></a><span style="font-family:Trebuchet MS;color:rgb(102,102,102);vertical-align:baseline;white-space:pre-wrap;background-color:transparent">Navigating Frame Viewer Mode</span></h3><br /><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">What Frame Viewer adds beyond the basic trace event system is a dump of the page’s state taken each time the renderer produces aframe. This is very useful when trying to visualize what’s happening from frame to frame. To see the state of the page’s layer tree for a frame, click one of the green circles along the top of the Renderer process track:</span></p><br /><div style="display:block;text-align:left"><a href="https://www.chromium.org/developers/how-tos/trace-event-profiling-tool/using-frameviewer/process.png?attredirects=0" imageanchor="1"><img border="0" src="https://www.chromium.org/_/rsrc/1416330631013/developers/how-tos/trace-event-profiling-tool/using-frameviewer/process.png" style="width:100%" /></a></div><br /><br /><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">You’ll get frames on the bottom of the screen that show the browser’s layer tree for this frame (on the left) as well as an image of the page with outlines for all the page’s layers (on the right).</span></p><br /><div style="display:block;text-align:left"><a href="https://www.chromium.org/developers/how-tos/trace-event-profiling-tool/using-frameviewer/2.png?attredirects=0" imageanchor="1"><img border="0" src="https://www.chromium.org/_/rsrc/1425562991824/developers/how-tos/trace-event-profiling-tool/using-frameviewer/2.png" /></a></div><br /><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">Checkboxes in the layer view control what information is included in the page visualization: the most useful are typically “other layer’s / passes” (to view the whole page, rather than just the layer selected), “invalidations” which shows what got dirtied that frame for repainting, and “contents” which attempts to fill in the actual pixels for each layer by rasterizing the SkPictures for each layer (the SkPicture being essentially a DisplayList Chrome internally uses to store paint operations and which also gets dumped along with the layer tree each frame when frame viewer is on). The “contents” view doesn’t always work well (e.g. text gets garbled) and you’ll need --enable-skia-benchmarking passed to whatever Chrome you’re using to view the trace.</span></p><br /><div style="display:block;text-align:left"><a href="https://www.chromium.org/developers/how-tos/trace-event-profiling-tool/using-frameviewer/3.png?attredirects=0" imageanchor="1"><img border="0" src="https://www.chromium.org/_/rsrc/1425563057417/developers/how-tos/trace-event-profiling-tool/using-frameviewer/3.png" /></a></div><div style="text-align:center"><br /></div><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">The layer visualization can get crowded, so the mouse controls are very useful. You can pan with <a href="https://www.chromium.org/developers/how-tos/trace-event-profiling-tool/using-frameviewer/4.png?attredirects=0" imageanchor="1" style="line-height:1.15"><img border="0" src="https://www.chromium.org/_/rsrc/1425563138558/developers/how-tos/trace-event-profiling-tool/using-frameviewer/4.png" /></a></span><span style="font-size:15px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">, zoom in and out with <a href="https://www.chromium.org/developers/how-tos/trace-event-profiling-tool/using-frameviewer/5.png?attredirects=0" imageanchor="1" style="line-height:1.15"><img border="0" src="https://www.chromium.org/_/rsrc/1425563167259/developers/how-tos/trace-event-profiling-tool/using-frameviewer/5.png" /></a></span><span style="font-size:15px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">, and rotate (in 3D, because we’re nerds) with </span><span style="font-size:15px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent"><a href="https://www.chromium.org/developers/how-tos/trace-event-profiling-tool/using-frameviewer/6.png?attredirects=0" imageanchor="1" style="line-height:1.15"><img border="0" src="https://www.chromium.org/_/rsrc/1425563186660/developers/how-tos/trace-event-profiling-tool/using-frameviewer/6.png" /></a><span style="line-height:1.15;vertical-align:baseline;background-color:transparent">, while</span><span style="line-height:1.15;vertical-align:baseline;background-color:transparent"> </span></span><a href="https://www.chromium.org/developers/how-tos/trace-event-profiling-tool/using-frameviewer/7.png?attredirects=0" imageanchor="1" style="font-size:10pt;line-height:normal"><img border="0" src="https://www.chromium.org/_/rsrc/1425563209649/developers/how-tos/trace-event-profiling-tool/using-frameviewer/7.png" /></a> <span style="line-height:1.15;background-color:transparent"><font size="3">allows you to select a layer for more detail about it.</font></span></p><div style="display:block;text-align:left"><a href="https://www.chromium.org/developers/how-tos/trace-event-profiling-tool/using-frameviewer/8.png?attredirects=0" imageanchor="1"><img border="0" src="https://www.chromium.org/_/rsrc/1425563314170/developers/how-tos/trace-event-profiling-tool/using-frameviewer/8.png" /></a></div><br /><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">When selected everything the compositor knows about the layer is shown in the bottommost frame. The “layerName” property is interesting because it maps the layer back to its root element in the DOM, such as div#content or the #document</span></p><br /><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">Selecting an invalidation tells you what layer the invalidation happened on as well as the invalidation’s bounds. Cross-reference the layer number with one of the layers in the layer tree on the left for more info about that layer.</span></p><br /><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">Layers with invalidations have SkPictures associated with them. Clicking on the SkPicture link will show you more information about the relevant SkPicture recording. You can also access these recordings by selecting the blue dots along the top of the Renderer’s track in the trace view; the pictures will appear at different times than the frames because they’re located at the time they got recorded, rather than the time they were played back to produce a frame. This might be within the same frame, if an on-screen invalidation occurred that frame, or it might be much earlier if a picture was recorded and the compositor has been using the picture to produce frames for some time afterward (this will happen with composited scrolls and with CSS transform animations in particular, since the compositor can run these on its own).</span></p><br /><div style="display:block;text-align:left"><a href="https://www.chromium.org/developers/how-tos/trace-event-profiling-tool/using-frameviewer/9.png?attredirects=0" imageanchor="1"><img border="0" src="https://www.chromium.org/_/rsrc/1425563356365/developers/how-tos/trace-event-profiling-tool/using-frameviewer/9.png" /></a></div><br /><br /><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">Frame viewer’s best feature is that is captures all of this information on a </span><span style="font-size:15px;font-family:Arial;font-style:italic;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">per-frame</span><span style="font-size:15px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent"> basis. The arrow keys move between frames while trying to retain the same view, so you can step through frame by frame and watch layer positions move with respect to one another or see invalidations appear.</span></p><br /><div style="display:block;text-align:left"><div style="display:block;text-align:left"><div style="display:block;text-align:center;margin-right:auto;margin-left:auto"><a href="http://jankfree.org/images/output_optimized_frame.gif" imageanchor="1"><img border="0" height="376" src="http://jankfree.org/images/output_optimized_frame.gif" width="400" /></a></div><br /></div><br /></div><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">This information, combined with the timing information encoded in the trace events, provides a powerful view into the performance of a web application.</span></p><br /><h3 dir="ltr" style="line-height:1.15;margin-top:8pt;margin-bottom:0pt"><a name="TOC-The-Critical-Path"></a><span style="font-family:Trebuchet MS;color:rgb(102,102,102);vertical-align:baseline;white-space:pre-wrap;background-color:transparent">The Critical Path</span></h3><br /><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">Taking a trace of a page that makes a change that requires repainting in response to touch input illustrates the entire pipeline in action (and in this case, working well).</span></p><br /><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">The traces in this section are all from </span><a href="http://git.chromium.org/gitweb/?p=chromium/src.git;a=blob_plain;f=tools/perf/page_sets/key_silk_cases/inbox_app.html;hb=HEAD" style="text-decoration:none"><span style="font-size:15px;font-family:Arial;color:rgb(17,85,204);text-decoration:underline;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">inbox_app.html</span></a><span style="font-size:15px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent"> in the Silk page set. The trace files used are available here (<a href="https://www.chromium.org/developers/how-tos/trace-event-profiling-tool/using-frameviewer/inbox_normal_trace?attredirects=0&amp;d=1">normal trace</a>) and here (<a href="https://www.chromium.org/developers/how-tos/trace-event-profiling-tool/using-frameviewer/inbox_frameviewer_trace?attredirects=0&amp;d=1">frameviewer trace</a>).</span></p><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent"><br /></span></p><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent"><br /></span></p><div style="display:block;text-align:left"><a href="https://www.chromium.org/developers/how-tos/trace-event-profiling-tool/using-frameviewer/10.png?attredirects=0" imageanchor="1"><img border="0" src="https://www.chromium.org/_/rsrc/1425563383751/developers/how-tos/trace-event-profiling-tool/using-frameviewer/10.png" /></a></div><br /><br /><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent"><br /></span></p><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">Zooming in it’s possible to follow a frame propagating through the Renderer process:</span></p><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent"><br /></span></p><br /><div style="display:block;text-align:left"><a href="https://www.chromium.org/developers/how-tos/trace-event-profiling-tool/using-frameviewer/11.png?attredirects=0" imageanchor="1"><img border="0" src="https://www.chromium.org/_/rsrc/1425563407706/developers/how-tos/trace-event-profiling-tool/using-frameviewer/11.png" /></a></div><br /><p style="margin-top:0pt;margin-bottom:0pt;text-align:center"><font face="Arial"><span style="font-size:15px;line-height:17.25px;white-space:pre-wrap"><i>Open the trace file yourself to zoom in further and see individual events </i></span></font></p><br /><ol style="margin-top:0pt;margin-bottom:0pt"><li dir="ltr" style="list-style-type:decimal;font-size:15px;font-family:Arial;vertical-align:baseline;background-color:transparent"><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="vertical-align:baseline;white-space:pre-wrap;background-color:transparent">Input event comes in from the browser process (not shown, but visible in its own track higher up in the trace) and gets delivered to the compositor thread. This is a tiny slice in the above trace that includes “InputEventFilter::ForwardToHandler”</span></p></li><li dir="ltr" style="list-style-type:decimal;font-size:15px;font-family:Arial;vertical-align:baseline;background-color:transparent"><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="vertical-align:baseline;white-space:pre-wrap;background-color:transparent">The input event gets routed from the compositor thread to the main thread. This kicks off Blink’s input event handling, bottoming out in V8 (i.e. the JavaScript touchmove event handler running)</span></p></li><li dir="ltr" style="list-style-type:decimal;font-size:15px;font-family:Arial;vertical-align:baseline;background-color:transparent"><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="vertical-align:baseline;white-space:pre-wrap;background-color:transparent">Blink begins a new animation frame, doing some of its own bookkeeping as well as calling requestAnimationFrame callback inside of “WebViewImpl::animate”</span></p></li><li dir="ltr" style="list-style-type:decimal;font-size:15px;font-family:Arial;vertical-align:baseline;background-color:transparent"><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="vertical-align:baseline;white-space:pre-wrap;background-color:transparent">JavaScript has modified the page since the last frame (presumably either in the rAF callback or the input event handler), triggering a layout. The first part of this is style recalculation, visible as Document::updateStyle</span></p></li><li dir="ltr" style="list-style-type:decimal;font-size:15px;font-family:Arial;vertical-align:baseline;background-color:transparent"><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="vertical-align:baseline;white-space:pre-wrap;background-color:transparent">Part of the on-screen DOM has been invalidated, so Blink repaints a chunk of the screen covering the invalidated area. This records drawing commands into an SkPicture, visible in the trace as Picture::Record events. Layer properties (such as transforms, scroll offsets, and opacity) are also updated in Blink’s copy of the layer tree.</span></p></li><li dir="ltr" style="list-style-type:decimal;font-size:15px;font-family:Arial;vertical-align:baseline;background-color:transparent"><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="vertical-align:baseline;white-space:pre-wrap;background-color:transparent">The new recordings and updated layer tree are transferred from the Blink thread to the compositor thread in ThreadProxy::BeginMainFrame::Commit. During this time the main thread is blocked on the compositor thread.</span></p></li><li dir="ltr" style="list-style-type:decimal;font-size:15px;font-family:Arial;vertical-align:baseline;background-color:transparent"><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="vertical-align:baseline;white-space:pre-wrap;background-color:transparent">The compositor considers the position of all layers and sorts all of the document’s content layer tiles to decide what order to rasterize them (this is for prioritization; on-screen tiles get highest priority followed by any prepainted tiles that might be on the screen soon). This is the ::UpdateTilePriorities and ::ManageTiles</span></p></li><li dir="ltr" style="list-style-type:decimal;font-size:15px;font-family:Arial;vertical-align:baseline;background-color:transparent"><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="vertical-align:baseline;white-space:pre-wrap;background-color:transparent">Some tiles needed for this frame get rasterized in Picture::Raster events (this trace is using Ganesh to rasterize tiles, so rasterization occurs on the compositor thread and actually represents the generation of GL commands for the tile contents, not filling in a bitmap which happens on the GPU).</span></p></li><li dir="ltr" style="list-style-type:decimal;font-size:15px;font-family:Arial;vertical-align:baseline;background-color:transparent"><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="vertical-align:baseline;white-space:pre-wrap;background-color:transparent">Shortly after the rasterization completes the compositor thread’s draw deadline arrives, so it does a bunch of bookkeeping to decide where exactly to draw each tile on the screen (LayerTreeHostImpl::PrepareToDraw) and then sends this frame to the browser compositor (DelegatingRenderer::DrawFrame) and swaps the framebuffer (DelegatingRenderer:SwapBuffers)</span></p></li></ol><br /><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">That’s the event flow, but it’s difficult (/impossible) to look at a trace and understand what actually changing on-screen in this frame.</span></p><br /><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">This is where Frame Viewer comes in. In a Frame Viewer trace of the same interaction, inspecting a couple frames around this one shows how the layers are moving from frame to frame. Here’s one:</span></p><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent"><br /></span></p><br /><div style="display:block;text-align:left"><a href="https://www.chromium.org/developers/how-tos/trace-event-profiling-tool/using-frameviewer/12.png?attredirects=0" imageanchor="1"><img border="0" src="https://www.chromium.org/_/rsrc/1425563425933/developers/how-tos/trace-event-profiling-tool/using-frameviewer/12.png" /></a></div><br /><br /><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">Pressing one of the right/left arrow keys lets us step to the previous/next frame. Here’s the next one:</span></p><br /><div style="display:block;text-align:left"><a href="https://www.chromium.org/developers/how-tos/trace-event-profiling-tool/using-frameviewer/13.png?attredirects=0" imageanchor="1"><img border="0" src="https://www.chromium.org/_/rsrc/1425563448767/developers/how-tos/trace-event-profiling-tool/using-frameviewer/13.png" /></a></div><br /><br /><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">They look almost the same, but the rectangle offset from the others, which is a layer that’s moving in response to touch input, has changed offsets slightly. Also note that a different green circle in the list of frames along the top of the Renderer track is now selected.</span></p><br /><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">It becomes more obvious what’s changing when we enable the “Contents” checkbox:</span></p><br /><div style="display:block;text-align:left"><a href="https://www.chromium.org/developers/how-tos/trace-event-profiling-tool/using-frameviewer/14.png?attredirects=0" imageanchor="1"><img border="0" src="https://www.chromium.org/_/rsrc/1425563472131/developers/how-tos/trace-event-profiling-tool/using-frameviewer/14.png" /></a></div><br /><br /><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">Remember from earlier we saw rasterization happen in this frame though, not just a layer changing position. You can see what got invalidated by turning on the “Invalidations” checkbox:</span></p><br /><div style="display:block;text-align:left"><a href="https://www.chromium.org/developers/how-tos/trace-event-profiling-tool/using-frameviewer/15.png?attredirects=0" imageanchor="1"><img border="0" src="https://www.chromium.org/_/rsrc/1425563492369/developers/how-tos/trace-event-profiling-tool/using-frameviewer/15.png" /></a></div><br /><br /><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">Clicking on the red invalidation rect, we see that it’s for layer 32:</span></p><br /><div style="display:block;text-align:left"><a href="https://www.chromium.org/developers/how-tos/trace-event-profiling-tool/using-frameviewer/16.png?attredirects=0" imageanchor="1"><img border="0" src="https://www.chromium.org/_/rsrc/1425563513910/developers/how-tos/trace-event-profiling-tool/using-frameviewer/16.png" /></a></div><br /><br /><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">Selecting layer 32 in the list of layers on the left, or disabling the invalidations and selecting the layer itself in the viewer rather than the invalidation rect, tells us more about that layer:</span></p><br /><div style="display:block;text-align:left"><a href="https://www.chromium.org/developers/how-tos/trace-event-profiling-tool/using-frameviewer/17.png?attredirects=0" imageanchor="1"><img border="0" src="https://www.chromium.org/_/rsrc/1425563532824/developers/how-tos/trace-event-profiling-tool/using-frameviewer/17.png" /></a></div><br /><br /><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">There’s a lot of information here, but the most interesting is probably the layerName which links this layer to the DOM; in this case, “RenderBlock APP-DISMISSABLE-ITEM class='message'”</span></p><br /><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">We can also get more info on the associated SkPicture for this layer for this frame by clicking the picture link. This opens up the SkPicture debugger:</span></p><br /><div style="display:block;text-align:left"><a href="https://www.chromium.org/developers/how-tos/trace-event-profiling-tool/using-frameviewer/18.png?attredirects=0" imageanchor="1"><img border="0" src="https://www.chromium.org/_/rsrc/1425563554274/developers/how-tos/trace-event-profiling-tool/using-frameviewer/18.png" /></a></div><br /><br /><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">Which has a list of all the draw operations stored in the SkPiture on the left and a timing graph that shows the cost of each draw operations as a vertical line. Selecting vertical lines will replay the picture up to that point, which helps identify what a given draw op is doing and letting you understand what the most expensive draw operations in the SkPicture are.</span></p><br /><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">Important caveat: this works by replaying the SkPicture </span><span style="font-size:15px;font-family:Arial;font-weight:bold;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">locally</span><span style="font-size:15px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">, on the machine used to view tracing. That means that the timing information will not be an accurate representation of performance on the device the trace was taken on! Furthermore, at this point all picture playback in tracing uses the software rasterizer, even if the picture was actually rastered with Ganesh when displaying the frame originally! Despite these two big limitations, the picture debugger can still be helpful to understand relative operation costs.  </span></p><br /><h3 dir="ltr" style="line-height:1.15;margin-top:8pt;margin-bottom:0pt"><a name="TOC-Anatomy-of-a-Performance-Problem"></a><span style="font-family:Trebuchet MS;color:rgb(102,102,102);vertical-align:baseline;white-space:pre-wrap;background-color:transparent">Anatomy of a Performance Problem</span></h3><br /><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">Lastly, a couple isolated examples of performance problems. A real app usually has a combination of problems and may go beyond these simple examples, but these are common bottlenecks shown on their own.</span></p><br /><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">Important caveat: tracing always imposes some amount of overhead on the browser’s regular operation. This is usually negligible for standard traces, but Frame Viewer traces are expensive and timing is not necessarily representative for Frame Viewer traces. It’s more useful to see what’s going on, rather than how long a particular operation took. In particular the DrawLayers operation on the compositor thread is expensive since it does most of the frame dump.</span></p><br /><h4 dir="ltr" style="line-height:1.15;margin-top:8pt;margin-bottom:0pt"><a name="TOC-Excess-Javascript-Touch-Responsiveness"></a><span style="font-size:15px;font-family:Trebuchet MS;color:rgb(102,102,102);font-weight:normal;text-decoration:underline;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">Excess Javascript / Touch Responsiveness</span></h4><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">Remember, the JavaScript main thread is a web app’s UI thread. Here’s an example where an JS event handler that spends 50ms in V8 during the requestAnimationFrame callback gets in the way of touch events, causing a long stall in the rendering pipeline:</span></p><br /><div style="display:block;text-align:left"><a href="https://www.chromium.org/developers/how-tos/trace-event-profiling-tool/using-frameviewer/19.png?attredirects=0" imageanchor="1"><img border="0" src="https://www.chromium.org/_/rsrc/1425563574555/developers/how-tos/trace-event-profiling-tool/using-frameviewer/19.png" /></a></div><br /><br /><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">Note the compositor thread is essentially idle during this time since the main thread can’t run additional JavaScript to process new touch events while its busy running the long rAF callback. The user would not see a new Renderer frame during this period (jank). </span></p><br /><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">The compositor is capable of running certain animations on its own (composited scroll and accelerated CSS animations), which it can run without waiting on JS. However with a touch event handler registered, as is the case on this page, the compositor thread </span><span style="font-size:15px;font-family:Arial;font-style:italic;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">must wait </span><span style="font-size:15px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">on the Blink main thread to process the touch event before responding to it by e.g. scrolling because JavaScript might call preventDefault on the touch event.</span></p><h4 dir="ltr" style="line-height:1.15;margin-top:8pt;margin-bottom:0pt"><a name="TOC-Unexpected-Painting"></a><span style="font-size:15px;font-family:Trebuchet MS;color:rgb(102,102,102);font-weight:normal;text-decoration:underline;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">Unexpected Painting</span></h4><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">Sometimes the only reasonable way to achieve an effect is to paint, but sometimes either Blink gets overeager and invalidates more than seems necessary or JavaScript manipulates style that invalidates more than it needs to.</span></p><br /><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">Frame viewer is great for catching these cases.</span></p><br /><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">For instance, look at this jsfiddle example from the Silk page set: </span><a href="http://jsfiddle.net/ugkd4/9/embedded/result/" style="text-decoration:none"><span style="font-size:15px;font-family:Arial;color:rgb(17,85,204);text-decoration:underline;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">http://jsfiddle.net/ugkd4/9/embedded/result/</span></a></p><br /><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">Here’s a trace (<a href="https://www.chromium.org/developers/how-tos/trace-event-profiling-tool/using-frameviewer/repaint_example_trace?attredirects=0&amp;d=1">trace file</a>) of that animation running for a few seconds.</span></p><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent"><br /></span></p><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">It’s supposed to demonstrate performing a clip with composited layers, so there shouldn’t be any painting going on. Stepping through the frames, though, we notice an odd invalidation at the beginning of each animation:</span></p><br /><div style="display:block;text-align:left"><a href="https://www.chromium.org/developers/how-tos/trace-event-profiling-tool/using-frameviewer/20.png?attredirects=0" imageanchor="1"><img border="0" src="https://www.chromium.org/_/rsrc/1425563596693/developers/how-tos/trace-event-profiling-tool/using-frameviewer/20.png" /></a></div><br /><br /><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">What’s that red rectangle doing there? Clicking on its associated layer and looking at layerName reveals it as “RenderButton BUTTON id=’button’”</span></p><br /><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">OK, so what’s going on with the button? The main thread frame that produced this invalidation precedes it in the CrRendererMain timeline, and shows a JavaScript timer firing:</span></p><br /><div style="display:block;text-align:left"><a href="https://www.chromium.org/developers/how-tos/trace-event-profiling-tool/using-frameviewer/21.png?attredirects=0" imageanchor="1"><img border="0" src="https://www.chromium.org/_/rsrc/1425563617099/developers/how-tos/trace-event-profiling-tool/using-frameviewer/21.png" /></a></div><br /><br /><br /><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">This makes sense, since referring to our example code the timer is firing once a second to restart the animation.</span></p><br /><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">So we know something in that timer’s JS block caused a style recalculation (visible under the timer’s V8 execution block). Unfortunately there the trail goes cold, because we don’t know what style change did it. We can start commenting out style changes and seeing if the invalidation goes away, however.</span></p><br /><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">A few rounds of that later, we have a simple reduction:</span></p><br /><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><a href="http://jsfiddle.net/3wMzq/1/embedded/result/" style="text-decoration:none"><span style="font-size:15px;font-family:Arial;color:rgb(17,85,204);text-decoration:underline;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">http://jsfiddle.net/3wMzq/1/embedded/result/</span></a></p><br /><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">And its <a href="https://www.chromium.org/developers/how-tos/trace-event-profiling-tool/using-frameviewer/repaint_example_reduced_trace?attredirects=0&amp;d=1">corresponding trace</a>.</span></p><div style="display:block;text-align:left"><a href="https://www.chromium.org/developers/how-tos/trace-event-profiling-tool/using-frameviewer/22.png?attredirects=0" imageanchor="1"><img border="0" src="https://www.chromium.org/_/rsrc/1425563639568/developers/how-tos/trace-event-profiling-tool/using-frameviewer/22.png" /></a></div><br /><br /><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">Nothing is changing on screen, and we’ve stripped out the additional DOM and all JavaScript except the empty click handler, which gets called once a second… and it’s still repainting!</span></p><br /><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">At which point it becomes clear that this is in fact a bug in Chrome, which one </span><a href="https://code.google.com/p/chromium/issues/detail?id=369358" style="text-decoration:none"><span style="font-size:15px;font-family:Arial;color:rgb(17,85,204);text-decoration:underline;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">files</span></a><span style="font-size:15px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">.</span></p><p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent"><br /></span></p><p style="line-height:1.15;margin-top:0pt;margin-bottom:0pt"><span style="font-size:15px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent">Happy hacking!</span></p><div><span style="font-size:15px;font-family:Arial;vertical-align:baseline;white-space:pre-wrap;background-color:transparent"><br /></span></div></div></td></tr></tbody></table>
</div> 
</div> 
<div id="sites-canvas-bottom-panel">
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_page-subpages"> </div>
<div id="sites-attachments-container">
<div xmlns="http://www.w3.org/1999/xhtml" id="sites-attachments">
<div class="sites-attachments-row"><div class="sites-attachments-icon" style="left:0px;"><span aria-label="Attachments" title="Attachments"><div class="sites-translucent sites-symbol" aria-hidden="true">Č</div></span></div><div id="sites-attachments-update-div" class="sites-attachments-inner-div" style="display:none;"><span class="sites-attachments-update-icon"><img src="https://ssl.gstatic.com/sites/p/56e332/system/app/images/spinner.gif" /></span><div class="sites-attachments-update-text">Updating...</div></div></div><div class="sites-attachments-separator"></div>
<div id="attachment-wuid:gx:509cfb819a99c33c"><div class="sites-attachments-row"><div class="sites-attachments-icon sites-attachments-icon-accessible" style="left:5px"><div class="sites-translucent sites-symbol" aria-label="File" title="File">ċ</div></div><div class="sites-attachments-inner-div"><div class="sites-attachments-name">inbox_frameviewer_trace <div class="sites-translucent">(16980k)</div></div><div class="sites-attachments-author">Tom Wiltzius, <div class="sites-translucent">May 8, 2014, 3:21 PM</div></div></div><div class="sites-attachments-version sites-attachments-version-accessible"><a href="/system/app/pages/admin/revisions?wuid=wuid:gx:509cfb819a99c33c">v.1</a></div><div id="attachment-download-wuid:gx:509cfb819a99c33c" class="sites-attachments-icon sites-attachments-icon-accessible" style="right:0px"><a href="/developers/how-tos/trace-event-profiling-tool/using-frameviewer/inbox_frameviewer_trace?attredirects=0&amp;d=1" aria-label="Download inbox_frameviewer_trace" title="Download" role="button"><span class="sites-symbol" aria-hidden="true">ď</span></a></div></div><div class="sites-attachments-separator"></div></div>
<div id="attachment-wuid:gx:250b0f544f7e3523"><div class="sites-attachments-row"><div class="sites-attachments-icon sites-attachments-icon-accessible" style="left:5px"><div class="sites-translucent sites-symbol" aria-label="File" title="File">ċ</div></div><div class="sites-attachments-inner-div"><div class="sites-attachments-name">inbox_normal_trace <div class="sites-translucent">(14182k)</div></div><div class="sites-attachments-author">Tom Wiltzius, <div class="sites-translucent">May 8, 2014, 3:21 PM</div></div></div><div class="sites-attachments-version sites-attachments-version-accessible"><a href="/system/app/pages/admin/revisions?wuid=wuid:gx:250b0f544f7e3523">v.1</a></div><div id="attachment-download-wuid:gx:250b0f544f7e3523" class="sites-attachments-icon sites-attachments-icon-accessible" style="right:0px"><a href="/developers/how-tos/trace-event-profiling-tool/using-frameviewer/inbox_normal_trace?attredirects=0&amp;d=1" aria-label="Download inbox_normal_trace" title="Download" role="button"><span class="sites-symbol" aria-hidden="true">ď</span></a></div></div><div class="sites-attachments-separator"></div></div>
<div id="attachment-wuid:gx:685f081fb0196c10"><div class="sites-attachments-row"><div class="sites-attachments-icon sites-attachments-icon-accessible" style="left:5px"><div class="sites-translucent sites-symbol" aria-label="File" title="File">ċ</div></div><div class="sites-attachments-inner-div"><div class="sites-attachments-name">nytimes_scroll_trace <div class="sites-translucent">(13498k)</div></div><div class="sites-attachments-author">Tom Wiltzius, <div class="sites-translucent">May 8, 2014, 3:21 PM</div></div></div><div class="sites-attachments-version sites-attachments-version-accessible"><a href="/system/app/pages/admin/revisions?wuid=wuid:gx:685f081fb0196c10">v.1</a></div><div id="attachment-download-wuid:gx:685f081fb0196c10" class="sites-attachments-icon sites-attachments-icon-accessible" style="right:0px"><a href="/developers/how-tos/trace-event-profiling-tool/using-frameviewer/nytimes_scroll_trace?attredirects=0&amp;d=1" aria-label="Download nytimes_scroll_trace" title="Download" role="button"><span class="sites-symbol" aria-hidden="true">ď</span></a></div></div><div class="sites-attachments-separator"></div></div>
<div id="attachment-wuid:gx:6ce25512f7cb5737"><div class="sites-attachments-row"><div class="sites-attachments-icon sites-attachments-icon-accessible" style="left:5px"><div class="sites-translucent sites-symbol" aria-label="File" title="File">ċ</div></div><div class="sites-attachments-inner-div"><div class="sites-attachments-name">repaint_example_reduced_trace <div class="sites-translucent">(2194k)</div></div><div class="sites-attachments-author">Tom Wiltzius, <div class="sites-translucent">May 8, 2014, 3:21 PM</div></div></div><div class="sites-attachments-version sites-attachments-version-accessible"><a href="/system/app/pages/admin/revisions?wuid=wuid:gx:6ce25512f7cb5737">v.1</a></div><div id="attachment-download-wuid:gx:6ce25512f7cb5737" class="sites-attachments-icon sites-attachments-icon-accessible" style="right:0px"><a href="/developers/how-tos/trace-event-profiling-tool/using-frameviewer/repaint_example_reduced_trace?attredirects=0&amp;d=1" aria-label="Download repaint_example_reduced_trace" title="Download" role="button"><span class="sites-symbol" aria-hidden="true">ď</span></a></div></div><div class="sites-attachments-separator"></div></div>
<div id="attachment-wuid:gx:53bfdb2148707ec5"><div class="sites-attachments-row"><div class="sites-attachments-icon sites-attachments-icon-accessible" style="left:5px"><div class="sites-translucent sites-symbol" aria-label="File" title="File">ċ</div></div><div class="sites-attachments-inner-div"><div class="sites-attachments-name">repaint_example_trace <div class="sites-translucent">(18414k)</div></div><div class="sites-attachments-author">Tom Wiltzius, <div class="sites-translucent">May 8, 2014, 3:21 PM</div></div></div><div class="sites-attachments-version sites-attachments-version-accessible"><a href="/system/app/pages/admin/revisions?wuid=wuid:gx:53bfdb2148707ec5">v.1</a></div><div id="attachment-download-wuid:gx:53bfdb2148707ec5" class="sites-attachments-icon sites-attachments-icon-accessible" style="right:0px"><a href="/developers/how-tos/trace-event-profiling-tool/using-frameviewer/repaint_example_trace?attredirects=0&amp;d=1" aria-label="Download repaint_example_trace" title="Download" role="button"><span class="sites-symbol" aria-hidden="true">ď</span></a></div></div><div class="sites-attachments-separator"></div></div>
<div style="height: 10px"></div>
</div>
</div>
<a xmlns="http://www.w3.org/1999/xhtml" name="page-comments"></a>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_page-comments"><div class="sites-comment-docos-wrapper"><div class="sites-comment-docos"><div class="sites-comment-docos-background"></div><div class="sites-comment-docos-header"><div class="sites-comment-docos-header-title">Comments</div></div><div id="sites-comment-docos-pane" class="sites-comment-docos-pane"></div></div></div></div>
</div>
</div> 
</td> 
</tr>
</table> 
</div> 
</div> 
<div id="sites-chrome-footer-wrapper">
<div id="sites-chrome-footer-wrapper-inside">
<div id="sites-chrome-footer">
</div>
</div>
</div>
</div> 
</div> 
<div id="sites-chrome-adminfooter-container">
<div xmlns="http://www.w3.org/1999/xhtml" class="sites-adminfooter" role="navigation"><p><a class="sites-system-link" href="https://www.google.com/a/UniversalLogin?service=jotspot&amp;continue=https://sites.google.com/a/chromium.org/dev/developers/how-tos/trace-event-profiling-tool/using-frameviewer">Sign in</a><span aria-hidden="true">|</span><a class="sites-system-link" href="/system/app/pages/recentChanges">Recent Site Activity</a><span aria-hidden="true">|</span><a class="sites-system-link" href="/system/app/pages/reportAbuse" target="_blank">Report Abuse</a><span aria-hidden="true">|</span><a class="sites-system-link" href="javascript:;" onclick="window.open(webspace.printUrl)">Print Page</a><span aria-hidden="true">|</span><span class="sites-system-link">Powered By</span> <b class="powered-by"><a href="http://sites.google.com">Google Sites</a></b></p></div>
</div>
</div> 
</div> 
<div id="sites-chrome-onebar-footer">
</div>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    window.jstiming.load.tick('sjl');
  </script>
<script xmlns="http://www.w3.org/1999/xhtml" src="https://ssl.gstatic.com/sites/p/56e332/system/js/jot_min_view__en.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    window.jstiming.load.tick('jl');
  </script>
<script xmlns="http://www.w3.org/1999/xhtml">
      
          sites.core.Analytics.createTracker();
          sites.core.Analytics.trackPageview();
        
    </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
                    sites.Searchbox.initialize(
                        'sites-searchbox-search-button',
                        {"object":[]}['object'],
                        'search-site',
                        {"label":"Configure search options...","url":"/system/app/pages/admin/settings"});
                  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
      gsites.HoverPopupMenu.createSiteDropdownMenus('sites-header-nav-dropdown', false);
    </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
            JOT_setupNav("7648876402527094", "Navigation", false);
            JOT_addListener('titleChange', 'JOT_NAVIGATION_titleChange', 'COMP_7648876402527094');
          </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
            JOT_setupNav("14720868319272995", "Quick links", false);
            JOT_addListener('titleChange', 'JOT_NAVIGATION_titleChange', 'COMP_14720868319272995');
          </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
            JOT_setupNav("19690813310444355", "Other sites", false);
            JOT_addListener('titleChange', 'JOT_NAVIGATION_titleChange', 'COMP_19690813310444355');
          </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
              new sites.CommentPane('//docs.google.com/comments/d/AAHRpnXvrAwjAfmld0ObrebBiGRq9JhPk0cBDc8W4UU4djmQmitip5vPUDS_EA7SZf42zIpw-j_2zFpey2AbYw9fpB_UsbgDwague4EmDSYhppvJwA2NvtQEVhr-x2mLSfLdbEmijrG_r/api/js?anon=true',
                  false, false);
            </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
  setTimeout(function() {
    var fingerprint = gsites.date.TimeZone.getFingerprint([]);
    gsites.Xhr.send('https://www.chromium.org/_/tz', null, null, 'GET', null, null, { afjstz: fingerprint });
  }, 500);
</script>
<script xmlns="http://www.w3.org/1999/xhtml">
                    window.onload = function() {
                      if (false) {
                        JOT_setMobilePreview();
                      }
                      var loadTimer = window.jstiming.load;
                      loadTimer.tick("ol");
                      loadTimer["name"] = "load," + webspace.page.type + ",user_page";
                      window.jstiming.report(loadTimer, {}, 'https://gg.google.com/csi');
                    }
                  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
        JOT_insertAnalyticsCode(false,
            false);
      </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    var maestroRunner = new gsites.pages.view.SitesMaestroRunner(
        webspace, "en");
    maestroRunner.initListeners();
    maestroRunner.installEditRender();
  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
  //<![CDATA[
    // Decorate any fastUI buttons on the page with a class of 'goog-button'.
    if (webspace.user.hasWriteAccess) {
      JOT_decorateButtons();
    }

    // Fires delayed events.
    (function() {
      JOT_fullyLoaded = true;
      var delayedEvents = JOT_delayedEvents;
      for (var x = 0; x < delayedEvents.length; x++) {
        var event = delayedEvents[x];
        JOT_postEvent(event.eventName, event.eventSrc, event.payload);
      }
      JOT_delayedEvents = null;
      JOT_postEvent('pageLoaded');
    })();
  //]]>
</script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    JOT_postEvent('decorateGvizCharts');
  </script>
<script type="text/javascript">
          JOT_setupPostRenderingManager();
        </script>
<script type="text/javascript">
          JOT_postEvent('renderPlus', null, 'sites-chrome-main');
        </script>
<div id="server-timer-div" style="display:none"> </div>
<script type="text/javascript">
          window.jstiming.load.tick('render');
          JOT_postEvent('usercontentrendered', this);
        </script>
</body>
</html>
