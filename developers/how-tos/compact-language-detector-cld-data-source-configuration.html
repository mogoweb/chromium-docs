<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/WebPage">
<head>
<meta http-equiv="X-UA-Compatible" content="chrome=1" />
<script type="text/javascript">/* Copyright 2008 Google. */ (function() { var e="wtsrt_",g="tbsd_",h="tbnd_",k="start",l="_wtsrt",m="_tbnd",n="CSI/";(function(){function f(a){this.t={};this.tick=function(a,c,b){this.t[a]=[void 0!=b?b:(new Date).getTime(),c];if(void 0==b)try{window.console.timeStamp(n+a)}catch(d){}};this.tick(k,null,a)}var a;window.performance&&(a=window.performance.timing);var p=a?new f(a.responseStart):new f;window.jstiming={Timer:f,load:p};if(a){var c=a.navigationStart,d=a.responseStart;0<c&&d>=c&&(window.jstiming.srt=d-c)}if(a){var b=window.jstiming.load;0<c&&d>=c&&(b.tick(l,void 0,c),b.tick(e,l,d),b.tick(g,e))}try{a=null,
window.chrome&&window.chrome.csi&&(a=Math.floor(window.chrome.csi().pageT),b&&0<c&&(b.tick(m,void 0,window.chrome.csi().startE),b.tick(h,m,c))),null==a&&window.gtbExternal&&(a=window.gtbExternal.pageT()),null==a&&window.external&&(a=window.external.pageT,b&&0<c&&(b.tick(m,void 0,window.external.startE),b.tick(h,m,c))),a&&(window.jstiming.pt=a)}catch(q){}})(); })()
</script>
<link rel="shortcut icon" href="../../_/rsrc/1354323194313/favicon.ico" type="image/x-icon" />
<link rel="apple-touch-icon" href="https://ssl.gstatic.com/sites/p/56e332/system/app/images/apple-touch-icon.png" type="image/png" />
<script type="text/javascript">/* Copyright 2008 Google. */ (function() { var d="",g="__duration__",h="function";function k(c){return document.getElementById(c)}window.byId=k;function l(c){return c.replace(/^\s+|\s+$/g,d)}window.trim=l;var m=[],n=0;window.JOT_addListener=function(c,a,b){var e=new String(n++);c={eventName:c,handler:a,compId:b,key:e};m.push(c);return e};window.JOT_removeListenerByKey=function(c){for(var a=0;a<m.length;a++)if(m[a].key==c){m.splice(a,1);break}};
window.JOT_removeAllListenersForName=function(c){for(var a=0;a<m.length;a++)m[a].eventName==c&&m.splice(a,1)};window.JOT_postEvent=function(c,a,b){var e={eventName:c,eventSrc:a||{},payload:b||{}};if(window.JOT_fullyLoaded)for(a=m.length,b=0;b<a&&b<m.length;b++){var f=m[b];f&&f.eventName==c&&(e.listenerCompId=f.compId||d,(f=typeof f.handler==h?f.handler:window[f.handler])&&f(e))}else window.JOT_delayedEvents.push({eventName:c,eventSrc:a,payload:b})};window.JOT_delayedEvents=[];
window.JOT_fullyLoaded=!1;window.JOT_formatRelativeToNow=function(c,a){var b=((new Date).getTime()-c)/6E4;if(1440<=b||0>b)return null;var e=0;60<=b&&(b/=60,e=2);2<=b&&e++;return a?window.JOT_siteRelTimeStrs[e].replace(g,Math.floor(b)):window.JOT_userRelTimeStrs[e].replace(g,Math.floor(b))}; })()
</script>
<script>

  

  var breadcrumbs = [{"path":"/developers","deleted":false,"title":"For Developers","dir":"ltr"},{"path":"/developers/how-tos","deleted":false,"title":"How-Tos","dir":"ltr"},{"path":"/developers/how-tos/compact-language-detector-cld-data-source-configuration","deleted":false,"title":"Compact Language Detector (CLD) Data Source Configuration","dir":"ltr"}];
  var JOT_clearDotPath = 'https://ssl.gstatic.com/sites/p/56e332/system/app/images/cleardot.gif';

  
  var JOT_userRelTimeStrs = ["a minute ago","__duration__ minutes ago","an hour ago","__duration__ hours ago"];

  
  

  

  var webspace = {"enableAnalytics":true,"pageSharingId":"jotspot_page","enableUniversalAnalytics":false,"sharingPolicy":"OPENED_WITH_INDICATOR","siteTitle":"The Chromium Projects","isStartPageEnabled":true,"adsensePublisherId":null,"features":{"languageSelectDefaultTextSetToDefault":true,"validateClientGvizDataSourceUrls":true,"moreMobileStyleImprovements":true,"newInsertMenuIcons":true,"accessibleSortingButtons":true,"domainAnalyticsInGAOnly":true,"noCaptcha":true,"fileCabinetScreenReaderFix":true,"updatedTosAndPrivacyLinks":null,"pageDrafts":false,"mobileOrientationFix":true,"plusBadge":false,"pdfEmbedSupport":false,"jsClickFix":true},"isPublic":true,"isConsumer":false,"serverFlags":{"cajaBaseUrl":"//www.gstatic.com/caja","cajaDebugMode":false},"onepickBaseUrl":"https://docs.google.com","domainAnalyticsAccountId":"","plusPageId":"","signInUrl":"https://www.google.com/a/SelectSession?continue\u003dhttps://sites.google.com/a/chromium.org/dev/developers/how-tos/compact-language-detector-cld-data-source-configuration\u0026service\u003djotspot","analyticsAccountId":"UA-5484340-1","scottyUrl":"/_/upload","homePath":"/","siteNoticeUrlEnabled":null,"plusPageUrl":"","adsensePromoClickedOrSiteIneligible":true,"csiReportUri":"https://gg.google.com/csi","sharingId":"jotspot","termsUrl":"//www.google.com/intl/en/policies/terms/","gvizVersion":1,"editorResources":{"sitelayout":["https://ssl.gstatic.com/sites/p/56e332/system/app/css/sitelayouteditor.css"],"text":["https://ssl.gstatic.com/sites/p/56e332/system/js/codemirror.js","https://ssl.gstatic.com/sites/p/56e332/system/app/css/codemirror_css.css","https://ssl.gstatic.com/sites/p/56e332/system/js/trog_edit__en.js","https://ssl.gstatic.com/sites/p/56e332/system/app/css/trogedit.css","/_/rsrc/1441580320000/system/app/css/editor.css","https://ssl.gstatic.com/sites/p/56e332/system/app/css/codeeditor.css","/_/rsrc/1441580320000/system/app/css/camelot/editor-jfk-wlb.css"]},"sharingUrlPrefix":"/_/sharing","isAdsenseEnabled":true,"domain":"chromium.org","baseUri":"","name":"dev","siteTemplateId":false,"siteNoticeRevision":null,"siteNoticeUrlAddress":null,"siteNoticeMessage":null,"page":{"isRtlLocale":false,"canDeleteWebspace":null,"isPageDraft":null,"parentPath":"/developers/how-tos","parentWuid":"wuid:gx:21c4408ba07e936a","siteLocale":"en","timeZone":"America/Los_Angeles","type":"text","title":"Compact Language Detector (CLD) Data Source Configuration","locale":"en","wuid":"wuid:gx:6f0be7d132c0095d","revision":13,"path":"/developers/how-tos/compact-language-detector-cld-data-source-configuration","isSiteRtlLocale":false,"pageInheritsPermissions":null,"name":"compact-language-detector-cld-data-source-configuration","canChangePath":true,"state":"","properties":{},"bidiEnabled":false,"currentTemplate":{"path":"/system/app/pagetemplates/text","title":"Web Page"}},"canPublishScriptToAnyone":true,"user":{"keyboardShortcuts":true,"sessionIndex":"","guest_":true,"displayNameOrEmail":"guest","userName":"guest","uid":"","renderMobile":false,"domain":"","namespace":"","hasWriteAccess":false,"namespaceUser":false,"primaryEmail":"guest","hasAdminAccess":false},"gadgets":{"baseUri":"/system/app/pages/gadgets"}};
  webspace.page.breadcrumbs = breadcrumbs;

  
  var JOT_siteRelTimeStrs = ["a minute ago","__duration__ minutes ago","an hour ago","__duration__ hours ago"];

</script>
<script type="text/javascript">
                window.jstiming.load.tick('scl');
              </script>
<meta name="title" content="Compact Language Detector (CLD) Data Source Configuration - The Chromium Projects" />
<meta itemprop="name" content="Compact Language Detector (CLD) Data Source Configuration - The Chromium Projects" />
<meta property="og:title" content="Compact Language Detector (CLD) Data Source Configuration - The Chromium Projects" />
<meta name="description" content="Home of the Chromium Open Source Project" />
<meta itemprop="description" content="Home of the Chromium Open Source Project" />
<meta id="meta-tag-description" property="og:description" content="Home of the Chromium Open Source Project" />
<style type="text/css">
</style>
<link rel="stylesheet" type="text/css" href="https://ssl.gstatic.com/sites/p/56e332/system/app/themes/beigeandblue/standard-css-beigeandblue-ltr-ltr.css" />
<link rel="stylesheet" type="text/css" href="../../_/rsrc/1441580320000/system/app/css/overlay.css%3Fcb=beigeandblueundefineda100%2525%2525150goog-ws-leftthemedefaultstandard.css" />
<link rel="stylesheet" type="text/css" href="../../_/rsrc/1441580320000/system/app/css/camelot/allthemes-view.css" />
<!--[if IE]>
          <link rel="stylesheet" type="text/css" href="/system/app/css/camelot/allthemes%2die.css" />
        <![endif]-->
<title>Compact Language Detector (CLD) Data Source Configuration - The Chromium Projects</title>
<meta itemprop="image" content="/_/rsrc/1438879449147/config/customLogo.gif?revision=3" />
<meta property="og:image" content="/_/rsrc/1438879449147/config/customLogo.gif?revision=3" />
<script type="text/javascript">
                window.jstiming.load.tick('cl');
              </script>
</head>
<body xmlns="http://www.google.com/ns/jotspot" id="body" class=" en            ">
<div id="sites-page-toolbar" class="sites-header-divider">
<div xmlns="http://www.w3.org/1999/xhtml" id="sites-status" class="sites-status" style="display:none;"><div id="sites-notice" class="sites-notice" role="status" aria-live="assertive"> </div></div>
</div>
<div id="sites-chrome-everything-scrollbar">
<div id="sites-chrome-everything" class="">
<div id="sites-chrome-page-wrapper" style="direction: ltr">
<div id="sites-chrome-page-wrapper-inside">
<div xmlns="http://www.w3.org/1999/xhtml" id="sites-chrome-header-wrapper" style="height:auto;">
<table id="sites-chrome-header" class="sites-layout-hbox" cellspacing="0" style="height:auto;">
<tr class="sites-header-primary-row" id="sites-chrome-userheader">
<td id="sites-header-title" class="" role="banner"><div class="sites-header-cell-buffer-wrapper"><a href="../../index.html" id="sites-chrome-userheader-logo"><img id="logo-img-id" src="../../_/rsrc/1438879449147/config/customLogo.gif%3Frevision=3" alt="The Chromium Projects" class="sites-logo  " /></a><h2><a href="../../index.html" dir="ltr" id="sites-chrome-userheader-title">The Chromium Projects</a></h2></div></td><td class="sites-layout-searchbox  "><div class="sites-header-cell-buffer-wrapper"><form id="sites-searchbox-form" action="https://www.chromium.org/system/app/pages/search" role="search"><input type="hidden" id="sites-searchbox-scope" name="scope" value="search-site" /><input type="text" id="jot-ui-searchInput" name="q" size="20" value="" aria-label="Search this site" /><div id="sites-searchbox-button-set" class="goog-inline-block"><div role="button" id="sites-searchbox-search-button" class="goog-inline-block jfk-button jfk-button-standard" tabindex="0">Search this site</div></div></form></div></td>
</tr>
<tr class="sites-header-secondary-row" id="sites-chrome-horizontal-nav">
<td colspan="2" id="sites-chrome-header-horizontal-nav-container" role="navigation">
</td>
</tr>
</table>
</div>
<div id="sites-chrome-main-wrapper">
<div id="sites-chrome-main-wrapper-inside">
<table id="sites-chrome-main" class="sites-layout-hbox" cellspacing="0" cellpadding="{scmCellpadding}" border="0">
<tr>
<td id="sites-chrome-sidebar-left" class="sites-layout-sidebar-left initial" style="width:150px">
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_7648876402527094" class="sites-embed" role="navigation"><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotId="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="../../chromium-projects.html" jotId="wuid:gx:10ae433dadbbab13" class="sites-navigation-link">Home</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="../../Home.1.html" jotId="wuid:gx:43582b9d2029d3af" class="sites-navigation-link">Chromium</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="../../chromium-os.1.html" jotId="wuid:gx:83df2ab1f8880ba" class="sites-navigation-link">Chromium OS</a></div></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_14720868319272995" class="sites-embed" role="navigation"><h4 class="sites-embed-title">Quick links</h4><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotId="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="../../for-testers/bug-reporting-guidelines.html" class="sites-navigation-link">Report bugs</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="../discussion-groups.html" class="sites-navigation-link">Discuss</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="../../system/app/pages/sitemap/hierarchy.html" jotId="wuid:gx:4b58a9a350ad12f" class="sites-navigation-link">网站地图</a></div></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_19690813310444355" class="sites-embed" role="navigation"><h4 class="sites-embed-title">Other sites</h4><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotId="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="http://blog.chromium.org/" class="sites-navigation-link">Chromium Blog</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="http://code.google.com/chrome/extensions/" class="sites-navigation-link">Google Chrome Extensions</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="https://developers.google.com/chrome/chrome-frame/" class="sites-navigation-link">Google Chrome Frame</a></div></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_19695218559354544" class="sites-embed" role="complementary"><h4 class="sites-embed-title"></h4><div class="sites-embed-content sites-embed-content-sidebar-textbox"><div dir="ltr"><span style="font-size:x-small">Except as otherwise </span><a href="http://developers.google.com/site-policies.html#restrictions"><span style="font-size:x-small">noted</span></a><span style="font-size:x-small">, the content of this page is licensed under a </span><a href="http://creativecommons.org/licenses/by/2.5/"><span style="font-size:x-small">Creative Commons Attribution 2.5 license</span></a><span style="font-size:x-small">, and examples are licensed under the </span><a href="http://src.chromium.org/viewvc/chrome/trunk/src/LICENSE" target="_blank"><span style="font-size:x-small">BSD License</span></a><span style="font-size:x-small">.<br /></span></div></div></div>
</td>
<td id="sites-canvas-wrapper">
<div id="sites-canvas" role="main">
<div id="goog-ws-editor-toolbar-container"> </div>
<div xmlns="http://www.w3.org/1999/xhtml" id="title-crumbs" style="">
<A href="../../developers.1.html" dir="ltr">For Developers</A>‎ &gt; ‎<A href="../how-tos.1.html" dir="ltr">How-Tos</A>‎ &gt; ‎
  </div>
<h3 xmlns="http://www.w3.org/1999/xhtml" id="sites-page-title-header" style="" align="left">
<span id="sites-page-title" dir="ltr" tabindex="-1" style="outline: none">Compact Language Detector (CLD) Data Source Configuration</span>
</h3>
<div id="sites-canvas-main" class="sites-canvas-main">
<div id="sites-canvas-main-content">
<table xmlns="http://www.w3.org/1999/xhtml" cellspacing="0" class="sites-layout-name-one-column sites-layout-hbox"><tbody><tr><td class="sites-layout-tile sites-tile-name-content-1"><div dir="ltr"><p style="font-size:21pt;margin:0px;font-family:Trebuchet MS;direction:ltr;padding-top:0pt;line-height:1.15;padding-bottom:0pt"><span style="font-size:18pt;font-family:Arial;text-align:justify;line-height:normal;background-color:transparent">Table of Contents</span></p><p style="font-size:11pt;margin:0px 0px 0px 18pt;font-family:Arial;direction:ltr"><span style="color:rgb(17,85,204);text-decoration:underline"><a href="compact-language-detector-cld-data-source-configuration.html#h.299sug40d4s1" style="color:inherit;text-decoration:inherit">Introduction</a></span></p><p style="font-size:11pt;margin:0px 0px 0px 18pt;font-family:Arial;direction:ltr"><span style="color:rgb(17,85,204);text-decoration:underline"><a href="compact-language-detector-cld-data-source-configuration.html#h.emgzaid2qrjf" style="color:inherit;text-decoration:inherit">Switching the CLD Data Source</a></span></p><p style="font-size:11pt;margin:0px 0px 0px 36pt;font-family:Arial;direction:ltr"><span style="color:rgb(17,85,204);text-decoration:underline"><a href="compact-language-detector-cld-data-source-configuration.html#h.f1mvyah1g5g1" style="color:inherit;text-decoration:inherit">The “static” Data Source</a></span></p><p style="font-size:11pt;margin:0px 0px 0px 36pt;font-family:Arial;direction:ltr"><span style="color:rgb(17,85,204);text-decoration:underline"><a href="compact-language-detector-cld-data-source-configuration.html#h.u4xtjxog6lko" style="color:inherit;text-decoration:inherit">The “standalone” Data Source</a></span></p><p style="font-size:11pt;margin:0px 0px 0px 36pt;font-family:Arial;direction:ltr"><span style="color:rgb(17,85,204);text-decoration:underline"><a href="compact-language-detector-cld-data-source-configuration.html#h.jm1jzdqhpa22" style="color:inherit;text-decoration:inherit">The “component” Data Source</a></span></p><p style="font-size:11pt;margin:0px 0px 0px 18pt;font-family:Arial;direction:ltr"><span style="color:rgb(17,85,204);text-decoration:underline"><a href="compact-language-detector-cld-data-source-configuration.html#h.u9js50uasco5" style="color:inherit;text-decoration:inherit">Consequences of Switching the Data Source</a></span></p><p style="font-size:11pt;margin:0px 0px 0px 18pt;font-family:Arial;direction:ltr"><span style="color:rgb(17,85,204);text-decoration:underline"><a href="compact-language-detector-cld-data-source-configuration.html#h.whhxxf9bul9f" style="color:inherit;text-decoration:inherit">Appendix: Existing Data Source Implementations</a></span></p><p style="font-size:11pt;margin:0px 0px 0px 36pt;font-family:Arial;direction:ltr"><span style="color:rgb(17,85,204);text-decoration:underline"><a href="compact-language-detector-cld-data-source-configuration.html#h.nkpiwm1dlaam" style="color:inherit;text-decoration:inherit">Core Interfaces</a></span></p><p style="font-size:11pt;margin:0px 0px 0px 36pt;font-family:Arial;direction:ltr"><span style="color:rgb(17,85,204);text-decoration:underline"><a href="compact-language-detector-cld-data-source-configuration.html#h.tm6n73l3xmqp" style="color:inherit;text-decoration:inherit">Implementation: “static”</a></span></p><p style="font-size:11pt;margin:0px 0px 0px 36pt;font-family:Arial;direction:ltr"><span style="color:rgb(17,85,204);text-decoration:underline"><a href="compact-language-detector-cld-data-source-configuration.html#h.1oickuqcerfg" style="color:inherit;text-decoration:inherit">Implementation: “standalone”</a></span></p><p style="font-size:11pt;margin:0px 0px 0px 36pt;font-family:Arial;direction:ltr"><span style="color:rgb(17,85,204);text-decoration:underline"><a href="compact-language-detector-cld-data-source-configuration.html#h.w3m68tqby78d" style="color:inherit;text-decoration:inherit">Implementation: “component”</a></span></p><p style="font-size:11pt;margin:0px 0px 0px 36pt;font-family:Arial;direction:ltr"><span style="color:rgb(17,85,204);text-decoration:underline"><a href="compact-language-detector-cld-data-source-configuration.html#h.z9kdle393ux" style="color:inherit;text-decoration:inherit">Testing Harnesses for Browser Tests</a></span></p><p style="font-size:11pt;margin:0px 0px 0px 18pt;font-family:Arial;direction:ltr"><span style="color:rgb(17,85,204);text-decoration:underline"><a href="compact-language-detector-cld-data-source-configuration.html#h.oovhqb3xjr21" style="color:inherit;text-decoration:inherit">Appendix: Effects on Unit Tests</a></span></p><p style="font-size:11pt;margin:0px 0px 0px 18pt;font-family:Arial;direction:ltr"><span style="color:rgb(17,85,204);text-decoration:underline"><a href="compact-language-detector-cld-data-source-configuration.html#h.wt4hc7wamb0t" style="color:inherit;text-decoration:inherit">Appendix: Implementing a Custom Data Source</a></span></p><p style="font-size:11pt;margin:0px 0px 0px 18pt;font-family:Arial;direction:ltr"><span style="color:rgb(17,85,204);text-decoration:underline"><a href="compact-language-detector-cld-data-source-configuration.html#h.z242dcgssb1h" style="color:inherit;text-decoration:inherit">Appendix: Functional Testing of Data Sources</a></span></p><p style="font-size:11pt;margin:0px 0px 0px 18pt;font-family:Arial;direction:ltr"><span style="color:rgb(17,85,204);text-decoration:underline"><a href="compact-language-detector-cld-data-source-configuration.html#h.yvqbgbivc7jz" style="color:inherit;text-decoration:inherit">Appendix: Maintenance Testing</a></span></p><h1 style="padding-top:10pt;line-height:1.15;text-align:justify;font-size:16pt;font-family:Trebuchet MS;padding-bottom:0pt;direction:ltr;height:16pt"><a name="h.jocrepqy8ear"></a></h1><h1 style="padding-top:10pt;line-height:1.15;text-align:justify;font-size:16pt;font-family:Trebuchet MS;padding-bottom:0pt;direction:ltr"><a name="h.299sug40d4s1"></a>Introduction</h1><p style="font-size:11pt;margin:0px;font-family:Arial;direction:ltr;text-align:justify">As part of ongoing efforts to reduce the size of Chromium binaries on Android, it was recognized that one of several large chunks of data currently embedded in Chromium (not just on Android!) is Compact Language Detector (CLD) data. CLD provides Chromium with the ability to identify the language used in a given page, which in turn enables the user to request translation into their chosen language. <span style="font-size:11pt;background-color:transparent">Examining the nature of Chromium’s integration with CLD revealed that the CLD data could be cleanly separated from the executable with very little risk to performance or functionality:</span></p><span style="font-family:Arial;font-size:11pt;text-align:justify;background-color:transparent"><ul><li><span style="font-size:11pt;background-color:transparent">Language detection is performed in the background some time after a page finishes loading, outside of any performance-critical workflow.</span></li><li><span style="font-size:11pt;background-color:transparent">Language detection is cleanly decoupled from translation via IPC messaging.</span></li><li><span style="font-size:11pt;background-color:transparent">Language detection failures are expected and simply result in not offering translation.</span></li><li><span style="font-size:11pt;background-color:transparent">The CLD APIs and data change</span><span style="font-size:11pt;background-color:transparent"> rarely, on a cycle of around 6 - 12 months.</span></li></ul></span><p style="font-size:11pt;margin:0px;font-family:Arial;direction:ltr;text-align:justify">After these initial investigations, work was done<sup><a href="compact-language-detector-cld-data-source-configuration.html#ftnt1" name="ftnt_ref1">[1]</a></sup> to load CLD data from a standalone file. This work paved the way for a complete decoupling of the CLD data from the rest of Chromium.<sup><a href="compact-language-detector-cld-data-source-configuration.html#ftnt2" name="ftnt_ref2">[2]</a></sup> It is now possible for each distribution to choose one of three possible CLD data sources, listed below; if none of these suit, custom implementations are straightforward to implement.<sup><a href="compact-language-detector-cld-data-source-configuration.html#ftnt3" name="ftnt_ref3">[3]</a></sup> The three choices now offered within Chromium are:</p><ul><li><span style="font-family:Arial;font-size:11pt;text-align:justify;background-color:transparent"><b>Statically linked<br /></b></span><span style="font-family:Arial;font-size:11pt;text-align:justify;background-color:transparent">CLD data is compiled directly into the Chromium binary, just as it has been in the past.</span></li><li><span style="font-family:Arial;font-size:11pt;text-align:justify;background-color:transparent"><b>Standalone file<br /></b></span><span style="font-family:Arial;font-size:11pt;text-align:justify;background-color:transparent">CLD data is provided as a standalone file; delivery of the file is up to the distribution.</span></li><li><span style="font-family:Arial;font-size:11pt;text-align:justify;background-color:transparent"><b>Downloaded file via Component Updater<br /></b></span><span style="font-family:Arial;font-size:11pt;text-align:justify;background-color:transparent">CLD data is downloaded asynchronously and automatically by the </span><span style="font-family:Arial;font-size:11pt;text-align:justify;color:rgb(17,85,204);text-decoration:underline;background-color:transparent"><a href="https://code.google.com/p/chromium/codesearch#chromium/src/chrome/browser/component_updater/" style="color:inherit;text-decoration:inherit">Component Updater</a></span></li></ul><p style="font-size:11pt;margin:0px;font-family:Arial;direction:ltr;text-align:justify">Each distribution can pick the data source that is best suited to it. If none suit, a custom data source implementation can be built to meet arbitrary requirements.</p><h1 style="padding-top:10pt;line-height:1.15;text-align:justify;font-size:16pt;font-family:Trebuchet MS;padding-bottom:0pt;direction:ltr"><a name="TOC-1"></a><br /></h1><h1 style="padding-top:10pt;line-height:1.15;text-align:justify;font-size:16pt;font-family:Trebuchet MS;padding-bottom:0pt;direction:ltr"><a name="h.emgzaid2qrjf"></a>Switching the CLD Data Source</h1><p style="font-size:11pt;margin:0px;font-family:Arial;direction:ltr;text-align:justify"><span style="color:rgb(255,0,0);font-weight:bold">IMPORTANT:</span> It is only possible to use the non-static data sources if the distribution is using CLD2. The original CLD (CLD “1”) is not supported by non-static data sources. Check the value of “cld_version” in <span style="color:rgb(17,85,204);text-decoration:underline"><a href="https://code.google.com/p/chromium/codesearch#chromium/src/build/common.gypi" style="color:inherit;text-decoration:inherit">build/common.gypi</a></span> to determine the version of CLD being used. As of November 20, 2014 the sole remaining platform using CLD1 is Android.</p><p style="font-size:11pt;margin:0px;font-family:Arial;direction:ltr;text-align:justify"><br /></p><p style="font-size:11pt;margin:0px;font-family:Arial;text-align:justify">There are 4 distinct places where the CLD data source can be configured. Each is covered in more detail below.</p><ol><li><font face="Arial"><span style="font-size:15px"><b>In GYP/GN</b> either static or dynamic mode needs to be set for CLD2 to be compiled and linked. Defaults for each platform can be configured in third_party/cld_2/cld_2.gyp and/or third_party/cld_2/BUILD.gn.</span></font></li><li><font face="Arial"><span style="font-size:15px"><b>In the browser process</b> a specific data source must be configured. This is achieved by setting a CldDataSource and a BrowserCldDataProviderFactory at runtime. Defaults for each platform can be configured in components/translate/content/browser/browser_cld_utils.cc.</span></font></li><li><font face="Arial"><span style="font-size:15px"><b>In the renderer process</b> a specific data source must be configured. This is achieved by setting a CldDataSource and a RendererCldDataProviderFactory at runtime. Defaults for each platform can be configured in components/translate/content/renderer/renderer_cld_utils.cc.</span></font></li><li><font face="Arial"><span style="font-size:15px"><b>In test processes</b> a specific data source must be injected if language detection is required. This is achieved by setting a CldDataHarnessFactory at runtime. Defaults for each </span></font><span style="font-size:15px;font-family:Arial;background-color:transparent">platform can be configured in chrome/browser/translate/cld_data_harness_factory.cc.</span></li></ol><p style="margin:0px;text-align:justify"><font face="trebuchet ms, sans-serif" size="4">GYP/GN</font></p><p style="font-size:11pt;margin:0px;font-family:Arial;text-align:justify">Each executable target must declare a dependency upon one of the following GYP/GN targets:</p><ul><li><font face="Arial"><span style="font-size:15px"><b>cld2_platform_impl</b> - inherits the default for the platform.</span></font></li><li><font face="Arial"><span style="font-size:15px"><b>cld2_static</b> - forces static linkage of CLD2 data, suitable for unit tests or any environment where dynamic data doesn't make sense</span></font></li><li><font face="Arial"><span style="font-size:15px"><b>cld2_dynamic</b> - prevents static linkage of CLD2 data; the runtime must provide the data.</span></font></li></ul><p style="font-size:11pt;margin:0px;font-family:Arial;text-align:justify">For <i>most</i> targets, cld2_platform_impl is the right way to go. The defaults for each platform are<span style="background-color:transparent"> defined in third_party/cld_2/cld_2.gyp and third_party/cld_2/BUILD.gn. Most of the executable targets should stick with this strategy and platform maintainers can then swap the implementation easily by changing the variable in the CLD2 buildfiles.</span></p><p style="font-size:11pt;margin:0px;font-family:Arial;text-align:justify"><span style="background-color:transparent"><br /></span></p><p style="font-size:11pt;margin:0px;font-family:Arial;text-align:justify"><span style="background-color:transparent">For <i>some</i> targets it may be appropriate to force the use static or dynamic CLD2. If in doubt, choose cld2_dynamic: it reduces binary size and implies that any unintentional dependency upon detection of languages will fail gracefully. Use of cld2_static is best for unit tests and other targets where dynamic data loading would be inconvenient or difficult and binary size is not a concern.</span></p><p style="font-size:11pt;margin:0px;font-family:Arial;text-align:justify"><span style="background-color:transparent"><br /></span></p><p style="margin:0px;text-align:justify"><font face="trebuchet ms, sans-serif" size="4">Browser Process</font></p><p style="font-size:11pt;margin:0px;font-family:Arial;text-align:justify">At runtime, translate::ChromeTranslateClient (chrome/browser/translate/chrome_translate_client.cc) will invoke translate::BrowserCldDataProviderFactory::Get (components/translate/content/browser/browser_cld_data_provider_factory.cc) to obtain a factory that will be used to create translate::BrowserCldDataProvider instances to attach to each RenderView.</p><p style="font-size:11pt;margin:0px;font-family:Arial;text-align:justify"><br /></p><p style="font-size:11pt;margin:0px;font-family:Arial;text-align:justify">For open-source projects, changing the data source used by the browser process is as simple as adding an #ifdef into translate::BrowserCldUtils::ConfigureDefaultDataProvider <span style="background-color:transparent">(components/translate/content/browser/browser_cld_utils.cc)</span><span style="font-size:11pt;background-color:transparent">. </span><span style="font-size:11pt;background-color:transparent">At runtime, ChromeBrowserMainParts (chrome/browser/chrome_browser_main.cc) will invoke this method during startup; this will set the factory returned by translate::BrowserCldDataProviderFactory::Get.</span></p><p style="font-size:11pt;margin:0px;font-family:Arial;text-align:justify"><span style="font-size:11pt;background-color:transparent"><br /></span></p><p style="font-size:11pt;margin:0px;font-family:Arial;text-align:justify"><span style="font-size:11pt;background-color:transparent">For embedder projects, changing the data source used by the browser process requires invoking translate::BrowserCldDataProviderFactory::Set some time in the browser life cycle before the first ChromeTranslateClient is constructed. Additionally, translate::CldDataSource::Set (components/translate/content/common/cld_data_source.cc) must also be invoked to configure the data source metadata used by the runtime (e.g., displayed in chrome:://translate-internals). A custom implementation of translate::BrowserCldDataProviderFactory - along with a custom implementation of translate::BrowserCldDataProvider, of course - will need to be implemented to suit the needs of the embedder.</span></p><p style="font-size:11pt;margin:0px;font-family:Arial;text-align:justify"><span style="font-size:11pt;background-color:transparent"><br /></span></p><p style="margin:0px;text-align:justify"><span style="background-color:transparent"><font face="trebuchet ms, sans-serif" size="4">Renderer Process</font></span></p><p style="font-size:11pt;margin:0px;font-family:Arial;text-align:justify"><span style="font-size:11pt;background-color:transparent">At runtime, translate::TranslateHelper (components/translate/content/renderer/translate_helper.cc) will invoke translate::RendererCldDataProviderFactory::Get (components/translate/content/renderer/renderer_cld_data_provider_factory.cc) to obtain a factory that will be used to create translate::RendererCldDataProvider instances to attach to each RenderViewObserver.</span></p><p style="font-size:11pt;margin:0px;font-family:Arial;text-align:justify"><span style="font-size:11pt;background-color:transparent"><br /></span></p><p style="font-size:11pt;margin:0px;font-family:Arial;text-align:justify"><span style="font-size:11pt;background-color:transparent">For open-source projects, changing the data source used by the renderer process is again as simple as adding an #ifdef into translate::RendererCldUtils::ConfigureDefaultDataProvider (components/translate/content/renderer/renderer_cld_utils.cc). At runtime, translate::TranslateHelper will invoke this method during its construction; this will set the factory returned by translate::RendererCldDataProviderFactory::Get.</span></p><p style="font-size:11pt;margin:0px;font-family:Arial;text-align:justify"><span style="font-size:11pt;background-color:transparent"><br /></span></p><p style="font-size:11pt;margin:0px;font-family:Arial;text-align:justify"><span style="font-size:11pt;background-color:transparent">For embedder projects, changing the data source used by the renderer process requires invoking translate::RendererCldDataProviderFactory::Set some time in the renderer life cycle before the TranslateHelper for the RenderView is constructed. Additionally, translate::CldDataSource::Set (components/translate/content/common/cld_data_source.cc) must also be invoked to configure the data source metadata used by the runtime (e.g., displayed in chrome://translate-internals). A custom implementation of translate::RendererCldDataProviderFactory - along with a custom implementation of translate::RendererCldDataProvider, of course - will need to be implemented to suit the needs of the embedder.</span></p><p style="font-size:11pt;margin:0px;font-family:Arial;text-align:justify"><span style="font-size:11pt;background-color:transparent"><br /></span></p><p style="margin:0px;text-align:justify"><span style="background-color:transparent"><font face="trebuchet ms, sans-serif" size="4">Test Processes</font></span></p><p style="font-size:11pt;margin:0px;font-family:Arial;text-align:justify">Test fixtures generally have a very different operating environment than the real browser. To facilitate testing there is a class called test::CldDataHarnessFactory (chrome/browser/translate/cld_data_harness_factory.cc) that can be used to bootstrap CLD data for a test environment. The default implementation of the CldDataHarnessFactory supports all the open-source data source implementations; just calling test::CldDataHarnessFactory::Get() will, by default, return a factory suitable for the configured data source.</p><p style="font-size:11pt;margin:0px;font-family:Arial;text-align:justify"><br /></p><p style="font-size:11pt;margin:0px;font-family:Arial;text-align:justify">For open-source projects, test fixtures/runners need to ensure that the correct CldDataSource has been configured prior to invoking any CldDataHarnessFactory methods. This can be done using the mechanisms described above; whatever bootstrap code sets up the test environment needs to make sure to configure CLD appropriately. An example of how to do this can be seen in ChromeUnitTestSuite (chrome/test/base/chrome_unit_test_suite.cc). Once the data source is configured the CldDataHarnessFactory will "just work". For more information on how to use the harness in test code, see the class documentation in chrome/browser/translate/cld_data_harness.h.</p><p style="font-size:11pt;margin:0px;font-family:Arial;text-align:justify"><br /></p><h2 style="padding-top:10pt;line-height:1.15;font-size:13pt;font-family:Trebuchet MS;padding-bottom:0pt;direction:ltr"><a name="h.f1mvyah1g5g1"></a>The “static” Data Source</h2><p style="font-size:11pt;margin:0px;font-family:Arial;direction:ltr;text-align:justify">This data source implementation is a bunch of no-ops that simply assumes CLD’s data is always available because it is compiled into the distribution. With this data source there is nothing to configure and no special behavior to be aware of. It is functionally equivalent to the original implementation of CLD access in Chromium.</p><h2 style="padding-top:10pt;line-height:1.15;font-size:13pt;font-family:Trebuchet MS;padding-bottom:0pt;direction:ltr"><a name="h.u4xtjxog6lko"></a>The “standalone” Data Source</h2><p style="font-size:11pt;margin:0px;font-family:Arial;direction:ltr">CLD data will be loaded from a file whose path is constructed as follows:</p><p style="font-size:11pt;margin:0px;font-family:Arial;direction:ltr"><br /></p><p style="font-size:11pt;margin:0px;direction:ltr;text-indent:36pt"><font face="courier new, monospace">chrome::DIR_USER_DATA/cld2_data.bin</font></p><p style="font-size:11pt;margin:0px;font-family:Arial;direction:ltr"><br /></p><p style="font-size:11pt;margin:0px;font-family:Arial;direction:ltr">Where:</p><ul><li><span style="font-size:11pt;background-color:transparent"><font face="courier new, monospace">chrome::DIR_USER_DATA</font><font face="Arial"> is defined by </font></span><span style="font-family:Arial;font-size:11pt;color:rgb(17,85,204);text-decoration:underline;background-color:transparent"><a href="https://code.google.com/p/chromium/codesearch#chromium/src/chrome/common/chrome_paths.h" style="color:inherit;text-decoration:inherit">chrome/common/chrome_paths.h</a></span></li><li><span style="font-size:11pt;background-color:transparent"><font face="courier new, monospace">cld2_data.bin</font><font face="Arial"> is hardcoded in </font></span><span style="font-family:Arial;font-size:11pt;color:rgb(17,85,204);text-decoration:underline;background-color:transparent"><a href="https://code.google.com/p/chromium/codesearch#chromium/src/chrome/browser/translate/chrome_translate_client.cc" style="color:inherit;text-decoration:inherit">chrome/browser/translate/chrome_translate_client.cc</a></span></li></ul><div><p style="font-size:11pt;margin:0px;font-family:Arial;direction:ltr;text-align:justify"><br /></p><p style="font-size:11pt;margin:0px;font-family:Arial;direction:ltr;text-align:justify">The data source implementation will periodically poll this path to see if the file exists; if it does, it will be mmap’ed into the renderer process and used to configure CLD. Until this has occurred, all language detection attempts are automatically deferred. When CLD is successfully configured, any deferred language detection attempts that are still outstanding<sup><a href="compact-language-detector-cld-data-source-configuration.html#ftnt4" name="ftnt_ref4">[4]</a></sup> will be resumed, seamlessly triggering the normal translation logic as appropriate for each page.</p><p style="font-size:11pt;margin:0px;font-family:Arial;direction:ltr;text-align:justify"><br /></p><p style="font-size:11pt;margin:0px;font-family:Arial;direction:ltr;text-align:justify">When using the “standalone” data source it is up to the distribution to ensure that this file is eventually placed into this location. This can occur at any time (even while Chromium is running), but it is <span style="font-weight:bold">very important that the CLD data file be made available atomically</span>. The easiest way to accomplish this is to simply package the file up with the distribution such that it is available at all times; if the file needs to be copied or in any way “built”, make sure to do that work in a temporary file and then do an atomic rename to the final path.</p><p style="font-size:11pt;margin:0px;font-family:Arial;direction:ltr;text-align:justify"><br /></p><p style="margin:0px;text-align:justify"><span style="font-family:Arial;font-size:11pt">To obtain a copy of the CLD2 data you can either copy it from </span><font face="courier new, monospace" size="3" style="color:inherit;line-height:13.333332061767578px;background-color:transparent"><a href="https://code.google.com/p/chromium/codesearch#chromium/src/chrome/test/data/cld2_component/" style="color:inherit;line-height:13.333332061767578px;background-color:transparent">chrome/test/data/cld2_component</a> </font><span style="font-size:15px;background-color:transparent"><font face="Arial">or generate it fresh using the instructions in </font><a href="https://code.google.com/p/chromium/codesearch#chromium/src/third_party/cld_2/README.chromium"><font face="courier new, monospace">third_party/cld_2/README.chromium</font></a></span></p><h2 style="padding-top:10pt;line-height:1.15;text-align:justify;font-size:13pt;font-family:Trebuchet MS;padding-bottom:0pt;direction:ltr"><a name="h.jm1jzdqhpa22"></a>The “component” Data Source</h2><p style="text-align:justify;margin:0px;direction:ltr"><b style="font-family:Arial;font-size:11pt"><font color="#ff0000">IMPORTANT:</font></b> <font face="Arial"><span style="font-size:15px">Using this data source requires an understanding of the tradeoffs that come from using the Component Updater. Please consult </span></font><span style="background-color:transparent;font-size:15px"><font face="Arial"><a href="https://code.google.com/p/chromium/codesearch#chromium/src/chrome/browser/component_updater/OWNERS">chrome/browser/component_updater/OWNERS</a> for Component Updater contact information and make sure to consult them before switching any distribution to this data source.</font></span></p><p style="font-size:11pt;margin:0px;font-family:Arial;direction:ltr;text-align:justify">CLD data will be loaded from a file whose path is constructed as follows:</p><p style="font-size:11pt;margin:0px;font-family:Arial;direction:ltr;text-align:justify"><br /></p><p style="font-size:11pt;margin:0px;direction:ltr;text-indent:36pt"><font face="courier new, monospace">chrome::DIR_COMPONENT_CLD2/[CRX_VERSION]/<span style="font-size:11pt;text-indent:36pt;background-color:transparent">_platform_specific/all/cld2_data.bin</span></font></p><p style="font-size:11pt;margin:0px;font-family:Arial;direction:ltr"><br /></p><p style="font-size:11pt;margin:0px;font-family:Arial;direction:ltr">Where:</p><span style="font-size:11pt;background-color:transparent"><ul><li><span style="font-size:11pt;background-color:transparent"><font face="courier new, monospace">chrome::DIR_COMPOENT_CLD2</font><font face="Arial"> is defined by </font></span><span style="font-family:Arial;font-size:11pt;color:rgb(17,85,204);text-decoration:underline;background-color:transparent"><a href="https://code.google.com/p/chromium/codesearch#chromium/src/chrome/common/chrome_paths.h" style="color:inherit;text-decoration:inherit">chrome/common/chrome_paths.h</a></span></li><li><span style="font-size:11pt;background-color:transparent"><font face="courier new, monospace">CRX_VERSION</font><font face="Arial"> is the CLD2 revision from which the CLD2 data file was built</font></span><sup style="font-family:Arial;background-color:transparent"><a href="compact-language-detector-cld-data-source-configuration.html#ftnt5" name="ftnt_ref5">[5]</a></sup></li><li><span style="font-size:11pt;background-color:transparent"><font face="courier new, monospace">_platform_specific/all/cld2_data.bin</font><font face="Arial"> is hardcoded in </font></span><span style="font-family:Arial;font-size:11pt;color:rgb(17,85,204);text-decoration:underline;background-color:transparent"><a href="https://code.google.com/p/chromium/codesearch#chromium/src/chrome/browser/component_updater/cld_component_installer.cc" style="color:inherit;text-decoration:inherit">chrome/browser/component_updater/cld_component_installer.cc</a></span><span style="font-family:Arial;font-size:11pt;background-color:transparent"> and corresponds to the layout of the CRX file</span><sup style="font-family:Arial;background-color:transparent"><a href="compact-language-detector-cld-data-source-configuration.html#ftnt6" name="ftnt_ref6">[6]</a></sup><span style="font-family:Arial;font-size:11pt;background-color:transparent"> in which the CLD2 data is packaged.</span></li></ul></span><p style="font-size:11pt;margin:0px;font-family:Arial;direction:ltr;text-align:justify">The <span style="color:rgb(17,85,204);text-decoration:underline"><a href="https://code.google.com/p/chromium/codesearch#chromium/src/chrome/browser/component_updater/cld_component_installer.cc" style="color:inherit;text-decoration:inherit">CLD component installer</a></span> will periodically attempt to download and install the CLD data as a CRX file, installing the data file to a path as described above. Upon success it will configured the data source implementation to use the downloaded data file, and then everything proceeds just as if you had used the “standalone” data source: the data source implementation will detect the presence of the file, mmap the data and configure CLD.</p><p style="font-size:11pt;margin:0px;font-family:Arial;text-align:justify"><br /></p><h1 style="padding-top:10pt;line-height:1.15;text-align:justify;font-size:16pt;font-family:Trebuchet MS;padding-bottom:0pt;direction:ltr"><a name="h.u9js50uasco5"></a>Consequences of Switching the Data Source</h1><p style="font-size:11pt;margin:0px;font-family:Arial;direction:ltr;text-align:justify">If you opt to change your data source from “static” to one of the other options, you should be aware of the following high-level consequences:</p><p style="font-size:11pt;margin:0px;font-family:Arial;direction:ltr;text-align:justify"><br /></p><span style="text-align:justify;background-color:transparent"><ul><li><font face="Arial"><span style="font-size:15px">Generally:</span></font></li><ul><li style="font-family:Arial;font-size:11pt"><span style="font-size:11pt;background-color:transparent">The distribution’s initial download size will decrease by a little over one megabyte.</span><sup style="background-color:transparent"><a href="compact-language-detector-cld-data-source-configuration.html#ftnt7" name="ftnt_ref7">[7]</a></sup></li><li style="font-family:Arial;font-size:11pt"><span style="font-size:11pt;background-color:transparent">The distribution’s subsequent update size may decrease in a similar manner.</span><sup style="background-color:transparent"><a href="compact-language-detector-cld-data-source-configuration.html#ftnt8" name="ftnt_ref8">[8]</a></sup></li><li style="font-family:Arial;font-size:11pt"><span style="font-size:11pt;background-color:transparent">There should be no perceptible performance degradation in any normal CLD use cases.</span></li></ul><li><font face="Arial"><span style="font-size:15px">Component Updater, Specifically:</span></font></li><ul><li><span style="font-size:11pt;background-color:transparent">The translate UI will not appear until CLD data is available. No messaging to the user is currently provided; it is assumed that the download will be sufficiently fast for this to not matter. If this is a problem you will need to add messaging appropriate to your platform.</span></li><li><span style="font-size:11pt;background-color:transparent">Component Updater does not care whether a device is on wifi or not, and thus the download of the CLD2 data may take place over any connection and at any time. This may have implications for mobile platforms, but is generally not a problem for desktops.</span></li></ul></ul></span><h1 style="padding-top:10pt;line-height:1.15;font-size:16pt;font-family:Trebuchet MS;padding-bottom:0pt;direction:ltr"><a name="TOC-2"></a><span style="font-size:16pt;line-height:1.15;font-weight:normal;background-color:transparent"><br /></span></h1><h1 style="padding-top:10pt;line-height:1.15;font-size:16pt;font-family:Trebuchet MS;padding-bottom:0pt;direction:ltr"><a name="TOC-Appendix:-Existing-Data-Source-Implementations"></a><span style="font-size:16pt;line-height:1.15;font-weight:normal;background-color:transparent">Appendix: Existing Data Source Implementations</span></h1><p style="font-size:11pt;margin:0px;font-family:Arial;direction:ltr;text-align:justify"><span style="font-size:11pt;background-color:transparent">At a high level, this is what all the implementations</span><sup style="background-color:transparent"><a href="compact-language-detector-cld-data-source-configuration.html#ftnt9" name="ftnt_ref9">[9]</a></sup><span style="font-size:11pt;background-color:transparent"> do:</span></p><span style="font-family:Arial;font-size:11pt;text-align:justify;background-color:transparent"><ol><li><span style="font-size:11pt;background-color:transparent">Factories produce BrowserCldDataProvider and RendererCldDataProvider objects.</span></li><li><span style="font-size:11pt;background-color:transparent">The runtime chooses which implementation to configure by setting a CldDataSource and factory instances in the browser and renderer processes.</span></li><li><span style="font-size:11pt;background-color:transparent">Within the browser process, </span><span style="font-size:11pt;color:rgb(17,85,204);text-decoration:underline;background-color:transparent"><a href="https://code.google.com/p/chromium/codesearch#chromium/src/chrome/browser/translate/chrome_translate_client.cc" style="color:inherit;text-decoration:inherit">ChromeTranslateClient</a></span><span style="font-size:11pt;background-color:transparent"> uses the factory to instantiate an instance of BrowserCldDataProvider.</span></li><li><span style="font-size:11pt;background-color:transparent">Within the renderer process, </span><span style="font-size:11pt;color:rgb(17,85,204);text-decoration:underline;background-color:transparent"><a href="https://code.google.com/p/chromium/codesearch#chromium/src/chrome/renderer/translate/translate_helper.cc" style="color:inherit;text-decoration:inherit">TranslateHelper</a></span><span style="font-size:11pt;background-color:transparent"> uses the factory to instantiate an instance of RendererCldDataProvider.</span></li><li><span style="font-size:11pt;background-color:transparent">The RendereCldDataProvider sends messages to the BrowserCldDataProvider via IPC, requesting CLD data.</span></li><li><span style="font-size:11pt;background-color:transparent">The BrowserCldDataProvider identifies the CLD data and sends a message back to the RendererCldDataProvider describing how to access that data.</span></li><li><span style="font-size:11pt;background-color:transparent">Finally, the RendererCldDataProvider configures CLD with the data.</span></li></ol></span><h2 style="padding-top:10pt;line-height:1.15;text-align:justify;font-size:13pt;font-family:Trebuchet MS;padding-bottom:0pt;direction:ltr"><a name="h.nkpiwm1dlaam"></a>Core Interfaces</h2><p style="font-size:11pt;margin:0px;font-family:Arial;direction:ltr">These files define the virtual base classes for all implementations:</p><span style="font-size:11pt;text-align:justify;background-color:transparent"><ul><li><span style="font-size:11pt;background-color:transparent"><font face="courier new, monospace">components/translate/content/browser/browser_cld_data_provider.h</font></span></li><li><span style="font-size:11pt;background-color:transparent"><font face="courier new, monospace">components/translate/content/browser/browser_cld_data_provider_factory.h</font></span></li><li><span style="font-size:11pt;background-color:transparent"><font face="courier new, monospace">components/translate/content/common/cld_data_source.h</font></span></li><li><span style="font-size:11pt;background-color:transparent"><font face="courier new, monospace">components/translate/content/renderer/renderer_cld_data_provider.h</font></span></li><li><span style="font-family:courier new,monospace;font-size:11pt;background-color:transparent">components/translate/content/renderer/renderer_cld_data_provider_factory.h</span></li></ul></span><h2 style="padding-top:10pt;line-height:1.15;text-align:justify;font-size:13pt;font-family:Trebuchet MS;padding-bottom:0pt;direction:ltr"><a name="h.tm6n73l3xmqp"></a>Implementation: “static”</h2><p style="font-size:11pt;margin:0px;font-family:Arial;direction:ltr">Simple no-op implementations of the core interfaces described above. The corresponding .cc files define this implementation, which has almost no special logic.</p><h2 style="padding-top:10pt;line-height:1.15;text-align:justify;font-size:13pt;font-family:Trebuchet MS;padding-bottom:0pt;direction:ltr"><a name="h.1oickuqcerfg"></a>Implementation: “standalone”</h2><p style="font-size:11pt;margin:0px;font-family:Arial;direction:ltr;text-align:justify">Each renderer process polls the browser process for CLD data via IPC. The browser process attempts to locate the CLD data file and, upon success, opens a file handle and passes the open handle back to the renderer process via IPC. The renderer process subsequently mmap’s the CLD data and initializes CLD. The <span style="color:rgb(17,85,204);text-decoration:underline"><a href="https://code.google.com/p/chromium/codesearch#chromium/src/chrome/browser/translate/chrome_translate_client.cc" style="color:inherit;text-decoration:inherit">ChromeTranslateClient</a></span> configures the location of the CLD data file by invoking CldDataSource::SetCldDataFilePath(...). The relevant sources are here:</p><span style="font-size:11pt;text-align:justify;background-color:transparent"><ul><li><span style="font-size:11pt;background-color:transparent"><font face="courier new, monospace">components/translate/content/browser/data_file_browser_cld_data_provider.cc</font></span></li><li><span style="font-size:11pt;background-color:transparent"><font face="courier new, monospace">components/translate/content/browser/data_file_browser_cld_data_provider.h</font></span></li><li><span style="font-size:11pt;background-color:transparent"><font face="courier new, monospace">components/translate/content/renderer/data_file_renderer_cld_data_provider.cc</font></span></li><li><span style="font-size:11pt;background-color:transparent"><font face="courier new, monospace">components/translate/content/renderer/data_file_renderer_cld_data_provider.h</font></span></li><li><span style="font-size:11pt;background-color:transparent"><font face="courier new, monospace">components/translate/content/common/data_file_cld_data_provider_messages.cc</font></span></li><li><span style="font-size:11pt;background-color:transparent"><font face="courier new, monospace">components/translate/content/common/data_file_cld_data_provider_messages.h</font></span></li></ul></span><h2 style="padding-top:10pt;line-height:1.15;text-align:justify;font-size:13pt;font-family:Trebuchet MS;padding-bottom:0pt;direction:ltr"><a name="h.w3m68tqby78d"></a>Implementation: “component”</h2><p style="font-size:11pt;margin:0px;font-family:Arial;direction:ltr;text-align:justify">The “component” implementation is actually the same as the “standalone” implementation, except that the CLD data file location is configured by the <span style="color:rgb(17,85,204);text-decoration:underline"><a href="https://code.google.com/p/chromium/codesearch#chromium/src/chrome/browser/component_updater/cld_component_installer.cc" style="color:inherit;text-decoration:inherit">CldComponentInstallerTraits</a></span> class instead of <span style="color:rgb(17,85,204);text-decoration:underline"><a href="https://code.google.com/p/chromium/codesearch#chromium/src/chrome/browser/translate/chrome_translate_client.cc" style="color:inherit;text-decoration:inherit">ChromeTranslateClient</a></span>. You can find the relevant code here:</p><span style="font-size:11pt;background-color:transparent"><ul><li><span style="font-size:11pt;background-color:transparent"><font face="courier new, monospace">chrome/browser/component_updater/cld_component_installer.cc</font></span></li></ul></span><h2 style="padding-top:10pt;line-height:1.15;font-size:13pt;font-family:Trebuchet MS;padding-bottom:0pt;direction:ltr"><a name="h.z9kdle393ux"></a>Testing Harnesses for Browser Tests</h2><p style="font-size:11pt;margin:0px;font-family:Arial;direction:ltr;text-align:justify">Of course, several tests rely - either directly or indirectly - upon CLD data being available so that language detection (and subsequently, translation) functionality can be exercised at build time. It is straightforward to add CLD data source configuration to browser tests by imitating the work done in <span style="color:rgb(17,85,204);text-decoration:underline"><a href="https://codereview.chromium.org/333603002/" style="color:inherit;text-decoration:inherit">https://codereview.chromium.org/333603002/</a></span>. A test harness is provided for each of the three data source implementations. The static test harness is a no-op, while the “component” and “static” test harnesses copy CLD test data<sup><a href="compact-language-detector-cld-data-source-configuration.html#ftnt10" name="ftnt_ref10">[10]</a></sup> into temporary directories and allow the CLD data source implementations to operate normally at runtime. Factory functions are used to produce the harnesses, just like the factory functions used to produce the data sources themselves. The relevant source files are:</p><span style="font-size:11pt;background-color:transparent"><ul><li><span style="font-size:11pt;background-color:transparent"><font face="courier new, monospace">chrome/browser/translate/cld_data_harness.h</font></span></li><li><span style="font-size:11pt;background-color:transparent"><font face="courier new, monospace">chrome/browser/translate/cld_data_harness.cc</font></span></li><li><span style="font-size:11pt;background-color:transparent"><font face="courier new, monospace">chrome/browser/translate/component_cld_data_harness.h</font></span></li><li><span style="font-size:11pt;background-color:transparent"><font face="courier new, monospace">chrome/browser/translate/component_cld_data_harness.cc</font></span></li><li><span style="font-size:11pt;background-color:transparent"><font face="courier new, monospace">chrome/browser/translate/standalone_cld_data_harness.h</font></span></li><li><span style="font-size:11pt;background-color:transparent"><font face="courier new, monospace">chrome/browser/translate/standalone_cld_data_harness.cc</font></span></li></ul></span><p style="font-size:11pt;margin:0px;font-family:Arial;direction:ltr">Additional documentation can be found in the virtual base class for these implementations:</p><span style="font-size:11pt;background-color:transparent"><ul><li><span style="font-size:11pt;background-color:transparent"><font face="courier new, monospace">chrome/browser/translate/cld_data_harness.h</font></span></li><li><span style="font-size:11pt;background-color:transparent"><font face="courier new, monospace">chrome/browser/translate/cld_data_harness.cc</font></span></li></ul></span><p style="font-size:11pt;margin:0px;font-family:Arial;direction:ltr">All <span style="font-style:italic">existing</span> browser tests that were affected have already been patched to use the harness.</p><h1 style="padding-top:10pt;line-height:1.15;font-size:16pt;font-family:Trebuchet MS;padding-bottom:0pt;direction:ltr"><a name="TOC-3"></a><br /></h1><h1 style="padding-top:10pt;line-height:1.15;font-size:16pt;font-family:Trebuchet MS;padding-bottom:0pt;direction:ltr"><a name="h.oovhqb3xjr21"></a>Appendix: Effects on Unit Tests</h1><p style="font-size:11pt;margin:0px;font-family:Arial;direction:ltr;text-align:justify">There should be <span style="font-style:italic">no</span> unit tests that explicitly require CLD, since CLD has unit tests of its own. Only code that is integrated with one of the data source implementations should have any need to deal with them. An example of this is the <span style="color:rgb(17,85,204);text-decoration:underline"><a href="https://code.google.com/p/chromium/codesearch#chromium/src/chrome/browser/component_updater/test/cld_component_installer_unittest.cc" style="color:inherit;text-decoration:inherit">CldComponentInstallerTest</a></span> class, which exercises the integration between the CLD Component Installer and the “component” data source implementation.</p><p style="font-size:11pt;margin:0px;font-family:Arial;direction:ltr;text-align:justify"><br /></p><p style="font-size:11pt;margin:0px;font-family:Arial;direction:ltr;text-align:justify">No other unit tests were affected during this work.</p><h1 style="padding-top:10pt;line-height:1.15;text-align:justify;font-size:16pt;font-family:Trebuchet MS;padding-bottom:0pt;direction:ltr"><a name="TOC-4"></a><br /></h1><h1 style="padding-top:10pt;line-height:1.15;text-align:justify;font-size:16pt;font-family:Trebuchet MS;padding-bottom:0pt;direction:ltr"><a name="h.wt4hc7wamb0t"></a>Appendix: Implementing a Custom Data Source</h1><p style="font-size:11pt;margin:0px;font-family:Arial;direction:ltr;text-align:justify">If none of the data sources are suitable for a given distribution, it is straightforward to add a custom implementation. <span style="color:rgb(17,85,204);text-decoration:underline"><a href="compact-language-detector-cld-data-source-configuration.html#h.whhxxf9bul9f" style="color:inherit;text-decoration:inherit">Appendix: Existing Data Source Implementations</a></span> provides the best examples to follow. The following high level steps are required:</p><span style="font-family:Arial;font-size:11pt;text-align:justify;background-color:transparent"><ol><li><span style="font-size:11pt;background-color:transparent">Implement BrowserCldDataProvider and RendererCldDataProvider subclasses and any “glue” (e.g., IPC messages) as necessary. Make sure to implement the factory functions previously discussed!</span></li><li><span style="font-size:11pt;background-color:transparent">Implement BrowserCldDataProviderFactory and RendererCldDataProviderFactory subclasses to produce the custom implementations of BrowserCldDataProvider and RendererCldDataProvider, respectively.</span></li><li><span style="font-size:11pt;background-color:transparent">Implement a subclass of CldDataSource.</span></li><li><span style="font-size:11pt;background-color:transparent">Include the custom implementation source files into the build so that the custom factory functions will be linked in.</span><sup style="background-color:transparent"><a href="compact-language-detector-cld-data-source-configuration.html#ftnt11" name="ftnt_ref11">[11]</a></sup></li><li>Invoke BrowserCldDataProviderFactory::Set and CldDataSource::Set during the browser process startup.</li><li>Invoke RendererCldDataProviderFacotry::Set and CldDataSource::Set during the renderer process startup.</li><li><span style="font-size:11pt;background-color:transparent">Add testing harnesses following the examples in </span><span style="font-size:11pt;color:rgb(17,85,204);text-decoration:underline;background-color:transparent"><a href="compact-language-detector-cld-data-source-configuration.html#h.z9kdle393ux" style="color:inherit;text-decoration:inherit">Testing Harnesses for Browser Tests</a></span><span style="font-size:11pt;background-color:transparent">; this basically amounts to implementing another pair of factory functions for the tests and implementing whatever logic is necessary to jam the data into the runtime. Take care not to access any network resources in this code, as tests must be runnable without network connectivity.</span></li><li><span style="font-size:11pt;background-color:transparent">Include the custom test harnesses into the build so that the custom factory functions will be linked in to the test code.</span><sup style="background-color:transparent"><a href="compact-language-detector-cld-data-source-configuration.html#ftnt12" name="ftnt_ref12">[12]</a></sup></li></ol></span><h1 style="padding-top:10pt;line-height:1.15;text-align:justify;font-size:16pt;font-family:Trebuchet MS;padding-bottom:0pt;direction:ltr"><a name="TOC-5"></a><br /></h1><h1 style="padding-top:10pt;line-height:1.15;text-align:justify;font-size:16pt;font-family:Trebuchet MS;padding-bottom:0pt;direction:ltr"><a name="h.z242dcgssb1h"></a>Appendix: Functional Testing of Data Sources</h1><p style="font-size:11pt;margin:0px;font-family:Arial;text-align:justify">First: to determine which data source was built into your distribution, visit the URL <a href="javascript:void(0);">chrome://translate-internals</a> and look for the section labeled "<b>CLD Data Source</b>" near the bottom-left of the page, just under "CLD Version". It will contain a string that describes the source of the CLD data configured by the runtime; this is the value returned from CldDataSource::GetName().</p><p style="font-size:11pt;margin:0px;font-family:Arial;text-align:justify"><span style="font-size:11pt;background-color:transparent"><br /></span></p><p style="font-size:11pt;margin:0px;font-family:Arial;direction:ltr;text-align:justify">For the “static” and “standalone” data source implementations, functional testing should be indistinguishable from how it is handled today: there should be no noticeable difference between the two implementations, nor should there be a noticeable difference from the legacy behavior before these separate implementations were derived. The situation becomes significantly more complex when using the “component” implementation, and the process for distribution-specific implementations are obviously out of scope for this document.</p><p style="font-size:11pt;margin:0px;font-family:Arial;direction:ltr;text-align:justify"><br /></p><p style="font-size:11pt;margin:0px;font-family:Arial;direction:ltr;text-align:justify">Both the “component” and “standalone” implementations share the same BrowserCldDataProvider and RendererCldDataProvider implementation; The simplest way to get information about what is going on is to enable logging during testing and watch for the VLOG messages defined in these implementations:</p><span style="font-size:11pt;text-align:justify;background-color:transparent"><ul><li><span style="font-size:11pt;background-color:transparent"><font face="courier new, monospace">components/translate/content/browser/data_file_browser_cld_data_provider.cc</font></span></li><li><span style="font-size:11pt;background-color:transparent"><font face="courier new, monospace">components/translate/content/renderer/data_file_renderer_cld_data_provider.cc</font></span></li><li><span style="font-size:11pt;background-color:transparent"><font face="courier new, monospace">chrome/browser/component_updater/cld_component_installer.cc</font></span></li></ul></span><p style="font-size:11pt;margin:0px;font-family:Arial;direction:ltr;text-align:justify">Logging is provided for most nontrivial events, e.g. successfully locating a CLD data file the browser process or successfully bootstrapping CLD in the renderer process.</p><p style="font-size:11pt;margin:0px;font-family:Arial;direction:ltr;text-align:justify"><br /></p><p style="font-size:11pt;margin:0px;font-family:Arial;direction:ltr;text-align:justify">To enable logging, start Chromium with the following flag:</p><blockquote style="margin:0 0 0 40px;border:none;padding:0px"><p style="font-size:11pt;margin:0px;text-align:justify"><font face="courier new, monospace">--enable-logging</font></p></blockquote><p style="font-size:11pt;margin:0px;font-family:Arial;direction:ltr;text-align:justify"><br /></p><p style="font-size:11pt;margin:0px;font-family:Arial;direction:ltr;text-align:justify">You’ll also have to turn on “vmodules” for the classes you care about, e.g.:</p><blockquote style="margin:0 0 0 40px;border:none;padding:0px"><p style="font-size:11pt;margin:0px;text-align:justify"><span style="font-size:11pt;text-indent:36pt;background-color:transparent"><font face="courier new, monospace">--vmodule=*cld*=1</font></span></p></blockquote><h1 style="padding-top:10pt;line-height:1.15;font-size:16pt;font-family:Trebuchet MS;padding-bottom:0pt;direction:ltr"><a name="TOC-6"></a><br /></h1><h1 style="padding-top:10pt;line-height:1.15;font-size:16pt;font-family:Trebuchet MS;padding-bottom:0pt;direction:ltr"><a name="h.yvqbgbivc7jz"></a>Appendix: Maintenance Testing</h1><p style="font-size:11pt;margin:0px;font-family:Arial;direction:ltr;text-align:justify">These commands can be used to run the browser tests and unit tests that confirm correct functioning of each data source implementation. More information on running tests is available at<span style="color:rgb(17,85,204);text-decoration:underline"><a href="http://www.chromium.org/developers/testing/running-tests" style="color:inherit;text-decoration:inherit">http://www.chromium.org/developers/testing/running-tests</a></span>.</p><p style="margin:0px;direction:ltr"><font face="courier new, monospace" size="3"><br /></font></p></div><blockquote style="margin:0 0 0 40px;border:none;padding:0px"><div><p style="margin:0px"><font face="courier new, monospace" size="3"># Start virtual display so tests can be run headless</font></p></div><div><p style="margin:0px"><font face="courier new, monospace" size="3">Xvfb :100 -screen 0 1600x1200x24 &amp;</font></p></div><div><p style="margin:0px"><font face="courier new, monospace" size="3"># browser tests</font></p></div><div><p style="margin:0px"><font face="courier new, monospace" size="3">DISPLAY=localhost:100 cr shell ./out_linux_x64/Debug/browser_tests\</font></p></div><div><p style="margin:0px"><font face="courier new, monospace" size="3"> --gtest_filter="PolicyTest.TranslateEnabled" --vmodule=*cld*=1</font></p></div><div><p style="margin:0px"><font face="courier new, monospace" size="3">DISPLAY=localhost:100 cr shell ./out_linux_x64/Debug/browser_tests\</font></p></div><div><p style="margin:0px"><font face="courier new, monospace" size="3"> --gtest_filter="TranslateManagerBrowserTest.*" --vmodule=*cld*=1</font></p></div><div><p style="margin:0px"><font face="courier new, monospace" size="3">DISPLAY=localhost:100 cr shell ./out_linux_x64/Debug/browser_tests\</font></p></div><div><p style="margin:0px"><font face="courier new, monospace" size="3"> --gtest_filter="BrowserTest.PageLanguageDetection" --vmodule=*cld*=1</font></p></div><div><p style="margin:0px"><font face="courier new, monospace" size="3">DISPLAY=localhost:100 cr shell ./out_linux_x64/Debug/browser_tests\</font></p></div><div><p style="margin:0px"><font face="courier new, monospace" size="3"> --gtest_filter="TranslateBubbleViewBrowserTest.*" --vmodule=*cld*=1</font></p></div><div><p style="margin:0px"><font face="courier new, monospace" size="3"># unit tests</font></p></div><div><p style="margin:0px"><font face="courier new, monospace" size="3">cr build unit_tests</font></p></div><div><p style="margin:0px"><font face="courier new, monospace" size="3">DISPLAY=localhost:100 cr shell ./out_linux_x64/Debug/unit_tests\</font></p></div><div><p style="margin:0px"><font face="courier new, monospace" size="3"> --gtest_filter="CldComponentInstallerTest.*" --vmodule=*cld*=1 --single-process-tests</font></p></div></blockquote><span style="font-family:Arial;font-size:15px;text-align:justify;background-color:transparent"><div><span style="font-family:Arial;font-size:15px;text-align:justify;background-color:transparent"><br /></span></div>To see the functionality in action for yourself the easiest thing to do is switch to the standalone data source and run the browser. Now copy the data file onto the device in a temporary location (you'll need root access)</span><div><div style="text-align:justify"><font face="Arial"><span style="font-size:15px"><br /></span></font></div></div><blockquote style="margin:0 0 0 40px;border:none;padding:0px"><div><div style="text-align:justify"><span style="font-size:15px"><font face="courier new, monospace">adb push chrome/test/data/cld2_component/160/_platform_specific/all/cld2_data.bin /data/data/com.google.android.apps.chrome/app_chrome/cld2_data.bin.tmp</font></span></div></div></blockquote><div><div style="text-align:justify"><font face="Arial"><span style="font-size:15px"><br /></span></font></div><div style="text-align:justify"><font face="Arial"><span style="font-size:15px">Now you've got a temp file in place and we can do the atomic rename when we're ready. First, navigate to a page that isn't in your local language. No translation bar should appear. This indicates that the data source hasn't located the CLD data file; the fact that your browser isn't crashing means all that machinery is working correctly. Now, rename the temp file:</span></font></div><div style="text-align:justify"><font face="Arial"><span style="font-size:15px"><br /></span></font></div></div><blockquote style="margin:0 0 0 40px;border:none;padding:0px"><div><div style="text-align:justify"><span style="font-size:15px"><font face="courier new, monospace">adb shell "mv /data/data/com.google.android.apps.chrome/app_chrome/cld2_data.bin.tmp /data/data/com.google.android.apps.chrome/app_chrome/cld2_data.bin"</font></span></div></div></blockquote><div><div style="text-align:justify"><font face="Arial"><span style="font-size:15px"><br /></span></font></div><div style="text-align:justify"><font face="Arial"><span style="font-size:15px">The translate bar should appear within a second or two. This demonstrates the data source finding the file, the renderer receiving the file handle via IPC, and the translate logic subsequently resuming the language detection for the page that you had already loaded. That's it, everything is working!</span></font></div><div style="text-align:justify"><font face="Arial"><span style="font-size:15px"><br /></span></font></div><div><div style="font-family:Times New Roman;font-size:medium"><p style="font-size:11pt;margin:0px;font-family:Arial;direction:ltr;line-height:1;text-align:justify"><br /></p><hr /><p style="font-size:11pt;margin:0px;font-family:Arial;direction:ltr;line-height:1;text-align:justify"><br /></p><p style="font-size:11pt;margin:0px;font-family:Arial;direction:ltr;line-height:1;text-align:justify"><a href="compact-language-detector-cld-data-source-configuration.html#ftnt_ref1" name="ftnt1">[1]</a><span style="font-size:10pt"> </span><span style="color:rgb(17,85,204);text-decoration:underline;font-size:10pt"><a href="https://code.google.com/p/chromium/issues/detail?id=367239" style="color:inherit;text-decoration:inherit">crbug/367239</a></span><span style="font-size:10pt"> describes these changes in detail</span></p></div><div style="font-family:Times New Roman;font-size:medium"><p style="font-size:11pt;margin:0px;font-family:Arial;direction:ltr;line-height:1"><a href="compact-language-detector-cld-data-source-configuration.html#ftnt_ref2" name="ftnt2">[2]</a><span style="font-size:10pt"> </span><span style="color:rgb(17,85,204);text-decoration:underline;font-size:10pt"><a href="https://code.google.com/p/chromium/issues/detail?id=383769" style="color:inherit;text-decoration:inherit">crbug/383769</a></span><span style="font-size:10pt"> describes the eventual implementation</span></p></div><div style="font-family:Times New Roman;font-size:medium"><p style="font-size:11pt;margin:0px;font-family:Arial;direction:ltr"><a href="compact-language-detector-cld-data-source-configuration.html#ftnt_ref3" name="ftnt3">[3]</a><span style="font-size:10pt"> See </span><span style="color:rgb(17,85,204);text-decoration:underline;font-size:10pt"><a href="compact-language-detector-cld-data-source-configuration.html#h.wt4hc7wamb0t" style="color:inherit;text-decoration:inherit">Appendix: Implementing a Custom Data Source</a></span><span style="font-size:10pt"> for more information</span></p></div><div style="font-family:Times New Roman;font-size:medium"><p style="font-size:11pt;margin:0px;font-family:Arial;direction:ltr;line-height:1;text-align:justify"><a href="compact-language-detector-cld-data-source-configuration.html#ftnt_ref4" name="ftnt4">[4]</a><span style="font-size:10pt"> I.e., for pages whose language has not yet been detected and are still loaded in the browser</span></p></div><div style="font-family:Times New Roman;font-size:medium"><p style="font-size:11pt;margin:0px;font-family:Arial;direction:ltr;line-height:1;text-align:justify"><a href="compact-language-detector-cld-data-source-configuration.html#ftnt_ref5" name="ftnt5">[5]</a><span style="font-size:10pt"> This is currently 160, corresponding to </span><span style="color:rgb(17,85,204);text-decoration:underline;font-size:10pt"><a href="https://code.google.com/p/cld2/source/detail?r=160" style="color:inherit;text-decoration:inherit">CLD2 revision 160</a></span></p></div><div style="font-family:Times New Roman;font-size:medium"><p style="font-size:11pt;margin:0px;font-family:Arial;direction:ltr;line-height:1;text-align:justify"><a href="compact-language-detector-cld-data-source-configuration.html#ftnt_ref6" name="ftnt6">[6]</a><span style="font-size:10pt"> For more information on the CRX format see </span><span style="color:rgb(17,85,204);text-decoration:underline;font-size:10pt"><a href="https://developer.chrome.com/extensions/crx" style="color:inherit;text-decoration:inherit">CRX Package Format</a></span></p></div><div style="font-family:Times New Roman;font-size:medium"><p style="font-size:11pt;margin:0px;font-family:Arial;direction:ltr;line-height:1;text-align:justify"><a href="compact-language-detector-cld-data-source-configuration.html#ftnt_ref7" name="ftnt7">[7]</a><span style="font-size:10pt"> The size of the CLD data file is approximately 1.4 megabytes uncompressed or 1.1 megabytes when compressed using “zip -9”</span></p></div><div style="font-family:Times New Roman;font-size:medium"><p style="font-size:11pt;margin:0px;font-family:Arial;direction:ltr;line-height:1;text-align:justify"><a href="compact-language-detector-cld-data-source-configuration.html#ftnt_ref8" name="ftnt8">[8]</a><span style="font-size:10pt"> The exact amount of savings will depend upon the distribution’s update mechanism. With the “static” configuration, the 1.4 megabytes of raw data exists as an RODATA section in the binary; how a given distribution packages its updates will determine how much of a savings can be achieved when this data is pulled out.</span></p></div><div style="font-family:Times New Roman;font-size:medium"><p style="font-size:11pt;margin:0px;font-family:Arial;direction:ltr;line-height:1;text-align:justify"><a href="compact-language-detector-cld-data-source-configuration.html#ftnt_ref9" name="ftnt9">[9]</a><span style="font-size:10pt"> Of course, the “static” implementation does not use IPC and simply consists of no-ops.</span></p></div><div style="font-family:Times New Roman;font-size:medium"><p style="font-size:11pt;margin:0px;font-family:Arial;direction:ltr;line-height:1;text-align:justify"><a href="compact-language-detector-cld-data-source-configuration.html#ftnt_ref10" name="ftnt10">[10]</a><span style="font-size:10pt"> You can find the test data under </span><span style="color:rgb(17,85,204);text-decoration:underline;font-size:10pt"><a href="https://code.google.com/p/chromium/codesearch#chromium/src/chrome/test/data/cld2_component/" style="color:inherit;text-decoration:inherit">chrome/test/data/cld2_component</a></span><span style="font-size:10pt">.</span></p></div><div style="font-family:Times New Roman;font-size:medium"><p style="font-size:11pt;margin:0px;font-family:Arial;direction:ltr;line-height:1;text-align:justify"><a href="compact-language-detector-cld-data-source-configuration.html#ftnt_ref11" name="ftnt11">[11]</a><span style="font-size:10pt"> See </span><span style="color:rgb(17,85,204);text-decoration:underline;font-size:10pt"><a href="https://code.google.com/p/chromium/codesearch#chromium/src/components/translate.gypi" style="color:inherit;text-decoration:inherit">components/translate.gypi</a></span><span style="font-size:10pt"> for examples</span></p></div><div style="font-family:Times New Roman;font-size:medium"><p style="font-size:11pt;margin:0px;font-family:Arial;direction:ltr;line-height:1;text-align:justify"><a href="compact-language-detector-cld-data-source-configuration.html#ftnt_ref12" name="ftnt12">[12]</a><span style="font-size:10pt"> See </span><span style="color:rgb(17,85,204);text-decoration:underline;font-size:10pt"><a href="https://code.google.com/p/chromium/codesearch#chromium/src/chrome/chrome_tests.gypi" style="color:inherit;text-decoration:inherit">chrome/chrome_tests.gypi</a></span><span style="font-size:10pt"> for examples</span></p></div></div></div></div></td></tr></tbody></table>
</div> 
</div> 
<div id="sites-canvas-bottom-panel">
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_page-subpages"> </div>
<div id="sites-attachments-container">
</div>
<a xmlns="http://www.w3.org/1999/xhtml" name="page-comments"></a>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_page-comments"><div class="sites-comment-docos-wrapper"><div class="sites-comment-docos"><div class="sites-comment-docos-background"></div><div class="sites-comment-docos-header"><div class="sites-comment-docos-header-title">Comments</div></div><div id="sites-comment-docos-pane" class="sites-comment-docos-pane"></div></div></div></div>
</div>
</div> 
</td> 
</tr>
</table> 
</div> 
</div> 
<div id="sites-chrome-footer-wrapper">
<div id="sites-chrome-footer-wrapper-inside">
<div id="sites-chrome-footer">
</div>
</div>
</div>
</div> 
</div> 
<div id="sites-chrome-adminfooter-container">
<div xmlns="http://www.w3.org/1999/xhtml" class="sites-adminfooter" role="navigation"><p><a class="sites-system-link" href="https://www.google.com/a/UniversalLogin?service=jotspot&amp;continue=https://sites.google.com/a/chromium.org/dev/developers/how-tos/compact-language-detector-cld-data-source-configuration">Sign in</a><span aria-hidden="true">|</span><a class="sites-system-link" href="../../system/app/pages/recentChanges.html">Recent Site Activity</a><span aria-hidden="true">|</span><a class="sites-system-link" href="../../system/app/pages/reportAbuse.html" target="_blank">Report Abuse</a><span aria-hidden="true">|</span><a class="sites-system-link" href="javascript:;" onclick="window.open(webspace.printUrl)">Print Page</a><span aria-hidden="true">|</span><span class="sites-system-link">Powered By</span> <b class="powered-by"><a href="http://sites.google.com">Google Sites</a></b></p></div>
</div>
</div> 
</div> 
<div id="sites-chrome-onebar-footer">
</div>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    window.jstiming.load.tick('sjl');
  </script>
<script xmlns="http://www.w3.org/1999/xhtml" src="https://ssl.gstatic.com/sites/p/56e332/system/js/jot_min_view__en.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    window.jstiming.load.tick('jl');
  </script>
<script xmlns="http://www.w3.org/1999/xhtml">
      
          sites.core.Analytics.createTracker();
          sites.core.Analytics.trackPageview();
        
    </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
                    sites.Searchbox.initialize(
                        'sites-searchbox-search-button',
                        {"object":[]}['object'],
                        'search-site',
                        {"label":"Configure search options...","url":"/system/app/pages/admin/settings"});
                  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
      gsites.HoverPopupMenu.createSiteDropdownMenus('sites-header-nav-dropdown', false);
    </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
            JOT_setupNav("7648876402527094", "Navigation", false);
            JOT_addListener('titleChange', 'JOT_NAVIGATION_titleChange', 'COMP_7648876402527094');
          </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
            JOT_setupNav("14720868319272995", "Quick links", false);
            JOT_addListener('titleChange', 'JOT_NAVIGATION_titleChange', 'COMP_14720868319272995');
          </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
            JOT_setupNav("19690813310444355", "Other sites", false);
            JOT_addListener('titleChange', 'JOT_NAVIGATION_titleChange', 'COMP_19690813310444355');
          </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
              new sites.CommentPane('//docs.google.com/comments/d/AAHRpnXvrAwjAfmld0ObrebBiGRq9IBHhLhohN3VISDaTf-AfXZ51gHNvJSyXZnEoDdER_03K6SXDLe-1EtMKgINm05EVqcjsf9AxrNBclumZsEI78fEK0ze6akV82RikH0r3N3Olxz9k/api/js?anon=true',
                  false, false);
            </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
  setTimeout(function() {
    var fingerprint = gsites.date.TimeZone.getFingerprint([]);
    gsites.Xhr.send('https://www.chromium.org/_/tz', null, null, 'GET', null, null, { afjstz: fingerprint });
  }, 500);
</script>
<script xmlns="http://www.w3.org/1999/xhtml">
                    window.onload = function() {
                      if (false) {
                        JOT_setMobilePreview();
                      }
                      var loadTimer = window.jstiming.load;
                      loadTimer.tick("ol");
                      loadTimer["name"] = "load," + webspace.page.type + ",user_page";
                      window.jstiming.report(loadTimer, {}, 'https://gg.google.com/csi');
                    }
                  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
        JOT_insertAnalyticsCode(false,
            false);
      </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    var maestroRunner = new gsites.pages.view.SitesMaestroRunner(
        webspace, "en");
    maestroRunner.initListeners();
    maestroRunner.installEditRender();
  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
  //<![CDATA[
    // Decorate any fastUI buttons on the page with a class of 'goog-button'.
    if (webspace.user.hasWriteAccess) {
      JOT_decorateButtons();
    }

    // Fires delayed events.
    (function() {
      JOT_fullyLoaded = true;
      var delayedEvents = JOT_delayedEvents;
      for (var x = 0; x < delayedEvents.length; x++) {
        var event = delayedEvents[x];
        JOT_postEvent(event.eventName, event.eventSrc, event.payload);
      }
      JOT_delayedEvents = null;
      JOT_postEvent('pageLoaded');
    })();
  //]]>
</script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    JOT_postEvent('decorateGvizCharts');
  </script>
<script type="text/javascript">
          JOT_setupPostRenderingManager();
        </script>
<script type="text/javascript">
          JOT_postEvent('renderPlus', null, 'sites-chrome-main');
        </script>
<div id="server-timer-div" style="display:none"> </div>
<script type="text/javascript">
          window.jstiming.load.tick('render');
          JOT_postEvent('usercontentrendered', this);
        </script>
</body>
</html>
