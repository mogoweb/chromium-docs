<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/WebPage">
<head>
<meta http-equiv="X-UA-Compatible" content="chrome=1" />
<script type="text/javascript">/* Copyright 2008 Google. */ (function() { var e="wtsrt_",g="tbsd_",h="tbnd_",k="start",l="_wtsrt",m="_tbnd",n="CSI/";(function(){function f(a){this.t={};this.tick=function(a,c,b){this.t[a]=[void 0!=b?b:(new Date).getTime(),c];if(void 0==b)try{window.console.timeStamp(n+a)}catch(d){}};this.tick(k,null,a)}var a;window.performance&&(a=window.performance.timing);var p=a?new f(a.responseStart):new f;window.jstiming={Timer:f,load:p};if(a){var c=a.navigationStart,d=a.responseStart;0<c&&d>=c&&(window.jstiming.srt=d-c)}if(a){var b=window.jstiming.load;0<c&&d>=c&&(b.tick(l,void 0,c),b.tick(e,l,d),b.tick(g,e))}try{a=null,
window.chrome&&window.chrome.csi&&(a=Math.floor(window.chrome.csi().pageT),b&&0<c&&(b.tick(m,void 0,window.chrome.csi().startE),b.tick(h,m,c))),null==a&&window.gtbExternal&&(a=window.gtbExternal.pageT()),null==a&&window.external&&(a=window.external.pageT,b&&0<c&&(b.tick(m,void 0,window.external.startE),b.tick(h,m,c))),a&&(window.jstiming.pt=a)}catch(q){}})(); })()
</script>
<link rel="shortcut icon" href="/_/rsrc/1354323194313/favicon.ico" type="image/x-icon" />
<link rel="apple-touch-icon" href="https://ssl.gstatic.com/sites/p/56e332/system/app/images/apple-touch-icon.png" type="image/png" />
<script type="text/javascript">/* Copyright 2008 Google. */ (function() { var d="",g="__duration__",h="function";function k(c){return document.getElementById(c)}window.byId=k;function l(c){return c.replace(/^\s+|\s+$/g,d)}window.trim=l;var m=[],n=0;window.JOT_addListener=function(c,a,b){var e=new String(n++);c={eventName:c,handler:a,compId:b,key:e};m.push(c);return e};window.JOT_removeListenerByKey=function(c){for(var a=0;a<m.length;a++)if(m[a].key==c){m.splice(a,1);break}};
window.JOT_removeAllListenersForName=function(c){for(var a=0;a<m.length;a++)m[a].eventName==c&&m.splice(a,1)};window.JOT_postEvent=function(c,a,b){var e={eventName:c,eventSrc:a||{},payload:b||{}};if(window.JOT_fullyLoaded)for(a=m.length,b=0;b<a&&b<m.length;b++){var f=m[b];f&&f.eventName==c&&(e.listenerCompId=f.compId||d,(f=typeof f.handler==h?f.handler:window[f.handler])&&f(e))}else window.JOT_delayedEvents.push({eventName:c,eventSrc:a,payload:b})};window.JOT_delayedEvents=[];
window.JOT_fullyLoaded=!1;window.JOT_formatRelativeToNow=function(c,a){var b=((new Date).getTime()-c)/6E4;if(1440<=b||0>b)return null;var e=0;60<=b&&(b/=60,e=2);2<=b&&e++;return a?window.JOT_siteRelTimeStrs[e].replace(g,Math.floor(b)):window.JOT_userRelTimeStrs[e].replace(g,Math.floor(b))}; })()
</script>
<script>

  

  var breadcrumbs = [{"path":"/developers","deleted":false,"title":"For Developers","dir":"ltr"},{"path":"/developers/cpp-in-chromium-101-codelab","deleted":false,"title":"C++ in Chromium 101 - Codelab","dir":"ltr"}];
  var JOT_clearDotPath = 'https://ssl.gstatic.com/sites/p/56e332/system/app/images/cleardot.gif';

  
  var JOT_userRelTimeStrs = ["a minute ago","__duration__ minutes ago","an hour ago","__duration__ hours ago"];

  
  

  

  var webspace = {"enableAnalytics":true,"pageSharingId":"jotspot_page","enableUniversalAnalytics":false,"sharingPolicy":"OPENED_WITH_INDICATOR","siteTitle":"The Chromium Projects","isStartPageEnabled":true,"adsensePublisherId":null,"features":{"languageSelectDefaultTextSetToDefault":true,"validateClientGvizDataSourceUrls":true,"moreMobileStyleImprovements":true,"newInsertMenuIcons":true,"accessibleSortingButtons":true,"domainAnalyticsInGAOnly":true,"noCaptcha":true,"fileCabinetScreenReaderFix":true,"updatedTosAndPrivacyLinks":null,"pageDrafts":false,"mobileOrientationFix":true,"plusBadge":false,"pdfEmbedSupport":false,"jsClickFix":true},"isPublic":true,"isConsumer":false,"serverFlags":{"cajaBaseUrl":"//www.gstatic.com/caja","cajaDebugMode":false},"onepickBaseUrl":"https://docs.google.com","domainAnalyticsAccountId":"","plusPageId":"","signInUrl":"https://www.google.com/a/SelectSession?continue\u003dhttps://sites.google.com/a/chromium.org/dev/developers/cpp-in-chromium-101-codelab\u0026service\u003djotspot","analyticsAccountId":"UA-5484340-1","scottyUrl":"/_/upload","homePath":"/","siteNoticeUrlEnabled":null,"plusPageUrl":"","adsensePromoClickedOrSiteIneligible":true,"csiReportUri":"https://gg.google.com/csi","sharingId":"jotspot","termsUrl":"//www.google.com/intl/en/policies/terms/","gvizVersion":1,"editorResources":{"sitelayout":["https://ssl.gstatic.com/sites/p/56e332/system/app/css/sitelayouteditor.css"],"text":["https://ssl.gstatic.com/sites/p/56e332/system/js/codemirror.js","https://ssl.gstatic.com/sites/p/56e332/system/app/css/codemirror_css.css","https://ssl.gstatic.com/sites/p/56e332/system/js/trog_edit__en.js","https://ssl.gstatic.com/sites/p/56e332/system/app/css/trogedit.css","/_/rsrc/1441580320000/system/app/css/editor.css","https://ssl.gstatic.com/sites/p/56e332/system/app/css/codeeditor.css","/_/rsrc/1441580320000/system/app/css/camelot/editor-jfk-wlb.css"]},"sharingUrlPrefix":"/_/sharing","isAdsenseEnabled":true,"domain":"chromium.org","baseUri":"","name":"dev","siteTemplateId":false,"siteNoticeRevision":null,"siteNoticeUrlAddress":null,"siteNoticeMessage":null,"page":{"isRtlLocale":false,"canDeleteWebspace":null,"isPageDraft":null,"parentPath":"/developers","parentWuid":"wuid:gx:982466121d9f2cd","siteLocale":"en","timeZone":"America/Los_Angeles","type":"text","title":"C++ in Chromium 101 - Codelab","locale":"en","wuid":"wuid:gx:13380b3c6bc98404","revision":27,"path":"/developers/cpp-in-chromium-101-codelab","isSiteRtlLocale":false,"pageInheritsPermissions":null,"name":"cpp-in-chromium-101-codelab","canChangePath":true,"state":"","properties":{},"bidiEnabled":false,"currentTemplate":{"path":"/system/app/pagetemplates/text","title":"Web Page"}},"canPublishScriptToAnyone":true,"user":{"keyboardShortcuts":true,"sessionIndex":"","guest_":true,"displayNameOrEmail":"guest","userName":"guest","uid":"","renderMobile":false,"domain":"","namespace":"","hasWriteAccess":false,"namespaceUser":false,"primaryEmail":"guest","hasAdminAccess":false},"gadgets":{"baseUri":"/system/app/pages/gadgets"}};
  webspace.page.breadcrumbs = breadcrumbs;

  
  var JOT_siteRelTimeStrs = ["a minute ago","__duration__ minutes ago","an hour ago","__duration__ hours ago"];

</script>
<script type="text/javascript">
                window.jstiming.load.tick('scl');
              </script>
<meta name="title" content="C++ in Chromium 101 - Codelab - The Chromium Projects" />
<meta itemprop="name" content="C++ in Chromium 101 - Codelab - The Chromium Projects" />
<meta property="og:title" content="C++ in Chromium 101 - Codelab - The Chromium Projects" />
<meta name="description" content="Home of the Chromium Open Source Project" />
<meta itemprop="description" content="Home of the Chromium Open Source Project" />
<meta id="meta-tag-description" property="og:description" content="Home of the Chromium Open Source Project" />
<style type="text/css">
</style>
<link rel="stylesheet" type="text/css" href="https://ssl.gstatic.com/sites/p/56e332/system/app/themes/beigeandblue/standard-css-beigeandblue-ltr-ltr.css" />
<link rel="stylesheet" type="text/css" href="/_/rsrc/1441580320000/system/app/css/overlay.css?cb=beigeandblueundefineda100%25%25150goog-ws-leftthemedefaultstandard" />
<link rel="stylesheet" type="text/css" href="/_/rsrc/1441580320000/system/app/css/camelot/allthemes-view.css" />
<!--[if IE]>
          <link rel="stylesheet" type="text/css" href="/system/app/css/camelot/allthemes%2die.css" />
        <![endif]-->
<title>C++ in Chromium 101 - Codelab - The Chromium Projects</title>
<meta itemprop="image" content="/_/rsrc/1438879449147/config/customLogo.gif?revision=3" />
<meta property="og:image" content="/_/rsrc/1438879449147/config/customLogo.gif?revision=3" />
<script type="text/javascript">
                window.jstiming.load.tick('cl');
              </script>
</head>
<body xmlns="http://www.google.com/ns/jotspot" id="body" class=" en            ">
<div id="sites-page-toolbar" class="sites-header-divider">
<div xmlns="http://www.w3.org/1999/xhtml" id="sites-status" class="sites-status" style="display:none;"><div id="sites-notice" class="sites-notice" role="status" aria-live="assertive"> </div></div>
</div>
<div id="sites-chrome-everything-scrollbar">
<div id="sites-chrome-everything" class="">
<div id="sites-chrome-page-wrapper" style="direction: ltr">
<div id="sites-chrome-page-wrapper-inside">
<div xmlns="http://www.w3.org/1999/xhtml" id="sites-chrome-header-wrapper" style="height:auto;">
<table id="sites-chrome-header" class="sites-layout-hbox" cellspacing="0" style="height:auto;">
<tr class="sites-header-primary-row" id="sites-chrome-userheader">
<td id="sites-header-title" class="" role="banner"><div class="sites-header-cell-buffer-wrapper"><a href="https://www.chromium.org/" id="sites-chrome-userheader-logo"><img id="logo-img-id" src="/_/rsrc/1438879449147/config/customLogo.gif?revision=3" alt="The Chromium Projects" class="sites-logo  " /></a><h2><a href="https://www.chromium.org/" dir="ltr" id="sites-chrome-userheader-title">The Chromium Projects</a></h2></div></td><td class="sites-layout-searchbox  "><div class="sites-header-cell-buffer-wrapper"><form id="sites-searchbox-form" action="/system/app/pages/search" role="search"><input type="hidden" id="sites-searchbox-scope" name="scope" value="search-site" /><input type="text" id="jot-ui-searchInput" name="q" size="20" value="" aria-label="Search this site" /><div id="sites-searchbox-button-set" class="goog-inline-block"><div role="button" id="sites-searchbox-search-button" class="goog-inline-block jfk-button jfk-button-standard" tabindex="0">Search this site</div></div></form></div></td>
</tr>
<tr class="sites-header-secondary-row" id="sites-chrome-horizontal-nav">
<td colspan="2" id="sites-chrome-header-horizontal-nav-container" role="navigation">
</td>
</tr>
</table>
</div>
<div id="sites-chrome-main-wrapper">
<div id="sites-chrome-main-wrapper-inside">
<table id="sites-chrome-main" class="sites-layout-hbox" cellspacing="0" cellpadding="{scmCellpadding}" border="0">
<tr>
<td id="sites-chrome-sidebar-left" class="sites-layout-sidebar-left initial" style="width:150px">
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_7648876402527094" class="sites-embed" role="navigation"><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotId="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="/chromium-projects" jotId="wuid:gx:10ae433dadbbab13" class="sites-navigation-link">Home</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="/Home" jotId="wuid:gx:43582b9d2029d3af" class="sites-navigation-link">Chromium</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="/chromium-os" jotId="wuid:gx:83df2ab1f8880ba" class="sites-navigation-link">Chromium OS</a></div></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_14720868319272995" class="sites-embed" role="navigation"><h4 class="sites-embed-title">Quick links</h4><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotId="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="http://www.chromium.org/for-testers/bug-reporting-guidelines" class="sites-navigation-link">Report bugs</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="http://www.chromium.org/developers/discussion-groups" class="sites-navigation-link">Discuss</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="/system/app/pages/sitemap/hierarchy" jotId="wuid:gx:4b58a9a350ad12f" class="sites-navigation-link">网站地图</a></div></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_19690813310444355" class="sites-embed" role="navigation"><h4 class="sites-embed-title">Other sites</h4><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotId="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="http://blog.chromium.org/" class="sites-navigation-link">Chromium Blog</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="http://code.google.com/chrome/extensions/" class="sites-navigation-link">Google Chrome Extensions</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="https://developers.google.com/chrome/chrome-frame/" class="sites-navigation-link">Google Chrome Frame</a></div></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_19695218559354544" class="sites-embed" role="complementary"><h4 class="sites-embed-title"></h4><div class="sites-embed-content sites-embed-content-sidebar-textbox"><div dir="ltr"><span style="font-size:x-small">Except as otherwise </span><a href="http://developers.google.com/site-policies.html#restrictions"><span style="font-size:x-small">noted</span></a><span style="font-size:x-small">, the content of this page is licensed under a </span><a href="http://creativecommons.org/licenses/by/2.5/"><span style="font-size:x-small">Creative Commons Attribution 2.5 license</span></a><span style="font-size:x-small">, and examples are licensed under the </span><a href="http://src.chromium.org/viewvc/chrome/trunk/src/LICENSE" target="_blank"><span style="font-size:x-small">BSD License</span></a><span style="font-size:x-small">.<br /></span></div></div></div>
</td>
<td id="sites-canvas-wrapper">
<div id="sites-canvas" role="main">
<div id="goog-ws-editor-toolbar-container"> </div>
<div xmlns="http://www.w3.org/1999/xhtml" id="title-crumbs" style="">
<A href="/developers" dir="ltr">For Developers</A>‎ &gt; ‎
  </div>
<h3 xmlns="http://www.w3.org/1999/xhtml" id="sites-page-title-header" style="" align="left">
<span id="sites-page-title" dir="ltr" tabindex="-1" style="outline: none">C++ in Chromium 101 - Codelab</span>
</h3>
<div id="sites-canvas-main" class="sites-canvas-main">
<div id="sites-canvas-main-content">
<table xmlns="http://www.w3.org/1999/xhtml" cellspacing="0" class="sites-layout-name-one-column sites-layout-hbox"><tbody><tr><td class="sites-layout-tile sites-tile-name-content-1"><div dir="ltr"><font face="arial, sans-serif" size="2">This tutorial will guide you through the creation of various example C++ applications, highlighting important Chromium C++ concepts. This tutorial assumes robust knowledge of C++ (the language) but does not assume you know how to write an application specific to Chromium's style and architecture. This tutorial does assume that you know how to check files out of Chromium's repository.</font><div><font face="arial, sans-serif" size="2"><br /></font></div><div><font face="arial, sans-serif" size="2">As always, consider the following resources as of primary importance:</font></div><div><ul><li><a href="https://www.chromium.org/developers/coding-style"><font face="arial, sans-serif" size="2">Coding Style</font></a></li><li><a href="https://www.chromium.org/developers/coding-style/important-abstractions-and-data-structures"><font face="arial, sans-serif" size="2">Important Abstractions and Data Structures</font></a></li></ul><div><p style="margin:0px;padding:0px 10px 10px 0px;color:rgb(8,36,58)"><font face="arial, sans-serif" size="2">This tutorial does not assume you have read any of the above, though you should feel free to peruse them when necessary. This tutorial will cover information across all of those guides.</font></p><h2><a name="TOC-Exercise-0:-Hello-World-"></a>Exercise 0: "Hello World!"</h2><p>This exercise demonstrates the use of the <a href="http://martine.github.io/ninja/">ninja</a> build system to build a simple C++ binary and demonstrates how typical C++ builds are organized within Chromium.</p><p>Create a new target in <code>base.gyp</code> for a new executable named <code>hello_world</code>. Then write the classic "Hello World!" program in C++. You should be able to build it with <code>ninja -C out/Debug hello_world</code> and execute it directly by finding the binary within <code>out/Debug</code>.</p><p>Sample execution:</p></div><div></div><div class="sites-codeblock sites-codesnippet-block"><div><span style="font-size:10pt"><code>$ cd /path/to/chromium/src</code></span></div><div><font color="#006000" face="monospace">$ gclient runhooks</font></div><div><span style="font-size:10pt"><code>$ ninja -C out/Debug hello_world</code></span></div><div><span style="font-size:10pt"><code>$ out/Debug/hello_world</code></span></div><div><span style="font-size:10pt"><code>Hello World!</code></span></div></div><div><br /><a href="https://codereview.chromium.org/23567011/">Exercise solution</a></div><div>AMI: might be confusing how rietveld shows the new file as a copy/diff against an unrelated file.</div></div><div>AMI: output doesn't actually match what's in the solution.  Might be confusing.</div><div><h3><a name="TOC-More-information"></a>More information</h3><div><a href="https://code.google.com/p/chromium/wiki/UsingGit">https://code.google.com/p/chromium/wiki/UsingGit</a></div></div><div><a href="https://docs.google.com/a/google.com/presentation/d/1abnqM9j6zFodPHA38JG1061rG2iGj_GABxEDgZsdbJg/">Life of a Chromium Developer</a></div><h2><a name="TOC-Part-1:-Using-command-line-arguments"></a>Part 1: Using command-line arguments</h2><p>We will augment our <code>hello_world</code> binary to parse command-line flags and use those values to print messages to the user.</p>Command-line arguments within Chromium are processed by the CommandLine::Init() function, which takes command line flags from the <a href="http://crasseux.com/books/ctutorial/argc-and-argv.html">argc and argv</a> (argument count &amp; vector) variables of the main() method. A typical invocation of CommandLine::Init() looks like the following:<div><br /></div><div><div class="sites-codeblock sites-codesnippet-block"><code>int main(int argc, char** argv) {</code><br /><code>  CommandLine::Init(argc, argv);</code><br /><code>  // Main program execution ...</code><br /><code>  return 0;</code><br /><code>}</code></div><br />Flags are not explicitly defined in Chromium. Instead, we use <code>GetSwitchValueAsASCII()</code> and friends to retrieve values passed in.<br /></div><div><h3><a name="TOC-Important-include-files"></a>Important include files</h3><div class="sites-codeblock sites-codesnippet-block"><code>#include "<a href="https://code.google.com/p/chromium/codesearch#chromium/src/base/command_line.h&amp;q=f:base/command_line.h&amp;sq=package:chromium&amp;type=cs&amp;l=1">base/command_line.h</a>"</code></div></div><div><h3><a name="TOC-Exercise-1:-Using-command-line-arguments"></a>Exercise 1: Using command-line arguments</h3><p>Change <code>hello_world</code> to take a <code>--greeting</code> and a <code>--name</code> switch.  The greeting, if not specified, should default to "Hello", and the name, if not specified, should default to "World".</p><a href="https://codereview.chromium.org/23455025/">Exercise solution</a><div><div><h2><a name="TOC-Part-2:-Callbacks-and-Bind"></a>Part 2: Callbacks and Bind</h2><p><font size="2"><span style="font-family:Arial,Helvetica,sans-serif">C++, unlike other languages such as Python, Javascript, or Lisp, has only rudimentary support for </span><a href="http://en.wikipedia.org/wiki/Callbacks" style="font-family:Arial,Helvetica,sans-serif">callbacks</a> and no support for <a href="https://en.wikipedia.org/wiki/Partial_application">partial application</a><span style="font-family:Arial,Helvetica,sans-serif">. However, Chromium has </span></font>the <code>base::Callback&lt;Sig&gt;</code> c<font size="2"><span style="font-family:Arial,Helvetica,sans-serif">lass, whose instances can be freely passed around, returned, and generally be treated as first-class values.</span></font></p><p><font size="2"><span style="font-family:Arial,Helvetica,sans-serif">AMI: last sentence might benefit from a pointer to refcounting (without which it might be less clear how binding works with copying of bound closures).</span></font></p><p>The <code>Sig</code> template parameter is a function signature type:</p></div></div><div class="sites-codeblock sites-codesnippet-block"><code>// The type of a callback that takes no arguments and does not return anything.</code><br /><code>// base::Closure is a typedef of this type.</code><br /><code>base::Callback&lt;void(void)&gt;</code><br /><br /><br /><code>// The type of a callback that takes two arguments (a string and a double)</code><br /><code>// and returns an int.</code><br /><code>base::Callback&lt;int(std::string, double)&gt;</code></div><p>Callbacks are executed by invoking the <code>Run()</code> member function:</p><div class="sites-codeblock sites-codesnippet-block"><code>void my_function(const base::Callback&lt;int(std::string, double)&gt;&amp; my_callback) {</code><br /><code>  ...</code><br /><code>  int result1 = my_callback.Run("my string 1", 1.0);</code><br /><code>  // Run() can be called as many times as you wish.</code><br /><code>  int result2 = my_callback.Run("my string 2", 2);</code><br /><code>  ...</code><br /><code>}</code></div><p><span style="background-color:transparent;font-size:10pt">Callbacks are constructed using the </span><code style="background-color:transparent;font-size:10pt">base::Bind()</code><span style="background-color:transparent;font-size:10pt"> function, which handles partial application:</span></p><div><div class="sites-codeblock sites-codesnippet-block"><code>// Declare a function.</code><br /><code>void my_function(int32 a, double b);</code><br /><br /><code>base::Callback&lt;void(double)&gt; my_callback = base::Bind(&amp;my_function, 10);</code><br /><br /><br /><code>// Equivalent to:</code><br /><code>//</code><br /><code>// my_function(10, 3.5);</code><br /><code>//</code><br /><code>my_callback.Run(3.5);</code></div><p><code>base::Bind()</code> can do a lot more, including binding class member functions and binding additional arguments to an existing <code>base::Callback</code>. See the comments in <code>base/callback.h</code> and <code>base/bind.h</code> for details.</p><h3><a name="TOC-Important-Include-Files"></a>Important Include Files</h3><div class="sites-codeblock sites-codesnippet-block"><code>#include "<a href="https://code.google.com/p/chromium/codesearch#chromium/src/base/bind.h&amp;q=f:/base/bind.h&amp;sq=package:chromium&amp;type=cs">base/bind.h</a>"</code><br /><code>#include "<a href="https://code.google.com/p/chromium/codesearch#chromium/src/base/callback.h&amp;q=f:base/callback.h&amp;sq=package:chromium&amp;type=cs">base/callback.h</a>"</code></div><h3><a name="TOC-Exercise-2:-Fibonacci-closures"></a>Exercise 2: Fibonacci closures</h3><p>Implement a function that returns a callback that takes no arguments and returns successive Fibonacci numbers. That is, a function that can be used like this:</p><div class="sites-codeblock sites-codesnippet-block"><code>base::Callback&lt;int()&gt; fibonacci_closure = MakeFibonacciClosure();</code><br /><code>printf("%d\n", fibonacci_closure.Run());  // Prints "1"</code><br /><code>printf("%d\n", fibonacci_closure.Run());  // Prints "1"</code><br /><code>printf("%d\n", fibonacci_closure.Run());  // Prints "2"</code><br /><code>...</code><br /></div><br />Each returned Fibonacci callback should be independent; running one callback shouldn't affect the result of running another callback. Write a <code>fibonacci</code> executable that takes an integer argument <code>n</code> and uses your function to print out the first <code>n</code> Fibonacci numbers.<br /><br />(This exercise was inspired by <a href="http://tour.golang.org/#45">this Go exercise: Function closures</a>.)<br /><br /><a href="https://codereview.chromium.org/23702018/">Exercise solution</a><div><h2><a name="TOC-Part-3:-Message-loops"></a>Part 3: Message loops</h2><div>Chromium's abstraction for event loops is <code>base::MessageLoop</code>. <code>base::MessageLoop</code> handles running tasks (which are instances of <code>base::Closure</code>) on the current thread. Given a pointer to the message loop for a thread, you can post tasks on it with <code>base::MessageLoop::PostTask</code> (or <code>base::MessageLoop::PostDelayedTask</code> if you want to add a delay).</div><div><br /></div><div>Normally you wouldn't have to worry about setting up a <code>base::MessageLoop</code> and keeping it running, since that is automatically done by Chromium's thread classes. However, since the main thread doesn't automatically start off with a <code>base::MessageLoop</code>, you have to create, pump, and shutdown one yourself if you're writing a new executable. The <code>base::RunLoop</code> class is the current recommended way of doing that.</div><div><div><h3><a name="TOC-Important-header-files"></a>Important header files</h3></div><div><div class="sites-codeblock sites-codesnippet-block"><code>#include "<a href="https://code.google.com/p/chromium/codesearch#chromium/src/base/message_loop/message_loop.h&amp;q=f:/message_loop.h&amp;sq=package:chromium&amp;type=cs">base/message_loop/message_loop.h</a>"<br />#include "<a href="https://code.google.com/p/chromium/codesearch#chromium/src/base/run_loop.h&amp;q=f:base/run_loop.h&amp;sq=package:chromium&amp;type=cs&amp;l=1">base/run_loop.h</a>"</code></div></div></div><h3><a name="TOC-Exercise-3:-Sleep"></a>Exercise 3: Sleep</h3><p><span style="font-size:10pt">Implement the Unix command-line utility <code>sleep</code> using only a <code><a href="https://code.google.com/p/chromium/codesearch#chromium/src/base/message_loop/message_loop.h&amp;l=96">base::MessageLoop</a></code> (i.e., without using the <code>sleep</code> function or <code>base::PlatformThread::Sleep</code>).</span></p><p><a href="https://codereview.chromium.org/23506012/" style="font-family:arial,sans-serif;font-size:small">Exercise solution</a></p><h2><a name="TOC-Part-4:-Threads-and-task-runners"></a>Part 4: Threads and task runners</h2><div><div><p>Chromium's platform-independent abstraction for threads is <code><a href="https://code.google.com/p/chromium/codesearch#chromium/src/base/threading/thread.h&amp;sq=package:chromium&amp;type=cs">base::Thread</a></code>. Once you call <code>base::Thread::Start()</code> (and it succeeds), you can post tasks on its message loop.</p><p>Chromium's abstraction for asynchronously running posted tasks is <code>base::TaskRunner</code>. You can get a <code>base::TaskRunner</code> for various things, including threads, message loops, and thread pools. <code>base::TaskRunner</code> allows you to write code that posts tasks without depending on what exactly will run those tasks.</p><p>An important member function of <code>base::TaskRunner</code> is <code>base::TaskRunner::PostTaskAndReply</code>. <code>PostTaskAndReply</code> lets you post a task to a <code>base::TaskRunner</code> which will post a task back to your current thread when its done. This sounds simple, but it's quite tricky to do this in a correct, thread-safe manner!</p><h3><a name="TOC-Important-header-files1"></a>Important header files</h3></div><div><div class="sites-codeblock sites-codesnippet-block"><code>#include "<a href="https://code.google.com/p/chromium/codesearch#chromium/src/base/task_runner.h&amp;q=f:base/task_runner.h&amp;sq=package:chromium&amp;type=cs&amp;l=1">base/task_runner.h</a>"<br />#include "<a href="https://code.google.com/p/chromium/codesearch#chromium/src/base/threading/thread.h&amp;sq=package:chromium&amp;type=cs">base/threading/thread.h</a>"</code></div></div><h3><a name="TOC-More-information1"></a>More information</h3><div><a href="http://www.chromium.org/developers/design-documents/threading">http://www.chromium.org/developers/design-documents/threading</a></div><h3><a name="TOC-Exercise-4:-Integer-factorization"></a>Exercise 4: Integer factorization</h3><p><span style="font-size:10pt">Take the given (slow) function to find a non-trivial factor of a given integer:</span></p><div><div class="sites-codeblock sites-codesnippet-block"><code>bool FindNonTrivialFactor(int n, int* factor) {<br /></code><code>  // Really naive algorithm.<br /></code><code>  for (int i = 2; i &lt; n; ++i) {<br />    </code><code>if (n % i == 0) {<br />      </code><code>*factor = i;<br /></code><code>      return true;<br /></code><code>    }<br /></code><code>  }<br /></code><code>  return false;<br /></code><font color="#006000" face="monospace">}</font></div></div><p>Write a command-line utility <code>factor</code> that takes a number, spawns a thread to factor it in the background using <code>FindNonTrivialFactor</code>, and prints a status update on the main thread every second while the worker thread is busy.</p><p><a href="https://codereview.chromium.org/23591018/" style="font-family:arial,sans-serif;font-size:small">Exercise solution</a></p></div></div></div></div></div></td></tr></tbody></table>
</div> 
</div> 
<div id="sites-canvas-bottom-panel">
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_page-subpages"> </div>
<div id="sites-attachments-container">
</div>
<a xmlns="http://www.w3.org/1999/xhtml" name="page-comments"></a>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_page-comments"><div class="sites-comment-docos-wrapper"><div class="sites-comment-docos"><div class="sites-comment-docos-background"></div><div class="sites-comment-docos-header"><div class="sites-comment-docos-header-title">Comments</div></div><div id="sites-comment-docos-pane" class="sites-comment-docos-pane"></div></div></div></div>
</div>
</div> 
</td> 
</tr>
</table> 
</div> 
</div> 
<div id="sites-chrome-footer-wrapper">
<div id="sites-chrome-footer-wrapper-inside">
<div id="sites-chrome-footer">
</div>
</div>
</div>
</div> 
</div> 
<div id="sites-chrome-adminfooter-container">
<div xmlns="http://www.w3.org/1999/xhtml" class="sites-adminfooter" role="navigation"><p><a class="sites-system-link" href="https://www.google.com/a/UniversalLogin?service=jotspot&amp;continue=https://sites.google.com/a/chromium.org/dev/developers/cpp-in-chromium-101-codelab">Sign in</a><span aria-hidden="true">|</span><a class="sites-system-link" href="/system/app/pages/recentChanges">Recent Site Activity</a><span aria-hidden="true">|</span><a class="sites-system-link" href="/system/app/pages/reportAbuse" target="_blank">Report Abuse</a><span aria-hidden="true">|</span><a class="sites-system-link" href="javascript:;" onclick="window.open(webspace.printUrl)">Print Page</a><span aria-hidden="true">|</span><span class="sites-system-link">Powered By</span> <b class="powered-by"><a href="http://sites.google.com">Google Sites</a></b></p></div>
</div>
</div> 
</div> 
<div id="sites-chrome-onebar-footer">
</div>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    window.jstiming.load.tick('sjl');
  </script>
<script xmlns="http://www.w3.org/1999/xhtml" src="https://ssl.gstatic.com/sites/p/56e332/system/js/jot_min_view__en.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    window.jstiming.load.tick('jl');
  </script>
<script xmlns="http://www.w3.org/1999/xhtml">
      
          sites.core.Analytics.createTracker();
          sites.core.Analytics.trackPageview();
        
    </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
                    sites.Searchbox.initialize(
                        'sites-searchbox-search-button',
                        {"object":[]}['object'],
                        'search-site',
                        {"label":"Configure search options...","url":"/system/app/pages/admin/settings"});
                  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
      gsites.HoverPopupMenu.createSiteDropdownMenus('sites-header-nav-dropdown', false);
    </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
            JOT_setupNav("7648876402527094", "Navigation", false);
            JOT_addListener('titleChange', 'JOT_NAVIGATION_titleChange', 'COMP_7648876402527094');
          </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
            JOT_setupNav("14720868319272995", "Quick links", false);
            JOT_addListener('titleChange', 'JOT_NAVIGATION_titleChange', 'COMP_14720868319272995');
          </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
            JOT_setupNav("19690813310444355", "Other sites", false);
            JOT_addListener('titleChange', 'JOT_NAVIGATION_titleChange', 'COMP_19690813310444355');
          </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
              new sites.CommentPane('//docs.google.com/comments/d/AAHRpnXvrAwjAfmld0ObrebBiGRq9Y2UyYEajD-owk8vcuSpp_K1NqbLcK6kEjeSBMqq_UaPcgUQ8JXFet07JFuKn5sN4GpyP-Q_ybypk9f2Q8xlkktB50796Iklk6_Ke8R8MG8XM0dO4/api/js?anon=true',
                  false, false);
            </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
  setTimeout(function() {
    var fingerprint = gsites.date.TimeZone.getFingerprint([]);
    gsites.Xhr.send('https://www.chromium.org/_/tz', null, null, 'GET', null, null, { afjstz: fingerprint });
  }, 500);
</script>
<script xmlns="http://www.w3.org/1999/xhtml">
                    window.onload = function() {
                      if (false) {
                        JOT_setMobilePreview();
                      }
                      var loadTimer = window.jstiming.load;
                      loadTimer.tick("ol");
                      loadTimer["name"] = "load," + webspace.page.type + ",user_page";
                      window.jstiming.report(loadTimer, {}, 'https://gg.google.com/csi');
                    }
                  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
        JOT_insertAnalyticsCode(false,
            false);
      </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    var maestroRunner = new gsites.pages.view.SitesMaestroRunner(
        webspace, "en");
    maestroRunner.initListeners();
    maestroRunner.installEditRender();
  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
  //<![CDATA[
    // Decorate any fastUI buttons on the page with a class of 'goog-button'.
    if (webspace.user.hasWriteAccess) {
      JOT_decorateButtons();
    }

    // Fires delayed events.
    (function() {
      JOT_fullyLoaded = true;
      var delayedEvents = JOT_delayedEvents;
      for (var x = 0; x < delayedEvents.length; x++) {
        var event = delayedEvents[x];
        JOT_postEvent(event.eventName, event.eventSrc, event.payload);
      }
      JOT_delayedEvents = null;
      JOT_postEvent('pageLoaded');
    })();
  //]]>
</script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    JOT_postEvent('decorateGvizCharts');
  </script>
<script type="text/javascript">
          JOT_setupPostRenderingManager();
        </script>
<script type="text/javascript">
          JOT_postEvent('renderPlus', null, 'sites-chrome-main');
        </script>
<div id="server-timer-div" style="display:none"> </div>
<script type="text/javascript">
          window.jstiming.load.tick('render');
          JOT_postEvent('usercontentrendered', this);
        </script>
</body>
</html>
