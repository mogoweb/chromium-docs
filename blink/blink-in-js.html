<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/WebPage">
<head>
<meta http-equiv="X-UA-Compatible" content="chrome=1" />
<script type="text/javascript">/* Copyright 2008 Google. */ (function() { var e="wtsrt_",g="tbsd_",h="tbnd_",k="start",l="_wtsrt",m="_tbnd",n="CSI/";(function(){function f(a){this.t={};this.tick=function(a,c,b){this.t[a]=[void 0!=b?b:(new Date).getTime(),c];if(void 0==b)try{window.console.timeStamp(n+a)}catch(d){}};this.tick(k,null,a)}var a;window.performance&&(a=window.performance.timing);var p=a?new f(a.responseStart):new f;window.jstiming={Timer:f,load:p};if(a){var c=a.navigationStart,d=a.responseStart;0<c&&d>=c&&(window.jstiming.srt=d-c)}if(a){var b=window.jstiming.load;0<c&&d>=c&&(b.tick(l,void 0,c),b.tick(e,l,d),b.tick(g,e))}try{a=null,
window.chrome&&window.chrome.csi&&(a=Math.floor(window.chrome.csi().pageT),b&&0<c&&(b.tick(m,void 0,window.chrome.csi().startE),b.tick(h,m,c))),null==a&&window.gtbExternal&&(a=window.gtbExternal.pageT()),null==a&&window.external&&(a=window.external.pageT,b&&0<c&&(b.tick(m,void 0,window.external.startE),b.tick(h,m,c))),a&&(window.jstiming.pt=a)}catch(q){}})(); })()
</script>
<link rel="shortcut icon" href="../_/rsrc/1354323194313/favicon.ico" type="image/x-icon" />
<link rel="apple-touch-icon" href="https://ssl.gstatic.com/sites/p/56e332/system/app/images/apple-touch-icon.png" type="image/png" />
<script type="text/javascript">/* Copyright 2008 Google. */ (function() { var d="",g="__duration__",h="function";function k(c){return document.getElementById(c)}window.byId=k;function l(c){return c.replace(/^\s+|\s+$/g,d)}window.trim=l;var m=[],n=0;window.JOT_addListener=function(c,a,b){var e=new String(n++);c={eventName:c,handler:a,compId:b,key:e};m.push(c);return e};window.JOT_removeListenerByKey=function(c){for(var a=0;a<m.length;a++)if(m[a].key==c){m.splice(a,1);break}};
window.JOT_removeAllListenersForName=function(c){for(var a=0;a<m.length;a++)m[a].eventName==c&&m.splice(a,1)};window.JOT_postEvent=function(c,a,b){var e={eventName:c,eventSrc:a||{},payload:b||{}};if(window.JOT_fullyLoaded)for(a=m.length,b=0;b<a&&b<m.length;b++){var f=m[b];f&&f.eventName==c&&(e.listenerCompId=f.compId||d,(f=typeof f.handler==h?f.handler:window[f.handler])&&f(e))}else window.JOT_delayedEvents.push({eventName:c,eventSrc:a,payload:b})};window.JOT_delayedEvents=[];
window.JOT_fullyLoaded=!1;window.JOT_formatRelativeToNow=function(c,a){var b=((new Date).getTime()-c)/6E4;if(1440<=b||0>b)return null;var e=0;60<=b&&(b/=60,e=2);2<=b&&e++;return a?window.JOT_siteRelTimeStrs[e].replace(g,Math.floor(b)):window.JOT_userRelTimeStrs[e].replace(g,Math.floor(b))}; })()
</script>
<script>

  

  var breadcrumbs = [{"path":"/blink","deleted":false,"title":"Blink","dir":"ltr"},{"path":"/blink/blink-in-js","deleted":false,"title":"Blink-in-JavaScript","dir":"ltr"}];
  var JOT_clearDotPath = 'https://ssl.gstatic.com/sites/p/56e332/system/app/images/cleardot.gif';

  
  var JOT_userRelTimeStrs = ["a minute ago","__duration__ minutes ago","an hour ago","__duration__ hours ago"];

  
  

  

  var webspace = {"enableAnalytics":true,"pageSharingId":"jotspot_page","enableUniversalAnalytics":false,"sharingPolicy":"OPENED_WITH_INDICATOR","siteTitle":"The Chromium Projects","isStartPageEnabled":true,"adsensePublisherId":null,"features":{"languageSelectDefaultTextSetToDefault":true,"validateClientGvizDataSourceUrls":true,"moreMobileStyleImprovements":true,"newInsertMenuIcons":true,"accessibleSortingButtons":true,"domainAnalyticsInGAOnly":true,"noCaptcha":true,"fileCabinetScreenReaderFix":true,"updatedTosAndPrivacyLinks":null,"pageDrafts":false,"mobileOrientationFix":true,"plusBadge":false,"pdfEmbedSupport":false,"jsClickFix":true},"isPublic":true,"isConsumer":false,"serverFlags":{"cajaBaseUrl":"//www.gstatic.com/caja","cajaDebugMode":false},"onepickBaseUrl":"https://docs.google.com","domainAnalyticsAccountId":"","plusPageId":"","signInUrl":"https://www.google.com/a/SelectSession?continue\u003dhttps://sites.google.com/a/chromium.org/dev/blink/blink-in-js\u0026service\u003djotspot","analyticsAccountId":"UA-5484340-1","scottyUrl":"/_/upload","homePath":"/","siteNoticeUrlEnabled":null,"plusPageUrl":"","adsensePromoClickedOrSiteIneligible":true,"csiReportUri":"https://gg.google.com/csi","sharingId":"jotspot","termsUrl":"//www.google.com/intl/en/policies/terms/","gvizVersion":1,"editorResources":{"sitelayout":["https://ssl.gstatic.com/sites/p/56e332/system/app/css/sitelayouteditor.css"],"text":["https://ssl.gstatic.com/sites/p/56e332/system/js/codemirror.js","https://ssl.gstatic.com/sites/p/56e332/system/app/css/codemirror_css.css","https://ssl.gstatic.com/sites/p/56e332/system/js/trog_edit__en.js","https://ssl.gstatic.com/sites/p/56e332/system/app/css/trogedit.css","/_/rsrc/1441580320000/system/app/css/editor.css","https://ssl.gstatic.com/sites/p/56e332/system/app/css/codeeditor.css","/_/rsrc/1441580320000/system/app/css/camelot/editor-jfk-wlb.css"]},"sharingUrlPrefix":"/_/sharing","isAdsenseEnabled":true,"domain":"chromium.org","baseUri":"","name":"dev","siteTemplateId":false,"siteNoticeRevision":null,"siteNoticeUrlAddress":null,"siteNoticeMessage":null,"page":{"isRtlLocale":false,"canDeleteWebspace":null,"isPageDraft":null,"parentPath":"/blink","parentWuid":"wuid:gx:1c15db3ef1df1880","siteLocale":"en","timeZone":"America/Los_Angeles","type":"text","title":"Blink-in-JavaScript","locale":"en","wuid":"wuid:gx:7b443a3f68cb59b4","revision":13,"path":"/blink/blink-in-js","isSiteRtlLocale":false,"pageInheritsPermissions":null,"name":"blink-in-js","canChangePath":true,"state":"","properties":{},"bidiEnabled":false,"currentTemplate":{"path":"/system/app/pagetemplates/text","title":"Web Page"}},"canPublishScriptToAnyone":true,"user":{"keyboardShortcuts":true,"sessionIndex":"","guest_":true,"displayNameOrEmail":"guest","userName":"guest","uid":"","renderMobile":false,"domain":"","namespace":"","hasWriteAccess":false,"namespaceUser":false,"primaryEmail":"guest","hasAdminAccess":false},"gadgets":{"baseUri":"/system/app/pages/gadgets"}};
  webspace.page.breadcrumbs = breadcrumbs;

  
  var JOT_siteRelTimeStrs = ["a minute ago","__duration__ minutes ago","an hour ago","__duration__ hours ago"];

</script>
<script type="text/javascript">
                window.jstiming.load.tick('scl');
              </script>
<meta name="title" content="Blink-in-JavaScript - The Chromium Projects" />
<meta itemprop="name" content="Blink-in-JavaScript - The Chromium Projects" />
<meta property="og:title" content="Blink-in-JavaScript - The Chromium Projects" />
<meta name="description" content="Home of the Chromium Open Source Project" />
<meta itemprop="description" content="Home of the Chromium Open Source Project" />
<meta id="meta-tag-description" property="og:description" content="Home of the Chromium Open Source Project" />
<style type="text/css">
</style>
<link rel="stylesheet" type="text/css" href="https://ssl.gstatic.com/sites/p/56e332/system/app/themes/beigeandblue/standard-css-beigeandblue-ltr-ltr.css" />
<link rel="stylesheet" type="text/css" href="../_/rsrc/1441580320000/system/app/css/overlay.css%3Fcb=beigeandblueundefineda100%2525%2525150goog-ws-leftthemedefaultstandard.css" />
<link rel="stylesheet" type="text/css" href="../_/rsrc/1441580320000/system/app/css/camelot/allthemes-view.css" />
<!--[if IE]>
          <link rel="stylesheet" type="text/css" href="/system/app/css/camelot/allthemes%2die.css" />
        <![endif]-->
<title>Blink-in-JavaScript - The Chromium Projects</title>
<meta itemprop="image" content="/_/rsrc/1438879449147/config/customLogo.gif?revision=3" />
<meta property="og:image" content="/_/rsrc/1438879449147/config/customLogo.gif?revision=3" />
<script type="text/javascript">
                window.jstiming.load.tick('cl');
              </script>
</head>
<body xmlns="http://www.google.com/ns/jotspot" id="body" class=" en            ">
<div id="sites-page-toolbar" class="sites-header-divider">
<div xmlns="http://www.w3.org/1999/xhtml" id="sites-status" class="sites-status" style="display:none;"><div id="sites-notice" class="sites-notice" role="status" aria-live="assertive"> </div></div>
</div>
<div id="sites-chrome-everything-scrollbar">
<div id="sites-chrome-everything" class="">
<div id="sites-chrome-page-wrapper" style="direction: ltr">
<div id="sites-chrome-page-wrapper-inside">
<div xmlns="http://www.w3.org/1999/xhtml" id="sites-chrome-header-wrapper" style="height:auto;">
<table id="sites-chrome-header" class="sites-layout-hbox" cellspacing="0" style="height:auto;">
<tr class="sites-header-primary-row" id="sites-chrome-userheader">
<td id="sites-header-title" class="" role="banner"><div class="sites-header-cell-buffer-wrapper"><a href="../index.html" id="sites-chrome-userheader-logo"><img id="logo-img-id" src="../_/rsrc/1438879449147/config/customLogo.gif%3Frevision=3" alt="The Chromium Projects" class="sites-logo  " /></a><h2><a href="../index.html" dir="ltr" id="sites-chrome-userheader-title">The Chromium Projects</a></h2></div></td><td class="sites-layout-searchbox  "><div class="sites-header-cell-buffer-wrapper"><form id="sites-searchbox-form" action="https://www.chromium.org/system/app/pages/search" role="search"><input type="hidden" id="sites-searchbox-scope" name="scope" value="search-site" /><input type="text" id="jot-ui-searchInput" name="q" size="20" value="" aria-label="Search this site" /><div id="sites-searchbox-button-set" class="goog-inline-block"><div role="button" id="sites-searchbox-search-button" class="goog-inline-block jfk-button jfk-button-standard" tabindex="0">Search this site</div></div></form></div></td>
</tr>
<tr class="sites-header-secondary-row" id="sites-chrome-horizontal-nav">
<td colspan="2" id="sites-chrome-header-horizontal-nav-container" role="navigation">
</td>
</tr>
</table>
</div>
<div id="sites-chrome-main-wrapper">
<div id="sites-chrome-main-wrapper-inside">
<table id="sites-chrome-main" class="sites-layout-hbox" cellspacing="0" cellpadding="{scmCellpadding}" border="0">
<tr>
<td id="sites-chrome-sidebar-left" class="sites-layout-sidebar-left initial" style="width:150px">
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_7648876402527094" class="sites-embed" role="navigation"><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotId="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="../chromium-projects.html" jotId="wuid:gx:10ae433dadbbab13" class="sites-navigation-link">Home</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="../Home.1.html" jotId="wuid:gx:43582b9d2029d3af" class="sites-navigation-link">Chromium</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="../chromium-os.1.html" jotId="wuid:gx:83df2ab1f8880ba" class="sites-navigation-link">Chromium OS</a></div></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_14720868319272995" class="sites-embed" role="navigation"><h4 class="sites-embed-title">Quick links</h4><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotId="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="../for-testers/bug-reporting-guidelines.html" class="sites-navigation-link">Report bugs</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="../developers/discussion-groups.html" class="sites-navigation-link">Discuss</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="../system/app/pages/sitemap/hierarchy.html" jotId="wuid:gx:4b58a9a350ad12f" class="sites-navigation-link">网站地图</a></div></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_19690813310444355" class="sites-embed" role="navigation"><h4 class="sites-embed-title">Other sites</h4><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotId="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="http://blog.chromium.org/" class="sites-navigation-link">Chromium Blog</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="http://code.google.com/chrome/extensions/" class="sites-navigation-link">Google Chrome Extensions</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="https://developers.google.com/chrome/chrome-frame/" class="sites-navigation-link">Google Chrome Frame</a></div></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_19695218559354544" class="sites-embed" role="complementary"><h4 class="sites-embed-title"></h4><div class="sites-embed-content sites-embed-content-sidebar-textbox"><div dir="ltr"><span style="font-size:x-small">Except as otherwise </span><a href="http://developers.google.com/site-policies.html#restrictions"><span style="font-size:x-small">noted</span></a><span style="font-size:x-small">, the content of this page is licensed under a </span><a href="http://creativecommons.org/licenses/by/2.5/"><span style="font-size:x-small">Creative Commons Attribution 2.5 license</span></a><span style="font-size:x-small">, and examples are licensed under the </span><a href="http://src.chromium.org/viewvc/chrome/trunk/src/LICENSE" target="_blank"><span style="font-size:x-small">BSD License</span></a><span style="font-size:x-small">.<br /></span></div></div></div>
</td>
<td id="sites-canvas-wrapper">
<div id="sites-canvas" role="main">
<div id="goog-ws-editor-toolbar-container"> </div>
<div xmlns="http://www.w3.org/1999/xhtml" id="title-crumbs" style="">
<A href="../blink.1.html" dir="ltr">Blink</A>‎ &gt; ‎
  </div>
<h3 xmlns="http://www.w3.org/1999/xhtml" id="sites-page-title-header" style="" align="left">
<span id="sites-page-title" dir="ltr" tabindex="-1" style="outline: none">Blink-in-JavaScript</span>
</h3>
<div id="sites-canvas-main" class="sites-canvas-main">
<div id="sites-canvas-main-content">
<table xmlns="http://www.w3.org/1999/xhtml" cellspacing="0" class="sites-layout-name-one-column sites-layout-hbox"><tbody><tr><td class="sites-layout-tile sites-tile-name-content-1"><div dir="ltr"><h2><a name="TOC-Overview"></a>Overview</h2><div><b><i>Blink-in-JavaScript</i></b> is a mechanism to enable Blink developers to implement DOM features in JavaScript (instead of C++). The goal of Blink-in-JS is to improve web layering by implementing high-level DOM features on top of existing web-exposed APIs. <span style="font-size:10pt;background-color:transparent">You can learn the design in </span><a href="https://docs.google.com/a/google.com/document/d/13cT9Klgvt_ciAR3ONGvzKvw6fz9-f6E0FrqYFqfoc8Y/edit#" style="font-size:10pt;background-color:transparent">this design document</a><span style="font-size:10pt;background-color:transparent"> and </span><a href="https://docs.google.com/a/google.com/presentation/d/1XvZdAF29Fgn19GCjDhHhlsECJAfOR49tpUFWrbtQAwU/edit#slide=id.g3840fe06e_00" style="font-size:10pt;background-color:transparent">this slide</a><span style="font-size:10pt;background-color:transparent">. If you are interested in the security model, you can also look at </span><a href="https://docs.google.com/a/google.com/document/d/1AtnKpzQaSY3Mo1qTm68mt_3DkcZzrp_jcGS92a3a1UU/edit" style="font-size:10pt;background-color:transparent">this document</a><span style="font-size:10pt;background-color:transparent">.</span></div><div><br /></div><div><h2><a name="TOC-Guideline"></a>Guideline</h2></div><div><div style="font-family:arial,sans-serif">When you want to implement a feature in Blink-in-JS, you need to follow the following guideline.</div><div><ol><li style="font-family:arial,sans-serif"><span style="font-size:10pt;background-color:transparent">If you plan to implement a feature in Blink-in-JS, you need to send an Intent-to-Implement to blink-dev@. The Intent-to-Implement should explain the advantages of the Blink-in-JS and have a list of private script APIs that will be required for the Blink-in-JS. (**)</span></li><li><span style="font-family:arial,sans-serif;font-size:10pt;background-color:transparent">You are strongly discouraged to use private script APIs. If you need to add a private script API, you need to provide a justification for the API and get an LGTM from one API owner (***). The API must meet either of the following conditions:</span></li></ol><span style="font-family:arial,sans-serif;font-size:10pt;background-color:transparent"><ul><ul><li><span style="font-size:10pt;background-color:transparent">The API is a missing part of the current web and going to be exposed to the web in the future.</span></li><li><span style="font-size:10pt;background-color:transparent">The API is for supporting a will-be-deprecated feature.</span></li></ul></ul></span></div><div style="font-family:arial,sans-serif">(*) See <a href="https://docs.google.com/a/chromium.org/presentation/d/1-5wpqeIltM40DAZdQBhbqnzOZuFNezS4eUfx1T4YV50/edit#slide=id.g437b0e633_00">this slide</a> for a background of this guideline.</div><div style="font-family:arial,sans-serif"><br /></div><div style="font-family:arial,sans-serif">(**) The fact that we’re lowering the priority of Blink-in-JS means that we are going to be conservative about accepting your Intent-to-Implement. It is important to consider if your Blink-in-JS work has higher impact than other projects you could work on alternately. The Intent-to-Implement must provide clear advantages of why you think it is important for Blink to implement the feature in Blink-in-JS. For example, the following Intent-to-Implements look appealing:</div><div style="font-family:arial,sans-serif"><ul><li><span style="font-size:10pt;background-color:transparent">I need to implement MediaControls for Android. There are two options for us: implement it in C++ or implement it in JS. Given that MediaControls is a self-contained and high-level feature that can be developed on top of existing web-exposed API, I propose to implement MediaControls in Blink-in-JS. It is easier to develop and maintain.</span></li><li><span style="font-size:10pt;background-color:transparent">XMLViewer is already written in JS and it is invoked using direct V8 APIs. Given that Blink-in-JS has a safer mechanism to run JS in Blink, I propose to move XMLViewer to Blink-in-JS.</span></li><li><span style="font-size:10pt;background-color:transparent">I plan to make a substantial restructuring of the rendering system for performance. I noticed that marquee-specific code in the rendering system prevents us from making the restructuring. Given that marquee is an out-dated feature, I want to just factor out the implementation to Blink-in-JS instead of supporting the marquee-specific code in the new rendering system.</span></li></ul></div><div style="font-family:arial,sans-serif">On the other hand, the following Intent-to-Implement would not be appealing:</div><div style="font-family:arial,sans-serif"><ul><li><span style="font-size:10pt;background-color:transparent">HTMLFormControls are self-contained and it is not hard to move the implementation to Blink-in-JS. The benefit is that we can remove a bunch of code from C++. However, I’m not sure if HTMLFormControls is an actively developed area and thus it’s not clear at this point how helpful it is for on-going Blink projects.</span></li></ul></div><div style="font-family:arial,sans-serif">(Note: These are just examples and not intending to imply go or non-go of MediaControls-in-JS etc)</div><div style="font-family:arial,sans-serif"><br /></div><div style="font-family:arial,sans-serif">(***) It is a good idea to ask review for dglazkov@ (API owner), jochen@ (API owner), haraken@ and area experts of the API.</div></div><div><br /></div><div><div><div><div></div></div></div></div><h2><a name="TOC-Basics"></a>Basics</h2><div><span style="font-size:10pt;background-color:transparent">The most common usage of Blink-in-JS is to implement DOM features defined in an IDL file in JavaScript. For example, consider to implement a &lt;marquee&gt; tag in Blink-in-JS.</span></div><div><span style="font-size:10pt;background-color:transparent"><br /></span></div><div><span style="font-size:10pt;background-color:transparent">In this case, what you need to do is just to:</span></div><div><ul><li>Add [ImplementedInPrivateScript] IDL extended attributes to DOM attributes/methods in an IDL file.</li><li>Implement the DOM attributes/methods in JavaScript (This JavaScript file is called a <i><b>private script</b></i>.)</li></ul></div><div>Specifically, you first need to add <span style="font-size:10pt;background-color:transparent">[ImplementedInPrivateScript] IDL extended attributes to DOM attributes/methods</span><span style="font-size:10pt;background-color:transparent"> in <a href="https://code.google.com/p/chromium/codesearch#chromium/src/third_party/WebKit/Source/core/html/HTMLMarqueeElement.idl&amp;q=htmlmarqueeelement.idl&amp;sq=package:chromium&amp;type=cs">HTMLMarqueeElement.idl</a>.</span></div><br /><div class="sites-codeblock sites-codesnippet-block"><code>interface HTMLMarqueeElement : HTMLElement {</code><br /><code>  [ImplementedInPrivateScript] void start();</code><br /><code>  [ImplementedInPrivateScript] void stop();</code><br /><code>  [ImplementedInPrivateScript] attribute long loop;</code><br /><code>  [ImplementedInPrivateScript] attribute long scrollAmount;</code><br /><code>  ...;</code><br /><code>};</code><br /><div></div></div><br /><div><span style="font-size:10pt;background-color:transparent">Second, you need to implement the DOM attributes/methods in </span><a href="https://code.google.com/p/chromium/codesearch#chromium/src/third_party/WebKit/Source/core/html/HTMLMarqueeElement.js&amp;sq=package:chromium&amp;type=cs" style="font-size:10pt;background-color:transparent">HTMLMarqueeElement.js</a><span style="font-size:10pt;background-color:transparent">.</span></div><div><br /></div><div></div><div class="sites-codeblock sites-codesnippet-block"><div><code>installClass("HTMLMarqueeElement", function(HTMLMarqueeElementPrototype)) {</code></div><div><span style="font-size:10pt;background-color:transparent"><br /></span></div><div><span style="font-size:10pt;background-color:transparent"><code>  HTMLMarqueeElementPrototype.start = function() {</code></span></div><div><span style="font-size:10pt;background-color:transparent"><code>    // Implement the start() method.</code></span></div><div><span style="font-size:10pt;background-color:transparent"><code>    // |this| object is equal to the wrapper of the &lt;marquee&gt; element.</code></span></div><div><span style="font-size:10pt;background-color:transparent"><code>  }</code></span></div><div><span style="font-size:10pt;background-color:transparent"><br /></span></div><div><span style="font-size:10pt;background-color:transparent"><code>  </code></span><span style="font-size:10pt;background-color:transparent"><code>Object.defineProperty(HTMLMarqueeElementPrototype, 'loop', {</code></span></div><div><code>      get: function() {</code></div><div><span style="font-size:10pt;background-color:transparent"><code>        // Implement the getter of the loop attribute.</code></span></div><div><span style="font-size:10pt;background-color:transparent"><code>        // |this| object is equal to the wrapper of the &lt;marquee&gt; element.</code></span></div><div><span style="font-size:10pt;background-color:transparent"><code>      },</code></span></div><div><code>      set: function(value) {</code></div><div><span style="font-size:10pt;background-color:transparent"><code>        // Implement the setter of the loop attribute.</code></span></div><div><span style="font-size:10pt;background-color:transparent"><code>        // |this| object is equal to the wrapper of the &lt;marquee&gt; element.</code></span></div><div><span style="font-size:10pt;background-color:transparent"><code>      },</code></span></div><div><code>  });</code></div><div><br /></div><div><code>  ...; // Implement other DOM attributes/methods.</code></div><div><br /></div><div><span style="font-size:10pt;background-color:transparent"><code>};</code></span></div><div></div></div><div><br /></div><div>That's it. Then the IDL compiler auto-generates the binding code that connects user's script with the JavaScript functions defined in the private script.</div><div><br /></div><div>The important points are as follows:</div><div><ul><li>A private script runs in a dedicated isolated world. For security reasons, no JavaScript objects nor DOM wrappers are shared between the private script and user's script. This restriction is needed to prevent the private script from leaking confidential information to user's script.</li><li>To force the restriction, the type of arguments you can pass from user's script to the private script is limited to JavaScript primitive types (e.g., int, double, string, boolean etc) and DOM wrappers. Similarly, the type you can return from the private script back to user's script is limited to JavaScript primitive types and DOM wrappers. You cannot pass JavaScript functions, JavaScript objects, Promises etc.</li><li>|global| is a window object of the private script. You can use the |global| object as you like, but note that the |global| object is shared among all private scripts. For example, HTMLMarqueeElement.js and XSLT.js share the same |global| object. Thus you should not cache data specific to your private script onto the |global| object.</li><li>|HTMLMarqueeElementPrototype| is a prototype object of the private script. Your main work is to define DOM attributes/methods on the prototype object.</li><li>|this| object is equal to the wrapper of the &lt;marquee&gt; element in the isolated world for private scripts. Due to the security isolation, |this| object is a different wrapper from the wrapper of the &lt;marquee&gt; element in the main world. You can cache whatever you want onto the |this| object. It is guaranteed that the |this| object is not accessible from user's script.</li><li><div>By default, the IDL compiler assumes that you have <span style="font-size:10pt;background-color:transparent">HTMLMarqueeElement.h in Blink. </span><span style="font-size:10pt;background-color:transparent">If you don't want to have HTMLMarqueeElement.h, you need to add [NoImplHeader] IDL attribute on the interface.</span></div></li><li>|this| object has the following prototype chain: |this| --&gt; HTMLMarqueeElementPrototype --&gt; HTMLMarqueeElement.prototype --&gt; HTMLElement.prototype --&gt; Element.prototype --&gt; Node.prototype --&gt; ....</li></ul><div>For more details, you can look at how <a href="https://code.google.com/p/chromium/codesearch#chromium/src/third_party/WebKit/Source/core/html/HTMLMarqueeElement.js&amp;sq=package:chromium&amp;type=cs">HTMLMarqueeElement.js</a> and <a href="https://code.google.com/p/chromium/codesearch#chromium/src/third_party/WebKit/Source/core/testing/PrivateScriptTest.js&amp;q=privatescripttest.js&amp;sq=package:chromium&amp;type=cs">PrivateScriptTest.js</a> are implemented.</div></div><div><br /></div><div><h2><a name="TOC-Details"></a>Details</h2><div>By using the [ImplementedInPrivateScript] IDL extended attribute, you can implement DOM features exposed to the web in a private script. However, this is sometimes not sufficient to implement real-world DOM features in a private script. Sometimes you will need to invoke a private script from C++. Sometimes you will need to implement internal DOM attributes/methods that are only exposed to private scripts.</div><div><br /></div></div><div>In general, Blink-in-JS supports the following four kinds of APIs.</div><div><ul><li><span style="font-size:10pt;background-color:transparent">[user's script &amp; private script =&gt; C++]: This is a normal DOM attribute/method (where Blink-in-JS is not involved). The DOM attribute/method is implemented in C++, and the DOM attribute/method is exposed to both user's script and private scripts.</span></li><li>[user's script &amp; private script =&gt; private script]: This is the most common usage of Blink-in-JS explained above. The DOM attribute/method is implemented in a private script, and the DOM attribute/method is exposed to both user's script and private scripts.</li><li>[private script =&gt; C++]: This is an "internal" DOM attribute/method for private scripts. The DOM attribute/method is implemented in C++, and the DOM attribute/method is exposed only to private scripts (not exposed to user's script).</li><li>[C++ =&gt; private script]: This is a way to invoke a private script from C++. The DOM attribute/method is implemented in a private script, and a C++ static function is provided to invoke the DOM attribute/method so that Blink can use it wherever it wants.</li></ul><div>You can control the kind of each API by combining the [ImplementedInPrivateScript] IDL extended attribute and [OnlyExposedToPrivateScript] IDL attribute.</div></div><div><ul><li><span style="font-size:10pt;background-color:transparent">[user's script &amp; private script =&gt; C++]: Use no IDL extended attributes.</span></li><li>[user's script &amp; private script =&gt; private script]: Use [ImplementedInPrivateScript].</li><li>[private script =&gt; C++]: Use [OnlyExposedToPrivateScript].</li><li>[C++ =&gt; private script]: Use [ImplementedInPrivateScript, OnlyExposedToPrivateScript].</li></ul><div>Here is an example:</div></div><div><br /></div><div></div><div class="sites-codeblock sites-codesnippet-block"><div><code>interface XXX {</code></div><div><code>  void f1();  // Normal DOM method implemented in C++; exposed to user's script and private scripts.</code></div><div><code>  [ImplementedInPrivateScript] void f2();  // DOM method implemented in a private script; exposed to user's script and private scripts.</code></div><div><code>  [OnlyExposedToPrivateScript] void f3();  // DOM method implemented in C++; exposed only to private scripts.</code></div><div><code>  [</code><span style="color:rgb(0,96,0);font-family:monospace;line-height:1;font-size:10pt">ImplementedInPrivateScript, </span><span style="color:rgb(0,96,0);font-family:monospace;line-height:1;font-size:10pt">OnlyExposedToPrivateScript] void f4();  // DOM method implemented in a private script; V8XXX::PrivateScript::f4Method() is provided as a static method so that Blink can invoke the private script.</span></div><div><span style="color:rgb(0,96,0);line-height:1;font-size:10pt">};</span></div><div></div></div><br /><div>For more details, see test cases in <a href="https://code.google.com/p/chromium/codesearch#chromium/src/third_party/WebKit/Source/core/testing/PrivateScriptTest.idl&amp;sq=package:chromium&amp;type=cs">PrivateScriptTest.idl</a>.</div><div><br /></div><div>DOM attributes/methods that have <span style="font-size:10pt;background-color:transparent">[OnlyExposedToPrivateScript] IDL attribute are "backdoors". <b>Backdoors are strongly discouraged</b> unless you are certain that the backdoors are APIs that are missing in the current web platform and should be exposed to the web in the future. Ideally Blink-in-JS should be implemented only by using existing web platform APIs. The only case where backdoors are allowed is a case where we think that the API is a missing part of the current web platform and should be exposed to the web in the future. (One of the goals of Blink-in-JS is to understand what APIs are missing in the web platform by trying to implement built-in contents of Blink in JavaScript.)</span></div><div><span style="font-size:10pt;background-color:transparent"><br /></span></div><div><br /></div><h2><a name="TOC-Where-Your-Private-Script-lives-"></a>Where Your Private Script lives?</h2><div>Your private script lives in <code>blink_resources.pak</code> in <code>out/<i>config</i>/gen/blink/public/resources/</code>, which is generated by <a href="https://chromium.googlesource.com/chromium/blink/+/master/public/blink_resources.gyp"><code>blink_resouces.gyp</code></a>, then it repacked into <code>content_shell.pak</code>, <code>resources.pak</code> and so.</div><div>So, you need to do following steps putting your private script into resource file:</div><div><ol><li>Change <a href="https://chromium.googlesource.com/chromium/blink/+/master/public/blink_resources.grd"><code>blink_resources.grd</code></a> in Blink repository to include your private script, e.g. <a href="http://crrev.com/570863002">crrev/570863002</a></li><ul><li>Since we also need to change file in Chromium repository, I recommend to create dummy file and check-in this before reviewing your private script.</li></ul><li>Change <a href="https://chromium.googlesource.com/chromium/src/+/master/content/child/blink_platform_impl.cc"><code>content/child/blink_platform_impl.cc</code></a> in Chromium repository, e.g. <a href="http://crrev.com/556793006">crrev/556793006</a></li><ul><li><span style="font-size:10pt;background-color:transparent"><b>You should wait step #1 blink change is rolled into Chromium rather than landed into blink repository.</b></span></li></ul></ol></div><div>Note: Due to <a href="http://crbug.com/415908">crbug/415908</a>, blink_resources.pak isn't rebuild when your private script file changed. You may want to remove it, <code>out/Debug/gen/blink/public/resources/blink_resources.pak</code>.</div><div><br /></div><div><br /></div><div><h2><a name="TOC-Contacts"></a>Contacts</h2></div><div>If you have any questions or comments, feel to free to ask haraken@. I'm planning to factor out more things from C++ to Blink-in-JS to improve the hackability of the Blink core. Your contributions are super welcome!</div><div><br /></div></div></td></tr></tbody></table>
</div> 
</div> 
<div id="sites-canvas-bottom-panel">
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_page-subpages"> </div>
<div id="sites-attachments-container">
</div>
<a xmlns="http://www.w3.org/1999/xhtml" name="page-comments"></a>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_page-comments"><div class="sites-comment-docos-wrapper"><div class="sites-comment-docos"><div class="sites-comment-docos-background"></div><div class="sites-comment-docos-header"><div class="sites-comment-docos-header-title">Comments</div></div><div id="sites-comment-docos-pane" class="sites-comment-docos-pane"></div></div></div></div>
</div>
</div> 
</td> 
</tr>
</table> 
</div> 
</div> 
<div id="sites-chrome-footer-wrapper">
<div id="sites-chrome-footer-wrapper-inside">
<div id="sites-chrome-footer">
</div>
</div>
</div>
</div> 
</div> 
<div id="sites-chrome-adminfooter-container">
<div xmlns="http://www.w3.org/1999/xhtml" class="sites-adminfooter" role="navigation"><p><a class="sites-system-link" href="https://www.google.com/a/UniversalLogin?service=jotspot&amp;continue=https://sites.google.com/a/chromium.org/dev/blink/blink-in-js">Sign in</a><span aria-hidden="true">|</span><a class="sites-system-link" href="../system/app/pages/recentChanges.html">Recent Site Activity</a><span aria-hidden="true">|</span><a class="sites-system-link" href="../system/app/pages/reportAbuse.html" target="_blank">Report Abuse</a><span aria-hidden="true">|</span><a class="sites-system-link" href="javascript:;" onclick="window.open(webspace.printUrl)">Print Page</a><span aria-hidden="true">|</span><span class="sites-system-link">Powered By</span> <b class="powered-by"><a href="http://sites.google.com">Google Sites</a></b></p></div>
</div>
</div> 
</div> 
<div id="sites-chrome-onebar-footer">
</div>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    window.jstiming.load.tick('sjl');
  </script>
<script xmlns="http://www.w3.org/1999/xhtml" src="https://ssl.gstatic.com/sites/p/56e332/system/js/jot_min_view__en.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    window.jstiming.load.tick('jl');
  </script>
<script xmlns="http://www.w3.org/1999/xhtml">
      
          sites.core.Analytics.createTracker();
          sites.core.Analytics.trackPageview();
        
    </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
                    sites.Searchbox.initialize(
                        'sites-searchbox-search-button',
                        {"object":[]}['object'],
                        'search-site',
                        {"label":"Configure search options...","url":"/system/app/pages/admin/settings"});
                  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
      gsites.HoverPopupMenu.createSiteDropdownMenus('sites-header-nav-dropdown', false);
    </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
            JOT_setupNav("7648876402527094", "Navigation", false);
            JOT_addListener('titleChange', 'JOT_NAVIGATION_titleChange', 'COMP_7648876402527094');
          </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
            JOT_setupNav("14720868319272995", "Quick links", false);
            JOT_addListener('titleChange', 'JOT_NAVIGATION_titleChange', 'COMP_14720868319272995');
          </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
            JOT_setupNav("19690813310444355", "Other sites", false);
            JOT_addListener('titleChange', 'JOT_NAVIGATION_titleChange', 'COMP_19690813310444355');
          </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
              new sites.CommentPane('//docs.google.com/comments/d/AAHRpnXvrAwjAfmld0ObrebBiGRq93DNTfTxWU3KcUWVOxrRhNKcoJ3WstTHxjQOnmQnZt261HB4vECGlCwMy00OORZK-X7JWxzCNnYCH6xqc0iS50SXYeLLmoVk9jorTQhWPeUFlIuwe/api/js?anon=true',
                  false, false);
            </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
  setTimeout(function() {
    var fingerprint = gsites.date.TimeZone.getFingerprint([]);
    gsites.Xhr.send('https://www.chromium.org/_/tz', null, null, 'GET', null, null, { afjstz: fingerprint });
  }, 500);
</script>
<script xmlns="http://www.w3.org/1999/xhtml">
                    window.onload = function() {
                      if (false) {
                        JOT_setMobilePreview();
                      }
                      var loadTimer = window.jstiming.load;
                      loadTimer.tick("ol");
                      loadTimer["name"] = "load," + webspace.page.type + ",user_page";
                      window.jstiming.report(loadTimer, {}, 'https://gg.google.com/csi');
                    }
                  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
        JOT_insertAnalyticsCode(false,
            false);
      </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    var maestroRunner = new gsites.pages.view.SitesMaestroRunner(
        webspace, "en");
    maestroRunner.initListeners();
    maestroRunner.installEditRender();
  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
  //<![CDATA[
    // Decorate any fastUI buttons on the page with a class of 'goog-button'.
    if (webspace.user.hasWriteAccess) {
      JOT_decorateButtons();
    }

    // Fires delayed events.
    (function() {
      JOT_fullyLoaded = true;
      var delayedEvents = JOT_delayedEvents;
      for (var x = 0; x < delayedEvents.length; x++) {
        var event = delayedEvents[x];
        JOT_postEvent(event.eventName, event.eventSrc, event.payload);
      }
      JOT_delayedEvents = null;
      JOT_postEvent('pageLoaded');
    })();
  //]]>
</script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    JOT_postEvent('decorateGvizCharts');
  </script>
<script type="text/javascript">
          JOT_setupPostRenderingManager();
        </script>
<script type="text/javascript">
          JOT_postEvent('renderPlus', null, 'sites-chrome-main');
        </script>
<div id="server-timer-div" style="display:none"> </div>
<script type="text/javascript">
          window.jstiming.load.tick('render');
          JOT_postEvent('usercontentrendered', this);
        </script>
</body>
</html>
